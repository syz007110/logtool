{"version":3,"file":"js/619.73292b69.js","mappings":"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","sources":["webpack://logtool-frontend/./src/views/Roles.vue","webpack://logtool-frontend/./src/views/Roles.vue?cb65"],"sourcesContent":["<template>\r\n  <div class=\"roles-container\">\r\n    <!-- 操作栏 -->\r\n    <div class=\"action-bar\">\r\n      <el-button type=\"primary\" @click=\"showAddDialog = true\">\r\n        <el-icon><Plus /></el-icon>\r\n        添加角色\r\n      </el-button>\r\n    </div>\r\n    \r\n    <!-- 角色列表 -->\r\n    <el-card class=\"list-card\">\r\n      <el-table\r\n        :data=\"roles\"\r\n        :loading=\"loading\"\r\n        style=\"width: 100%\"\r\n        v-loading=\"loading\"\r\n      >\r\n        <el-table-column prop=\"name\" label=\"角色名称\" width=\"150\" />\r\n        <el-table-column prop=\"description\" label=\"角色描述\" show-overflow-tooltip />\r\n        <!-- 移除权限列 -->\r\n        <el-table-column label=\"操作\" width=\"150\" fixed=\"right\">\r\n          <template #default=\"{ row }\">\r\n            <el-button \r\n              size=\"small\" \r\n              @click=\"handleEdit(row)\"\r\n            >\r\n              编辑\r\n            </el-button>\r\n            <el-button \r\n              size=\"small\" \r\n              type=\"danger\" \r\n              @click=\"handleDelete(row)\"\r\n            >\r\n              删除\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </el-card>\r\n    \r\n    <!-- 添加/编辑角色对话框 -->\r\n    <el-dialog\r\n      v-model=\"showAddDialog\"\r\n      :title=\"editingRole ? '编辑角色' : '添加角色'\"\r\n      width=\"600px\"\r\n    >\r\n      <el-form\r\n        ref=\"roleFormRef\"\r\n        :model=\"roleForm\"\r\n        :rules=\"rules\"\r\n        label-width=\"100px\"\r\n      >\r\n        <el-form-item label=\"角色名称\" prop=\"name\">\r\n          <el-input v-model=\"roleForm.name\" />\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"角色描述\" prop=\"description\">\r\n          <el-input\r\n            v-model=\"roleForm.description\"\r\n            type=\"textarea\"\r\n            :rows=\"3\"\r\n          />\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"权限\" prop=\"permissions\">\r\n          <el-checkbox-group v-model=\"roleForm.permissions\">\r\n            <el-row :gutter=\"20\">\r\n              <el-col :span=\"12\" v-for=\"(group, groupName) in permissionGroups\" :key=\"groupName\" style=\"margin-bottom: 10px;\">\r\n                <h4>{{ groupName }}</h4>\r\n                <el-checkbox v-for=\"perm in group\" :key=\"perm.name\" :value=\"perm.name\">\r\n                  {{ perm.name }}\r\n                </el-checkbox>\r\n              </el-col>\r\n            </el-row>\r\n          </el-checkbox-group>\r\n        </el-form-item>\r\n      </el-form>\r\n      \r\n      <template #footer>\r\n        <el-button @click=\"showAddDialog = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleSave\" :loading=\"saving\">\r\n          保存\r\n        </el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport api from '../api'\r\n\r\nexport default {\r\n  name: 'Roles',\r\n  setup() {\r\n    const store = useStore()\r\n    \r\n    // 响应式数据\r\n    const loading = ref(false)\r\n    const saving = ref(false)\r\n    const showAddDialog = ref(false)\r\n    const editingRole = ref(null)\r\n    const permissions = ref([])\r\n    \r\n    const roleFormRef = ref(null)\r\n    const roleForm = reactive({\r\n      name: '',\r\n      description: '',\r\n      permissions: []\r\n    })\r\n    \r\n    const rules = {\r\n      name: [\r\n        { required: true, message: '请输入角色名称', trigger: 'blur' }\r\n      ],\r\n      description: [\r\n        { required: true, message: '请输入角色描述', trigger: 'blur' }\r\n      ]\r\n    }\r\n    \r\n    // 计算属性\r\n    const roles = computed(() => store.getters['users/rolesList'])\r\n\r\n    const permissionGroups = computed(() => {\r\n      const groups = {}\r\n      for (const p of permissions.value) {\r\n        const key = (p.name.includes(':') ? p.name.split(':')[0] : '其他')\r\n        if (!groups[key]) groups[key] = []\r\n        groups[key].push(p)\r\n      }\r\n      return groups\r\n    })\r\n    \r\n    // 方法\r\n    const loadRoles = async () => {\r\n      loading.value = true\r\n      try {\r\n        await store.dispatch('users/fetchRoles')\r\n      } catch (error) {\r\n        ElMessage.error('加载角色失败')\r\n      } finally {\r\n        loading.value = false\r\n      }\r\n    }\r\n\r\n    const loadPermissions = async () => {\r\n      try {\r\n        const res = await api.permissions.getList()\r\n        permissions.value = res.data.permissions || []\r\n      } catch (e) {\r\n        ElMessage.error('加载权限清单失败')\r\n      }\r\n    }\r\n    \r\n    const resetForm = () => {\r\n      Object.assign(roleForm, {\r\n        name: '',\r\n        description: '',\r\n        permissions: []\r\n      })\r\n      editingRole.value = null\r\n    }\r\n    \r\n    const handleEdit = (row) => {\r\n      editingRole.value = row\r\n      Object.assign(roleForm, {\r\n        name: row.name,\r\n        description: row.description,\r\n        permissions: row.permissions || []\r\n      })\r\n      showAddDialog.value = true\r\n    }\r\n    \r\n    const handleDelete = async (row) => {\r\n      try {\r\n        await ElMessageBox.confirm('确定要删除这个角色吗？', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        })\r\n        await store.dispatch('users/deleteRole', row.id)\r\n        ElMessage.success('删除成功')\r\n        loadRoles()\r\n      } catch (error) {\r\n        if (error !== 'cancel') {\r\n          ElMessage.error('删除失败')\r\n        }\r\n      }\r\n    }\r\n    \r\n    const handleSave = async () => {\r\n      try {\r\n        saving.value = true\r\n        if (editingRole.value) {\r\n          await store.dispatch('users/updateRole', {\r\n            id: editingRole.value.id,\r\n            data: roleForm\r\n          })\r\n          ElMessage.success('更新成功')\r\n        } else {\r\n          await store.dispatch('users/createRole', roleForm)\r\n          ElMessage.success('添加成功')\r\n        }\r\n        showAddDialog.value = false\r\n        resetForm()\r\n        loadRoles()\r\n      } catch (error) {\r\n        ElMessage.error('保存失败')\r\n      } finally {\r\n        saving.value = false\r\n      }\r\n    }\r\n    \r\n    onMounted(() => {\r\n      loadRoles()\r\n      loadPermissions()\r\n    })\r\n    \r\n    return {\r\n      loading,\r\n      saving,\r\n      showAddDialog,\r\n      editingRole,\r\n      roleForm,\r\n      roleFormRef,\r\n      rules,\r\n      roles,\r\n      permissions,\r\n      permissionGroups,\r\n      handleEdit,\r\n      handleDelete,\r\n      handleSave\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.roles-container {\r\n  height: 100%;\r\n}\r\n\r\n.action-bar {\r\n  margin-bottom: 20px;\r\n  padding: 20px;\r\n  background: white;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.list-card {\r\n  margin-bottom: 20px;\r\n}\r\n\r\nh4 {\r\n  margin: 10px 0;\r\n  color: #333;\r\n  font-size: 14px;\r\n}\r\n\r\n.el-checkbox {\r\n  display: block;\r\n  margin-bottom: 8px;\r\n}\r\n</style> ","import { render } from \"./Roles.vue?vue&type=template&id=065c4e25&scoped=true\"\nimport script from \"./Roles.vue?vue&type=script&lang=js\"\nexport * from \"./Roles.vue?vue&type=script&lang=js\"\n\nimport \"./Roles.vue?vue&type=style&index=0&id=065c4e25&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-065c4e25\"]])\n\nexport default __exports__"],"names":["class","type","showAddDialog","data","roles","loading","style","prop","label","width","fixed","default","row","size","handleEdit","handleDelete","title","editingRole","footer","handleSave","saving","ref","model","roleForm","rules","name","description","rows","permissions","gutter","permissionGroups","group","groupName","span","key","perm","value","setup","store","roleFormRef","required","message","trigger","getters","groups","p","includes","split","push","loadRoles","async","dispatch","error","loadPermissions","res","api","getList","e","resetForm","Object","assign","confirm","confirmButtonText","cancelButtonText","id","success","__exports__","render"],"sourceRoot":""}