"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[95,113,783],{3095:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var l=a(641),i=a(33);const s={class:"card"},o={class:"uploader"},n={class:"card",style:{"margin-top":"24px"}},r=["src"];function d(e,t,a,d,u,c){const p=(0,l.g2)("el-input"),g=(0,l.g2)("el-form-item"),m=(0,l.g2)("Plus"),b=(0,l.g2)("el-icon"),f=(0,l.g2)("el-upload"),v=(0,l.g2)("el-button"),k=(0,l.g2)("el-form"),h=(0,l.g2)("FeedbackList"),_=(0,l.g2)("el-dialog"),w=(0,l.g2)("FeedbackDetail");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",s,[t[6]||(t[6]=(0,l.Lk)("div",{class:"card-title"},"缺陷提交",-1)),(0,l.bF)(k,{model:d.form,rules:d.rules,ref:"formRef","label-width":"90px"},{default:(0,l.k6)(()=>[(0,l.bF)(g,{label:"标题",prop:"title"},{default:(0,l.k6)(()=>[(0,l.bF)(p,{modelValue:d.form.title,"onUpdate:modelValue":t[0]||(t[0]=e=>d.form.title=e),type:"text",placeholder:"请填写问题标题（100字以内）",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,l.bF)(g,{label:"描述",prop:"description"},{default:(0,l.k6)(()=>[(0,l.bF)(p,{modelValue:d.form.description,"onUpdate:modelValue":t[1]||(t[1]=e=>d.form.description=e),type:"textarea",rows:5,placeholder:"请描述遇到的问题（500字以内）",maxlength:"500","show-word-limit":"",onInput:d.onDescInput},null,8,["modelValue","onInput"])]),_:1}),(0,l.bF)(g,{label:"图片",prop:"images"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",o,[(0,l.bF)(f,{class:(0,i.C4)(["upload",{"no-trigger":d.fileList.length>=3}]),action:"#","auto-upload":!1,limit:3,"on-exceed":d.onExceed,"before-upload":d.beforeUpload,"http-request":d.noop,"list-type":"picture-card","file-list":d.fileList,"on-remove":d.handleRemove,"on-change":d.handleChange},{default:(0,l.k6)(()=>[d.fileList.length<3?((0,l.uX)(),(0,l.Wv)(b,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(m)]),_:1})):(0,l.Q3)("",!0)]),_:1},8,["class","on-exceed","before-upload","http-request","file-list","on-remove","on-change"]),t[4]||(t[4]=(0,l.Lk)("div",{class:"tips"},"支持 JPG/PNG/WebP，单张≤2MB，最多3张",-1))])]),_:1}),(0,l.bF)(g,null,{default:(0,l.k6)(()=>[(0,l.bF)(v,{type:"primary",loading:d.submitting,onClick:d.submit},{default:(0,l.k6)(()=>t[5]||(t[5]=[(0,l.eW)("提交")])),_:1,__:[5]},8,["loading","onClick"])]),_:1})]),_:1},8,["model","rules"])]),(0,l.Lk)("div",n,[t[7]||(t[7]=(0,l.Lk)("div",{class:"card-title"},"反馈列表",-1)),(0,l.bF)(h,{onView:d.openDetail},null,8,["onView"])]),(0,l.bF)(_,{modelValue:d.dialogImageVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>d.dialogImageVisible=e)},{default:(0,l.k6)(()=>[(0,l.Lk)("img",{src:d.dialogImageUrl,alt:"预览",style:{width:"100%"}},null,8,r)]),_:1},8,["modelValue"]),(0,l.bF)(_,{modelValue:d.detailDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>d.detailDialogVisible=e),title:"反馈详情",width:"60%"},{default:(0,l.k6)(()=>[d.selectedId?((0,l.uX)(),(0,l.Wv)(w,{key:0,id:d.selectedId},null,8,["id"])):(0,l.Q3)("",!0)]),_:1},8,["modelValue"])],64)}var u=a(5495),c=a(8548),p=a(953),g=a(163),m=a(8783),b=a(5113),f={name:"Feedback",components:{Plus:c.Plus,FeedbackList:m["default"],FeedbackDetail:b["default"]},setup(){const e=(0,p.Kh)({title:"",description:""}),t={title:[{required:!0,message:"请填写标题",trigger:"blur"},{min:1,max:100,message:"标题需在100字以内",trigger:"change"}],description:[{required:!0,message:"请填写描述",trigger:"blur"},{min:1,max:500,message:"描述需在500字以内",trigger:"change"}]},a=(0,p.KR)(null),l=(0,p.KR)([]),i=(0,p.KR)(!1),s=(0,p.KR)(!1),o=(0,p.KR)(""),n=(0,p.KR)(!1),r=(0,p.KR)(null),d=t=>{t&&t.length>500&&(e.description=t.slice(0,500))},c=e=>{const t=["image/jpeg","image/png","image/webp"].includes(e.type);if(!t)return g.nk.error("仅支持 JPG/PNG/WebP 图片"),!1;const a=e.size<=2097152;return!!a||(g.nk.error("图片大小不能超过 2MB"),!1)},m=(e,t)=>{l.value=t.slice(0,3)},b=(e,t)=>{l.value=t},f=()=>{},v=()=>g.nk.error("最多上传3张图片"),k=async()=>{if(i.value)return;await a.value.validate();const t=new FormData;t.append("title",e.title.trim()),t.append("description",e.description.trim()),l.value.forEach(e=>t.append("images",e.raw)),i.value=!0;try{await u.A.feedback.create(t),g.nk.success("提交成功，感谢反馈！"),e.title="",e.description="",l.value=[]}catch(s){}finally{i.value=!1}},h=e=>{r.value=e,n.value=!0};return{form:e,rules:t,formRef:a,fileList:l,submitting:i,submit:k,beforeUpload:c,handleRemove:b,handleChange:m,onDescInput:d,dialogImageVisible:s,dialogImageUrl:o,noop:f,onExceed:v,detailDialogVisible:n,selectedId:r,openDetail:h}}},v=a(6262);const k=(0,v.A)(f,[["render",d],["__scopeId","data-v-71a2c4b9"]]);var h=k},5113:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var l=a(641),i=a(33);const s={key:0,class:"card"},o={class:"header"},n={class:"meta"},r=["textContent"],d={key:0,class:"images"};function u(e,t,a,u,c,p){const g=(0,l.g2)("el-tag"),m=(0,l.g2)("el-image");return u.detail?((0,l.uX)(),(0,l.CE)("div",s,[(0,l.Lk)("div",o,[(0,l.Lk)("h3",null,(0,i.v_)(u.detail.title),1),(0,l.bF)(g,{type:u.statusType(u.detail.status)},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(u.statusText(u.detail.status)),1)]),_:1},8,["type"])]),(0,l.Lk)("div",n,"提交时间："+(0,i.v_)(u.formatTime(u.detail.created_at)),1),(0,l.Lk)("div",{class:"desc",textContent:(0,i.v_)(u.detail.description)},null,8,r),u.detail.images&&u.detail.images.length?((0,l.uX)(),(0,l.CE)("div",d,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(u.detail.images,e=>((0,l.uX)(),(0,l.Wv)(m,{key:e.id,src:u.toAbs(e.url),"preview-src-list":u.detail.images.map(e=>u.toAbs(e.url))},null,8,["src","preview-src-list"]))),128))])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)}var c=a(5495),p=a(953),g={name:"FeedbackDetail",props:{id:{type:Number,required:!0}},setup(e){const t=(0,p.KR)(null),a=async()=>{const{data:a}=await c.A.feedback.getDetail(e.id);t.value=a},i=e=>({open:"待处理",in_progress:"处理中",resolved:"已解决"}[e]||e),s=e=>({open:"danger",in_progress:"warning",resolved:"success"}[e]||"info"),o=e=>new Date(e).toLocaleString(),n=e=>{if(!e)return"";if(e.startsWith("http"))return e;const t=window.location.origin.replace(":8080",":3000");return e.startsWith("/")?t+e:t+"/"+e};return(0,l.sV)(a),(0,l.wB)(()=>e.id,a),{detail:t,statusText:i,statusType:s,formatTime:o,toAbs:n}}},m=a(6262);const b=(0,m.A)(g,[["render",u],["__scopeId","data-v-4eb79019"]]);var f=b},8783:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var l=a(641),i=a(33);const s={class:"card"},o={class:"toolbar"},n={class:"explanation-ellipsis"},r={class:"pager"};function d(e,t,a,d,u,c){const p=(0,l.g2)("el-option"),g=(0,l.g2)("el-select"),m=(0,l.g2)("el-tooltip"),b=(0,l.g2)("el-table-column"),f=(0,l.g2)("el-tag"),v=(0,l.g2)("el-button"),k=(0,l.g2)("el-table"),h=(0,l.g2)("el-pagination");return(0,l.uX)(),(0,l.CE)("div",s,[(0,l.Lk)("div",o,[(0,l.bF)(g,{modelValue:d.status,"onUpdate:modelValue":t[0]||(t[0]=e=>d.status=e),placeholder:"全部状态",clearable:"",style:{width:"180px"},onChange:t[1]||(t[1]=e=>d.fetchData(1))},{default:(0,l.k6)(()=>[(0,l.bF)(p,{label:"全部",value:""}),(0,l.bF)(p,{label:"待处理",value:"open"}),(0,l.bF)(p,{label:"已解决",value:"resolved"})]),_:1},8,["modelValue"])]),(0,l.bF)(k,{data:d.items,style:{width:"100%"},fit:!1},{default:(0,l.k6)(()=>[(0,l.bF)(b,{prop:"title",label:"问题标题","min-width":"450"},{default:(0,l.k6)(({row:e})=>[(0,l.bF)(m,{content:e.title,placement:"top",effect:"dark","popper-class":"explanation-tooltip dark","show-after":120,teleported:!0},{default:(0,l.k6)(()=>[(0,l.Lk)("span",n,(0,i.v_)(e.title),1)]),_:2},1032,["content"])]),_:1}),(0,l.bF)(b,{label:"状态标签",width:"120"},{default:(0,l.k6)(({row:e})=>[(0,l.bF)(f,{type:d.statusType(e.status)},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(d.statusText(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,l.bF)(b,{prop:"created_at",label:"提交时间",width:"180"},{default:(0,l.k6)(({row:e})=>[(0,l.eW)((0,i.v_)(d.formatTime(e.created_at)),1)]),_:1}),(0,l.bF)(b,{label:"查看详情",width:"120"},{default:(0,l.k6)(({row:e})=>[(0,l.bF)(v,{link:"",type:"primary",onClick:t=>d.viewDetail(e.id)},{default:(0,l.k6)(()=>t[2]||(t[2]=[(0,l.eW)("查看详情")])),_:2,__:[2]},1032,["onClick"])]),_:1}),(0,l.bF)(b,{label:"状态修改",width:"160"},{default:(0,l.k6)(({row:e})=>[(0,l.bF)(g,{"model-value":e.status,size:"small",style:{width:"120px"},onChange:t=>d.changeStatus(e.id,t)},{default:(0,l.k6)(()=>[(0,l.bF)(p,{label:"待处理",value:"open"}),(0,l.bF)(p,{label:"已解决",value:"resolved"})]),_:2},1032,["model-value","onChange"])]),_:1})]),_:1},8,["data"]),(0,l.Lk)("div",r,[(0,l.bF)(h,{background:"",layout:"prev, pager, next, jumper",total:d.total,"page-size":d.pageSize,"current-page":d.page,onCurrentChange:d.fetchData},null,8,["total","page-size","current-page","onCurrentChange"])])])}var u=a(5495),c=a(953),p=a(163),g={name:"FeedbackList",emits:["view"],setup(e,{emit:t}){const a=(0,c.KR)([]),i=(0,c.KR)(0),s=(0,c.KR)(1),o=(0,c.KR)(10),n=(0,c.KR)(""),r=async(e=s.value)=>{s.value=e;try{const{data:e}=await u.A.feedback.getList({page:s.value,pageSize:o.value,status:n.value});a.value=e.items,i.value=e.total}catch(t){}},d=e=>({open:"待处理",in_progress:"处理中",resolved:"已解决"}[e]||e),g=e=>({open:"danger",in_progress:"warning",resolved:"success"}[e]||"info"),m=e=>new Date(e).toLocaleString(),b=e=>{t("view",e)},f=async(e,t)=>{try{await u.A.feedback.updateStatus(e,t),p.nk.success("状态已更新"),r()}catch(a){}};return(0,l.sV)(()=>r(1)),{items:a,total:i,page:s,pageSize:o,status:n,fetchData:r,statusText:d,statusType:g,formatTime:m,viewDetail:b,changeStatus:f}}},m=a(6262);const b=(0,m.A)(g,[["render",d],["__scopeId","data-v-b4a45354"]]);var f=b}}]);
//# sourceMappingURL=95.f706371c.js.map