"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[234],{8234:function(e,a,l){l.r(a),l.d(a,{default:function(){return v}});var t=l(641),s=l(33);const r={class:"users-container"},o={class:"action-bar"},u={class:"search-section"},n={class:"action-section"},d={class:"pagination-wrapper"};function i(e,a,l,i,c,g){const p=(0,t.g2)("Search"),m=(0,t.g2)("el-icon"),h=(0,t.g2)("el-input"),b=(0,t.g2)("Plus"),k=(0,t.g2)("el-button"),v=(0,t.g2)("el-table-column"),f=(0,t.g2)("el-tag"),_=(0,t.g2)("el-table"),F=(0,t.g2)("el-pagination"),w=(0,t.g2)("el-card"),y=(0,t.g2)("el-form-item"),C=(0,t.g2)("el-option"),R=(0,t.g2)("el-select"),V=(0,t.g2)("el-form"),U=(0,t.g2)("el-dialog"),W=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.Lk)("div",o,[(0,t.Lk)("div",u,[(0,t.bF)(h,{modelValue:i.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>i.searchQuery=e),placeholder:"搜索用户...",style:{width:"300px"},clearable:"",onInput:i.handleSearch},{prefix:(0,t.k6)(()=>[(0,t.bF)(m,null,{default:(0,t.k6)(()=>[(0,t.bF)(p)]),_:1})]),_:1},8,["modelValue","onInput"])]),(0,t.Lk)("div",n,[(0,t.bF)(k,{type:"primary",onClick:a[1]||(a[1]=e=>i.showAddDialog=!0)},{default:(0,t.k6)(()=>[(0,t.bF)(m,null,{default:(0,t.k6)(()=>[(0,t.bF)(b)]),_:1}),a[11]||(a[11]=(0,t.eW)(" 添加用户 "))]),_:1,__:[11]})])]),(0,t.bF)(w,{class:"list-card"},{default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(_,{data:i.users,loading:i.loading,style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(v,{prop:"username",label:"用户名",width:"150"}),(0,t.bF)(v,{prop:"email",label:"邮箱",width:"200"}),(0,t.bF)(v,{prop:"role",label:"角色",width:"120"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(f,{type:i.getRoleType(e.role)},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(i.getRoleText(e.role)),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(v,{prop:"status",label:"状态",width:"100"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(f,{type:"active"===e.status?"success":"danger"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)("active"===e.status?"激活":"禁用"),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(v,{prop:"createdAt",label:"创建时间",width:"180"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,s.v_)(i.formatDate(e.createdAt)),1)]),_:1}),(0,t.bF)(v,{label:"操作",width:"250",fixed:"right"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(k,{size:"small",onClick:a=>i.handleEdit(e)},{default:(0,t.k6)(()=>a[12]||(a[12]=[(0,t.eW)(" 编辑 ")])),_:2,__:[12]},1032,["onClick"]),(0,t.bF)(k,{size:"small",type:"warning",onClick:a=>i.handleAssignRole(e)},{default:(0,t.k6)(()=>a[13]||(a[13]=[(0,t.eW)(" 分配角色 ")])),_:2,__:[13]},1032,["onClick"]),(0,t.bF)(k,{size:"small",type:"danger",onClick:a=>i.handleDelete(e)},{default:(0,t.k6)(()=>a[14]||(a[14]=[(0,t.eW)(" 删除 ")])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])),[[W,i.loading]]),(0,t.Lk)("div",d,[(0,t.bF)(F,{"current-page":i.currentPage,"page-size":i.pageSize,"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i.handleSizeChange,onCurrentChange:i.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),(0,t.bF)(U,{modelValue:i.showAddDialog,"onUpdate:modelValue":a[7]||(a[7]=e=>i.showAddDialog=e),title:i.editingUser?"编辑用户":"添加用户",width:"500px"},{footer:(0,t.k6)(()=>[(0,t.bF)(k,{onClick:a[6]||(a[6]=e=>i.showAddDialog=!1)},{default:(0,t.k6)(()=>a[15]||(a[15]=[(0,t.eW)("取消")])),_:1,__:[15]}),(0,t.bF)(k,{type:"primary",onClick:i.handleSave,loading:i.saving},{default:(0,t.k6)(()=>a[16]||(a[16]=[(0,t.eW)(" 保存 ")])),_:1,__:[16]},8,["onClick","loading"])]),default:(0,t.k6)(()=>[(0,t.bF)(V,{ref:"userForm",model:i.userForm,rules:i.rules,"label-width":"100px"},{default:(0,t.k6)(()=>[(0,t.bF)(y,{label:"用户名",prop:"username"},{default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:i.userForm.username,"onUpdate:modelValue":a[2]||(a[2]=e=>i.userForm.username=e),disabled:!!i.editingUser},null,8,["modelValue","disabled"])]),_:1}),(0,t.bF)(y,{label:"邮箱",prop:"email"},{default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:i.userForm.email,"onUpdate:modelValue":a[3]||(a[3]=e=>i.userForm.email=e)},null,8,["modelValue"])]),_:1}),i.editingUser?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(y,{key:0,label:"密码",prop:"password"},{default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:i.userForm.password,"onUpdate:modelValue":a[4]||(a[4]=e=>i.userForm.password=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),(0,t.bF)(y,{label:"状态",prop:"status"},{default:(0,t.k6)(()=>[(0,t.bF)(R,{modelValue:i.userForm.status,"onUpdate:modelValue":a[5]||(a[5]=e=>i.userForm.status=e),placeholder:"选择状态"},{default:(0,t.k6)(()=>[(0,t.bF)(C,{label:"激活",value:"active"}),(0,t.bF)(C,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),(0,t.bF)(U,{modelValue:i.showRoleDialog,"onUpdate:modelValue":a[10]||(a[10]=e=>i.showRoleDialog=e),title:"分配角色",width:"400px"},{footer:(0,t.k6)(()=>[(0,t.bF)(k,{onClick:a[9]||(a[9]=e=>i.showRoleDialog=!1)},{default:(0,t.k6)(()=>a[17]||(a[17]=[(0,t.eW)("取消")])),_:1,__:[17]}),(0,t.bF)(k,{type:"primary",onClick:i.handleSaveRole,loading:i.savingRole},{default:(0,t.k6)(()=>a[18]||(a[18]=[(0,t.eW)(" 保存 ")])),_:1,__:[18]},8,["onClick","loading"])]),default:(0,t.k6)(()=>[(0,t.bF)(V,{"label-width":"100px"},{default:(0,t.k6)(()=>[(0,t.bF)(y,{label:"用户"},{default:(0,t.k6)(()=>[(0,t.Lk)("span",null,(0,s.v_)(i.selectedUser?.username),1)]),_:1}),(0,t.bF)(y,{label:"角色"},{default:(0,t.k6)(()=>[(0,t.bF)(R,{modelValue:i.selectedRole,"onUpdate:modelValue":a[8]||(a[8]=e=>i.selectedRole=e),placeholder:"选择角色"},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(i.roles,e=>((0,t.uX)(),(0,t.Wv)(C,{key:e.id,label:i.getRoleText(e.name),value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var c=l(953),g=l(6278),p=l(163),m=l(7918),h={name:"Users",setup(){const e=(0,g.Pj)(),a=(0,c.KR)(!1),l=(0,c.KR)(!1),s=(0,c.KR)(!1),r=(0,c.KR)(!1),o=(0,c.KR)(!1),u=(0,c.KR)(null),n=(0,c.KR)(null),d=(0,c.KR)(""),i=(0,c.KR)(1),h=(0,c.KR)(20),b=(0,c.KR)(""),k=(0,c.Kh)({username:"",email:"",password:"",status:"active"}),v={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于 6 个字符",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},f=(0,t.EW)(()=>e.getters["users/usersList"]),_=(0,t.EW)(()=>e.getters["users/rolesList"]),F=(0,t.EW)(()=>e.getters["users/totalCount"]),w=async()=>{try{a.value=!0,await e.dispatch("users/fetchUsers",{page:i.value,limit:h.value,search:d.value})}catch(l){p.nk.error("加载用户失败")}finally{a.value=!1}},y=async()=>{try{await e.dispatch("users/fetchRoles")}catch(a){p.nk.error("加载角色失败")}},C=()=>{i.value=1,w()},R=e=>{h.value=e,i.value=1,w()},V=e=>{i.value=e,w()},U=()=>{Object.assign(k,{username:"",email:"",password:"",status:"active"}),u.value=null},W=e=>{u.value=e,Object.assign(k,{username:e.username,email:e.email,status:e.status}),r.value=!0},x=async a=>{try{await m.s.confirm("确定要删除这个用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await e.dispatch("users/deleteUser",a.id),p.nk.success("删除成功"),w()}catch(l){"cancel"!==l&&p.nk.error("删除失败")}},z=async()=>{try{l.value=!0,u.value?(await e.dispatch("users/updateUser",{id:u.value.id,data:k}),p.nk.success("更新成功")):(await e.dispatch("users/createUser",k),p.nk.success("添加成功")),r.value=!1,U(),w()}catch(a){p.nk.error("保存失败")}finally{l.value=!1}},D=e=>{n.value=e,b.value=e.roleId||"",o.value=!0},S=async()=>{try{s.value=!0,await e.dispatch("users/assignUserRole",n.value.id,b.value),p.nk.success("角色分配成功"),o.value=!1,w()}catch(a){p.nk.error("角色分配失败")}finally{s.value=!1}},K=e=>{const a={admin:"danger",expert:"warning",user:"info"};return a[e]||"info"},A=e=>{const a={admin:"管理员",expert:"专家用户",user:"普通用户"};return a[e]||e},L=e=>e?new Date(e).toLocaleString("zh-CN"):"-";return(0,t.sV)(()=>{w(),y()}),{loading:a,saving:l,savingRole:s,showAddDialog:r,showRoleDialog:o,editingUser:u,selectedUser:n,searchQuery:d,currentPage:i,pageSize:h,selectedRole:b,userForm:k,rules:v,users:f,roles:_,total:F,handleSearch:C,handleSizeChange:R,handleCurrentChange:V,handleEdit:W,handleDelete:x,handleSave:z,handleAssignRole:D,handleSaveRole:S,getRoleType:K,getRoleText:A,formatDate:L}}},b=l(6262);const k=(0,b.A)(h,[["render",i],["__scopeId","data-v-886e1274"]]);var v=k}}]);
//# sourceMappingURL=234.59299f8a.js.map