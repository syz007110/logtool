"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[389],{6389:function(e,a,r){r.r(a),r.d(a,{default:function(){return c}});var l=r(641),s=r(33);const o={class:"account-container"};function d(e,a,r,d,t,n){const u=(0,l.g2)("el-input"),i=(0,l.g2)("el-form-item"),p=(0,l.g2)("el-tag"),w=(0,l.g2)("el-button"),c=(0,l.g2)("el-form"),f=(0,l.g2)("el-card"),m=(0,l.g2)("el-col"),g=(0,l.g2)("el-row");return(0,l.uX)(),(0,l.CE)("div",o,[(0,l.bF)(g,{gutter:20},{default:(0,l.k6)(()=>[(0,l.bF)(m,{span:12},{default:(0,l.k6)(()=>[(0,l.bF)(f,{class:"profile-card"},{header:(0,l.k6)(()=>a[5]||(a[5]=[(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("span",null,"个人信息")],-1)])),default:(0,l.k6)(()=>[(0,l.bF)(c,{ref:"profileForm",model:d.profileData,rules:d.profileRules,"label-width":"100px"},{default:(0,l.k6)(()=>[(0,l.bF)(i,{label:"用户名"},{default:(0,l.k6)(()=>[(0,l.bF)(u,{modelValue:d.profileData.username,"onUpdate:modelValue":a[0]||(a[0]=e=>d.profileData.username=e),disabled:""},null,8,["modelValue"])]),_:1}),(0,l.bF)(i,{label:"邮箱",prop:"email"},{default:(0,l.k6)(()=>[(0,l.bF)(u,{modelValue:d.profileData.email,"onUpdate:modelValue":a[1]||(a[1]=e=>d.profileData.email=e)},null,8,["modelValue"])]),_:1}),(0,l.bF)(i,{label:"角色"},{default:(0,l.k6)(()=>[(0,l.bF)(p,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,s.v_)(d.getRoleText(d.profileData.role)),1)]),_:1})]),_:1}),(0,l.bF)(i,{label:"注册时间"},{default:(0,l.k6)(()=>[(0,l.Lk)("span",null,(0,s.v_)(d.formatDate(d.profileData.created_at)),1)]),_:1}),(0,l.bF)(i,null,{default:(0,l.k6)(()=>[(0,l.bF)(w,{type:"primary",onClick:d.handleUpdateProfile,loading:d.updatingProfile},{default:(0,l.k6)(()=>a[6]||(a[6]=[(0,l.eW)("保存")])),_:1,__:[6]},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1}),(0,l.bF)(m,{span:12},{default:(0,l.k6)(()=>[(0,l.bF)(f,{class:"password-card"},{header:(0,l.k6)(()=>a[7]||(a[7]=[(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("span",null,"修改密码")],-1)])),default:(0,l.k6)(()=>[(0,l.bF)(c,{ref:"passwordForm",model:d.passwordData,rules:d.passwordRules,"label-width":"100px"},{default:(0,l.k6)(()=>[(0,l.bF)(i,{label:"原密码",prop:"oldPassword"},{default:(0,l.k6)(()=>[(0,l.bF)(u,{modelValue:d.passwordData.oldPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>d.passwordData.oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),(0,l.bF)(i,{label:"新密码",prop:"newPassword"},{default:(0,l.k6)(()=>[(0,l.bF)(u,{modelValue:d.passwordData.newPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>d.passwordData.newPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),(0,l.bF)(i,{label:"确认密码",prop:"confirmPassword"},{default:(0,l.k6)(()=>[(0,l.bF)(u,{modelValue:d.passwordData.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>d.passwordData.confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),(0,l.bF)(i,null,{default:(0,l.k6)(()=>[(0,l.bF)(w,{type:"primary",onClick:d.handleChangePassword,loading:d.changingPassword},{default:(0,l.k6)(()=>a[8]||(a[8]=[(0,l.eW)("修改密码")])),_:1,__:[8]},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})])}var t=r(953),n=r(6278),u=r(163),i={name:"Account",setup(){const e=(0,n.Pj)(),a=(0,t.KR)(!1),r=(0,t.KR)(!1),s=(0,t.KR)(null),o=(0,t.KR)(null),d=(0,t.Kh)({username:"",email:"",role:"",created_at:""}),i=(0,t.Kh)({oldPassword:"",newPassword:"",confirmPassword:""}),p={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},w=(e,a,r)=>{a!==i.newPassword?r(new Error("两次输入的密码不一致")):r()},c={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于 6 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:w,trigger:"blur"}]},f=((0,l.EW)(()=>e.getters.currentUser),()=>{const a=e.getters["auth/currentUser"];a&&Object.assign(d,{username:a.username,email:a.email,role:a.role,created_at:a.created_at})}),m=async()=>{try{await s.value.validate(),a.value=!0,await e.dispatch("users/updateUser",{id:e.getters["auth/currentUser"].id,data:{email:d.email}}),u.nk.success("更新成功")}catch(r){u.nk.error("更新失败")}finally{a.value=!1}},g=async()=>{try{if(await o.value.validate(),r.value=!0,i.newPassword!==i.confirmPassword)return void u.nk.error("两次输入的新密码不一致");await e.dispatch("users/updateUser",{id:e.getters["auth/currentUser"].id,data:{password:i.newPassword}}),u.nk.success("密码修改成功"),Object.assign(i,{oldPassword:"",newPassword:"",confirmPassword:""}),o.value.resetFields()}catch(a){u.nk.error("密码修改失败")}finally{r.value=!1}},b=e=>{const a={admin:"danger",expert:"warning",user:"info"};return a[e]||"info"},k=e=>{const a={admin:"管理员",expert:"专家用户",user:"普通用户"};return a[e]||e},_=e=>e?new Date(e).toLocaleString("zh-CN"):"-";return(0,l.sV)(()=>{f()}),{updatingProfile:a,changingPassword:r,profileForm:s,passwordForm:o,profileData:d,passwordData:i,profileRules:p,passwordRules:c,handleUpdateProfile:m,handleChangePassword:g,getRoleType:b,getRoleText:k,formatDate:_}}},p=r(6262);const w=(0,p.A)(i,[["render",d],["__scopeId","data-v-f7c8ed9e"]]);var c=w}}]);
//# sourceMappingURL=389.3cda518c.js.map