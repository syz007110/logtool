{"version":3,"file":"js/60.d80e9dda.js","mappings":"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","sources":["webpack://logtool-frontend/./src/views/Devices.vue","webpack://logtool-frontend/./src/views/Devices.vue?788b"],"sourcesContent":["<template>\r\n  <div class=\"devices-container\">\r\n    <div class=\"action-bar\">\r\n      <div class=\"search-section\">\r\n        <el-input v-model=\"search\" placeholder=\"搜索设备（编号/型号/密钥/医院）...\" style=\"width: 300px\" clearable @keyup.enter=\"loadDevices\" />\r\n        <el-button @click=\"loadDevices\">查询</el-button>\r\n      </div>\r\n      <div class=\"action-section\" v-if=\"canEdit\">\r\n        <el-button type=\"primary\" @click=\"openEdit()\">新增设备</el-button>\r\n      </div>\r\n    </div>\r\n\r\n    <el-card class=\"list-card\">\r\n      <el-table :data=\"devices\" :loading=\"loading\" style=\"width: 100%\">\r\n        <el-table-column prop=\"device_id\" label=\"设备编号\" width=\"160\" />\r\n        <el-table-column prop=\"device_model\" label=\"设备型号\" width=\"160\" />\r\n        <el-table-column prop=\"device_key\" label=\"设备密钥(MAC)\" width=\"200\" />\r\n        <el-table-column prop=\"hospital\" label=\"所属医院\" />\r\n        <el-table-column label=\"操作\" width=\"200\" v-if=\"canEdit\">\r\n          <template #default=\"{ row }\">\r\n            <el-button size=\"small\" @click=\"openEdit(row)\">编辑</el-button>\r\n            <el-button size=\"small\" type=\"danger\" @click=\"onDelete(row)\">删除</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div class=\"pagination-wrapper\">\r\n        <el-pagination\r\n          :current-page=\"page\"\r\n          :page-size=\"limit\"\r\n          :total=\"total\"\r\n          :page-sizes=\"[10,20,50,100]\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          @current-change=\"(p)=>{page=p;loadDevices()}\"\r\n          @size-change=\"(s)=>{limit=s;page=1;loadDevices()}\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n\r\n    <el-dialog v-model=\"showEdit\" :title=\"editing ? '编辑设备' : '新增设备'\" width=\"520px\">\r\n      <el-form :model=\"form\" label-width=\"110px\" :rules=\"rules\" ref=\"formRef\">\r\n        <el-form-item label=\"设备编号\" prop=\"device_id\">\r\n          <el-input v-model=\"form.device_id\" :disabled=\"!!editing\" placeholder=\"如 4371-01 / ABC-12\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"设备型号\" prop=\"device_model\">\r\n          <el-input v-model=\"form.device_model\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"设备密钥(MAC)\" prop=\"device_key\">\r\n          <el-input v-model=\"form.device_key\" placeholder=\"00-01-05-77-6a-09\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"所属医院\" prop=\"hospital\">\r\n          <el-input v-model=\"form.hospital\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <el-button @click=\"showEdit=false\">取消</el-button>\r\n        <el-button type=\"primary\" :loading=\"saving\" @click=\"save\">保存</el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n  \r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport api from '../api'\r\nimport { useStore } from 'vuex'\r\n\r\nexport default {\r\n  name: 'Devices',\r\n  setup() {\r\n    const store = useStore()\r\n    const canEdit = computed(() => {\r\n      const role = store.getters['auth/userRole']\r\n      return role === 'admin' || role === 'expert'\r\n    })\r\n\r\n    const loading = ref(false)\r\n    const saving = ref(false)\r\n    const devices = ref([])\r\n    const total = ref(0)\r\n    const page = ref(1)\r\n    const limit = ref(20)\r\n    const search = ref('')\r\n\r\n    const showEdit = ref(false)\r\n    const editing = ref(null)\r\n    const formRef = ref(null)\r\n    const form = reactive({ device_id: '', device_model: '', device_key: '', hospital: '' })\r\n\r\n    const rules = {\r\n      device_id: [\r\n        { required: true, message: '请输入设备编号', trigger: 'blur' },\r\n        { pattern: /^[0-9A-Za-z]+-[0-9A-Za-z]+$/, message: '格式如 4371-01 / ABC-12', trigger: 'blur' }\r\n      ],\r\n      device_key: [\r\n        { pattern: /^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/, message: '请输入MAC地址格式', trigger: 'blur' }\r\n      ]\r\n    }\r\n\r\n    const loadDevices = async () => {\r\n      loading.value = true\r\n      try {\r\n        const res = await api.devices.getList({ page: page.value, limit: limit.value, search: search.value })\r\n        devices.value = res.data.devices || []\r\n        total.value = res.data.total || 0\r\n      } catch {\r\n        ElMessage.error('加载设备失败')\r\n      } finally {\r\n        loading.value = false\r\n      }\r\n    }\r\n\r\n    const openEdit = (row) => {\r\n      if (row) {\r\n        editing.value = row\r\n        Object.assign(form, { device_id: row.device_id, device_model: row.device_model, device_key: row.device_key, hospital: row.hospital })\r\n      } else {\r\n        editing.value = null\r\n        Object.assign(form, { device_id: '', device_model: '', device_key: '', hospital: '' })\r\n      }\r\n      showEdit.value = true\r\n    }\r\n\r\n    const save = async () => {\r\n      await formRef.value?.validate()\r\n      saving.value = true\r\n      try {\r\n        if (editing.value) {\r\n          await api.devices.update(editing.value.id, form)\r\n          ElMessage.success('更新成功')\r\n        } else {\r\n          await api.devices.create(form)\r\n          ElMessage.success('创建成功')\r\n        }\r\n        showEdit.value = false\r\n        await loadDevices()\r\n      } catch (e) {\r\n        ElMessage.error(e?.response?.data?.message || '保存失败')\r\n      } finally {\r\n        saving.value = false\r\n      }\r\n    }\r\n\r\n    const onDelete = async (row) => {\r\n      try {\r\n        await ElMessageBox.confirm('确定删除该设备？', '提示', { type: 'warning' })\r\n        await api.devices.delete(row.id)\r\n        ElMessage.success('删除成功')\r\n        loadDevices()\r\n      } catch (e) {\r\n        if (e !== 'cancel') ElMessage.error(e?.response?.data?.message || '删除失败')\r\n      }\r\n    }\r\n\r\n    onMounted(loadDevices)\r\n\r\n    return { devices, total, page, limit, search, loading, saving, showEdit, editing, form, rules, formRef, canEdit, loadDevices, openEdit, save, onDelete }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.devices-container { height: 100%; }\r\n.action-bar {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n  padding: 20px;\r\n  background: white;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n}\r\n.action-section { display: flex; gap: 10px; }\r\n.list-card { margin-bottom: 20px; }\r\n.pagination-wrapper { display: flex; justify-content: center; margin-top: 20px; }\r\n</style>\r\n\r\n\r\n","import { render } from \"./Devices.vue?vue&type=template&id=5bec2bc9&scoped=true\"\nimport script from \"./Devices.vue?vue&type=script&lang=js\"\nexport * from \"./Devices.vue?vue&type=script&lang=js\"\n\nimport \"./Devices.vue?vue&type=style&index=0&id=5bec2bc9&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-5bec2bc9\"]])\n\nexport default __exports__"],"names":["class","search","placeholder","style","clearable","loadDevices","type","openEdit","data","devices","loading","prop","label","width","default","row","size","onDelete","page","limit","total","layout","p","s","showEdit","title","editing","footer","saving","save","model","form","rules","ref","device_id","disabled","device_model","device_key","hospital","name","setup","store","canEdit","role","getters","formRef","required","message","trigger","pattern","async","value","res","api","getList","error","Object","assign","validate","update","id","success","create","e","response","confirm","delete","__exports__","render"],"sourceRoot":""}