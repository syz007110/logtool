"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[141],{1141:function(e,l,a){a.r(l),a.d(l,{default:function(){return k}});var t=a(641),o=a(33);const r={class:"roles-container"},d={class:"action-bar"};function u(e,l,a,u,s,n){const i=(0,t.g2)("Plus"),_=(0,t.g2)("el-icon"),c=(0,t.g2)("el-button"),p=(0,t.g2)("el-table-column"),b=(0,t.g2)("el-tag"),k=(0,t.g2)("el-table"),f=(0,t.g2)("el-card"),g=(0,t.g2)("el-input"),m=(0,t.g2)("el-form-item"),F=(0,t.g2)("el-checkbox"),v=(0,t.g2)("el-col"),h=(0,t.g2)("el-row"),w=(0,t.g2)("el-checkbox-group"),W=(0,t.g2)("el-form"),y=(0,t.g2)("el-dialog"),C=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.Lk)("div",d,[(0,t.bF)(c,{type:"primary",onClick:l[0]||(l[0]=e=>u.showAddDialog=!0)},{default:(0,t.k6)(()=>[(0,t.bF)(_,null,{default:(0,t.k6)(()=>[(0,t.bF)(i)]),_:1}),l[6]||(l[6]=(0,t.eW)(" 添加角色 "))]),_:1,__:[6]})]),(0,t.bF)(f,{class:"list-card"},{default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(k,{data:u.roles,loading:u.loading,style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(p,{prop:"name",label:"角色名称",width:"150"}),(0,t.bF)(p,{prop:"description",label:"角色描述","show-overflow-tooltip":""}),(0,t.bF)(p,{prop:"permissions",label:"权限",width:"300"},{default:(0,t.k6)(({row:e})=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.permissions,e=>((0,t.uX)(),(0,t.Wv)(b,{key:e,size:"small",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(e),1)]),_:2},1024))),128))]),_:1}),(0,t.bF)(p,{prop:"createdAt",label:"创建时间",width:"180"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,o.v_)(u.formatDate(e.createdAt)),1)]),_:1}),(0,t.bF)(p,{label:"操作",width:"150",fixed:"right"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(c,{size:"small",onClick:l=>u.handleEdit(e)},{default:(0,t.k6)(()=>l[7]||(l[7]=[(0,t.eW)(" 编辑 ")])),_:2,__:[7]},1032,["onClick"]),(0,t.bF)(c,{size:"small",type:"danger",onClick:l=>u.handleDelete(e)},{default:(0,t.k6)(()=>l[8]||(l[8]=[(0,t.eW)(" 删除 ")])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])),[[C,u.loading]])]),_:1}),(0,t.bF)(y,{modelValue:u.showAddDialog,"onUpdate:modelValue":l[5]||(l[5]=e=>u.showAddDialog=e),title:u.editingRole?"编辑角色":"添加角色",width:"600px"},{footer:(0,t.k6)(()=>[(0,t.bF)(c,{onClick:l[4]||(l[4]=e=>u.showAddDialog=!1)},{default:(0,t.k6)(()=>l[33]||(l[33]=[(0,t.eW)("取消")])),_:1,__:[33]}),(0,t.bF)(c,{type:"primary",onClick:u.handleSave,loading:u.saving},{default:(0,t.k6)(()=>l[34]||(l[34]=[(0,t.eW)(" 保存 ")])),_:1,__:[34]},8,["onClick","loading"])]),default:(0,t.k6)(()=>[(0,t.bF)(W,{ref:"roleForm",model:u.roleForm,rules:u.rules,"label-width":"100px"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{label:"角色名称",prop:"name"},{default:(0,t.k6)(()=>[(0,t.bF)(g,{modelValue:u.roleForm.name,"onUpdate:modelValue":l[1]||(l[1]=e=>u.roleForm.name=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(m,{label:"角色描述",prop:"description"},{default:(0,t.k6)(()=>[(0,t.bF)(g,{modelValue:u.roleForm.description,"onUpdate:modelValue":l[2]||(l[2]=e=>u.roleForm.description=e),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),(0,t.bF)(m,{label:"权限",prop:"permissions"},{default:(0,t.k6)(()=>[(0,t.bF)(w,{modelValue:u.roleForm.permissions,"onUpdate:modelValue":l[3]||(l[3]=e=>u.roleForm.permissions=e)},{default:(0,t.k6)(()=>[(0,t.bF)(h,{gutter:20},{default:(0,t.k6)(()=>[(0,t.bF)(v,{span:12},{default:(0,t.k6)(()=>[l[14]||(l[14]=(0,t.Lk)("h4",null,"用户管理",-1)),(0,t.bF)(F,{value:"user:read"},{default:(0,t.k6)(()=>l[9]||(l[9]=[(0,t.eW)("查看用户")])),_:1,__:[9]}),(0,t.bF)(F,{value:"user:create"},{default:(0,t.k6)(()=>l[10]||(l[10]=[(0,t.eW)("创建用户")])),_:1,__:[10]}),(0,t.bF)(F,{value:"user:update"},{default:(0,t.k6)(()=>l[11]||(l[11]=[(0,t.eW)("修改用户")])),_:1,__:[11]}),(0,t.bF)(F,{value:"user:delete"},{default:(0,t.k6)(()=>l[12]||(l[12]=[(0,t.eW)("删除用户")])),_:1,__:[12]}),(0,t.bF)(F,{value:"user:role:assign"},{default:(0,t.k6)(()=>l[13]||(l[13]=[(0,t.eW)("分配角色")])),_:1,__:[13]})]),_:1,__:[14]}),(0,t.bF)(v,{span:12},{default:(0,t.k6)(()=>[l[19]||(l[19]=(0,t.Lk)("h4",null,"角色管理",-1)),(0,t.bF)(F,{value:"role:read"},{default:(0,t.k6)(()=>l[15]||(l[15]=[(0,t.eW)("查看角色")])),_:1,__:[15]}),(0,t.bF)(F,{value:"role:create"},{default:(0,t.k6)(()=>l[16]||(l[16]=[(0,t.eW)("创建角色")])),_:1,__:[16]}),(0,t.bF)(F,{value:"role:update"},{default:(0,t.k6)(()=>l[17]||(l[17]=[(0,t.eW)("修改角色")])),_:1,__:[17]}),(0,t.bF)(F,{value:"role:delete"},{default:(0,t.k6)(()=>l[18]||(l[18]=[(0,t.eW)("删除角色")])),_:1,__:[18]})]),_:1,__:[19]})]),_:1}),(0,t.bF)(h,{gutter:20,style:{"margin-top":"20px"}},{default:(0,t.k6)(()=>[(0,t.bF)(v,{span:12},{default:(0,t.k6)(()=>[l[25]||(l[25]=(0,t.Lk)("h4",null,"故障码管理",-1)),(0,t.bF)(F,{value:"error_code:read"},{default:(0,t.k6)(()=>l[20]||(l[20]=[(0,t.eW)("查看故障码")])),_:1,__:[20]}),(0,t.bF)(F,{value:"error_code:create"},{default:(0,t.k6)(()=>l[21]||(l[21]=[(0,t.eW)("创建故障码")])),_:1,__:[21]}),(0,t.bF)(F,{value:"error_code:update"},{default:(0,t.k6)(()=>l[22]||(l[22]=[(0,t.eW)("修改故障码")])),_:1,__:[22]}),(0,t.bF)(F,{value:"error_code:delete"},{default:(0,t.k6)(()=>l[23]||(l[23]=[(0,t.eW)("删除故障码")])),_:1,__:[23]}),(0,t.bF)(F,{value:"error_code:export"},{default:(0,t.k6)(()=>l[24]||(l[24]=[(0,t.eW)("导出XML")])),_:1,__:[24]})]),_:1,__:[25]}),(0,t.bF)(v,{span:12},{default:(0,t.k6)(()=>[l[32]||(l[32]=(0,t.Lk)("h4",null,"日志管理",-1)),(0,t.bF)(F,{value:"log:upload"},{default:(0,t.k6)(()=>l[26]||(l[26]=[(0,t.eW)("上传日志")])),_:1,__:[26]}),(0,t.bF)(F,{value:"log:read_all"},{default:(0,t.k6)(()=>l[27]||(l[27]=[(0,t.eW)("查看所有日志")])),_:1,__:[27]}),(0,t.bF)(F,{value:"log:read_own"},{default:(0,t.k6)(()=>l[28]||(l[28]=[(0,t.eW)("查看自己的日志")])),_:1,__:[28]}),(0,t.bF)(F,{value:"log:parse"},{default:(0,t.k6)(()=>l[29]||(l[29]=[(0,t.eW)("解析日志")])),_:1,__:[29]}),(0,t.bF)(F,{value:"log:download"},{default:(0,t.k6)(()=>l[30]||(l[30]=[(0,t.eW)("下载日志")])),_:1,__:[30]}),(0,t.bF)(F,{value:"log:delete"},{default:(0,t.k6)(()=>l[31]||(l[31]=[(0,t.eW)("删除日志")])),_:1,__:[31]})]),_:1,__:[32]})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}var s=a(953),n=a(6278),i=a(163),_=a(7918),c={name:"Roles",setup(){const e=(0,n.Pj)(),l=(0,s.KR)(!1),a=(0,s.KR)(!1),o=(0,s.KR)(!1),r=(0,s.KR)(null),d=(0,s.Kh)({name:"",description:"",permissions:[]}),u={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]},c=(0,t.EW)(()=>e.getters["users/rolesList"]),p=async()=>{try{l.value=!0,await e.dispatch("users/fetchRoles")}catch(a){i.nk.error("加载角色失败")}finally{l.value=!1}},b=()=>{Object.assign(d,{name:"",description:"",permissions:[]}),r.value=null},k=e=>{r.value=e,Object.assign(d,{name:e.name,description:e.description,permissions:e.permissions||[]}),o.value=!0},f=async l=>{try{await _.s.confirm("确定要删除这个角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await e.dispatch("users/deleteRole",l.id),i.nk.success("删除成功"),p()}catch(a){"cancel"!==a&&i.nk.error("删除失败")}},g=async()=>{try{a.value=!0,r.value?(await e.dispatch("users/updateRole",{id:r.value.id,data:d}),i.nk.success("更新成功")):(await e.dispatch("users/createRole",d),i.nk.success("添加成功")),o.value=!1,b(),p()}catch(l){i.nk.error("保存失败")}finally{a.value=!1}},m=e=>e?new Date(e).toLocaleString("zh-CN"):"-";return(0,t.sV)(()=>{p()}),{loading:l,saving:a,showAddDialog:o,editingRole:r,roleForm:d,rules:u,roles:c,handleEdit:k,handleDelete:f,handleSave:g,formatDate:m}}},p=a(6262);const b=(0,p.A)(c,[["render",u],["__scopeId","data-v-35ba23da"]]);var k=b}}]);
//# sourceMappingURL=141.378470fe.js.map