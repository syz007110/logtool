"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[631],{2631:function(e,a,l){l.r(a),l.d(a,{default:function(){return _}});var t=l(641),o=l(33);const n={class:"logs-container"},r={class:"upload-actions"},s={class:"card-header"},d={class:"pagination-wrapper"};function i(e,a,l,i,u,c){const p=(0,t.g2)("upload-filled"),g=(0,t.g2)("el-icon"),k=(0,t.g2)("el-upload"),f=(0,t.g2)("el-button"),h=(0,t.g2)("el-card"),_=(0,t.g2)("Refresh"),b=(0,t.g2)("el-table-column"),w=(0,t.g2)("el-tag"),m=(0,t.g2)("el-table"),C=(0,t.g2)("el-pagination"),v=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",n,[(0,t.bF)(h,{class:"upload-card"},{header:(0,t.k6)(()=>a[0]||(a[0]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"日志上传")],-1)])),default:(0,t.k6)(()=>[(0,t.bF)(k,{ref:"uploadRef",action:i.uploadUrl,headers:i.uploadHeaders,"before-upload":i.beforeUpload,"on-success":i.onUploadSuccess,"on-error":i.onUploadError,"auto-upload":!1,"show-file-list":!1,accept:".log,.txt",drag:""},{tip:(0,t.k6)(()=>a[1]||(a[1]=[(0,t.Lk)("div",{class:"el-upload__tip"}," 只能上传 log/txt 文件，且不超过 100MB ",-1)])),default:(0,t.k6)(()=>[(0,t.bF)(g,{class:"el-icon--upload"},{default:(0,t.k6)(()=>[(0,t.bF)(p)]),_:1}),a[2]||(a[2]=(0,t.Lk)("div",{class:"el-upload__text"},[(0,t.eW)(" 将文件拖到此处，或"),(0,t.Lk)("em",null,"点击上传")],-1))]),_:1,__:[2]},8,["action","headers","before-upload","on-success","on-error"]),(0,t.Lk)("div",r,[(0,t.bF)(f,{type:"primary",onClick:i.submitUpload,loading:i.uploading},{default:(0,t.k6)(()=>a[3]||(a[3]=[(0,t.eW)(" 开始上传 ")])),_:1,__:[3]},8,["onClick","loading"]),(0,t.bF)(f,{onClick:i.clearUpload},{default:(0,t.k6)(()=>a[4]||(a[4]=[(0,t.eW)("清空")])),_:1,__:[4]},8,["onClick"])])]),_:1}),(0,t.bF)(h,{class:"list-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",s,[a[6]||(a[6]=(0,t.Lk)("span",null,"日志列表",-1)),(0,t.bF)(f,{type:"primary",size:"small",onClick:i.loadLogs},{default:(0,t.k6)(()=>[(0,t.bF)(g,null,{default:(0,t.k6)(()=>[(0,t.bF)(_)]),_:1}),a[5]||(a[5]=(0,t.eW)(" 刷新 "))]),_:1,__:[5]},8,["onClick"])])]),default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(m,{data:i.logs,loading:i.loading,style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(b,{prop:"filename",label:"文件名",width:"200"}),(0,t.bF)(b,{prop:"size",label:"文件大小",width:"120"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,o.v_)(i.formatFileSize(e.size)),1)]),_:1}),(0,t.bF)(b,{prop:"status",label:"状态",width:"100"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(w,{type:i.getStatusType(e.status)},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(i.getStatusText(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(b,{prop:"uploadTime",label:"上传时间",width:"180"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,o.v_)(i.formatDate(e.uploadTime)),1)]),_:1}),(0,t.bF)(b,{prop:"parseTime",label:"解析时间",width:"180"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,o.v_)(e.parseTime?i.formatDate(e.parseTime):"-"),1)]),_:1}),(0,t.bF)(b,{label:"操作",width:"250",fixed:"right"},{default:(0,t.k6)(({row:e})=>["uploaded"===e.status?((0,t.uX)(),(0,t.Wv)(f,{key:0,size:"small",type:"primary",onClick:a=>i.handleParse(e),loading:e.parsing},{default:(0,t.k6)(()=>a[7]||(a[7]=[(0,t.eW)(" 解析 ")])),_:2,__:[7]},1032,["onClick","loading"])):(0,t.Q3)("",!0),(0,t.bF)(f,{size:"small",type:"success",onClick:a=>i.handleDownload(e)},{default:(0,t.k6)(()=>a[8]||(a[8]=[(0,t.eW)(" 下载 ")])),_:2,__:[8]},1032,["onClick"]),(0,t.bF)(f,{size:"small",type:"danger",onClick:a=>i.handleDelete(e)},{default:(0,t.k6)(()=>a[9]||(a[9]=[(0,t.eW)(" 删除 ")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])),[[v,i.loading]]),(0,t.Lk)("div",d,[(0,t.bF)(C,{"current-page":i.currentPage,"page-size":i.pageSize,"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i.handleSizeChange,onCurrentChange:i.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1})])}var u=l(953),c=l(6278),p=l(163),g=l(7918),k={name:"Logs",setup(){const e=(0,c.Pj)(),a=(0,u.KR)(!1),l=(0,u.KR)(!1),o=(0,u.KR)(null),n=(0,u.KR)(1),r=(0,u.KR)(20),s=(0,t.EW)(()=>e.getters["logs/logsList"]),d=(0,t.EW)(()=>e.getters["logs/totalCount"]),i=(0,t.EW)(()=>"/api/logs/upload"),k=(0,t.EW)(()=>({Authorization:`Bearer ${e.state.auth.token}`})),f=async()=>{try{a.value=!0,await e.dispatch("logs/fetchLogs",{page:n.value,limit:r.value})}catch(l){p.nk.error("加载日志失败")}finally{a.value=!1}},h=e=>{r.value=e,n.value=1,f()},_=e=>{n.value=e,f()},b=e=>{const a="text/plain"===e.type||e.name.endsWith(".log"),l=e.size/1024/1024<100;return a?!!l||(p.nk.error("文件大小不能超过 100MB!"),!1):(p.nk.error("只能上传 log/txt 文件!"),!1)},w=()=>{o.value.submit()},m=()=>{o.value.clearFiles()},C=e=>{p.nk.success("上传成功"),f()},v=e=>{p.nk.error("上传失败")},y=async a=>{try{a.parsing=!0,await e.dispatch("logs/parseLog",a.id),p.nk.success("解析成功"),f()}catch(l){p.nk.error("解析失败")}finally{a.parsing=!1}},F=async a=>{try{const l=await e.dispatch("logs/downloadLog",a.id),t=new Blob([l.data]),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=a.filename,n.click(),window.URL.revokeObjectURL(o),p.nk.success("下载成功")}catch(l){p.nk.error("下载失败")}},L=async a=>{try{await g.s.confirm("确定要删除这个日志文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await e.dispatch("logs/deleteLog",a.id),p.nk.success("删除成功"),f()}catch(l){"cancel"!==l&&p.nk.error("删除失败")}},z=e=>{if(0===e)return"0 B";const a=1024,l=["B","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,t)).toFixed(2))+" "+l[t]},W=e=>e?new Date(e).toLocaleString("zh-CN"):"-",U=e=>{const a={uploaded:"warning",parsed:"success",failed:"danger"};return a[e]||"info"},S=e=>{const a={uploaded:"已上传",parsed:"已解析",failed:"解析失败"};return a[e]||e};return(0,t.sV)(()=>{f()}),{loading:a,uploading:l,uploadRef:o,currentPage:n,pageSize:r,logs:s,total:d,uploadUrl:i,uploadHeaders:k,loadLogs:f,handleSizeChange:h,handleCurrentChange:_,beforeUpload:b,submitUpload:w,clearUpload:m,onUploadSuccess:C,onUploadError:v,handleParse:y,handleDownload:F,handleDelete:L,formatFileSize:z,formatDate:W,getStatusType:U,getStatusText:S}}},f=l(6262);const h=(0,f.A)(k,[["render",i],["__scopeId","data-v-7fe58ff0"]]);var _=h}}]);
//# sourceMappingURL=631.6d914dce.js.map