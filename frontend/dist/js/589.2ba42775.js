"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[589],{9589:function(e,a,l){l.r(a),l.d(a,{default:function(){return P}});var t=l(641),s=l(33),o=l(3751);const n={class:"logs-container"},r={key:0,class:"overall-progress"},i={class:"progress-stages"},d={class:"el-upload__tip"},c={key:0},u={key:1,class:"parsing-tip"},p={key:1,class:"custom-file-list"},g={class:"file-list-header"},v={class:"file-items"},k={class:"file-name"},h={class:"file-size"},b={class:"key-input-section"},f={class:"key-input-row"},m={key:0,class:"key-file-info"},y={key:1,class:"key-error"},F={class:"device-input-section"},_={class:"device-input-row"},w={key:0,class:"device-error"},C={class:"upload-actions"},L={class:"card-header"},z={class:"header-actions"},E={key:0,class:"batch-operations"},D={class:"batch-actions"},W={key:0,class:"device-check-tip"},K={class:"device-message"},B={class:"search-section"},R={key:0,class:"status-tip"},x={class:"pagination-wrapper"};function I(e,a,l,I,S,U){const A=(0,t.g2)("el-progress"),X=(0,t.g2)("upload-filled"),$=(0,t.g2)("el-icon"),M=(0,t.g2)("Refresh"),T=(0,t.g2)("el-upload"),O=(0,t.g2)("el-button"),P=(0,t.g2)("Document"),V=(0,t.g2)("Delete"),j=(0,t.g2)("Key"),Q=(0,t.g2)("el-input"),N=(0,t.g2)("Upload"),Z=(0,t.g2)("el-tag"),H=(0,t.g2)("Monitor"),Y=(0,t.g2)("el-card"),G=(0,t.g2)("Download"),J=(0,t.g2)("InfoFilled"),q=(0,t.g2)("el-tooltip"),ee=(0,t.g2)("Warning"),ae=(0,t.g2)("Search"),le=(0,t.g2)("el-table-column"),te=(0,t.g2)("el-table"),se=(0,t.g2)("el-pagination"),oe=(0,t.g2)("el-dialog"),ne=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",n,[(0,t.bF)(Y,{class:"upload-card"},{header:(0,t.k6)(()=>a[4]||(a[4]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"日志上传")],-1)])),default:(0,t.k6)(()=>[I.uploading?((0,t.uX)(),(0,t.CE)("div",r,[(0,t.bF)(A,{percentage:I.overallProgress,status:I.overallProgress>=100?"success":"","stroke-width":12,"show-text":!0,format:I.progressFormat},null,8,["percentage","status","format"]),(0,t.Lk)("div",i,[(0,t.Lk)("span",{class:(0,s.C4)(["stage",{active:I.overallProgress>=0,completed:I.overallProgress>=30}])}," 文件上传 ",2),(0,t.Lk)("span",{class:(0,s.C4)(["stage",{active:I.overallProgress>=30,completed:I.overallProgress>=60}])}," 解密处理 ",2),(0,t.Lk)("span",{class:(0,s.C4)(["stage",{active:I.overallProgress>=60,completed:I.overallProgress>=100}])}," 解析完成 ",2)])])):(0,t.Q3)("",!0),(0,t.bF)(T,{ref:"uploadRef",action:I.uploadUrl,headers:I.uploadHeaders,"before-upload":I.beforeUpload,"on-success":I.onUploadSuccess,"on-error":I.onUploadError,"on-exceed":I.onExceed,"on-change":I.onFileChange,"on-remove":I.onFileRemove,"on-progress":e.onUploadProgress,"auto-upload":!1,"show-file-list":!1,multiple:!0,limit:50,accept:".medbot",drag:"",name:"file",disabled:I.uploading},{tip:(0,t.k6)(()=>[(0,t.Lk)("div",d,[I.uploading?((0,t.uX)(),(0,t.CE)("div",u,[(0,t.bF)($,{class:"is-loading"},{default:(0,t.k6)(()=>[(0,t.bF)(M)]),_:1}),a[5]||(a[5]=(0,t.eW)(" 正在解析中，请勿刷新页面... "))])):((0,t.uX)(),(0,t.CE)("div",c," 支持上传 .medbot 文件，最多50个文件，总大小不超过200MB，上传后将自动解密并解析 "))])]),default:(0,t.k6)(()=>[(0,t.bF)($,{class:"el-icon--upload"},{default:(0,t.k6)(()=>[(0,t.bF)(X)]),_:1}),a[6]||(a[6]=(0,t.Lk)("div",{class:"el-upload__text"},[(0,t.eW)(" 将文件拖到此处，或"),(0,t.Lk)("em",null,"点击上传")],-1))]),_:1,__:[6]},8,["action","headers","before-upload","on-success","on-error","on-exceed","on-change","on-remove","on-progress","disabled"]),I.uploadFileList.length>0?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.Lk)("div",g,[(0,t.Lk)("span",null,"已选择的文件 ("+(0,s.v_)(I.uploadFileList.length)+")",1),(0,t.bF)(O,{type:"text",size:"small",onClick:I.clearUpload,disabled:I.uploading},{default:(0,t.k6)(()=>a[7]||(a[7]=[(0,t.eW)(" 清空 ")])),_:1,__:[7]},8,["onClick","disabled"])]),(0,t.Lk)("div",v,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(I.uploadFileList,(e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"file-item"},[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(P)]),_:1}),(0,t.Lk)("span",k,(0,s.v_)(e.name||e.originalname),1),(0,t.Lk)("span",h,(0,s.v_)(I.formatFileSize(e.size||e.raw?.size||0)),1),(0,t.bF)(O,{type:"text",size:"small",onClick:e=>I.removeFile(a),disabled:I.uploading},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(V)]),_:1})]),_:2},1032,["onClick","disabled"])]))),128))])])):(0,t.Q3)("",!0),(0,t.Lk)("div",b,[(0,t.Lk)("div",f,[(0,t.bF)(Q,{modelValue:I.decryptKey,"onUpdate:modelValue":a[0]||(a[0]=e=>I.decryptKey=e),placeholder:"请输入解密密钥（MAC地址格式，如：00-01-05-77-6a-09）",style:{width:"300px"},clearable:"",onBlur:I.validateKeyFormat},{prefix:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(j)]),_:1})]),_:1},8,["modelValue","onBlur"]),(0,t.bF)(O,{type:"primary",plain:"",onClick:I.autoFillDeviceId,disabled:!I.decryptKey.trim()},{default:(0,t.k6)(()=>a[8]||(a[8]=[(0,t.eW)(" 自动填充设备编号 ")])),_:1,__:[8]},8,["onClick","disabled"]),a[10]||(a[10]=(0,t.Lk)("span",{class:"key-separator"},"或",-1)),(0,t.bF)(T,{ref:"keyUploadRef","auto-upload":!1,"show-file-list":!1,accept:".txt","before-upload":I.beforeKeyUpload,"on-change":I.onKeyFileChange},{default:(0,t.k6)(()=>[(0,t.bF)(O,{type:"primary",plain:""},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(N)]),_:1}),a[9]||(a[9]=(0,t.eW)(" 上传密钥文件 "))]),_:1,__:[9]})]),_:1},8,["before-upload","on-change"])]),I.keyFileName?((0,t.uX)(),(0,t.CE)("div",m,[(0,t.bF)(Z,{type:"success",size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(P)]),_:1}),(0,t.eW)(" "+(0,s.v_)(I.keyFileName),1)]),_:1})])):(0,t.Q3)("",!0),I.keyError?((0,t.uX)(),(0,t.CE)("div",y,[(0,t.bF)(Z,{type:"danger",size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(I.keyError),1)]),_:1})])):(0,t.Q3)("",!0)]),(0,t.Lk)("div",F,[(0,t.Lk)("div",_,[(0,t.bF)(Q,{modelValue:I.deviceId,"onUpdate:modelValue":a[1]||(a[1]=e=>I.deviceId=e),placeholder:"设备编号（格式：数字或字母组合，例：4371-01、ABC-12，默认为0000-00）",style:{width:"300px"},clearable:"",onBlur:I.validateDeviceIdFormat},{prefix:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(H)]),_:1})]),_:1},8,["modelValue","onBlur"]),(0,t.bF)(O,{type:"primary",plain:"",onClick:I.autoFillKey,disabled:!I.deviceId.trim()},{default:(0,t.k6)(()=>a[11]||(a[11]=[(0,t.eW)(" 自动填充密钥 ")])),_:1,__:[11]},8,["onClick","disabled"])]),I.deviceIdError?((0,t.uX)(),(0,t.CE)("div",w,[(0,t.bF)(Z,{type:"danger",size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(I.deviceIdError),1)]),_:1})])):(0,t.Q3)("",!0)]),(0,t.Lk)("div",C,[(0,t.bF)(O,{type:"primary",onClick:I.submitUpload,loading:I.uploading,disabled:I.uploading||!I.decryptKey.trim()||0===I.uploadFileList.length},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(I.uploading?"解析中...":"上传并解析"),1)]),_:1},8,["onClick","loading","disabled"])])]),_:1}),(0,t.bF)(Y,{class:"list-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",L,[a[14]||(a[14]=(0,t.Lk)("span",null,"日志列表",-1)),(0,t.Lk)("div",z,[I.selectedLogs.length>0?((0,t.uX)(),(0,t.CE)("div",E,[(0,t.Lk)("div",D,[(0,t.bF)(O,{type:"primary",size:"small",onClick:I.handleBatchAnalyze,disabled:!I.canBatchOperate||!I.isSameDevice,title:I.deviceCheckMessage},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(H)]),_:1}),(0,t.eW)(" 批量分析 ("+(0,s.v_)(I.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled","title"]),(0,t.bF)(O,{type:"success",size:"small",onClick:I.handleBatchDownload,disabled:!I.canBatchOperate},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(G)]),_:1}),(0,t.eW)(" 批量下载 ("+(0,s.v_)(I.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled"]),(0,t.bF)(O,{type:"danger",size:"small",onClick:I.handleBatchDelete,disabled:!I.canBatchDelete},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(V)]),_:1}),(0,t.eW)(" 批量删除 ("+(0,s.v_)(I.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled"]),3===e.userRole?((0,t.uX)(),(0,t.Wv)(q,{key:0,content:"普通用户只能删除自己上传的日志",placement:"top"},{default:(0,t.k6)(()=>[(0,t.bF)($,{class:"info-icon"},{default:(0,t.k6)(()=>[(0,t.bF)(J)]),_:1})]),_:1})):(0,t.Q3)("",!0),(0,t.bF)(O,{type:"info",size:"small",onClick:I.clearSelection},{default:(0,t.k6)(()=>a[12]||(a[12]=[(0,t.eW)(" 取消选择 ")])),_:1,__:[12]},8,["onClick"])]),I.deviceCheckMessage?((0,t.uX)(),(0,t.CE)("div",W,[(0,t.bF)(Z,{type:"warning",size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(ee)]),_:1}),(0,t.Lk)("span",K,(0,s.v_)(I.deviceCheckMessage),1)]),_:1})])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),(0,t.Lk)("div",B,[(0,t.bF)(Q,{modelValue:I.filterDeviceId,"onUpdate:modelValue":a[2]||(a[2]=e=>I.filterDeviceId=e),placeholder:"按设备编号筛选",class:"search-input",clearable:"",onKeyup:(0,o.jR)(I.loadLogs,["enter"])},{prefix:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(ae)]),_:1})]),_:1},8,["modelValue","onKeyup"]),(0,t.bF)(O,{type:"primary",size:"small",onClick:I.loadLogs},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(M)]),_:1}),a[13]||(a[13]=(0,t.eW)(" 刷新 "))]),_:1,__:[13]},8,["onClick"])])])])]),default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(te,{data:I.logs,loading:I.loading,style:{width:"100%"},onSelectionChange:I.handleSelectionChange},{default:(0,t.k6)(()=>[(0,t.bF)(le,{type:"selection",width:"55"}),(0,t.bF)(le,{prop:"original_name",label:"原始文件名",width:"200"}),(0,t.bF)(le,{prop:"device_id",label:"设备编号",width:"120"}),(0,t.bF)(le,{prop:"uploader_id",label:"用户ID",width:"80"}),(0,t.bF)(le,{prop:"upload_time",label:"上传时间",width:"150"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,s.v_)(I.formatDate(e.upload_time)),1)]),_:1}),(0,t.bF)(le,{label:"状态",width:"120",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(Z,{type:I.getStatusType(e.status),size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(I.getStatusText(e.status)),1)]),_:2},1032,["type"]),I.canOperate(e)?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",R,[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(ee)]),_:1}),a[15]||(a[15]=(0,t.Lk)("span",null,"处理中，请稍候",-1))]))]),_:1}),(0,t.bF)(le,{label:"操作",width:"240",fixed:"right"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(O,{size:"small",type:"primary",onClick:a=>I.goToLogAnalysis(e),disabled:!I.canOperate(e)},{default:(0,t.k6)(()=>a[16]||(a[16]=[(0,t.eW)(" 分析 ")])),_:2,__:[16]},1032,["onClick","disabled"]),(0,t.bF)(O,{size:"small",type:"success",onClick:a=>I.handleDownload(e),disabled:!I.canOperate(e)},{default:(0,t.k6)(()=>a[17]||(a[17]=[(0,t.eW)(" 下载 ")])),_:2,__:[17]},1032,["onClick","disabled"]),I.canDeleteLog(e)?((0,t.uX)(),(0,t.Wv)(O,{key:0,size:"small",type:"danger",onClick:a=>I.handleDelete(e),disabled:!I.canOperate(e)},{default:(0,t.k6)(()=>a[18]||(a[18]=[(0,t.eW)(" 删除 ")])),_:2,__:[18]},1032,["onClick","disabled"])):(0,t.Q3)("",!0)]),_:1})]),_:1},8,["data","loading","onSelectionChange"])),[[ne,I.loading]]),(0,t.Lk)("div",x,[(0,t.bF)(se,{"current-page":I.currentPage,"page-size":I.pageSize,"page-sizes":[10,20,50,100],total:I.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I.handleSizeChange,onCurrentChange:I.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),(0,t.bF)(oe,{modelValue:e.showEntriesDialog,"onUpdate:modelValue":a[3]||(a[3]=a=>e.showEntriesDialog=a),title:"日志分析",width:"900px"},{default:(0,t.k6)(()=>[(0,t.bF)(te,{data:e.logEntries,style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(le,{prop:"timestamp",label:"时间戳",width:"180"}),(0,t.bF)(le,{prop:"error_code",label:"故障码",width:"100"}),(0,t.bF)(le,{prop:"param1",label:"参数1",width:"100"}),(0,t.bF)(le,{prop:"param2",label:"参数2",width:"100"}),(0,t.bF)(le,{prop:"param3",label:"参数3",width:"100"}),(0,t.bF)(le,{prop:"param4",label:"参数4",width:"100"}),(0,t.bF)(le,{prop:"explanation",label:"日志解释"})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}var S=l(953),U=l(6278),A=l(5220),X=l(163),$=l(7918),M={name:"Logs",setup(){const e=(0,U.Pj)(),a=(0,A.rd)(),l=(0,S.KR)(!1),s=(0,S.KR)(!1),o=(0,S.KR)(0),n=(0,S.KR)(null),r=(0,S.KR)(null),i=(0,S.KR)(1),d=(0,S.KR)(20),c=(0,S.KR)(""),u=(0,S.KR)(""),p=(0,S.KR)(""),g=(0,S.KR)(""),v=(0,S.KR)([]),k=(0,S.KR)(""),h=(0,S.KR)(""),b=(0,S.KR)([]),f=(0,t.EW)(()=>e.getters["logs/logsList"]),m=(0,t.EW)(()=>e.getters["logs/totalCount"]),y=(0,t.EW)(()=>"/api/logs/upload"),F=(0,t.EW)(()=>({Authorization:`Bearer ${e.state.auth.token}`,"X-Decrypt-Key":c.value,"X-Device-ID":p.value})),_=(0,t.EW)(()=>e.state.auth.user?.role_id),w=(0,t.EW)(()=>e.state.auth.user?.id),C=(0,t.EW)(()=>b.value.length>0&&b.value.every(e=>de(e))),L=(0,t.EW)(()=>{if(0===b.value.length)return!0;const e=b.value[0].device_id;return b.value.every(a=>a.device_id===e)}),z=(0,t.EW)(()=>{if(0===b.value.length)return"";if(!L.value){const e=[...new Set(b.value.map(e=>e.device_id))];return`选中日志包含不同的设备: ${e.join(", ")}`}return""}),E=(0,t.EW)(()=>b.value.length>0&&b.value.every(e=>D(e))),D=e=>1===_.value||(2===_.value||3===_.value&&e.uploader_id===w.value),W=async()=>{try{l.value=!0,await e.dispatch("logs/fetchLogs",{page:i.value,limit:d.value,device_id:g.value||void 0})}catch(a){X.nk.error("加载日志失败")}finally{l.value=!1}},K=e=>{d.value=e,i.value=1,W()},B=e=>{i.value=e,W()},R=()=>{if(!c.value.trim())return void X.nk.error("请输入解密密钥或上传密钥文件");const e=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;if(!e.test(c.value))return void X.nk.error("密钥格式不正确，应为MAC地址格式（如：00-01-05-77-6a-09）");if(!p.value.trim())return void X.nk.warning("请输入设备编号，或使用默认值0000-00");if(!p.value||"0000-00"===p.value)return void X.nk.warning("请输入设备编号，或使用默认值0000-00");{const e=/^[0-9A-Za-z]+-[0-9A-Za-z]+$/;if(!e.test(p.value))return void X.nk.error("设备编号格式不正确，应为数字或字母组合格式（如：4371-01、ABC-12、123-XY）")}if(!n.value)return void X.nk.error("上传组件未初始化");if(0===v.value.length)return void X.nk.error("请选择要上传的文件");if(v.value.length>50)return void X.nk.error("最多只能上传50个文件");const a=v.value.reduce((e,a)=>e+(a.size||a.raw?.size||0),0);a/1024/1024>200?X.nk.error("总文件大小不能超过200MB"):n.value.submit()},x=e=>{const a=e.name.endsWith(".medbot"),l=e.size/1024/1024<200;return a?l?!!c.value.trim()||(X.nk.error("请输入解密密钥或上传密钥文件!"),!1):(X.nk.error("单个文件大小不能超过200MB!"),!1):(X.nk.error("只能上传 .medbot 文件!"),!1)},I=e=>{const a=e.name.endsWith(".txt"),l="systemInfo.txt"===e.name,t=e.size/1024/1024<1;return a?l?(t||X.nk.error("密钥文件大小不能超过1MB!"),!1):(X.nk.error("密钥文件名必须是 systemInfo.txt!"),!1):(X.nk.error("密钥文件必须是 .txt 格式!"),!1)},M=e=>{const a=new FileReader;a.onload=a=>{const l=a.target.result.trim(),t=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;t.test(l)?(c.value=l,u.value=e.name,k.value="",X.nk.success("密钥文件读取成功")):X.nk.error("密钥文件内容格式不正确，应为MAC地址格式（如：00-01-05-77-6a-09）")},a.readAsText(e.raw)},T=()=>{n.value&&n.value.clearFiles(),r.value&&r.value.clearFiles(),v.value=[],c.value="",u.value="",p.value="",k.value="",h.value="",s.value=!1,o.value=0},O=e=>e<30?`文件上传中 ${e}%`:e<60?`解密处理中 ${e}%`:e<100?`解析处理中 ${e}%`:`处理完成 ${e}%`,P=()=>{if(s.value)return"解析正在进行中，刷新页面可能导致解析失败。确定要离开吗？"};(0,t.sV)(()=>{window.addEventListener("beforeunload",P)});const V=(e,a,l)=>{if(v.value=l,0===l.length){s.value=!0,X.nk.success("文件上传完成，正在解密和解析中...");let e=30,a=0;const l=setInterval(()=>{e<60?(e+=2,o.value=e):(clearInterval(l),t())},100),t=()=>{const e=setInterval(()=>{a<40?(a+=1,o.value=60+a):(clearInterval(e),n())},200)},n=async()=>{try{await W();const e=f.value.every(e=>"parsed"===e.status);if(e){o.value=100,s.value=!1;const e=v.value.map(e=>e.name||e.originalname).join(", ");X.nk.success(`${e} 上传成功，解析完成`),T()}else setTimeout(n,1e3)}catch(e){s.value=!1,o.value=0,X.nk.error("检查解析状态失败"),T()}};setTimeout(()=>{},500)}else X.nk.success(`文件 ${a.name} 上传成功，正在处理中...`)},j=e=>{X.nk.error("上传失败: "+(e.message||"未知错误"))},Q=(e,a)=>{X.nk.error("最多只能上传50个文件!")},N=(e,a)=>{v.value=a},Z=(e,a)=>{v.value=a},H=e=>{v.value.splice(e,1)},Y=async a=>{try{a.parsing=!0,await e.dispatch("logs/parseLog",a.id),X.nk.success("解析成功"),W()}catch(l){X.nk.error("解析失败")}finally{a.parsing=!1}},G=async a=>{try{const l=await e.dispatch("logs/downloadLog",a.id),t=new Blob([l.data]),s=window.URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=a.filename,o.click(),window.URL.revokeObjectURL(s),X.nk.success("下载成功")}catch(l){X.nk.error("下载失败")}},J=async a=>{try{await $.s.confirm("确定要删除这个日志文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await e.dispatch("logs/deleteLog",a.id),X.nk.success("删除成功"),W()}catch(l){"cancel"!==l&&X.nk.error("删除失败")}},q=e=>{const l=a.resolve(`/analysis/${e.id}`);window.open(l.href,"_blank")},ee=e=>{if(0===e)return"0 B";const a=1024,l=["B","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,t)).toFixed(2))+" "+l[t]},ae=e=>e?new Date(e).toLocaleString("zh-CN"):"-",le=e=>{const a={uploading:"warning",decrypting:"warning",parsing:"warning",parsed:"success",failed:"danger"};return a[e]||"info"},te=e=>{const a={uploading:"上传中",decrypting:"解密中",parsing:"解析中",parsed:"完成",failed:"解析失败"};return a[e]||e},se=e=>{b.value=e;try{sessionStorage.setItem("selectedLogs",JSON.stringify(e))}catch(a){console.warn("保存选中日志到sessionStorage失败:",a)}},oe=()=>{b.value=[]},ne=()=>{const e=b.value.map(e=>e.id).join(","),l=a.resolve(`/batch-analysis/${e}`);window.open(l.href,"_blank")},re=async()=>{try{X.nk.info("正在打包文件，请稍候...");const a=b.value.map(e=>e.id),l=await e.dispatch("logs/batchDownloadLogs",a),t=new Blob([l.data]),s=window.URL.createObjectURL(t),o=document.createElement("a");o.href=s;const n=(new Date).toISOString().replace(/[:.]/g,"-");o.download=`logs_batch_${n}.zip`,o.click(),window.URL.revokeObjectURL(s),X.nk.success("批量下载完成")}catch(a){console.error("批量下载失败:",a);const e=a.response?.data?.message||a.message||"批量下载失败";X.nk.error(e)}},ie=async()=>{try{await $.s.confirm(`确定要删除选中的 ${b.value.length} 个日志文件吗？此操作不可恢复！`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),X.nk.info("开始批量删除...");const l=[...b.value],t=l.map(e=>parseInt(e.id)).filter(e=>!isNaN(e));if(0===t.length)return void X.nk.error("选中的日志ID格式不正确");let s;try{s=await e.dispatch("logs/batchDeleteLogs",t)}catch(a){console.error("批量删除失败:",a);const e=a.response?.data?.message||a.message||"批量删除失败";return void X.nk.error(e)}s.data.failCount>0?(X.nk.warning(`批量删除完成，成功 ${s.data.successCount} 个，失败 ${s.data.failCount} 个`),s.data.failedLogs&&s.data.failedLogs.length>0&&console.error("删除失败的日志:",s.data.failedLogs)):X.nk.success(s.data.message),W(),oe()}catch(l){if("cancel"!==l){console.error("批量删除错误:",l),console.error("错误详情:",{name:l.name,message:l.message,code:l.code,response:l.response?.data,status:l.response?.status,statusText:l.response?.statusText,config:{url:l.config?.url,method:l.config?.method,data:l.config?.data}});let e="批量删除失败";l.response?.data?.message?e=l.response.data.message:l.message&&(e=l.message),X.nk.error(e)}}},de=e=>"parsed"===e.status,ce=async()=>{try{const a=await e.dispatch("logs/autoFillKey",p.value);a.data.key?(c.value=a.data.key,X.nk.success("已自动填充密钥")):X.nk.warning("未找到该设备编号对应的密钥")}catch(a){console.error("自动填充密钥错误:",a);const e=a.response?.data?.message||a.message||"自动填充密钥失败";X.nk.error(e)}},ue=()=>{const e=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;c.value&&!e.test(c.value)?k.value="请输入有效的MAC地址格式密钥 (如: 00-01-05-77-6a-09)":k.value=""},pe=async()=>{try{const a=await e.dispatch("logs/autoFillDeviceId",c.value);a.data.device_id?(p.value=a.data.device_id,X.nk.success("已自动填充设备编号")):X.nk.warning("未找到该密钥对应的设备编号")}catch(a){console.error("自动填充设备编号错误:",a);const e=a.response?.data?.message||a.message||"自动填充设备编号失败";X.nk.error(e)}},ge=()=>{const e=/^[0-9A-Za-z]+-[0-9A-Za-z]+$/;p.value&&!e.test(p.value)?h.value="请输入有效的设备编号格式 (如: 4371-01、ABC-12、123-XY)":h.value=""};return(0,t.sV)(()=>{W()}),{loading:l,uploading:s,overallProgress:o,progressFormat:O,uploadRef:n,currentPage:i,pageSize:d,logs:f,total:m,uploadUrl:y,uploadHeaders:F,loadLogs:W,handleSizeChange:K,handleCurrentChange:B,beforeUpload:x,submitUpload:R,clearUpload:T,onUploadSuccess:V,onUploadError:j,onExceed:Q,onFileChange:N,onFileRemove:Z,removeFile:H,handleParse:Y,handleDownload:G,handleDelete:J,formatFileSize:ee,formatDate:ae,getStatusType:le,getStatusText:te,goToLogAnalysis:q,decryptKey:c,keyUploadRef:r,keyFileName:u,deviceId:p,filterDeviceId:g,uploadFileList:v,beforeKeyUpload:I,onKeyFileChange:M,canDeleteLog:D,canOperate:de,keyError:k,deviceIdError:h,autoFillKey:ce,validateKeyFormat:ue,autoFillDeviceId:pe,validateDeviceIdFormat:ge,selectedLogs:b,canBatchOperate:C,canBatchDelete:E,isSameDevice:L,deviceCheckMessage:z,handleSelectionChange:se,clearSelection:oe,handleBatchAnalyze:ne,handleBatchDownload:re,handleBatchDelete:ie}}},T=l(6262);const O=(0,T.A)(M,[["render",I],["__scopeId","data-v-525b3581"]]);var P=O}}]);
//# sourceMappingURL=589.2ba42775.js.map