"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[60],{8060:function(e,l,a){a.r(l),a.d(l,{default:function(){return _}});var i=a(641),d=a(3751);const t={class:"devices-container"},o={class:"action-bar"},s={class:"search-section"},n={key:0,class:"action-section"},c={class:"pagination-wrapper"};function r(e,l,a,r,u,p){const v=(0,i.g2)("el-input"),m=(0,i.g2)("el-button"),g=(0,i.g2)("el-table-column"),b=(0,i.g2)("el-table"),k=(0,i.g2)("el-pagination"),f=(0,i.g2)("el-card"),_=(0,i.g2)("el-form-item"),h=(0,i.g2)("el-form"),y=(0,i.g2)("el-dialog");return(0,i.uX)(),(0,i.CE)("div",t,[(0,i.Lk)("div",o,[(0,i.Lk)("div",s,[(0,i.bF)(v,{modelValue:r.search,"onUpdate:modelValue":l[0]||(l[0]=e=>r.search=e),placeholder:"搜索设备（编号/型号/密钥/医院）...",style:{width:"300px"},clearable:"",onKeyup:(0,d.jR)(r.loadDevices,["enter"])},null,8,["modelValue","onKeyup"]),(0,i.bF)(m,{onClick:r.loadDevices},{default:(0,i.k6)(()=>[...l[10]||(l[10]=[(0,i.eW)("查询",-1)])]),_:1},8,["onClick"])]),r.canEdit?((0,i.uX)(),(0,i.CE)("div",n,[(0,i.bF)(m,{type:"primary",onClick:l[1]||(l[1]=e=>r.openEdit())},{default:(0,i.k6)(()=>[...l[11]||(l[11]=[(0,i.eW)("新增设备",-1)])]),_:1})])):(0,i.Q3)("",!0)]),(0,i.bF)(f,{class:"list-card"},{default:(0,i.k6)(()=>[(0,i.bF)(b,{data:r.devices,loading:r.loading,style:{width:"100%"}},{default:(0,i.k6)(()=>[(0,i.bF)(g,{prop:"device_id",label:"设备编号",width:"160"}),(0,i.bF)(g,{prop:"device_model",label:"设备型号",width:"160"}),(0,i.bF)(g,{prop:"device_key",label:"设备密钥(MAC)",width:"200"}),(0,i.bF)(g,{prop:"hospital",label:"所属医院"}),r.canEdit?((0,i.uX)(),(0,i.Wv)(g,{key:0,label:"操作",width:"200"},{default:(0,i.k6)(({row:e})=>[(0,i.bF)(m,{size:"small",onClick:l=>r.openEdit(e)},{default:(0,i.k6)(()=>[...l[12]||(l[12]=[(0,i.eW)("编辑",-1)])]),_:2},1032,["onClick"]),(0,i.bF)(m,{size:"small",type:"danger",onClick:l=>r.onDelete(e)},{default:(0,i.k6)(()=>[...l[13]||(l[13]=[(0,i.eW)("删除",-1)])]),_:2},1032,["onClick"])]),_:1})):(0,i.Q3)("",!0)]),_:1},8,["data","loading"]),(0,i.Lk)("div",c,[(0,i.bF)(k,{"current-page":r.page,"page-size":r.limit,total:r.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:l[2]||(l[2]=e=>{r.page=e,r.loadDevices()}),onSizeChange:l[3]||(l[3]=e=>{r.limit=e,r.page=1,r.loadDevices()})},null,8,["current-page","page-size","total"])])]),_:1}),(0,i.bF)(y,{modelValue:r.showEdit,"onUpdate:modelValue":l[9]||(l[9]=e=>r.showEdit=e),title:r.editing?"编辑设备":"新增设备",width:"520px"},{footer:(0,i.k6)(()=>[(0,i.bF)(m,{onClick:l[8]||(l[8]=e=>r.showEdit=!1)},{default:(0,i.k6)(()=>[...l[14]||(l[14]=[(0,i.eW)("取消",-1)])]),_:1}),(0,i.bF)(m,{type:"primary",loading:r.saving,onClick:r.save},{default:(0,i.k6)(()=>[...l[15]||(l[15]=[(0,i.eW)("保存",-1)])]),_:1},8,["loading","onClick"])]),default:(0,i.k6)(()=>[(0,i.bF)(h,{model:r.form,"label-width":"110px",rules:r.rules,ref:"formRef"},{default:(0,i.k6)(()=>[(0,i.bF)(_,{label:"设备编号",prop:"device_id"},{default:(0,i.k6)(()=>[(0,i.bF)(v,{modelValue:r.form.device_id,"onUpdate:modelValue":l[4]||(l[4]=e=>r.form.device_id=e),disabled:!!r.editing,placeholder:"如 4371-01 / ABC-12"},null,8,["modelValue","disabled"])]),_:1}),(0,i.bF)(_,{label:"设备型号",prop:"device_model"},{default:(0,i.k6)(()=>[(0,i.bF)(v,{modelValue:r.form.device_model,"onUpdate:modelValue":l[5]||(l[5]=e=>r.form.device_model=e)},null,8,["modelValue"])]),_:1}),(0,i.bF)(_,{label:"设备密钥(MAC)",prop:"device_key"},{default:(0,i.k6)(()=>[(0,i.bF)(v,{modelValue:r.form.device_key,"onUpdate:modelValue":l[6]||(l[6]=e=>r.form.device_key=e),placeholder:"00-01-05-77-6a-09"},null,8,["modelValue"])]),_:1}),(0,i.bF)(_,{label:"所属医院",prop:"hospital"},{default:(0,i.k6)(()=>[(0,i.bF)(v,{modelValue:r.form.hospital,"onUpdate:modelValue":l[7]||(l[7]=e=>r.form.hospital=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}var u=a(953),p=a(163),v=a(7918),m=a(5495),g=a(6278),b={name:"Devices",setup(){const e=(0,g.Pj)(),l=(0,i.EW)(()=>{const l=e.getters["auth/userRole"];return"admin"===l||"expert"===l}),a=(0,u.KR)(!1),d=(0,u.KR)(!1),t=(0,u.KR)([]),o=(0,u.KR)(0),s=(0,u.KR)(1),n=(0,u.KR)(20),c=(0,u.KR)(""),r=(0,u.KR)(!1),b=(0,u.KR)(null),k=(0,u.KR)(null),f=(0,u.Kh)({device_id:"",device_model:"",device_key:"",hospital:""}),_={device_id:[{required:!0,message:"请输入设备编号",trigger:"blur"},{pattern:/^[0-9A-Za-z]+-[0-9A-Za-z]+$/,message:"格式如 4371-01 / ABC-12",trigger:"blur"}],device_key:[{pattern:/^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/,message:"请输入MAC地址格式",trigger:"blur"}]},h=async()=>{a.value=!0;try{const e=await m.A.devices.getList({page:s.value,limit:n.value,search:c.value});t.value=e.data.devices||[],o.value=e.data.total||0}catch{p.nk.error("加载设备失败")}finally{a.value=!1}},y=e=>{e?(b.value=e,Object.assign(f,{device_id:e.device_id,device_model:e.device_model,device_key:e.device_key,hospital:e.hospital})):(b.value=null,Object.assign(f,{device_id:"",device_model:"",device_key:"",hospital:""})),r.value=!0},F=async()=>{await(k.value?.validate()),d.value=!0;try{b.value?(await m.A.devices.update(b.value.id,f),p.nk.success("更新成功")):(await m.A.devices.create(f),p.nk.success("创建成功")),r.value=!1,await h()}catch(e){p.nk.error(e?.response?.data?.message||"保存失败")}finally{d.value=!1}},w=async e=>{try{await v.s.confirm("确定删除该设备？","提示",{type:"warning"}),await m.A.devices.delete(e.id),p.nk.success("删除成功"),h()}catch(l){"cancel"!==l&&p.nk.error(l?.response?.data?.message||"删除失败")}};return(0,i.sV)(h),{devices:t,total:o,page:s,limit:n,search:c,loading:a,saving:d,showEdit:r,editing:b,form:f,rules:_,formRef:k,canEdit:l,loadDevices:h,openEdit:y,save:F,onDelete:w}}},k=a(6262);const f=(0,k.A)(b,[["render",r],["__scopeId","data-v-5bec2bc9"]]);var _=f}}]);
//# sourceMappingURL=60.63a519ff.js.map