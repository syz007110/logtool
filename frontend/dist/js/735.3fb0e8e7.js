"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[735],{9735:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});var l=t(641),n=t(33);const r={class:"analysis-container"},o={class:"card-header"},i={class:"header-left"},s={class:"header-right"},d={key:0,class:"log-info"},u={class:"search-section"},g={class:"entries-section"},c={class:"section-header"},p={key:0,class:"loading-section"},m={key:1,class:"error-section"},h={key:2,class:"table-container"},f={key:3,class:"pagination-wrapper"};function v(e,a,t,v,b,k){const _=(0,l.g2)("el-tag"),w=(0,l.g2)("Download"),C=(0,l.g2)("el-icon"),y=(0,l.g2)("el-button"),F=(0,l.g2)("el-descriptions-item"),S=(0,l.g2)("el-descriptions"),L=(0,l.g2)("Search"),R=(0,l.g2)("el-input"),z=(0,l.g2)("el-date-picker"),D=(0,l.g2)("el-empty"),E=(0,l.g2)("el-table-column"),W=(0,l.g2)("el-table"),x=(0,l.g2)("el-pagination"),I=(0,l.g2)("el-card"),M=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(I,{class:"analysis-card"},{header:(0,l.k6)(()=>[(0,l.Lk)("div",o,[(0,l.Lk)("div",i,[a[2]||(a[2]=(0,l.Lk)("span",{class:"title"},"日志分析",-1)),v.logInfo.original_name?((0,l.uX)(),(0,l.Wv)(_,{key:0,type:"info",size:"small"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(v.logInfo.original_name),1)]),_:1})):(0,l.Q3)("",!0)]),(0,l.Lk)("div",s,[(0,l.bF)(y,{onClick:v.exportToCSV,type:"success",size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(C,null,{default:(0,l.k6)(()=>[(0,l.bF)(w)]),_:1}),a[3]||(a[3]=(0,l.eW)(" 导出CSV "))]),_:1,__:[3]},8,["onClick"])])])]),default:(0,l.k6)(()=>[v.logInfo.id?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.bF)(S,{column:3,border:"",size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(F,{label:"文件名"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(v.logInfo.original_name),1)]),_:1}),(0,l.bF)(F,{label:"设备编号"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(v.logInfo.device_id),1)]),_:1}),(0,l.bF)(F,{label:"文件大小"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(v.formatFileSize(v.logInfo.size)),1)]),_:1}),(0,l.bF)(F,{label:"上传时间"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(v.formatDate(v.logInfo.upload_time)),1)]),_:1}),(0,l.bF)(F,{label:"解析时间"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(v.formatDate(v.logInfo.parse_time)),1)]),_:1}),(0,l.bF)(F,{label:"上传用户ID"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(v.logInfo.uploader_id),1)]),_:1})]),_:1})])):(0,l.Q3)("",!0),(0,l.Lk)("div",u,[(0,l.bF)(R,{modelValue:v.searchKeyword,"onUpdate:modelValue":a[0]||(a[0]=e=>v.searchKeyword=e),placeholder:"搜索释义内容或故障码",style:{width:"250px","margin-right":"15px"},clearable:"",onInput:v.handleSearch},{prefix:(0,l.k6)(()=>[(0,l.bF)(C,null,{default:(0,l.k6)(()=>[(0,l.bF)(L)]),_:1})]),_:1},8,["modelValue","onInput"]),(0,l.bF)(z,{modelValue:v.timeRange,"onUpdate:modelValue":a[1]||(a[1]=e=>v.timeRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"300px","margin-right":"15px"},onChange:v.handleTimeRangeChange},null,8,["modelValue","onChange"]),v.timeRangeLimit?((0,l.uX)(),(0,l.Wv)(_,{key:0,type:"info",size:"small",style:{"margin-left":"10px"}},{default:(0,l.k6)(()=>[(0,l.eW)(" 可选范围: "+(0,n.v_)(v.formatTimestamp(v.timeRangeLimit[0]))+" 至 "+(0,n.v_)(v.formatTimestamp(v.timeRangeLimit[1])),1)]),_:1})):(0,l.Q3)("",!0),v.timeRangeLimit?((0,l.uX)(),(0,l.Wv)(y,{key:1,onClick:v.setFullTimeRange,type:"primary",size:"small",style:{"margin-left":"10px"}},{default:(0,l.k6)(()=>a[4]||(a[4]=[(0,l.eW)(" 选择全部时间 ")])),_:1,__:[4]},8,["onClick"])):(0,l.Q3)("",!0),(0,l.bF)(y,{onClick:v.clearFilters,type:"info",size:"small"},{default:(0,l.k6)(()=>a[5]||(a[5]=[(0,l.eW)(" 清除筛选 ")])),_:1,__:[5]},8,["onClick"])]),(0,l.Lk)("div",g,[(0,l.Lk)("div",c,[(0,l.Lk)("h3",null,"日志条目 ("+(0,n.v_)(v.filteredEntries.length)+")",1)]),v.loading?((0,l.uX)(),(0,l.CE)("div",p,[(0,l.bF)(D,{description:"正在加载日志数据..."})])):0===v.logEntries.length?((0,l.uX)(),(0,l.CE)("div",m,[(0,l.bF)(D,{description:"未找到日志条目"})])):((0,l.uX)(),(0,l.CE)("div",h,[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(W,{data:v.paginatedEntries,style:{width:"100%"},height:"calc(100vh - 350px)",stripe:""},{default:(0,l.k6)(()=>[(0,l.bF)(E,{prop:"timestamp",label:"时间戳",width:"180",sortable:""},{default:(0,l.k6)(({row:e})=>[(0,l.eW)((0,n.v_)(v.formatTimestamp(e.timestamp)),1)]),_:1}),(0,l.bF)(E,{prop:"error_code",label:"故障码",width:"120",sortable:""}),(0,l.bF)(E,{prop:"param1",label:"参数1",width:"100"}),(0,l.bF)(E,{prop:"param2",label:"参数2",width:"100"}),(0,l.bF)(E,{prop:"param3",label:"参数3",width:"100"}),(0,l.bF)(E,{prop:"param4",label:"参数4",width:"100"}),(0,l.bF)(E,{prop:"explanation",label:"释义","min-width":"300","show-overflow-tooltip":""})]),_:1},8,["data"])),[[M,v.loading]])])),v.filteredEntries.length>0?((0,l.uX)(),(0,l.CE)("div",f,[(0,l.bF)(x,{"current-page":v.currentPage,"page-size":v.pageSize,"page-sizes":[50,100,200,500],total:v.filteredEntries.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v.handleSizeChange,onCurrentChange:v.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])):(0,l.Q3)("",!0)])]),_:1})])}var b=t(953),k=t(6278),_=t(5220),w=t(163),C=t(8548),y={name:"Analysis",components:{Search:C.Search,Download:C.Download,ArrowLeft:C.ArrowLeft},setup(){const e=(0,k.Pj)(),a=(0,_.lq)(),t=(0,_.rd)(),n=a.params.id,r=(0,b.KR)(!1),o=(0,b.KR)({}),i=(0,b.KR)([]),s=(0,b.KR)(""),d=(0,b.KR)(null),u=(0,b.KR)(1),g=(0,b.KR)(100),c=(0,l.EW)(()=>{if(0===i.value.length)return null;const e=i.value.map(e=>new Date(e.timestamp)),a=new Date(Math.min(...e)),t=new Date(Math.max(...e));return console.log("时间范围限制:",{minTime:a.toISOString(),maxTime:t.toISOString(),entriesCount:i.value.length}),[a,t]}),p=(0,l.EW)(()=>{let e=i.value;if(s.value&&(e=e.filter(e=>e.explanation.toLowerCase().includes(s.value.toLowerCase())||e.error_code.toLowerCase().includes(s.value.toLowerCase()))),d.value&&2===d.value.length){const[a,t]=d.value;e=e.filter(e=>{const l=new Date(e.timestamp),n=new Date(a),r=new Date(t);return l>=n&&l<=r})}return e}),m=(0,l.EW)(()=>{const e=(u.value-1)*g.value,a=e+g.value;return p.value.slice(e,a)}),h=async()=>{try{r.value=!0;const a=await e.dispatch("logs/fetchLogs",{page:1,limit:1e3}),l=a.data.logs.find(e=>e.id==n);l?o.value=l:(w.nk.error("日志不存在"),t.go(-1))}catch(a){w.nk.error("加载日志信息失败")}finally{r.value=!1}},f=async()=>{try{r.value=!0;const a=await e.dispatch("logs/fetchLogEntries",n);i.value=a.data?.entries||a.entries||[]}catch(a){w.nk.error("加载日志条目失败")}finally{r.value=!1}},v=()=>{u.value=1},C=()=>{u.value=1},y=()=>{s.value="",d.value=null,u.value=1},F=()=>{const e=["时间戳","故障码","参数1","参数2","参数3","参数4","释义"],a=[e.join(","),...p.value.map(e=>[D(e.timestamp),e.error_code,e.param1,e.param2,e.param3,e.param4,`"${e.explanation.replace(/"/g,'""')}"`].join(","))].join("\n"),t=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(t),l.download=`${o.value.original_name}_analysis.csv`,l.click(),URL.revokeObjectURL(l.href),w.nk.success("CSV文件导出成功")},S=e=>{g.value=e,u.value=1},L=e=>{u.value=e},R=e=>{if(0===e)return"0 B";const a=1024,t=["B","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,l)).toFixed(2))+" "+t[l]},z=e=>e?new Date(e).toLocaleString("zh-CN"):"-",D=e=>{if(!e)return"-";const a=new Date(e),t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0"),r=String(a.getHours()).padStart(2,"0"),o=String(a.getMinutes()).padStart(2,"0"),i=String(a.getSeconds()).padStart(2,"0");return`${t}-${l}-${n} ${r}:${o}:${i}`},E=()=>{c.value&&(d.value=[c.value[0],c.value[1]])};return(0,l.sV)(()=>{h(),f()}),{loading:r,logInfo:o,logEntries:i,searchKeyword:s,timeRange:d,currentPage:u,pageSize:g,filteredEntries:p,paginatedEntries:m,loadLogInfo:h,loadLogEntries:f,handleSearch:v,handleTimeRangeChange:C,clearFilters:y,exportToCSV:F,handleSizeChange:S,handleCurrentChange:L,formatFileSize:R,formatDate:z,formatTimestamp:D,timeRangeLimit:c,setFullTimeRange:E}}},F=t(6262);const S=(0,F.A)(y,[["render",v],["__scopeId","data-v-418d4a57"]]);var L=S}}]);
//# sourceMappingURL=735.3fb0e8e7.js.map