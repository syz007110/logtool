"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[987],{5987:function(e,s,t){t.r(s),t.d(s,{default:function(){return re}});var a=t(641),l=t(33);const n={class:"monitoring-dashboard"},i={class:"page-header"},r={class:"header-actions"},o={class:"metric-content"},c={class:"metric-icon cpu"},u={class:"metric-info"},d={class:"metric-value"},k={class:"metric-content"},m={class:"metric-icon queue"},p={class:"metric-info"},g={class:"metric-value"},v={class:"metric-content"},f={class:"metric-icon users"},b={class:"metric-info"},h={class:"metric-value"},y={class:"metric-content"},L={class:"metric-icon fairness"},_={class:"metric-info"},F={class:"metric-value"},w={class:"section-header section-header-left"},M={class:"system-info"},S={class:"info-item"},R={class:"value"},C={class:"info-item"},T={class:"value"},A={class:"info-item"},q={class:"info-item"},V={class:"value"},K={class:"section-header"},W={class:"header-left"},$={key:0,class:"header-right"},U={class:"queue-info"},E={class:"info-item"},Q={class:"value"},X={class:"info-item"},x={class:"value"},z={class:"info-item"},D={class:"value"},I={class:"info-item"},P={class:"value"},j={class:"info-item"},B={class:"value"},N={class:"queue-table"},O={class:"consumers-container"},G={key:0,class:"no-consumers"},H={class:"section-header"};function J(e,s,t,J,Y,Z){const ee=(0,a.g2)("el-button"),se=(0,a.g2)("Monitor"),te=(0,a.g2)("el-icon"),ae=(0,a.g2)("el-card"),le=(0,a.g2)("el-col"),ne=(0,a.g2)("List"),ie=(0,a.g2)("User"),re=(0,a.g2)("TrendCharts"),oe=(0,a.g2)("el-row"),ce=(0,a.g2)("Moon"),ue=(0,a.g2)("el-button-group"),de=(0,a.g2)("el-table-column"),ke=(0,a.g2)("el-tag"),me=(0,a.g2)("el-table"),pe=(0,a.g2)("Warning"),ge=(0,a.g2)("el-alert"),ve=(0,a.g2)("el-input-number"),fe=(0,a.g2)("el-form-item"),be=(0,a.g2)("el-form"),he=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.CE)("div",n,[(0,a.Lk)("div",i,[(0,a.Lk)("div",r,[(0,a.bF)(ee,{type:"primary",icon:e.Refresh,onClick:J.refreshData,loading:J.loading},{default:(0,a.k6)(()=>[...s[9]||(s[9]=[(0,a.eW)(" 刷新数据 ",-1)])]),_:1},8,["icon","onClick","loading"]),(0,a.bF)(ee,{type:"success",icon:e.Setting,onClick:s[0]||(s[0]=e=>J.showSettings=!0)},{default:(0,a.k6)(()=>[...s[10]||(s[10]=[(0,a.eW)(" 告警设置 ",-1)])]),_:1},8,["icon"])])]),(0,a.bF)(oe,{gutter:20,class:"overview-cards"},{default:(0,a.k6)(()=>[(0,a.bF)(le,{span:6},{default:(0,a.k6)(()=>[(0,a.bF)(ae,{class:"metric-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",o,[(0,a.Lk)("div",c,[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(se)]),_:1})]),(0,a.Lk)("div",u,[(0,a.Lk)("div",d,(0,l.v_)(J.systemMetrics.memory?.usage||0)+"%",1),s[11]||(s[11]=(0,a.Lk)("div",{class:"metric-label"},"内存使用率",-1))])])]),_:1})]),_:1}),(0,a.bF)(le,{span:6},{default:(0,a.k6)(()=>[(0,a.bF)(ae,{class:"metric-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",k,[(0,a.Lk)("div",m,[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(ne)]),_:1})]),(0,a.Lk)("div",p,[(0,a.Lk)("div",g,(0,l.v_)(J.businessMetrics.tasks?.waiting||0),1),s[12]||(s[12]=(0,a.Lk)("div",{class:"metric-label"},"队列等待任务",-1))])])]),_:1})]),_:1}),(0,a.bF)(le,{span:6},{default:(0,a.k6)(()=>[(0,a.bF)(ae,{class:"metric-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",v,[(0,a.Lk)("div",f,[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(ie)]),_:1})]),(0,a.Lk)("div",b,[(0,a.Lk)("div",h,(0,l.v_)(J.businessMetrics.users?.active||0),1),s[13]||(s[13]=(0,a.Lk)("div",{class:"metric-label"},"活跃用户",-1))])])]),_:1})]),_:1}),(0,a.bF)(le,{span:6},{default:(0,a.k6)(()=>[(0,a.bF)(ae,{class:"metric-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",y,[(0,a.Lk)("div",L,[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(re)]),_:1})]),(0,a.Lk)("div",_,[(0,a.Lk)("div",F,(0,l.v_)(J.businessMetrics.fairness||0)+"%",1),s[14]||(s[14]=(0,a.Lk)("div",{class:"metric-label"},"用户公平性",-1))])])]),_:1})]),_:1})]),_:1}),(0,a.bF)(oe,{gutter:20,class:"detail-sections"},{default:(0,a.k6)(()=>[(0,a.bF)(le,{span:24},{default:(0,a.k6)(()=>[(0,a.bF)(ae,{class:"monitoring-section"},{header:(0,a.k6)(()=>[(0,a.Lk)("div",w,[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(se)]),_:1}),s[15]||(s[15]=(0,a.Lk)("span",null,"系统状态",-1))])]),default:(0,a.k6)(()=>[(0,a.Lk)("div",M,[(0,a.Lk)("div",S,[s[16]||(s[16]=(0,a.Lk)("span",{class:"label"},"运行时间:",-1)),(0,a.Lk)("span",R,(0,l.v_)(J.formatUptime(J.systemMetrics.uptime)),1)]),(0,a.Lk)("div",C,[s[17]||(s[17]=(0,a.Lk)("span",{class:"label"},"内存使用:",-1)),(0,a.Lk)("span",T,(0,l.v_)(J.systemMetrics.memory?.used||0)+"MB / "+(0,l.v_)(J.systemMetrics.memory?.total||0)+"MB",1)]),(0,a.Lk)("div",A,[s[18]||(s[18]=(0,a.Lk)("span",{class:"label"},"缓存状态:",-1)),(0,a.Lk)("span",{class:(0,l.C4)(["value",{"status-connected":J.applicationMetrics.cache?.connected,"status-disconnected":!J.applicationMetrics.cache?.connected}])},(0,l.v_)(J.applicationMetrics.cache?.connected?"已连接":"未连接"),3)]),(0,a.Lk)("div",q,[s[19]||(s[19]=(0,a.Lk)("span",{class:"label"},"缓存键数:",-1)),(0,a.Lk)("span",V,(0,l.v_)(J.applicationMetrics.cache?.keys||0),1)])])]),_:1})]),_:1})]),_:1}),(0,a.bF)(oe,{gutter:20,class:"detail-sections"},{default:(0,a.k6)(()=>[(0,a.bF)(le,{span:24},{default:(0,a.k6)(()=>[(0,a.bF)(ae,{class:"monitoring-section"},{header:(0,a.k6)(()=>[(0,a.Lk)("div",K,[(0,a.Lk)("div",W,[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(ne)]),_:1}),s[20]||(s[20]=(0,a.Lk)("span",null,"队列状态",-1))]),J.clusterStatus.enabled?((0,a.uX)(),(0,a.CE)("div",$,[(0,a.bF)(ue,null,{default:(0,a.k6)(()=>[(0,a.bF)(ee,{type:"peak"===J.currentMode?"primary":"default",loading:J.modeSwitching,onClick:s[1]||(s[1]=e=>J.switchMode("peak")),size:"small"},{default:(0,a.k6)(()=>[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(re)]),_:1}),s[21]||(s[21]=(0,a.eW)(" 高峰模式 ",-1))]),_:1},8,["type","loading"]),(0,a.bF)(ee,{type:"offPeak"===J.currentMode?"primary":"default",loading:J.modeSwitching,onClick:s[2]||(s[2]=e=>J.switchMode("offPeak")),size:"small"},{default:(0,a.k6)(()=>[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(ce)]),_:1}),s[22]||(s[22]=(0,a.eW)(" 非高峰模式 ",-1))]),_:1},8,["type","loading"])]),_:1})])):(0,a.Q3)("",!0)])]),default:(0,a.k6)(()=>[(0,a.Lk)("div",U,[(0,a.Lk)("div",E,[s[23]||(s[23]=(0,a.Lk)("span",{class:"label"},"总任务数:",-1)),(0,a.Lk)("span",Q,(0,l.v_)(J.businessMetrics.tasks?.total||0),1)]),(0,a.Lk)("div",X,[s[24]||(s[24]=(0,a.Lk)("span",{class:"label"},"等待中:",-1)),(0,a.Lk)("span",x,(0,l.v_)(J.businessMetrics.tasks?.waiting||0),1)]),(0,a.Lk)("div",z,[s[25]||(s[25]=(0,a.Lk)("span",{class:"label"},"处理中:",-1)),(0,a.Lk)("span",D,(0,l.v_)(J.businessMetrics.tasks?.processing||0),1)]),(0,a.Lk)("div",I,[s[26]||(s[26]=(0,a.Lk)("span",{class:"label"},"已完成:",-1)),(0,a.Lk)("span",P,(0,l.v_)(J.businessMetrics.tasks?.completed||0),1)]),(0,a.Lk)("div",j,[s[27]||(s[27]=(0,a.Lk)("span",{class:"label"},"失败:",-1)),(0,a.Lk)("span",B,(0,l.v_)(J.businessMetrics.tasks?.failed||0),1)])]),(0,a.Lk)("div",N,[s[28]||(s[28]=(0,a.Lk)("div",{class:"stats-header"},[(0,a.Lk)("span",null,"队列列表")],-1)),(0,a.bF)(me,{data:J.queueRows,border:"",style:{width:"100%"},size:"small","empty-text":J.loading?"加载中...":"暂无数据"},{default:(0,a.k6)(()=>[(0,a.bF)(de,{prop:"type",label:"队列类型","min-width":"180"}),(0,a.bF)(de,{label:"消费队列的进程","min-width":"220"},{default:(0,a.k6)(({row:e})=>[(0,a.Lk)("div",O,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.consumers,(e,s)=>((0,a.uX)(),(0,a.Wv)(ke,{key:s,type:J.getConsumerTagType(e),size:"small",class:"consumer-tag"},{default:(0,a.k6)(()=>[(0,a.eW)((0,l.v_)(J.formatConsumerDisplay(e)),1)]),_:2},1032,["type"]))),128)),e.consumers&&0!==e.consumers.length?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",G,"—"))])]),_:1}),(0,a.bF)(de,{prop:"active",label:"执行中任务数量",width:"160"}),(0,a.bF)(de,{prop:"waiting",label:"等待中任务数量",width:"160"})]),_:1},8,["data","empty-text"])])]),_:1})]),_:1})]),_:1}),J.alerts.length>0?((0,a.uX)(),(0,a.Wv)(oe,{key:0,gutter:20},{default:(0,a.k6)(()=>[(0,a.bF)(le,{span:24},{default:(0,a.k6)(()=>[(0,a.bF)(ae,{class:"monitoring-section"},{header:(0,a.k6)(()=>[(0,a.Lk)("div",H,[(0,a.bF)(te,null,{default:(0,a.k6)(()=>[(0,a.bF)(pe)]),_:1}),s[29]||(s[29]=(0,a.Lk)("span",null,"系统告警",-1))])]),default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(J.alerts,e=>((0,a.uX)(),(0,a.Wv)(ge,{key:e.timestamp,title:e.message,type:J.getAlertType(e.level),closable:!1,class:"alert-item"},null,8,["title","type"]))),128))]),_:1})]),_:1})]),_:1})):(0,a.Q3)("",!0),(0,a.bF)(he,{modelValue:J.showSettings,"onUpdate:modelValue":s[8]||(s[8]=e=>J.showSettings=e),title:"告警设置",width:"600px"},{footer:(0,a.k6)(()=>[(0,a.bF)(ee,{onClick:s[7]||(s[7]=e=>J.showSettings=!1)},{default:(0,a.k6)(()=>[...s[34]||(s[34]=[(0,a.eW)("取消",-1)])]),_:1}),(0,a.bF)(ee,{type:"primary",onClick:J.saveAlertSettings},{default:(0,a.k6)(()=>[...s[35]||(s[35]=[(0,a.eW)("保存",-1)])]),_:1},8,["onClick"])]),default:(0,a.k6)(()=>[(0,a.bF)(be,{model:J.alertSettings,"label-width":"150px"},{default:(0,a.k6)(()=>[(0,a.bF)(fe,{label:"内存使用率阈值"},{default:(0,a.k6)(()=>[(0,a.bF)(ve,{modelValue:J.alertSettings.memoryUsage,"onUpdate:modelValue":s[3]||(s[3]=e=>J.alertSettings.memoryUsage=e),min:0,max:100,step:5,"controls-position":"right"},null,8,["modelValue"]),s[30]||(s[30]=(0,a.Lk)("span",{class:"unit"},"%",-1))]),_:1}),(0,a.bF)(fe,{label:"队列长度阈值"},{default:(0,a.k6)(()=>[(0,a.bF)(ve,{modelValue:J.alertSettings.queueLength,"onUpdate:modelValue":s[4]||(s[4]=e=>J.alertSettings.queueLength=e),min:0,step:10,"controls-position":"right"},null,8,["modelValue"]),s[31]||(s[31]=(0,a.Lk)("span",{class:"unit"},"个任务",-1))]),_:1}),(0,a.bF)(fe,{label:"错误率阈值"},{default:(0,a.k6)(()=>[(0,a.bF)(ve,{modelValue:J.alertSettings.errorRate,"onUpdate:modelValue":s[5]||(s[5]=e=>J.alertSettings.errorRate=e),min:0,max:100,step:1,"controls-position":"right"},null,8,["modelValue"]),s[32]||(s[32]=(0,a.Lk)("span",{class:"unit"},"%",-1))]),_:1}),(0,a.bF)(fe,{label:"响应时间阈值"},{default:(0,a.k6)(()=>[(0,a.bF)(ve,{modelValue:J.alertSettings.responseTime,"onUpdate:modelValue":s[6]||(s[6]=e=>J.alertSettings.responseTime=e),min:0,step:100,"controls-position":"right"},null,8,["modelValue"]),s[33]||(s[33]=(0,a.Lk)("span",{class:"unit"},"毫秒",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}var Y=t(953),Z=t(163),ee=t(8548),se=t(5495),te=t(4335),ae=t(6464),le={name:"MonitoringDashboard",components:{Refresh:ee.Refresh,Setting:ee.Setting,Monitor:ee.Monitor,List:ee.List,User:ee.User,Scale:ee.Scale,Connection:ee.Connection,Warning:ee.Warning,TrendCharts:ee.TrendCharts,Moon:ee.Moon},setup(){const e=(0,Y.KR)(!1),s=(0,Y.KR)(!1),t=(0,Y.KR)(null),l=(0,Y.KR)(!1),n=(0,Y.KR)("peak"),i=(0,Y.KR)({}),r=(0,Y.KR)({}),o=(0,Y.KR)({}),c=(0,Y.KR)({}),u=(0,Y.KR)({}),d=(0,Y.KR)({}),k=(0,Y.KR)([]),m=(0,Y.Kh)({memoryUsage:80,queueLength:100,errorRate:5,responseTime:5e3}),p=async()=>{try{e.value=!0;const s=await se.A.monitoring.getOverview();if(s.data.success){const e=s.data.data;i.value=e.system||{},r.value=e.application||{},o.value=e.business||{},c.value=e.cluster||{},u.value=e.queue||{},d.value=e.queue?.processStats||{},k.value=e.alerts||[],console.log("集群调度器状态:",e.cluster?.scheduler),e.cluster?.scheduler?.displayMode?(n.value=e.cluster.scheduler.displayMode,console.log("使用 displayMode:",e.cluster.scheduler.displayMode)):e.cluster?.scheduler?.currentMode&&(n.value=e.cluster.scheduler.currentMode,console.log("使用 currentMode:",e.cluster.scheduler.currentMode)),console.log("监控数据:",e),console.log("进程统计:",d.value),d.value.processes&&(console.log("进程列表:",d.value.processes),d.value.processes.forEach((e,s)=>{console.log(`进程 ${s}:`,e)}))}}catch(s){console.error("获取监控数据失败:",s),Z.nk.error("获取监控数据失败")}finally{e.value=!1}},g=()=>{p()},v=async()=>{try{await se.A.monitoring.setAlertThresholds(m),Z.nk.success("告警设置已保存"),s.value=!1}catch(e){console.error("保存告警设置失败:",e),Z.nk.error("保存告警设置失败")}},f=(0,a.EW)(()=>{const e=[],s=u.value||{};if(Array.isArray(s.queues))return s.queues.forEach(s=>{const t=Array.isArray(s.consumers)?s.consumers:[],a=t.length>0?t:["worker#test123"];e.push({type:F(s.type)||"未知",consumers:a,active:s.active??0,waiting:s.waiting??0})}),e;if(s.byType&&"object"===typeof s.byType)return Object.keys(s.byType).forEach(t=>{const a=s.byType[t]||{},l=Array.isArray(a.consumers)?a.consumers:[];e.push({type:F(t),consumers:l,active:a.tasks?.active??0,waiting:a.tasks?.waiting??0})}),e;const t=d.value||{};if(Array.isArray(t.processes)&&t.processes.length>0){const s={};t.processes.forEach(e=>{const t=e.role||"unknown";s[t]||(s[t]={consumers:[],active:0,waiting:0}),s[t].consumers.push(`${e.type||"进程"}#${e.pid||"-"}`),s[t].active+=Number(e.tasks?.active||0),s[t].waiting+=Number(e.tasks?.waiting||0)}),Object.keys(s).forEach(t=>{const a=s[t],l=a.consumers;e.push({type:_(t),consumers:l,active:a.active,waiting:a.waiting})})}return e}),b=e=>{if(!e)return"0秒";const s=Math.floor(e/3600),t=Math.floor(e%3600/60),a=Math.floor(e%60);return s>0?`${s}小时${t}分钟`:t>0?`${t}分钟${a}秒`:`${a}秒`},h=e=>{if(!e)return"未知";try{const s=new Date(e);return s.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(s){return"格式错误"}},y=e=>{const s={ready:"success",active:"success",timeout:"danger",offline:"info"};return s[e]||"info"},L=e=>{const s={historyLog:"warning",userRequest:"success",monitor:"info"};return s[e]||"default"},_=e=>{const s={historyLog:"历史日志",userRequest:"用户请求",monitor:"目录监控"};return s[e]||e},F=e=>{const s={logProcessingQueue:"日志处理队列",realtimeProcessingQueue:"实时处理队列",historicalProcessingQueue:"历史处理队列",surgeryAnalysisQueue:"手术分析队列"};return s[e]||e},w=e=>e.includes("_userRequest")||e.includes("userRequest")||e.includes("用户请求")?"success":e.includes("_general")||e.includes("general")||e.includes("通用")?"primary":e.includes("master")||e.includes("主进程")?"warning":"info",M=e=>{const s=e.split("#");if(2===s.length){const[e,t]=s;let a=e,l="";if(e.includes("_")){const s=e.split("_");a=s[0],l=s[1]}const n={worker:"工作进程",master:"主进程"},i={general:"通用",userRequest:"用户请求",monitor:"监控"},r=n[a]||a,o=l?`(${i[l]||l})`:"";return`${r}${o}#${t}`}return e},S=async e=>{if(l.value)Z.nk.warning("正在切换模式中，请稍候...");else try{l.value=!0,Z.nk.info(`正在切换到${"peak"===e?"高峰":"非高峰"}模式，请等待任务完成...`);const s=ae.A.state.auth.token,t=await te.A.post("/api/monitoring/cluster/mode",{mode:e},{headers:{Authorization:`Bearer ${s}`}});t.data.success?(Z.nk.success(t.data.message),await p()):Z.nk.error(t.data.message)}catch(s){console.error("切换模式失败:",s),Z.nk.error("切换模式失败: "+(s.response?.data?.message||s.message))}finally{l.value=!1}},R=e=>{const s={warning:"warning",critical:"error",error:"error"};return s[e]||"info"},C=()=>{t.value=setInterval(p,3e4)},T=()=>{t.value&&(clearInterval(t.value),t.value=null)};return(0,a.sV)(()=>{p(),C()}),(0,a.hi)(()=>{T()}),{loading:e,showSettings:s,modeSwitching:l,currentMode:n,systemMetrics:i,applicationMetrics:r,businessMetrics:o,clusterStatus:c,queueStatus:u,processStats:d,alerts:k,alertSettings:m,queueRows:f,refreshData:g,saveAlertSettings:v,formatUptime:b,formatStartTime:h,getStatusType:y,getRoleType:L,getRoleLabel:_,getQueueTypeLabel:F,getConsumerTagType:w,formatConsumerDisplay:M,switchMode:S,getAlertType:R}}},ne=t(6262);const ie=(0,ne.A)(le,[["render",J],["__scopeId","data-v-790e62a9"]]);var re=ie}}]);
//# sourceMappingURL=987.b0fedf86.js.map