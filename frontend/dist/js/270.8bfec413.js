"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[270],{2270:function(e,a,l){l.r(a),l.d(a,{default:function(){return H}});var t=l(641),s=l(33),n=l(3751);const i={class:"logs-container"},o={class:"upload-actions"},r={class:"card-header"},d={class:"header-actions"},u={key:0,class:"header-section batch-section"},c={class:"batch-actions"},p={class:"header-section only-own-section"},g={class:"header-section reset-section"},v={class:"header-section refresh-section"},k={class:"col-header"},h={class:"filter-panel"},f={class:"filter-actions"},m={class:"col-header"},b={class:"filter-panel"},y={class:"filter-actions"},F={key:0,class:"status-progress"},_={key:1,class:"status-tip"},w={class:"pagination-wrapper"},C={class:"el-upload__tip"},L={key:0},D={key:1,class:"parsing-tip"},R={key:0,class:"custom-file-list"},z={class:"file-list-header"},W={class:"file-items"},x={class:"file-name"},E={class:"file-size"},K={class:"key-input-section"},U={class:"key-input-row"},B={key:0,class:"key-file-info"},S={key:1,class:"key-error"},M={class:"device-input-section"},A={class:"device-input-row"},I={key:0,class:"device-error"},Y={class:"upload-actions"};function T(e,a,l,T,O,V){const X=(0,t.g2)("UploadFilled"),P=(0,t.g2)("el-icon"),$=(0,t.g2)("el-button"),N=(0,t.g2)("el-card"),j=(0,t.g2)("Monitor"),Q=(0,t.g2)("Download"),H=(0,t.g2)("Delete"),Z=(0,t.g2)("Refresh"),q=(0,t.g2)("InfoFilled"),G=(0,t.g2)("el-tooltip"),J=(0,t.g2)("el-checkbox"),ee=(0,t.g2)("el-table-column"),ae=(0,t.g2)("Search"),le=(0,t.g2)("el-input"),te=(0,t.g2)("Filter"),se=(0,t.g2)("el-popover"),ne=(0,t.g2)("el-tag"),ie=(0,t.g2)("el-progress"),oe=(0,t.g2)("Warning"),re=(0,t.g2)("el-table"),de=(0,t.g2)("el-pagination"),ue=(0,t.g2)("upload-filled"),ce=(0,t.g2)("el-upload"),pe=(0,t.g2)("Document"),ge=(0,t.g2)("Key"),ve=(0,t.g2)("Upload"),ke=(0,t.g2)("el-dialog"),he=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.bF)(N,{class:"upload-card"},{header:(0,t.k6)(()=>a[11]||(a[11]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"日志上传")],-1)])),default:(0,t.k6)(()=>[(0,t.Lk)("div",o,[(0,t.bF)($,{type:"primary",onClick:a[0]||(a[0]=e=>T.showUploadDialog=!0)},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(X)]),_:1}),a[12]||(a[12]=(0,t.eW)(" 上传日志 "))]),_:1,__:[12]})])]),_:1}),(0,t.bF)(N,{class:"list-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",r,[a[16]||(a[16]=(0,t.Lk)("span",null,"日志列表",-1)),(0,t.Lk)("div",d,[T.selectedLogs&&T.selectedLogs.length>0?((0,t.uX)(),(0,t.CE)("div",u,[(0,t.Lk)("div",c,[(0,t.bF)($,{type:"primary",size:"small",onClick:T.handleBatchAnalyze,disabled:!T.canBatchOperate||!T.isSameDevice,title:e.incompleteLogsMessage||T.deviceCheckMessage},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(j)]),_:1}),(0,t.eW)(" 批量分析 ("+(0,s.v_)(T.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled","title"]),(0,t.bF)($,{type:"success",size:"small",onClick:T.handleBatchDownload,disabled:!T.canBatchOperate,title:e.incompleteLogsMessage},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(Q)]),_:1}),(0,t.eW)(" 批量下载 ("+(0,s.v_)(T.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled","title"]),(0,t.bF)($,{type:"danger",size:"small",onClick:T.handleBatchDelete,disabled:!T.canBatchDelete,title:e.incompleteLogsMessage},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(H)]),_:1}),(0,t.eW)(" 批量删除 ("+(0,s.v_)(T.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled","title"]),1===T.userRole?((0,t.uX)(),(0,t.Wv)($,{key:0,type:"warning",size:"small",onClick:T.handleBatchReparse,disabled:0===T.selectedLogs.length||1!==T.userRole||!T.canBatchOperate,title:e.incompleteLogsMessage},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(Z)]),_:1}),(0,t.eW)(" 批量重新解析 ("+(0,s.v_)(T.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled","title"])):(0,t.Q3)("",!0),3===T.userRole?((0,t.uX)(),(0,t.Wv)(G,{key:1,content:"普通用户只能删除自己上传的日志",placement:"top"},{default:(0,t.k6)(()=>[(0,t.bF)(P,{class:"info-icon"},{default:(0,t.k6)(()=>[(0,t.bF)(q)]),_:1})]),_:1})):(0,t.Q3)("",!0),(0,t.bF)($,{type:"info",size:"small",onClick:T.clearSelection},{default:(0,t.k6)(()=>a[13]||(a[13]=[(0,t.eW)(" 取消选择 ")])),_:1,__:[13]},8,["onClick"])])])):(0,t.Q3)("",!0),(0,t.Lk)("div",p,[(0,t.bF)(J,{modelValue:T.onlyOwn,"onUpdate:modelValue":a[1]||(a[1]=e=>T.onlyOwn=e),onChange:T.applyOnlyOwn,label:"仅看自己"},null,8,["modelValue","onChange"])]),(0,t.Lk)("div",g,[(0,t.bF)($,{plain:"",size:"small",onClick:T.resetAllFilters},{default:(0,t.k6)(()=>a[14]||(a[14]=[(0,t.eW)("重置")])),_:1,__:[14]},8,["onClick"])]),(0,t.Lk)("div",v,[(0,t.bF)($,{plain:"",size:"small",onClick:T.loadLogs},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(Z)]),_:1}),a[15]||(a[15]=(0,t.eW)(" 刷新 "))]),_:1,__:[15]},8,["onClick"])])])])]),default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(re,{data:T.logs,loading:T.loading,style:{width:"100%"},onSelectionChange:T.handleSelectionChange},{default:(0,t.k6)(()=>[(0,t.bF)(ee,{type:"selection",width:"55"}),(0,t.bF)(ee,{prop:"original_name",label:"原始文件名",width:"240"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",k,[a[20]||(a[20]=(0,t.Lk)("span",null,"原始文件名",-1)),(0,t.bF)(se,{placement:"bottom-start",width:"260",visible:T.showNameFilterPanel,"onUpdate:visible":a[3]||(a[3]=e=>T.showNameFilterPanel=e),"popper-class":"custom-filter-panel"},{reference:(0,t.k6)(()=>[(0,t.bF)(P,{class:(0,s.C4)(["filter-trigger",{active:!!T.nameTimePrefix}])},{default:(0,t.k6)(()=>[(0,t.bF)(te)]),_:1},8,["class"])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",h,[a[19]||(a[19]=(0,t.Lk)("div",{class:"filter-title"},"时间前缀 (YYYY / YYYYMM / YYYYMMDD / YYYYMMDDHH)",-1)),(0,t.bF)(le,{modelValue:T.nameTimePrefix,"onUpdate:modelValue":a[2]||(a[2]=e=>T.nameTimePrefix=e),placeholder:"例如 2025081611",clearable:"",onKeyup:(0,n.jR)(T.applyNameFilter,["enter"])},{prefix:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(ae)]),_:1})]),_:1},8,["modelValue","onKeyup"]),(0,t.Lk)("div",f,[(0,t.bF)($,{size:"small",type:"primary",onClick:T.applyNameFilter},{default:(0,t.k6)(()=>a[17]||(a[17]=[(0,t.eW)("搜索")])),_:1,__:[17]},8,["onClick"]),(0,t.bF)($,{size:"small",onClick:T.resetNameFilter},{default:(0,t.k6)(()=>a[18]||(a[18]=[(0,t.eW)("重置")])),_:1,__:[18]},8,["onClick"])])])]),_:1},8,["visible"])])]),_:1}),(0,t.bF)(ee,{prop:"device_id",label:"设备编号",width:"160"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",m,[a[24]||(a[24]=(0,t.Lk)("span",null,"设备编号",-1)),(0,t.bF)(se,{placement:"bottom-start",width:"260",visible:T.showDeviceFilterPanel,"onUpdate:visible":a[5]||(a[5]=e=>T.showDeviceFilterPanel=e),"popper-class":"custom-filter-panel"},{reference:(0,t.k6)(()=>[(0,t.bF)(P,{class:(0,s.C4)(["filter-trigger",{active:!!T.filterDeviceId}])},{default:(0,t.k6)(()=>[(0,t.bF)(te)]),_:1},8,["class"])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",b,[a[23]||(a[23]=(0,t.Lk)("div",{class:"filter-title"},"设备编号",-1)),(0,t.bF)(le,{modelValue:T.filterDeviceId,"onUpdate:modelValue":a[4]||(a[4]=e=>T.filterDeviceId=e),placeholder:"例如 4371-01",clearable:"",onKeyup:(0,n.jR)(T.applyDeviceFilter,["enter"])},{prefix:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(ae)]),_:1})]),_:1},8,["modelValue","onKeyup"]),(0,t.Lk)("div",y,[(0,t.bF)($,{size:"small",type:"primary",onClick:T.applyDeviceFilter},{default:(0,t.k6)(()=>a[21]||(a[21]=[(0,t.eW)("搜索")])),_:1,__:[21]},8,["onClick"]),(0,t.bF)($,{size:"small",onClick:T.resetDeviceFilter},{default:(0,t.k6)(()=>a[22]||(a[22]=[(0,t.eW)("重置")])),_:1,__:[22]},8,["onClick"])])])]),_:1},8,["visible"])])]),_:1}),(0,t.bF)(ee,{prop:"uploader_id",label:"用户ID",width:"80"}),(0,t.bF)(ee,{prop:"upload_time",label:"上传时间",width:"150"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,s.v_)(T.formatDate(e.upload_time)),1)]),_:1}),(0,t.bF)(ee,{label:"状态",width:"120",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(ne,{type:T.getRowStatusType(e),size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(T.getRowStatusText(e)),1)]),_:2},1032,["type"]),"uploading"===e.status||"decrypting"===e.status||"parsing"===e.status?((0,t.uX)(),(0,t.CE)("div",F,[(0,t.bF)(ie,{percentage:T.getStatusProgress(e),"stroke-width":4,"show-text":!1,status:"parsed"===e.status?"success":""},null,8,["percentage","status"])])):(0,t.Q3)("",!0),T.canOperate(e)?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",_,[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(oe)]),_:1}),(0,t.Lk)("span",null,(0,s.v_)(T.isDeleting(e.id)?"删除中，请稍候":"处理中，请稍候"),1)]))]),_:1}),(0,t.bF)(ee,{label:"操作",width:"300",fixed:"right"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)($,{size:"small",type:"primary",onClick:a=>T.goToLogAnalysis(e),disabled:!T.canOperate(e)},{default:(0,t.k6)(()=>a[25]||(a[25]=[(0,t.eW)(" 分析 ")])),_:2,__:[25]},1032,["onClick","disabled"]),(0,t.bF)($,{size:"small",type:"success",onClick:a=>T.handleDownload(e),disabled:!T.canOperate(e)},{default:(0,t.k6)(()=>a[26]||(a[26]=[(0,t.eW)(" 下载 ")])),_:2,__:[26]},1032,["onClick","disabled"]),T.canDeleteLog(e)?((0,t.uX)(),(0,t.Wv)($,{key:0,size:"small",type:"danger",onClick:a=>T.handleDelete(e),disabled:!T.canOperate(e)},{default:(0,t.k6)(()=>a[27]||(a[27]=[(0,t.eW)(" 删除 ")])),_:2,__:[27]},1032,["onClick","disabled"])):(0,t.Q3)("",!0),T.canReparse?((0,t.uX)(),(0,t.Wv)($,{key:1,size:"small",type:"warning",onClick:a=>T.handleReparse(e),disabled:!T.canOperate(e)||e.parsing},{default:(0,t.k6)(()=>a[28]||(a[28]=[(0,t.eW)(" 重新解析 ")])),_:2,__:[28]},1032,["onClick","disabled"])):(0,t.Q3)("",!0)]),_:1})]),_:1},8,["data","loading","onSelectionChange"])),[[he,T.loading]]),(0,t.Lk)("div",w,[(0,t.bF)(de,{"current-page":T.currentPage,"page-size":T.pageSize,"page-sizes":[10,20,50,100],total:T.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:T.handleSizeChange,onCurrentChange:T.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),(0,t.bF)(ke,{modelValue:T.showUploadDialog,"onUpdate:modelValue":a[9]||(a[9]=e=>T.showUploadDialog=e),title:"上传日志",width:"700px","append-to-body":""},{footer:(0,t.k6)(()=>[(0,t.Lk)("div",Y,[(0,t.bF)($,{onClick:a[8]||(a[8]=e=>T.showUploadDialog=!1),disabled:T.uploading},{default:(0,t.k6)(()=>a[36]||(a[36]=[(0,t.eW)("取消")])),_:1,__:[36]},8,["disabled"]),(0,t.bF)($,{type:"primary",onClick:T.submitUpload,loading:T.uploading,disabled:T.uploading||!T.decryptKey.trim()||0===T.uploadFileList.length},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(T.uploading?"解析中...":"上传并解析"),1)]),_:1},8,["onClick","loading","disabled"])])]),default:(0,t.k6)(()=>[(0,t.bF)(ce,{ref:"uploadRef",action:T.uploadUrl,headers:T.uploadHeaders,"before-upload":T.beforeUpload,"on-success":T.onUploadSuccess,"on-error":T.onUploadError,"on-exceed":T.onExceed,"on-change":T.onFileChange,"on-remove":T.onFileRemove,"on-progress":e.onUploadProgress,"auto-upload":!1,"show-file-list":!1,multiple:!0,limit:50,accept:".medbot",name:"file",disabled:T.uploading},{tip:(0,t.k6)(()=>[(0,t.Lk)("div",C,[T.uploading?((0,t.uX)(),(0,t.CE)("div",D,[(0,t.bF)(P,{class:"is-loading"},{default:(0,t.k6)(()=>[(0,t.bF)(Z)]),_:1}),a[30]||(a[30]=(0,t.eW)(" 正在解析中，请勿刷新页面... "))])):((0,t.uX)(),(0,t.CE)("div",L," 支持上传 .medbot 文件，最多50个文件，总大小不超过200MB，上传后将自动解密并解析 "))])]),default:(0,t.k6)(()=>[(0,t.bF)($,{type:"primary",disabled:T.uploading},{default:(0,t.k6)(()=>[(0,t.bF)(P,{class:"el-icon--upload"},{default:(0,t.k6)(()=>[(0,t.bF)(ue)]),_:1}),a[29]||(a[29]=(0,t.eW)(" 选择文件 "))]),_:1,__:[29]},8,["disabled"])]),_:1},8,["action","headers","before-upload","on-success","on-error","on-exceed","on-change","on-remove","on-progress","disabled"]),T.uploadFileList&&T.uploadFileList.length>0?((0,t.uX)(),(0,t.CE)("div",R,[(0,t.Lk)("div",z,[(0,t.Lk)("span",null,"已选择的文件 ("+(0,s.v_)(T.uploadFileList.length)+")",1),(0,t.bF)($,{type:"text",size:"small",onClick:T.clearUpload,disabled:T.uploading},{default:(0,t.k6)(()=>a[31]||(a[31]=[(0,t.eW)(" 清空 ")])),_:1,__:[31]},8,["onClick","disabled"])]),(0,t.Lk)("div",W,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(T.uploadFileList,(e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"file-item"},[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(pe)]),_:1}),(0,t.Lk)("span",x,(0,s.v_)(e.name||e.originalname),1),(0,t.Lk)("span",E,(0,s.v_)(e.sizeText),1),(0,t.bF)($,{type:"text",size:"small",onClick:e=>T.removeFile(a),disabled:T.uploading},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(H)]),_:1})]),_:2},1032,["onClick","disabled"])]))),128))])])):(0,t.Q3)("",!0),(0,t.Lk)("div",K,[(0,t.Lk)("div",U,[(0,t.bF)(le,{modelValue:T.decryptKey,"onUpdate:modelValue":a[6]||(a[6]=e=>T.decryptKey=e),placeholder:"请输入解密密钥（MAC地址格式，如：00-01-05-77-6a-09）",style:{width:"300px"},clearable:"",onBlur:T.validateKeyFormat},{prefix:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(ge)]),_:1})]),_:1},8,["modelValue","onBlur"]),(0,t.bF)($,{type:"primary",plain:"",onClick:T.autoFillDeviceId,disabled:!T.decryptKey.trim()},{default:(0,t.k6)(()=>a[32]||(a[32]=[(0,t.eW)(" 自动填充设备编号 ")])),_:1,__:[32]},8,["onClick","disabled"]),a[34]||(a[34]=(0,t.Lk)("span",{class:"key-separator"},"或",-1)),(0,t.bF)(ce,{ref:"keyUploadRef","auto-upload":!1,"show-file-list":!1,accept:".txt","before-upload":T.beforeKeyUpload,"on-change":T.onKeyFileChange},{default:(0,t.k6)(()=>[(0,t.bF)($,{type:"primary",plain:""},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(ve)]),_:1}),a[33]||(a[33]=(0,t.eW)(" 上传密钥文件 "))]),_:1,__:[33]})]),_:1},8,["before-upload","on-change"])]),T.keyFileName?((0,t.uX)(),(0,t.CE)("div",B,[(0,t.bF)(ne,{type:"success",size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(pe)]),_:1}),(0,t.eW)(" "+(0,s.v_)(T.keyFileName),1)]),_:1})])):(0,t.Q3)("",!0),T.keyError?((0,t.uX)(),(0,t.CE)("div",S,[(0,t.bF)(ne,{type:"danger",size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(T.keyError),1)]),_:1})])):(0,t.Q3)("",!0)]),(0,t.Lk)("div",M,[(0,t.Lk)("div",A,[(0,t.bF)(le,{modelValue:T.deviceId,"onUpdate:modelValue":a[7]||(a[7]=e=>T.deviceId=e),placeholder:"设备编号（格式：数字或字母组合，例：4371-01、ABC-12，默认为0000-00）",style:{width:"300px"},clearable:"",onBlur:T.validateDeviceIdFormat},{prefix:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(j)]),_:1})]),_:1},8,["modelValue","onBlur"]),(0,t.bF)($,{type:"primary",plain:"",onClick:T.autoFillKey,disabled:!T.deviceId.trim()},{default:(0,t.k6)(()=>a[35]||(a[35]=[(0,t.eW)(" 自动填充密钥 ")])),_:1,__:[35]},8,["onClick","disabled"])]),T.deviceIdError?((0,t.uX)(),(0,t.CE)("div",I,[(0,t.bF)(ne,{type:"danger",size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(T.deviceIdError),1)]),_:1})])):(0,t.Q3)("",!0)])]),_:1},8,["modelValue"]),(0,t.bF)(ke,{modelValue:e.showEntriesDialog,"onUpdate:modelValue":a[10]||(a[10]=a=>e.showEntriesDialog=a),title:"日志分析",width:"900px"},{default:(0,t.k6)(()=>[(0,t.bF)(re,{data:e.logEntries,style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(ee,{prop:"timestamp",label:"时间戳",width:"180"}),(0,t.bF)(ee,{prop:"error_code",label:"故障码",width:"100"}),(0,t.bF)(ee,{prop:"param1",label:"参数1",width:"100"}),(0,t.bF)(ee,{prop:"param2",label:"参数2",width:"100"}),(0,t.bF)(ee,{prop:"param3",label:"参数3",width:"100"}),(0,t.bF)(ee,{prop:"param4",label:"参数4",width:"100"}),(0,t.bF)(ee,{prop:"explanation",label:"日志解释"})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}var O=l(953),V=l(6278),X=l(5220),P=l(163),$=l(7918),N={name:"Logs",setup(){const e=(0,V.Pj)(),a=(0,X.rd)(),l=(0,O.KR)(!1),s=(0,O.KR)(!1),n=(0,O.KR)(!1),i=(0,O.KR)(0),o=(0,O.KR)(""),r=(0,O.KR)(null),d=(0,O.KR)(null),u=(0,O.KR)(1),c=(0,O.KR)(20),p=(0,O.KR)(!1),g=(0,O.KR)(!1),v=(0,O.KR)(""),k=(0,O.KR)(!1),h=(0,O.KR)([{text:"本年",value:()=>{const e=new Date((new Date).getFullYear(),0,1,0,0,0),a=new Date((new Date).getFullYear(),11,31,23,59,59);return[e,a]}},{text:"本月",value:()=>{const e=new Date,a=new Date(e.getFullYear(),e.getMonth(),1,0,0,0),l=new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59);return[a,l]}},{text:"今天",value:()=>{const e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),l=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[a,l]}}]),f=(0,O.KR)(""),m=(0,O.KR)(""),b=(0,O.KR)(""),y=(0,O.KR)(""),F=(0,O.KR)([]),_=(0,O.KR)(""),w=(0,O.KR)(""),C=(0,O.KR)([]),L=(0,t.EW)(()=>Array.isArray(e.getters["logs/logsList"])?e.getters["logs/logsList"]:[]),D=(0,t.EW)(()=>e.getters["logs/totalCount"]),R=(0,t.EW)(()=>"/api/logs/upload"),z=(0,t.EW)(()=>({Authorization:`Bearer ${e.state.auth.token}`,"X-Decrypt-Key":f.value,"X-Device-ID":b.value})),W=(0,t.EW)(()=>e.state.auth.user?.role_id),x=(0,t.EW)(()=>e.state.auth.user?.id),E=(0,t.EW)(()=>C.value.length>0&&C.value.every(e=>Ue(e))&&C.value.every(e=>"parsed"===e.status)),K=(0,t.EW)(()=>{if(0===C.value.length)return!0;const e=C.value[0].device_id;return C.value.every(a=>a.device_id===e)}),U=(0,t.EW)(()=>{if(0===C.value.length)return"";if(!K.value){const e=[...new Set(C.value.map(e=>e.device_id))];return`选中日志包含不同的设备: ${e.join(", ")}`}return""}),B=(0,t.EW)(()=>C.value.some(e=>"parsed"!==e.status)),S=((0,t.EW)(()=>{if(0===C.value.length)return"";if(B.value){const e=C.value.filter(e=>"parsed"!==e.status).length;return`选中的日志中有 ${e} 个未完成解析，请等待解析完成后再操作`}return""}),(0,t.EW)(()=>C.value.length>0&&C.value.every(e=>M(e))&&C.value.every(e=>"parsed"===e.status))),M=e=>1===W.value||(2===W.value||3===W.value&&e.uploader_id===x.value),A=async()=>{try{l.value=!0;const a=T();await e.dispatch("logs/fetchLogs",{page:u.value,limit:c.value,device_id:y.value||void 0,...a})}catch(a){P.nk.error("加载日志失败")}finally{l.value=!1}},I=e=>{c.value=e,u.value=1,A()},Y=e=>{u.value=e,A()},T=()=>{const e=(v.value||"").trim();return e&&/^[0-9]{4}(?:[0-9]{2}){0,3}$/.test(e)?{time_prefix:e,only_own:k.value||void 0}:{only_own:k.value||void 0}},N=()=>{u.value=1,p.value=!1,A()},j=()=>{v.value="",N()},Q=()=>{u.value=1,g.value=!1,A()},H=()=>{y.value="",Q()},Z=()=>{u.value=1,A()},q=()=>{v.value="",y.value="",k.value=!1,u.value=1,A()},G=()=>{if(!f.value.trim())return void P.nk.error("请输入解密密钥或上传密钥文件");const e=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;if(!e.test(f.value))return void P.nk.error("密钥格式不正确，应为MAC地址格式（如：00-01-05-77-6a-09）");if(!b.value.trim())return void P.nk.warning("请输入设备编号，或使用默认值0000-00");if(!b.value||"0000-00"===b.value)return void P.nk.warning("请输入设备编号，或使用默认值0000-00");{const e=/^[0-9A-Za-z]+-[0-9A-Za-z]+$/;if(!e.test(b.value))return void P.nk.error("设备编号格式不正确，应为数字或字母组合格式（如：4371-01、ABC-12、123-XY）")}if(!r.value)return void P.nk.error("上传组件未初始化");if(0===F.value.length)return void P.nk.error("请选择要上传的文件");if(F.value.length>50)return void P.nk.error("最多只能上传50个文件");const a=F.value.reduce((e,a)=>e+(a.size||a.raw?.size||0),0);a/1024/1024>200?P.nk.error("总文件大小不能超过200MB"):(r.value.submit(),n.value=!1,A())},J=e=>{const a=e.name.endsWith(".medbot"),l=e.size/1024/1024<200;return a?l?!!f.value.trim()||(P.nk.error("请输入解密密钥或上传密钥文件!"),!1):(P.nk.error("单个文件大小不能超过200MB!"),!1):(P.nk.error("只能上传 .medbot 文件!"),!1)},ee=e=>{const a=e.name.endsWith(".txt"),l="systemInfo.txt"===e.name,t=e.size/1024/1024<1;return a?l?(t||P.nk.error("密钥文件大小不能超过1MB!"),!1):(P.nk.error("密钥文件名必须是 systemInfo.txt!"),!1):(P.nk.error("密钥文件必须是 .txt 格式!"),!1)},ae=e=>{const a=new FileReader;a.onload=a=>{pe(()=>{const l=(a.target.result||"").trim(),t=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;t.test(l)?(f.value=l,m.value=e.name,_.value="",P.nk.success("密钥文件读取成功")):P.nk.error("密钥文件内容格式不正确，应为MAC地址格式（如：00-01-05-77-6a-09）")})},a.readAsText(e.raw)},le=()=>{r.value&&r.value.clearFiles(),d.value&&d.value.clearFiles(),F.value=[],f.value="",m.value="",b.value="",_.value="",w.value="",s.value=!1,i.value=0},te=e=>e<30?`文件上传中 ${e}%`:e<60?`解密处理中 ${e}%`:e<100?`解析处理中 ${e}%`:`处理完成 ${e}%`,se=()=>{if(s.value)return"解析正在进行中，刷新页面可能导致解析失败。确定要离开吗？"};(0,t.sV)(()=>{window.addEventListener("beforeunload",se)});const ne=(e,a,l)=>{console.log("上传成功:",e),ge(l);const t=l.length>0&&l.every(e=>"success"===e.status);t&&(s.value=!0,i.value=30,o.value="文件已上传，等待处理...",ie())},ie=()=>{let e=0;const a=30,l=async()=>{try{await A(),e++;const t=L.value.filter(e=>"uploading"===e.status||"decrypting"===e.status||"parsing"===e.status);if(t.length>0){const n=t.filter(e=>"uploading"===e.status).length,r=t.filter(e=>"decrypting"===e.status).length,d=t.filter(e=>"parsing"===e.status).length;n>0?(i.value=30,o.value="文件上传中..."):r>0?(i.value=45,o.value="解密中..."):d>0&&(i.value=75,o.value="解析中..."),e<a?setTimeout(l,2e3):(s.value=!1,i.value=0,o.value="",P.nk.warning("处理超时，请刷新页面查看最新状态"),le())}else{const t=L.value.every(e=>"parsed"===e.status),r=L.value.some(e=>"failed"===e.status);if(t){i.value=100,s.value=!1,o.value="";const e=F.value.map(e=>e.name||e.originalname).join(", ");P.nk.success(`${e} 上传成功，解析完成`),n.value=!1,le()}else r?(s.value=!1,i.value=0,o.value="",P.nk.error("部分日志解析失败，请检查日志详情"),le()):e<a?setTimeout(l,2e3):(s.value=!1,i.value=0,o.value="",P.nk.warning("处理超时，请刷新页面查看最新状态"),le())}}catch(t){s.value=!1,i.value=0,o.value="",P.nk.error("检查状态失败"),le()}};setTimeout(l,1e3)},oe=e=>{P.nk.error("上传失败: "+(e.message||"未知错误"))},re=(e,a)=>{P.nk.error("最多只能上传50个文件!")},de=(e,a)=>{ge(a)},ue=(e,a)=>{ge(a)},ce=e=>{F.value.splice(e,1)},pe=e=>{const a=window.requestIdleCallback||(e=>setTimeout(()=>e({timeRemaining:()=>0}),1));a(()=>e())},ge=e=>{const a=(e||[]).map(e=>{const a=e.size||e.raw?.size||0,l=_e(a);return{...e,sizeText:l}});pe(()=>{F.value=a})},ve=async a=>{try{a.parsing=!0,await e.dispatch("logs/parseLog",a.id),P.nk.success("解析成功"),A()}catch(l){P.nk.error("解析失败")}finally{a.parsing=!1}},ke=(0,t.EW)(()=>e.getters["auth/hasPermission"]?.("log:reparse")),he=async a=>{try{if(!ke.value)return void P.nk.error("仅管理员可重新解析");a.parsing=!0,a.status="parsing",await e.dispatch("logs/reparseLog",a.id),P.nk.success("重新解析完成"),await A()}catch(l){const e=l.response?.data?.message||l.message||"重新解析失败";P.nk.error(e)}finally{a.parsing=!1}},fe=async a=>{try{const l=await e.dispatch("logs/downloadLog",a.id),t=new Blob([l.data]),s=window.URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=a.filename,n.click(),window.URL.revokeObjectURL(s),P.nk.success("下载成功")}catch(l){P.nk.error("下载失败")}},me=(0,O.KR)(new Set),be=e=>me.value.has(e),ye=async a=>{try{await $.s.confirm("确定要删除这个日志文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),me.value.add(a.id),await(0,t.dY)(),await e.dispatch("logs/deleteLog",a.id),P.nk.success("删除成功"),await A()}catch(l){"cancel"!==l&&P.nk.error("删除失败")}finally{me.value.delete(a.id)}},Fe=e=>{const l=a.resolve(`/batch-analysis/${e.id}`);window.open(l.href,"_blank")},_e=e=>{if(0===e)return"0 B";const a=1024,l=["B","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,t)).toFixed(2))+" "+l[t]},we=e=>e?new Date(e).toLocaleString("zh-CN"):"-",Ce=e=>{if(me.value.has(e.id))return"warning";const a={uploading:"warning",decrypting:"warning",parsing:"warning",parsed:"success",failed:"danger"};return a[e.status]||"info"},Le=e=>{if(me.value.has(e.id))return"删除中";const a={uploading:"日志上传中",decrypting:"解密中",parsing:"解析中",parsed:"完成",failed:"解析失败"};return a[e.status]||e.status||"-"},De=e=>{const a={uploading:30,decrypting:60,parsing:90,parsed:100,failed:0};return a[e.status]||0},Re=e=>{C.value=e;try{sessionStorage.setItem("selectedLogs",JSON.stringify(e))}catch(a){console.warn("保存选中日志到sessionStorage失败:",a)}},ze=()=>{C.value=[]},We=()=>{const e=C.value.map(e=>e.id).join(","),l=a.resolve(`/batch-analysis/${e}`);window.open(l.href,"_blank")},xe=async()=>{try{P.nk.info("正在打包文件，请稍候...");const a=C.value.map(e=>e.id),l=await e.dispatch("logs/batchDownloadLogs",a),t=new Blob([l.data]),s=window.URL.createObjectURL(t),n=document.createElement("a");n.href=s;const i=(new Date).toISOString().replace(/[:.]/g,"-");n.download=`logs_batch_${i}.zip`,n.click(),window.URL.revokeObjectURL(s),P.nk.success("批量下载完成")}catch(a){console.error("批量下载失败:",a);const e=a.response?.data?.message||a.message||"批量下载失败";P.nk.error(e)}},Ee=async()=>{try{if(B.value)return void P.nk.warning("请等待所有选中的日志解析完成后再进行删除操作");await $.s.confirm(`确定要删除选中的 ${C.value.length} 个日志文件吗？此操作不可恢复！`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const l=[...C.value],s=l.map(e=>parseInt(e.id)).filter(e=>!isNaN(e));if(0===s.length)return void P.nk.error("选中的日志ID格式不正确");s.forEach(e=>me.value.add(e)),await(0,t.dY)();try{await e.dispatch("logs/batchDeleteLogs",s),s.forEach(e=>me.value.delete(e)),A(),ze()}catch(a){console.error("批量删除失败:",a);const e=a.response?.data?.message||a.message||"批量删除失败";P.nk.error(e),s.forEach(e=>me.value.delete(e))}}catch(l){if("cancel"!==l){console.error("批量删除错误:",l),console.error("错误详情:",{name:l.name,message:l.message,code:l.code,response:l.response?.data,status:l.response?.status,statusText:l.response?.statusText,config:{url:l.config?.url,method:l.config?.method,data:l.config?.data}});let e="批量删除失败";l.response?.data?.message?e=l.response.data.message:l.message&&(e=l.message),P.nk.error(e)}}},Ke=async()=>{try{if(!ke.value)return void P.nk.error("仅管理员可批量重新解析");if(!C.value.length)return void P.nk.warning("请先选择要重新解析的日志");if(B.value)return void P.nk.warning("请等待所有选中的日志解析完成后再进行重新解析操作");await $.s.confirm(`确定对选中的 ${C.value.length} 个日志重新解析释义吗？`,"批量重新解析确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=C.value.map(e=>e.id);C.value.forEach(e=>{e.status="parsing"}),await e.dispatch("logs/batchReparseLogs",a),await A()}catch(a){if("cancel"!==a){const e=a.response?.data?.message||a.message||"批量重新解析失败";P.nk.error(e)}}},Ue=e=>"parsed"===e.status,Be=async()=>{try{const a=await e.dispatch("logs/autoFillKey",b.value);a.data.key?(f.value=a.data.key,P.nk.success("已自动填充密钥")):P.nk.warning("未找到该设备编号对应的密钥")}catch(a){console.error("自动填充密钥错误:",a);const e=a.response?.data?.message||a.message||"自动填充密钥失败";P.nk.error(e)}},Se=()=>{const e=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;f.value&&!e.test(f.value)?_.value="请输入有效的MAC地址格式密钥 (如: 00-01-05-77-6a-09)":_.value=""},Me=async()=>{try{const a=await e.dispatch("logs/autoFillDeviceId",f.value);a.data.device_id?(b.value=a.data.device_id,P.nk.success("已自动填充设备编号")):P.nk.warning("未找到该密钥对应的设备编号")}catch(a){console.error("自动填充设备编号错误:",a);const e=a.response?.data?.message||a.message||"自动填充设备编号失败";P.nk.error(e)}},Ae=()=>{const e=/^[0-9A-Za-z]+-[0-9A-Za-z]+$/;b.value&&!e.test(b.value)?w.value="请输入有效的设备编号格式 (如: 4371-01、ABC-12、123-XY)":w.value=""};return(0,t.sV)(()=>{A()}),{loading:l,uploading:s,showUploadDialog:n,overallProgress:i,processingStatus:o,progressFormat:te,uploadRef:r,currentPage:u,pageSize:c,logs:L,total:D,uploadUrl:R,uploadHeaders:z,loadLogs:A,handleSizeChange:I,handleCurrentChange:Y,dateShortcuts:h,beforeUpload:J,submitUpload:G,clearUpload:le,onUploadSuccess:ne,onUploadError:oe,onExceed:re,onFileChange:de,onFileRemove:ue,removeFile:ce,handleParse:ve,handleDownload:fe,handleDelete:ye,handleReparse:he,canReparse:ke,formatFileSize:_e,formatDate:we,getRowStatusType:Ce,getRowStatusText:Le,getStatusProgress:De,goToLogAnalysis:Fe,isDeleting:be,userRole:W,decryptKey:f,keyUploadRef:d,keyFileName:m,deviceId:b,filterDeviceId:y,uploadFileList:F,beforeKeyUpload:ee,onKeyFileChange:ae,canDeleteLog:M,canOperate:Ue,keyError:_,deviceIdError:w,autoFillKey:Be,validateKeyFormat:Se,autoFillDeviceId:Me,validateDeviceIdFormat:Ae,selectedLogs:C,canBatchOperate:E,canBatchDelete:S,isSameDevice:K,deviceCheckMessage:U,handleSelectionChange:Re,clearSelection:ze,handleBatchAnalyze:We,handleBatchDownload:xe,handleBatchDelete:Ee,handleBatchReparse:Ke,showNameFilterPanel:p,showDeviceFilterPanel:g,nameTimePrefix:v,onlyOwn:k,applyNameFilter:N,resetNameFilter:j,applyDeviceFilter:Q,resetDeviceFilter:H,applyOnlyOwn:Z,resetAllFilters:q,startStatusMonitoring:ie}}},j=l(6262);const Q=(0,j.A)(N,[["render",T],["__scopeId","data-v-a89303fa"]]);var H=Q}}]);
//# sourceMappingURL=270.8bfec413.js.map