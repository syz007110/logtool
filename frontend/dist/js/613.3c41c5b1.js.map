{"version":3,"file":"js/613.3c41c5b1.js","mappings":"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","sources":["webpack://logtool-frontend/./src/views/SurgeryStatistics.vue","webpack://logtool-frontend/./src/views/SurgeryStatistics.vue?30b3"],"sourcesContent":["<template>\r\n  <div class=\"surgery-statistics-container\">\r\n    <!-- 页面标题和操作栏 -->\r\n    <div class=\"action-bar\">\r\n      <div class=\"title-section\">\r\n        <h2 class=\"page-title\">手术统计</h2>\r\n        <p class=\"page-subtitle\">查看各场手术的详细统计数据</p>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- 分析按钮 -->\r\n    <div class=\"analysis-section\" v-if=\"!surgeries.length && !analyzing\">\r\n      <el-card class=\"empty-card\">\r\n        <div class=\"empty-content\">\r\n          <el-icon class=\"empty-icon\"><Calendar /></el-icon>\r\n          <h3>手术数据统计</h3>\r\n          <p v-if=\"logEntriesCount > 0\">\r\n                          检测到 {{ logEntriesCount }} 条日志数据，点击按钮开始统计\r\n          </p>\r\n          <p v-else>\r\n                          暂无日志数据，请先在批量查看或日志查看页面加载日志数据\r\n          </p>\r\n          \r\n          <el-button \r\n            type=\"primary\" \r\n            @click=\"analyzeLogs\" \r\n            :loading=\"analyzing\"\r\n            :disabled=\"logEntriesCount === 0\"\r\n          >\r\n            <el-icon><DataAnalysis /></el-icon>\r\n            {{ getAnalysisButtonText() }}\r\n          </el-button>\r\n        </div>\r\n      </el-card>\r\n    </div>\r\n\r\n    <!-- 分析中状态 -->\r\n    <div class=\"analysis-section\" v-if=\"!surgeries.length && analyzing\">\r\n      <el-card class=\"empty-card\">\r\n        <div class=\"empty-content\">\r\n          <el-icon class=\"empty-icon\"><Loading /></el-icon>\r\n          <h3>正在统计手术数据...</h3>\r\n          <p>请稍候，系统正在处理日志数据</p>\r\n        </div>\r\n      </el-card>\r\n    </div>\r\n\r\n    <!-- 手术统计内容 -->\r\n    <div v-else>\r\n      \r\n      \r\n      <!-- 标签页导航 -->\r\n      <el-card class=\"tab-card\">\r\n        <el-tabs \r\n          v-model=\"activeTab\" \r\n          type=\"card\" \r\n          @tab-click=\"handleTabClick\"\r\n          :lazy=\"true\"\r\n          :before-leave=\"handleBeforeTabLeave\"\r\n          :stretch=\"false\"\r\n          :closable=\"false\"\r\n          :addable=\"false\"\r\n        >\r\n          <el-tab-pane \r\n            v-for=\"surgery in surgeries\" \r\n            :key=\"surgery.id\"\r\n            :label=\"surgery.surgery_id\"\r\n            :name=\"surgery.id.toString()\"\r\n            :data-surgery-id=\"surgery.id\"\r\n          >\r\n            <!-- 导出按钮 -->\r\n            <div class=\"export-section\">\r\n              <el-button type=\"primary\" @click=\"exportSurgeryData(surgery.id)\">\r\n                <el-icon><Download /></el-icon>\r\n                导出手术数据（手术结构化数据）\r\n              </el-button>\r\n            </div>\r\n            \r\n                        <!-- 手术信息布局 -->\r\n            <div class=\"surgery-info-layout\">\r\n              <!-- 手术时间线 - 30%宽度 -->\r\n              <div class=\"timeline-section\">\r\n                <el-card class=\"info-card\">\r\n                  <div class=\"info-header\">\r\n                    <div class=\"time\">手术时间线</div>\r\n                    <div class=\"badges\">\r\n                      <el-tag \r\n                        v-if=\"surgery.alarm_count > 0\" \r\n                        type=\"danger\" \r\n                        size=\"small\"\r\n                        class=\"alarm-tag\"\r\n                        @click=\"scrollToAlarmCard(surgery.id)\"\r\n                        style=\"cursor: pointer;\"\r\n                      >\r\n                        查看手术故障\r\n                      </el-tag>\r\n                      <el-tag \r\n                        v-if=\"surgery.is_remote_surgery\" \r\n                        type=\"info\" \r\n                        size=\"small\"\r\n                        class=\"network-tag\"\r\n                        @click=\"scrollToNetworkCard(surgery.id)\"\r\n                        style=\"cursor: pointer; margin-left: 8px;\"\r\n                      >\r\n                        查看网络延时\r\n                      </el-tag>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <!-- PostgreSQL结构化数据预览 -->\r\n                  <div class=\"postgresql-preview-section\">\r\n                    <div class=\"preview-header\">\r\n                      <span class=\"preview-title\">PostgreSQL结构化数据预览</span>\r\n                      <el-button \r\n                        type=\"text\" \r\n                        size=\"small\" \r\n                        @click=\"togglePostgreSQLPreview(surgery.id)\"\r\n                        style=\"padding: 0; margin-left: 8px;\"\r\n                      >\r\n                        {{ postgresqlPreviewVisible[surgery.id] ? '收起' : '展开' }}\r\n                      </el-button>\r\n                    </div>\r\n                    \r\n                    <div v-if=\"postgresqlPreviewVisible[surgery.id]\" class=\"preview-content\">\r\n                      <el-input\r\n                        v-model=\"postgresqlDataText[surgery.id]\"\r\n                        type=\"textarea\"\r\n                        :rows=\"8\"\r\n                        readonly\r\n                        placeholder=\"正在生成PostgreSQL结构化数据...\"\r\n                        class=\"postgresql-textarea\"\r\n                      />\r\n                      <div class=\"preview-actions\">\r\n                        <el-button \r\n                          type=\"primary\" \r\n                          size=\"small\" \r\n                          @click=\"copyPostgreSQLData(surgery.id)\"\r\n                          :loading=\"copyingData[surgery.id]\"\r\n                        >\r\n                          <el-icon><Document /></el-icon>\r\n                          复制数据\r\n                        </el-button>\r\n                        <el-button \r\n                          type=\"success\" \r\n                          size=\"small\" \r\n                          @click=\"refreshPostgreSQLData(surgery.id)\"\r\n                          :loading=\"refreshingData[surgery.id]\"\r\n                        >\r\n                          <el-icon><Refresh /></el-icon>\r\n                          刷新数据\r\n                        </el-button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <!-- 按时间顺序排序的时间线（AntD Steps progressDot 风格） -->\r\n                  <a-steps\r\n                    direction=\"vertical\"\r\n                    :current=\"getSortedTimelineEvents(surgery).length - 1\"\r\n                    :progress-dot=\"true\"\r\n                    class=\"surgery-steps\"\r\n                  >\r\n                    <a-step\r\n                      v-for=\"(event, index) in getSortedTimelineEvents(surgery)\"\r\n                      :key=\"`event-${index}`\"\r\n                      :title=\"event.label\"\r\n                      :description=\"formatTime(event.time)\"\r\n                    />\r\n                  </a-steps>\r\n                </el-card>\r\n              </div>\r\n\r\n              <!-- 手术状态变化图 - 70%宽度 -->\r\n              <div class=\"state-chart-section\">\r\n                <el-card class=\"state-chart-card\">\r\n                  <div class=\"chart-header\">\r\n                    <div class=\"chart-title\">手术状态机变化图</div>\r\n                  </div>\r\n                  \r\n                  <!-- 状态机曲线图容器（ECharts） -->\r\n                  <div \r\n                    class=\"state-chart-container\"\r\n                  >\r\n                    <div :id=\"`stateMachineChart_${surgery.id}`\" style=\"width: 100%; height: 100%\"></div>\r\n                  </div>\r\n                </el-card>\r\n              </div>\r\n            </div>\r\n                        \r\n            <!-- 手术统计（恢复整行宽度），并在卡片内下方显示手术器械表 -->\r\n            <el-card class=\"arm-usage-card\">\r\n              <template #header>\r\n                <div class=\"card-header\">\r\n                  <span>手术统计</span>\r\n                  <el-tag type=\"info\">总手术时长: {{ surgery.total_duration }} 分钟</el-tag>\r\n                </div>\r\n              </template>\r\n\r\n              <!-- 统一时间轴视图 - 结合手术时长和工具臂使用 -->\r\n              <div class=\"unified-timeline-view\">\r\n                <!-- 手术时长进度条 -->\r\n                <div class=\"surgery-progress-container\">\r\n                  <div class=\"surgery-duration-info\">\r\n                    <span class=\"duration-text\">手术时长：{{ surgery.total_duration }} 分钟</span>\r\n                    <span class=\"time-range\">手术时间：{{ formatTime(surgery.surgery_start_time) }} - {{ formatTime(surgery.surgery_end_time) }}</span>\r\n                  </div>\r\n                  <div class=\"surgery-timeline-wrapper\">\r\n                    <div class=\"surgery-label\">\r\n                      <div class=\"surgery-color\"></div>\r\n                      <span class=\"surgery-name\">手术时间段</span>\r\n                    </div>\r\n                    <div class=\"surgery-timeline-container\">\r\n                      <div class=\"surgery-timeline-bar\">\r\n                        <div \r\n                          class=\"surgery-timeline-segment\"\r\n                          :style=\"getSurgeryTimelineStyle(surgery)\"\r\n                        >\r\n                          <span class=\"surgery-segment-text\">手术时间段</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"progress-labels\">\r\n                    <span class=\"time-label\">{{ formatTimeShort(getProgressTimelineRange(surgery).start) }}</span>\r\n                    <span class=\"time-label\">{{ formatTimeShort(getProgressTimelineRange(surgery).end) }}</span>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- 工具臂时间线（更紧凑） -->\r\n                <div class=\"arm-timeline\">\r\n                  <div \r\n                    v-for=\"(armUsage, index) in getArmUsages(surgery)\" \r\n                    :key=\"index\"\r\n                    class=\"arm-item\"\r\n                  >\r\n                    <div class=\"arm-header\">\r\n                      <div class=\"arm-actions\">\r\n                        <el-button \r\n                          size=\"small\" \r\n                          type=\"primary\" \r\n                          plain\r\n                          @click=\"toggleArmDetails(surgery.id, index)\"\r\n                        >\r\n                          <el-icon><ArrowDown /></el-icon>\r\n                          详情\r\n                        </el-button>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div class=\"arm-timeline-container\">\r\n                      <div class=\"arm-label\">\r\n                        <div class=\"arm-color\" :class=\"`arm-${index + 1}`\"></div>\r\n                        <span class=\"arm-name\">工具臂 {{ index + 1 }}</span>\r\n                      </div>\r\n                      <div class=\"arm-timeline-bar\">\r\n                        <div \r\n                          v-for=\"(segment, segmentIndex) in getArmTimelineSegments(armUsage, surgery)\" \r\n                          :key=\"segmentIndex\"\r\n                          class=\"timeline-segment\" \r\n                          :class=\"`arm-${index + 1}`\" \r\n                          :style=\"segment\"\r\n                        >\r\n                          <el-tooltip \r\n                            :content=\"`${getSegmentInstrumentName(segment, armUsage, surgery)}`\"\r\n                            placement=\"top\"\r\n                            :show-arrow=\"true\"\r\n                            :popper-class=\"'usage-time-tooltip'\"\r\n                          >\r\n                            <div class=\"segment-content\">\r\n                              <span class=\"segment-text\"> </span>\r\n                            </div>\r\n                          </el-tooltip>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <el-collapse-transition>\r\n                      <div v-show=\"armDetailsVisible[surgery.id + '_' + index]\" class=\"arm-details\">\r\n                        <div \r\n                          v-for=\"(groupedUsage, udiCode) in getGroupedUsagesByUdi(armUsage)\" \r\n                          :key=\"udiCode\"\r\n                          class=\"usage-group\"\r\n                        >\r\n                          <div class=\"usage-group-header\">\r\n                            <div class=\"usage-group-info\">\r\n                              <div class=\"usage-group-name\">\r\n                                {{ groupedUsage.instrumentName }}\r\n                              </div>\r\n                              <div class=\"usage-group-udi\">UDI: {{ udiCode }}</div>\r\n                              <div class=\"usage-group-duration\">总使用时长: {{ getGroupedUsageDuration(groupedUsage) }}</div>\r\n                            </div>\r\n                          </div>\r\n                          <div class=\"arm-timeline-container\">\r\n                            <div class=\"arm-timeline-bar\">\r\n                              <div \r\n                                v-for=\"(usage, usageIndex) in groupedUsage.usages\" \r\n                                :key=\"usageIndex\"\r\n                                class=\"timeline-segment\" \r\n                                :class=\"`arm-${index + 1}`\" \r\n                                :style=\"getUsageTimelineStyle(usage, surgery)\"\r\n                              >\r\n                                <el-tooltip \r\n                                  :content=\"`器械：${usage.instrumentName}\\n时间：${formatTime(usage.startTime)} - ${formatTime(usage.endTime)}\\n时长：${Math.floor((new Date(usage.endTime) - new Date(usage.startTime)) / 1000 / 60)}分钟`\"\r\n                                  placement=\"top\"\r\n                                  :show-arrow=\"true\"\r\n                                  :popper-class=\"'usage-time-tooltip'\"\r\n                                >\r\n                                  <div class=\"segment-content\">\r\n                                    <span class=\"segment-text\">{{ getSegmentText(usage, surgery) }}</span>\r\n                                  </div>\r\n                                </el-tooltip>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div class=\"energy-time\">\r\n                          <el-icon class=\"energy-icon\"><Lightning /></el-icon>\r\n                          器械总使用时间: {{ getEnergyTime(armUsage) }}\r\n                        </div>\r\n                      </div>\r\n                    </el-collapse-transition>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <!-- 手术器械（位于手术统计卡片内，工具臂激活时间下方） -->\r\n              <div class=\"instruments-inside\">\r\n                <div class=\"card-header\" style=\"margin-top: 12px; margin-bottom: 8px;\">\r\n                  <span>手术器械</span>\r\n                </div>\r\n                <el-table :data=\"getInstrumentRows(surgery)\" size=\"small\" style=\"width: 100%\">\r\n                  <el-table-column prop=\"instrumentName\" label=\"器械名称\" min-width=\"180\" />\r\n                  <el-table-column prop=\"udi\" label=\"UDI码\" min-width=\"220\" />\r\n                </el-table>\r\n              </div>\r\n            </el-card>\r\n            \r\n            <!-- 安全报警信息 -->\r\n            <el-card class=\"alarm-card\">\r\n              <template #header>\r\n                <span>安全报警记录</span>\r\n              </template>\r\n              \r\n              <el-table :data=\"getAlarmDetails(surgery).slice(0, showAllAlarms[surgery.id] ? undefined : 5)\" style=\"width: 100%\">\r\n                <el-table-column prop=\"time\" label=\"时间\" width=\"180\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ formatTime(row.time) }}\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"code\" label=\"故障码\" width=\"120\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ row.code || row.error_code || '无' }}\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"message\" label=\"报警信息\" />\r\n                <el-table-column prop=\"status\" label=\"处理状态\" width=\"120\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-tag :type=\"row.status === '已恢复' ? 'success' : row.status === '未处理' ? 'danger' : 'warning'\">\r\n                      {{ row.status }}\r\n                    </el-tag>\r\n                  </template>\r\n                </el-table-column>\r\n              </el-table>\r\n              \r\n              <!-- 展开/折叠按钮 -->\r\n              <div v-if=\"getAlarmDetails(surgery).length > 5\" class=\"alarm-toggle\">\r\n                <el-button \r\n                  type=\"text\" \r\n                  @click=\"toggleAlarms(surgery.id)\"\r\n                  size=\"small\"\r\n                >\r\n                  <el-icon>\r\n                    <ArrowDown v-if=\"!showAllAlarms[surgery.id]\" />\r\n                    <ArrowUp v-else />\r\n                  </el-icon>\r\n                  {{ showAllAlarms[surgery.id] ? '收起' : `展开更多 (${getAlarmDetails(surgery).length - 5}条)` }}\r\n                </el-button>\r\n              </div>\r\n              \r\n              <div class=\"alarm-summary\">\r\n                <el-tag type=\"danger\">报警总数: {{ surgery.alarm_count || 0 }}</el-tag>\r\n                <el-tag type=\"info\" style=\"margin-left: 8px;\">未处理: {{ getDeduplicatedAlarmStats(surgery).activeCount }}</el-tag>\r\n                <div style=\"margin-top: 8px; font-size: 12px; color: #909399;\">\r\n                  <span>说明：相同故障码在解除恢复前只统计一次</span>\r\n                </div>\r\n              </div>\r\n            </el-card>\r\n            \r\n            <!-- 网络延时统计 -->\r\n            <el-card v-if=\"surgery.is_remote_surgery\" class=\"network-card\">\r\n              <template #header>\r\n                <span>网络延时统计</span>\r\n              </template>\r\n              \r\n              <div v-if=\"surgery.network_stats\" class=\"network-stats\">\r\n                <div class=\"network-summary\">\r\n                  <el-tag type=\"info\">数据点: {{ surgery.network_stats.count }}</el-tag>\r\n                  <el-tag type=\"success\" style=\"margin-left: 8px;\">平均延时: {{ surgery.network_stats.avg }}ms</el-tag>\r\n                  <el-tag type=\"warning\" style=\"margin-left: 8px;\">范围: {{ surgery.network_stats.min }}-{{ surgery.network_stats.max }}ms</el-tag>\r\n                </div>\r\n                \r\n                <!-- 网络延时曲线图 -->\r\n                <div class=\"network-chart-container\">\r\n                  <div :id=\"`networkChart_${surgery.id}`\" style=\"width: 100%; height: 300px\"></div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div v-else class=\"network-no-data\">\r\n                <el-empty description=\"暂无网络延时数据\" :image-size=\"60\" />\r\n              </div>\r\n            </el-card>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </el-card>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, onMounted, nextTick, computed, watch, h, resolveComponent } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { \r\n  DataAnalysis, \r\n  Download, \r\n  SwitchButton, \r\n  Close, \r\n  VideoPlay, \r\n  VideoPause, \r\n  ArrowUp, \r\n  ArrowDown,\r\n  ArrowLeft,\r\n  ArrowRight,\r\n  Calendar,\r\n  Lightning,\r\n  Loading,\r\n  InfoFilled,\r\n  Document,\r\n  Refresh\r\n} from '@element-plus/icons-vue'\r\nimport { debounce, safeNextTick } from '@/utils/resizeObserverFix'\r\nimport * as echarts from 'echarts'\r\n\r\nimport api from '@/api'\r\n\r\nexport default {\r\n  name: 'SurgeryStatistics',\r\n  components: {\r\n    DataAnalysis,\r\n    Download,\r\n    SwitchButton,\r\n    Close,\r\n    VideoPlay,\r\n    VideoPause,\r\n        ArrowUp, \r\n    ArrowDown,\r\n    ArrowLeft,\r\n    ArrowRight,\r\n    Calendar,\r\n    Lightning,\r\n    Loading,\r\n    Document,\r\n    Refresh\r\n  },\r\n  setup() {\r\n    // 不需要悬停效果：移除自定义 progressDot 渲染与状态区分\r\n    const store = useStore()\r\n    const router = useRouter()\r\n    const route = useRoute()\r\n    \r\n    // ResizeObserver 错误处理已在全局初始化，这里不需要重复处理\r\n    \r\n    // 响应式数据\r\n    const surgeries = ref([])\r\n    const activeTab = ref('')\r\n    const armDetailsVisible = reactive({})\r\n    const showAllAlarms = reactive({})\r\n    const analyzing = ref(false)\r\n    \r\n    // PostgreSQL数据预览相关\r\n    const postgresqlPreviewVisible = reactive({})\r\n    const postgresqlDataText = reactive({})\r\n    const copyingData = reactive({})\r\n    const refreshingData = reactive({})\r\n    \r\n    // 状态机图表相关\r\n    const stateMachineCharts = new Map() // 为每个手术存储独立的图表实例\r\n    const chartViewRange = ref(5) // 默认显示5分钟\r\n    const chartCurrentTime = ref(null) // 当前图表中心时间\r\n    \r\n    // Y轴刻度配置 - 固定间隔\r\n    const yAxisConfig = {\r\n      // 固定间隔 - 显示指定的刻度值，使用映射位置增大间距\r\n      fixedInterval: {\r\n        afterBuildTicks: function(axis) {\r\n          // 使用固定的刻度值\r\n          const fixedStates = getFixedTicks()\r\n          const positionMap = getStateToYPositionMap()\r\n          \r\n          // 创建刻度数组，确保显示正确的状态值\r\n          axis.ticks = fixedStates.map(stateValue => {\r\n            const yPosition = positionMap[stateValue]\r\n            return {\r\n              value: yPosition,        // Y轴位置使用映射值\r\n              label: stateValue.toString() // 显示原始状态值\r\n            }\r\n          })\r\n        }\r\n      }\r\n    }\r\n    \r\n    // 状态值到Y轴位置的映射 - 增大特定刻度之间的距离\r\n    // 这个映射用于在Y轴上增大特定状态值之间的视觉距离，而不改变显示的刻度值\r\n    const getStateToYPositionMap = () => {\r\n      return {\r\n        0: 0,   // 0位置\r\n        1: 5,   // 1位置（与0距离增大）\r\n        2: 10,  // 2位置\r\n        10: 20, // 10位置\r\n        12: 25, // 12位置（与10距离增大）\r\n        13: 30, // 13位置（与12距离增大）\r\n        14: 35, // 14位置（与13距离增大）\r\n        20: 45, // 20位置（与14距离增大）\r\n        21: 50, // 21位置（与20距离增大）\r\n        30: 60, // 30位置（与21距离增大）\r\n        31: 65  // 31位置（与30距离增大）\r\n      }\r\n    }\r\n    \r\n    // 固定显示指定的刻度值\r\n    const getFixedTicks = () => {\r\n      // 显示的刻度值：0, 1, 2, 10, 12, 13, 14, 20, 21, 30, 31\r\n      return [0, 1, 2, 10, 12, 13, 14, 20, 21, 30, 31]\r\n    }\r\n\r\n    \r\n\r\n\r\n    // 计算属性 - 获取日志条目数据\r\n    const logEntries = computed(() => {\r\n      // 优先从URL参数获取日志ID\r\n      const logIdsParam = route.query.logIds\r\n      if (logIdsParam) {\r\n        // 如果有URL参数，直接返回空数组，让后端处理\r\n        return []\r\n      }\r\n      \r\n      // 如果没有URL参数，尝试从sessionStorage获取数据（兼容旧版本）\r\n      try {\r\n        const surgeryData = sessionStorage.getItem('surgeryAnalysisData')\r\n        if (surgeryData) {\r\n          const data = JSON.parse(surgeryData)\r\n          if (data && data.entries && data.entries.length > 0) {\r\n            // 检查数据是否过期（1小时）\r\n            const dataAge = Date.now() - (data.timestamp || 0)\r\n            if (dataAge > 60 * 60 * 1000) {\r\n              console.log('手术分析数据已过期，清除缓存')\r\n              sessionStorage.removeItem('surgeryAnalysisData')\r\n              return []\r\n            }\r\n            \r\n            // 检查是否是压缩格式的数据\r\n            if (data.compressed) {\r\n              // 解压缩数据\r\n              const decompressedEntries = data.entries.map(entry => ({\r\n                timestamp: entry.t,\r\n                error_code: entry.e,\r\n                param1: entry.p1,\r\n                param2: entry.p2,\r\n                param3: entry.p3,\r\n                param4: entry.p4,\r\n                explanation: entry.exp,\r\n                log_name: entry.ln\r\n              }))\r\n              \r\n              return decompressedEntries\r\n            } else {\r\n              return data.entries\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('解析手术分析数据失败:', error)\r\n        sessionStorage.removeItem('surgeryAnalysisData')\r\n      }\r\n      \r\n      return []\r\n    })\r\n    \r\n    const logEntriesCount = computed(() => logEntries.value.length)\r\n    \r\n    // 通过URL参数中的日志ID直接分析手术数据\r\n    const loadBatchLogEntriesByIds = async () => {\r\n      try {\r\n        // 从URL参数获取日志ID\r\n        const logIdsParam = route.query.logIds\r\n        if (!logIdsParam) return\r\n        \r\n        const logIds = logIdsParam.split(',').map(id => parseInt(id))\r\n        if (!logIds || logIds.length === 0) return\r\n        \r\n        // 设置分析状态\r\n        analyzing.value = true\r\n        \r\n        // 调用后端API创建分析任务\r\n        const response = await api.surgeryStatistics.analyzeByLogIds(logIds)\r\n        \r\n        if (response.data.success && response.data.taskId) {\r\n          // 异步任务已创建，开始轮询结果\r\n          await pollTaskResult(response.data.taskId)\r\n        } else if (response.data.success && response.data.data) {\r\n          // 直接返回结果（兼容旧版本）\r\n          surgeries.value = response.data.data || []\r\n          \r\n          if (surgeries.value.length > 0) {\r\n            activeTab.value = surgeries.value[0].id.toString()\r\n            surgeries.value.forEach(surgery => {\r\n              armDetailsVisible[surgery.id] = false\r\n              showAllAlarms[surgery.id] = false\r\n              // 初始化PostgreSQL预览状态\r\n              postgresqlPreviewVisible[surgery.id] = false\r\n              postgresqlDataText[surgery.id] = ''\r\n            })\r\n          }\r\n          \r\n          ElMessage.success(response.data.message || `成功统计出 ${surgeries.value.length} 场手术`)\r\n        } else {\r\n          ElMessage.error(response.data.message || '统计失败')\r\n        }\r\n        \r\n      } catch (error) {\r\n        ElMessage.error('分析批量日志数据失败: ' + (error.response?.data?.message || error.message))\r\n      } finally {\r\n        analyzing.value = false\r\n      }\r\n    }\r\n    \r\n    // 轮询任务结果\r\n    const pollTaskResult = async (taskId) => {\r\n      const maxAttempts = 60 // 最多轮询60次（5分钟）\r\n      let attempts = 0\r\n      \r\n      const poll = async () => {\r\n        try {\r\n          const response = await api.surgeryStatistics.getAnalysisTaskStatus(taskId)\r\n          \r\n          if (response.data.success) {\r\n            const task = response.data.data\r\n            \r\n            if (task.status === 'completed') {\r\n              // 任务完成，显示结果\r\n              surgeries.value = task.result || []\r\n              \r\n              if (surgeries.value.length > 0) {\r\n                activeTab.value = surgeries.value[0].id.toString()\r\n                surgeries.value.forEach(surgery => {\r\n                  armDetailsVisible[surgery.id] = false\r\n                  showAllAlarms[surgery.id] = false\r\n                  // 初始化PostgreSQL预览状态\r\n                  postgresqlPreviewVisible[surgery.id] = false\r\n                  postgresqlDataText[surgery.id] = ''\r\n                })\r\n              }\r\n              \r\n              ElMessage.success(`成功分析出 ${surgeries.value.length} 场手术`)\r\n              return\r\n            } else if (task.status === 'failed') {\r\n              // 任务失败\r\n              ElMessage.error(task.error || '分析任务失败')\r\n              return\r\n            } else if (task.status === 'processing') {\r\n              // 任务进行中，继续轮询\r\n              attempts++\r\n              if (attempts < maxAttempts) {\r\n                // 使用Promise包装setTimeout\r\n                await new Promise(resolve => setTimeout(resolve, 5000))\r\n                await poll()\r\n              } else {\r\n                ElMessage.error('分析任务超时，请稍后查看结果')\r\n              }\r\n            }\r\n          } else {\r\n            ElMessage.error('查询任务状态失败')\r\n          }\r\n        } catch (error) {\r\n          ElMessage.error('查询任务状态失败: ' + error.message)\r\n        }\r\n      }\r\n      \r\n      // 开始轮询\r\n      await poll()\r\n    }\r\n    \r\n    // 获取时间范围\r\n    const getTimeRange = () => {\r\n      if (logEntries.value.length === 0) return '无数据'\r\n      \r\n      const timestamps = logEntries.value.map(entry => new Date(entry.timestamp))\r\n      const minTime = new Date(Math.min(...timestamps))\r\n      const maxTime = new Date(Math.max(...timestamps))\r\n      \r\n      return `${formatTimeShort(minTime)} 至 ${formatTimeShort(maxTime)}`\r\n    }\r\n\r\n    // 获取分析按钮文本\r\n    const getAnalysisButtonText = () => {\r\n      if (logEntriesCount.value === 0) {\r\n        return '请先加载日志条目数据'\r\n      }\r\n              return `统计日志条目 (${logEntriesCount.value})`\r\n    }\r\n\r\n          // 统计日志数据\r\n    const analyzeLogs = async () => {\r\n      if (logEntries.value.length === 0) {\r\n        ElMessage.warning('暂无日志数据，请先在批量查看或日志查看页面加载日志数据')\r\n        return\r\n      }\r\n      \r\n      analyzing.value = true\r\n      try {\r\n        // 直接使用已排序的日志条目数据进行手术分析\r\n        \r\n        // 检查数据大小\r\n        const dataSize = JSON.stringify(logEntries.value).length\r\n        const maxSize = 10 * 1024 * 1024 // 10MB\r\n        let analysisData = logEntries.value\r\n        \r\n        if (dataSize > maxSize) {\r\n          ElMessage.warning(`数据量较大(${(dataSize / 1024 / 1024).toFixed(1)}MB)，将进行数据采样以提高统计速度`)\r\n          \r\n          // 数据采样：保留关键数据点\r\n          const sampleSize = Math.floor(maxSize / (dataSize / logEntries.value.length))\r\n          const step = Math.floor(logEntries.value.length / sampleSize)\r\n          analysisData = []\r\n          \r\n          for (let i = 0; i < logEntries.value.length; i += step) {\r\n            analysisData.push(logEntries.value[i])\r\n            if (analysisData.length >= sampleSize) break\r\n          }\r\n          \r\n        }\r\n        \r\n\r\n        \r\n        // 调用新的API端点，传递已排序的日志条目数据\r\n        const response = await api.surgeryStatistics.analyzeSortedEntries({\r\n          logEntries: analysisData,\r\n          includePostgreSQLStructure: true\r\n        })\r\n        \r\n        if (response.data.success) {\r\n          surgeries.value = response.data.data || []\r\n          \r\n          \r\n          \r\n          if (surgeries.value.length > 0) {\r\n            activeTab.value = surgeries.value[0].id.toString()\r\n            surgeries.value.forEach(surgery => {\r\n              armDetailsVisible[surgery.id] = false\r\n              showAllAlarms[surgery.id] = false\r\n              // 初始化PostgreSQL预览状态\r\n              postgresqlPreviewVisible[surgery.id] = false\r\n              postgresqlDataText[surgery.id] = ''\r\n            })\r\n          }\r\n          \r\n          ElMessage.success(`手术数据统计完成，共发现 ${surgeries.value.length} 场手术`)\r\n        } else {\r\n          ElMessage.error(response.data.message || '统计失败')\r\n        }\r\n      } catch (error) {\r\n        ElMessage.error('统计日志数据失败: ' + (error.response?.data?.message || error.message))\r\n      } finally {\r\n        analyzing.value = false\r\n      }\r\n    }\r\n\r\n    // 导出手术数据（结构化数据）\r\n    const exportSurgeryData = async (surgeryId) => {\r\n      try {\r\n        const response = await api.surgeryStatistics.exportSingleSurgeryData(surgeryId)\r\n        if (response.data.success) {\r\n          ElMessage.success('手术结构化数据导出成功')\r\n          // 可以在这里添加下载功能\r\n          console.log('导出的结构化数据:', response.data.data)\r\n        } else {\r\n          ElMessage.error(response.data.message || '导出失败')\r\n        }\r\n      } catch (error) {\r\n        ElMessage.error('导出手术数据失败: ' + (error.response?.data?.message || error.message))\r\n      }\r\n    }\r\n\r\n    // 切换PostgreSQL数据预览显示\r\n    const togglePostgreSQLPreview = (surgeryId) => {\r\n      postgresqlPreviewVisible[surgeryId] = !postgresqlPreviewVisible[surgeryId]\r\n      \r\n      // 如果展开预览，则生成PostgreSQL数据\r\n      if (postgresqlPreviewVisible[surgeryId] && !postgresqlDataText[surgeryId]) {\r\n        generatePostgreSQLData(surgeryId)\r\n      }\r\n    }\r\n\r\n    // 生成PostgreSQL结构化数据\r\n    const generatePostgreSQLData = (surgeryId) => {\r\n      const surgery = surgeries.value.find(s => s.id === surgeryId)\r\n      if (!surgery) {\r\n        postgresqlDataText[surgeryId] = '未找到手术数据'\r\n        return\r\n      }\r\n\r\n      try {\r\n        // 获取正确的日志ID\r\n        let logId = surgery.log_id\r\n        if (!logId) {\r\n          // 尝试从URL参数获取日志ID\r\n          const logIdsParam = route.query.logIds\r\n          if (logIdsParam) {\r\n            const logIdArray = logIdsParam.split(',').map(id => parseInt(id.trim()))\r\n            logId = logIdArray[0] // 使用第一个日志ID\r\n          }\r\n        }\r\n        \r\n        // 构建完整的surgeries表数据\r\n        const surgeriesData = {\r\n          surgery_id: surgery.surgery_id,\r\n          device_ids: logId ? [logId] : [1], // 使用正确的日志ID\r\n          start_time: surgery.surgery_start_time,\r\n          end_time: surgery.surgery_end_time,\r\n          is_remote: surgery.is_remote_surgery || false,\r\n          structured_data: surgery.postgresql_structure || generateStructuredData(surgery),\r\n          last_analyzed_at: new Date().toISOString(),\r\n          created_at: new Date().toISOString(),\r\n          updated_at: new Date().toISOString()\r\n        }\r\n\r\n        postgresqlDataText[surgeryId] = JSON.stringify(surgeriesData, null, 2)\r\n      } catch (error) {\r\n        console.error('生成PostgreSQL数据失败:', error)\r\n        postgresqlDataText[surgeryId] = '生成PostgreSQL数据失败: ' + error.message\r\n      }\r\n    }\r\n\r\n    // 生成结构化数据（如果后端没有提供）\r\n    const generateStructuredData = (surgery) => {\r\n      // 构建power_cycles - 使用正确的字段名\r\n      const powerCycles = []\r\n      \r\n      // 使用正确的字段名：power_on_times 和 shutdown_times\r\n      if (surgery.power_on_times && surgery.shutdown_times) {\r\n        const onTimes = surgery.power_on_times\r\n        const offTimes = surgery.shutdown_times\r\n        \r\n        for (let i = 0; i < Math.max(onTimes.length, offTimes.length); i++) {\r\n          if (onTimes[i] || offTimes[i]) {\r\n            powerCycles.push({\r\n              on_time: onTimes[i] ? new Date(onTimes[i]).toISOString() : null,\r\n              off_time: offTimes[i] ? new Date(offTimes[i]).toISOString() : null\r\n            })\r\n          }\r\n        }\r\n      }\r\n      \r\n      // 兼容旧版本字段名\r\n      if (powerCycles.length === 0) {\r\n        for (let i = 1; i <= 4; i++) {\r\n          const powerOnTime = surgery[`power${i}_on_time`]\r\n          const powerOffTime = surgery[`power${i}_off_time`]\r\n          if (powerOnTime && powerOffTime) {\r\n            powerCycles.push({\r\n              on_time: new Date(powerOnTime).toISOString(),\r\n              off_time: new Date(powerOffTime).toISOString()\r\n            })\r\n          }\r\n        }\r\n      }\r\n\r\n      // 构建arms数据 - 使用正确的字段名\r\n      const arms = []\r\n      for (let i = 1; i <= 4; i++) {\r\n        const armUsage = surgery[`arm${i}_usage`] || []\r\n        arms.push({\r\n          arm_id: i,\r\n          instrument_usage: armUsage.map(usage => ({\r\n            tool_type: usage.instrumentName || usage.tool_type || '未知器械',\r\n            udi: usage.udi || '',\r\n            start_time: usage.startTime || usage.start_time,\r\n            end_time: usage.endTime || usage.end_time,\r\n            energy_activation: usage.energy_activation || []\r\n          }))\r\n        })\r\n      }\r\n\r\n      // 构建surgery_stats\r\n      const surgeryStats = {\r\n        has_fault: surgery.has_error || false,\r\n        success: !surgery.has_error,\r\n        is_remote: surgery.is_remote_surgery || false,\r\n        network_latency_ms: surgery.network_stats ? surgery.network_stats.data.map(d => d.latency) : [],\r\n        faults: surgery.alarm_details ? surgery.alarm_details.map(fault => ({\r\n          timestamp: fault.time,\r\n          error_code: fault.code,\r\n          param1: \"\",\r\n          param2: \"\",\r\n          param3: \"\",\r\n          param4: \"\",\r\n          explanation: fault.message,\r\n          log_id: surgery.log_id || 1\r\n        })) : [],\r\n        arm_switch_count: 0,\r\n        left_hand_clutch: surgery.hand_clutch_stats?.arm1 || 0,\r\n        right_hand_clutch: surgery.hand_clutch_stats?.arm2 || 0,\r\n        foot_clutch: surgery.foot_pedal_stats?.clutch || 0,\r\n        endoscope_pedal: surgery.foot_pedal_stats?.camera || 0\r\n      }\r\n\r\n      return {\r\n        power_cycles: powerCycles,\r\n        arms: arms,\r\n        surgery_stats: surgeryStats\r\n      }\r\n    }\r\n\r\n    // 复制PostgreSQL数据到剪贴板\r\n    const copyPostgreSQLData = async (surgeryId) => {\r\n      copyingData[surgeryId] = true\r\n      try {\r\n        const text = postgresqlDataText[surgeryId]\r\n        if (text) {\r\n          await navigator.clipboard.writeText(text)\r\n          ElMessage.success('PostgreSQL数据已复制到剪贴板')\r\n        } else {\r\n          ElMessage.warning('没有可复制的数据')\r\n        }\r\n      } catch (error) {\r\n        console.error('复制失败:', error)\r\n        ElMessage.error('复制失败: ' + error.message)\r\n      } finally {\r\n        copyingData[surgeryId] = false\r\n      }\r\n    }\r\n\r\n    // 刷新PostgreSQL数据\r\n    const refreshPostgreSQLData = async (surgeryId) => {\r\n      refreshingData[surgeryId] = true\r\n      try {\r\n        generatePostgreSQLData(surgeryId)\r\n        ElMessage.success('PostgreSQL数据已刷新')\r\n      } catch (error) {\r\n        console.error('刷新失败:', error)\r\n        ElMessage.error('刷新失败: ' + error.message)\r\n      } finally {\r\n        refreshingData[surgeryId] = false\r\n      }\r\n    }\r\n\r\n    // 切换工具臂详情显示\r\n    const toggleArmDetails = (surgeryId, armIndex) => {\r\n      const key = `${surgeryId}_${armIndex}`\r\n      armDetailsVisible[key] = !armDetailsVisible[key]\r\n    }\r\n\r\n    // 切换报警记录显示\r\n    const toggleAlarms = (surgeryId) => {\r\n      showAllAlarms[surgeryId] = !showAllAlarms[surgeryId]\r\n    }\r\n\r\n    // 滚动到安全报警记录卡片\r\n    const scrollToAlarmCard = (surgeryId) => {\r\n      // 确保当前手术标签页是激活的\r\n      if (activeTab.value !== surgeryId.toString()) {\r\n        activeTab.value = surgeryId.toString()\r\n      }\r\n      \r\n      // 等待DOM更新后滚动到报警卡片\r\n      nextTick(() => {\r\n        const alarmCard = document.querySelector(`[data-surgery-id=\"${surgeryId}\"] .alarm-card`)\r\n        if (alarmCard) {\r\n          alarmCard.scrollIntoView({ \r\n            behavior: 'smooth', \r\n            block: 'start' \r\n          })\r\n          \r\n          // 添加高亮效果\r\n          alarmCard.style.boxShadow = '0 0 0 2px #F56C6C, 0 4px 12px rgba(245, 108, 108, 0.3)'\r\n          alarmCard.style.transition = 'box-shadow 0.3s ease'\r\n          \r\n          // 3秒后移除高亮效果\r\n          setTimeout(() => {\r\n            alarmCard.style.boxShadow = ''\r\n          }, 3000)\r\n        }\r\n      })\r\n    }\r\n\r\n    // 滚动到网络延时统计卡片\r\n    const scrollToNetworkCard = (surgeryId) => {\r\n      // 确保当前手术标签页是激活的\r\n      if (activeTab.value !== surgeryId.toString()) {\r\n        activeTab.value = surgeryId.toString()\r\n      }\r\n      \r\n      // 等待DOM更新后滚动到网络卡片\r\n      nextTick(() => {\r\n        const networkCard = document.querySelector(`[data-surgery-id=\"${surgeryId}\"] .network-card`)\r\n        if (networkCard) {\r\n          networkCard.scrollIntoView({ \r\n            behavior: 'smooth', \r\n            block: 'start' \r\n          })\r\n          \r\n          // 添加高亮效果\r\n          networkCard.style.boxShadow = '0 0 0 2px #409EFF, 0 4px 12px rgba(64, 158, 255, 0.3)'\r\n          networkCard.style.transition = 'box-shadow 0.3s ease'\r\n          \r\n          // 3秒后移除高亮效果\r\n          setTimeout(() => {\r\n            networkCard.style.boxShadow = ''\r\n          }, 3000)\r\n        }\r\n      })\r\n    }\r\n\r\n\r\n\r\n    // 获取工具臂使用情况\r\n    const getArmUsages = (surgery) => {\r\n      return [\r\n        surgery.arm1_usage || [],\r\n        surgery.arm2_usage || [],\r\n        surgery.arm3_usage || [],\r\n        surgery.arm4_usage || []\r\n      ]\r\n    }\r\n\r\n      // 手术器械表数据\r\n      const getInstrumentRows = (surgery) => {\r\n        if (!surgery) return []\r\n        const grouped = new Map()\r\n        const allArms = getArmUsages(surgery)\r\n        allArms.forEach(armUsage => {\r\n          (armUsage || []).forEach(u => {\r\n            if (!u) return\r\n            if (!u.startTime || !u.endTime) return\r\n            const udi = u.udi || '未知'\r\n            const key = `${udi}__${u.instrumentName || '未知器械'}`\r\n            if (!grouped.has(key)) {\r\n              grouped.set(key, {\r\n                instrumentName: u.instrumentName || '未知器械',\r\n                udi: udi,\r\n                segments: []\r\n              })\r\n            }\r\n            grouped.get(key).segments.push({ startTime: u.startTime, endTime: u.endTime })\r\n          })\r\n        })\r\n        // 合并相邻/重叠的段，并计算整体起止\r\n        const rows = Array.from(grouped.values()).map(item => {\r\n          // 排序\r\n          item.segments.sort((a, b) => new Date(a.startTime) - new Date(b.startTime))\r\n          // 合并重叠或相邻\r\n          const merged = []\r\n          for (const seg of item.segments) {\r\n            if (merged.length === 0) { merged.push({ ...seg }); continue }\r\n            const last = merged[merged.length - 1]\r\n            const lastEnd = new Date(last.endTime).getTime()\r\n            const curStart = new Date(seg.startTime).getTime()\r\n            const curEnd = new Date(seg.endTime).getTime()\r\n            if (curStart <= lastEnd) {\r\n              if (curEnd > lastEnd) last.endTime = seg.endTime\r\n            } else {\r\n              merged.push({ ...seg })\r\n            }\r\n          }\r\n          const startTime = merged.length ? merged[0].startTime : null\r\n          const endTime = merged.length ? merged[merged.length - 1].endTime : null\r\n          return { ...item, segments: merged, startTime, endTime }\r\n        })\r\n        // 按起始时间排序\r\n        rows.sort((a, b) => new Date(a.startTime) - new Date(b.startTime))\r\n        return rows\r\n      }\r\n\r\n    // 获取工具臂总时间\r\n    const getArmTotalTime = (armUsage) => {\r\n      if (!armUsage || armUsage.length === 0) return '0分钟'\r\n      \r\n      // 计算所有完整使用时间段的总时长\r\n      const totalMinutes = armUsage\r\n        .filter(usage => usage.startTime && usage.endTime)\r\n        .reduce((total, usage) => {\r\n          const duration = Math.floor((new Date(usage.endTime) - new Date(usage.startTime)) / 1000 / 60)\r\n          return total + duration\r\n        }, 0)\r\n      \r\n      return `${totalMinutes}分钟`\r\n    }\r\n\r\n    // 获取报警类型标签类型\r\n    const getAlarmTypeTag = (type) => {\r\n      switch (type) {\r\n        case '错误':\r\n          return 'danger'\r\n        case '警告':\r\n          return 'warning'\r\n        case '网络':\r\n          return 'info'\r\n        default:\r\n          return 'info'\r\n      }\r\n    }\r\n\r\n    // 获取报警详情\r\n    const getAlarmDetails = (surgery) => {\r\n      if (!surgery || !surgery.alarm_details) return []\r\n      \r\n      let details = []\r\n      \r\n      if (typeof surgery.alarm_details === 'string') {\r\n        try {\r\n          details = JSON.parse(surgery.alarm_details)\r\n        } catch (error) {\r\n          console.error('解析alarm_details字符串失败:', error)\r\n          return []\r\n        }\r\n      } else {\r\n        details = surgery.alarm_details || []\r\n      }\r\n      \r\n      return details\r\n    }\r\n\r\n    // 获取去重后的故障统计信息\r\n    const getDeduplicatedAlarmStats = (surgery) => {\r\n      const details = getAlarmDetails(surgery)\r\n      if (!details || details.length === 0) {\r\n        return { uniqueCount: 0, totalCount: 0, activeCount: 0 }\r\n      }\r\n      \r\n      // 统计唯一故障码数量\r\n      const uniqueCodes = new Set(details.map(d => d.code))\r\n      const uniqueCount = uniqueCodes.size\r\n      \r\n      // 统计总故障数量\r\n      const totalCount = details.length\r\n      \r\n      // 统计未处理的故障数量\r\n      const activeCount = details.filter(d => d.status === '未处理' && d.isActive === true).length\r\n      \r\n      return { uniqueCount, totalCount, activeCount }\r\n    }\r\n\r\n    // 格式化时间（24小时制）\r\n    const formatTime = (time) => {\r\n      if (!time) return '-'\r\n      const date = new Date(time)\r\n      const year = date.getFullYear()\r\n      const month = String(date.getMonth() + 1).padStart(2, '0')\r\n      const day = String(date.getDate()).padStart(2, '0')\r\n      const hours = String(date.getHours()).padStart(2, '0')\r\n      const minutes = String(date.getMinutes()).padStart(2, '0')\r\n      const seconds = String(date.getSeconds()).padStart(2, '0')\r\n      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`\r\n    }\r\n\r\n    // 格式化手术时间范围\r\n    const formatSurgeryTime = (surgery) => {\r\n      if (!surgery.surgery_start_time || !surgery.surgery_end_time) {\r\n        return '手术时间未确定'\r\n      }\r\n      const start = new Date(surgery.surgery_start_time).toLocaleString()\r\n      const end = new Date(surgery.surgery_end_time).toLocaleString()\r\n      return `${start} ~ ${end}`\r\n    }\r\n\r\n    // 格式化短时间（24小时制）\r\n    const formatTimeShort = (time) => {\r\n      if (!time) return '-'\r\n      const date = new Date(time)\r\n      const hours = String(date.getHours()).padStart(2, '0')\r\n      const minutes = String(date.getMinutes()).padStart(2, '0')\r\n      return `${hours}:${minutes}`\r\n    }\r\n\r\n    // 获取统一的时间轴范围（重新设计：严格使用手术开始到手术结束时间）\r\n    const getTimelineRange = (surgery) => {\r\n      if (!surgery) return { start: null, end: null }\r\n      \r\n      // 重新设计：严格使用手术开始和结束时间，确保与状态机图表一致\r\n      const start = surgery.surgery_start_time\r\n      const end = surgery.surgery_end_time\r\n      \r\n      // 确保开始时间早于结束时间\r\n      if (start && end) {\r\n        const startTime = new Date(start).getTime()\r\n        const endTime = new Date(end).getTime()\r\n        \r\n        if (startTime >= endTime) {\r\n          console.warn('时间轴范围异常：开始时间晚于或等于结束时间', {\r\n            surgery_id: surgery.surgery_id,\r\n            start: start,\r\n            end: end,\r\n            startTime: startTime,\r\n            endTime: endTime\r\n          })\r\n          return { start: null, end: null }\r\n        }\r\n      }\r\n      \r\n      console.log('时间轴范围 (重新设计):', surgery.surgery_id, {\r\n        start: start,\r\n        end: end,\r\n        duration: start && end ? (new Date(end).getTime() - new Date(start).getTime()) / (1000 * 60) : 'N/A'\r\n      })\r\n      \r\n      return { start, end }\r\n    }\r\n\r\n    // 获取\"手术时间线\"事件范围：起点为第一个事件时间，终点为最后一个事件时间\r\n    const getEventTimelineRange = (surgery) => {\r\n      try {\r\n        const events = getSortedTimelineEvents(surgery)\r\n        if (!events || events.length === 0) {\r\n          // 回退到进度条时间轴范围（开机-关机）\r\n          return getProgressTimelineRange(surgery)\r\n        }\r\n        const start = events[0].time\r\n        const end = events[events.length - 1].time\r\n        return { start, end }\r\n      } catch (e) {\r\n        return getProgressTimelineRange(surgery)\r\n      }\r\n    }\r\n\r\n    // 获取进度条时间轴范围（使用开机时间和关机时间）\r\n    const getProgressTimelineRange = (surgery) => {\r\n      if (!surgery) return { start: null, end: null }\r\n      \r\n      // 获取开机时间\r\n      const powerOnTime = getPowerOnTime(surgery)\r\n      \r\n      // 获取关机时间，如果没有则使用手术结束时间\r\n      const powerOffTime = getPowerOffTime(surgery)\r\n      const endTime = powerOffTime || surgery.surgery_end_time\r\n      \r\n      // 确定时间轴起点：优先使用开机时间，如果没有则使用手术开始时间\r\n      let start = powerOnTime\r\n      if (!start && surgery.surgery_start_time) {\r\n        start = surgery.surgery_start_time\r\n      }\r\n      \r\n      // 确定时间轴终点：优先使用关机时间，如果没有则使用手术结束时间\r\n      let end = endTime\r\n      if (!end && surgery.surgery_end_time) {\r\n        end = surgery.surgery_end_time\r\n      }\r\n      \r\n      // 确保开始时间早于结束时间\r\n      if (start && end) {\r\n        const startTime = new Date(start).getTime()\r\n        const endTime = new Date(end).getTime()\r\n        \r\n        if (startTime >= endTime) {\r\n          console.warn('进度条时间轴范围异常：开始时间晚于或等于结束时间', {\r\n            surgery_id: surgery.surgery_id,\r\n            start: start,\r\n            end: end,\r\n            startTime: startTime,\r\n            endTime: endTime\r\n          })\r\n          return { start: null, end: null }\r\n        }\r\n      }\r\n      \r\n      console.log('进度条时间轴范围:', surgery.surgery_id, {\r\n        start: start,\r\n        end: end,\r\n        powerOnTime: powerOnTime,\r\n        powerOffTime: powerOffTime,\r\n        surgeryEndTime: surgery.surgery_end_time,\r\n        duration: start && end ? (new Date(end).getTime() - new Date(start).getTime()) / (1000 * 60) : 'N/A'\r\n      })\r\n      \r\n      return { start, end }\r\n    }\r\n\r\n    // 计算时间在时间轴上的位置百分比（改进版本，支持跨天）\r\n    const getTimePosition = (time, startTime, endTime) => {\r\n      if (!time || !startTime || !endTime) return 0\r\n      \r\n      try {\r\n        // 确保时间格式正确\r\n        const start = new Date(startTime).getTime()\r\n        const end = new Date(endTime).getTime()\r\n        const current = new Date(time).getTime()\r\n        \r\n        // 检查时间有效性\r\n        if (isNaN(start) || isNaN(end) || isNaN(current)) {\r\n          console.warn('时间计算异常：无效的时间值', { time, startTime, endTime })\r\n          return 0\r\n        }\r\n        \r\n        // 检查时间顺序\r\n        if (start >= end) {\r\n          console.warn('时间轴范围异常：开始时间晚于或等于结束时间', { startTime, endTime })\r\n          return 0\r\n        }\r\n        \r\n        // 计算位置百分比\r\n        const position = ((current - start) / (end - start)) * 100\r\n        \r\n        // 确保位置在有效范围内\r\n        return Math.max(0, Math.min(100, position))\r\n      } catch (error) {\r\n        console.error('时间位置计算失败:', error, { time, startTime, endTime })\r\n        return 0\r\n      }\r\n    }\r\n\r\n    // 获取时间轴刻度位置\r\n    const getTimelineTicks = (startTime, endTime) => {\r\n      if (!startTime || !endTime) return []\r\n      const start = new Date(startTime)\r\n      const end = new Date(endTime)\r\n      const duration = end.getTime() - start.getTime()\r\n      \r\n      // 根据手术时长决定刻度间隔\r\n      let interval\r\n      if (duration <= 30 * 60 * 1000) { // 30分钟以内，5分钟间隔\r\n        interval = 5 * 60 * 1000\r\n      } else if (duration <= 2 * 60 * 60 * 1000) { // 2小时以内，15分钟间隔\r\n        interval = 15 * 60 * 1000\r\n      } else { // 超过2小时，30分钟间隔\r\n        interval = 30 * 60 * 1000\r\n      }\r\n      \r\n      const ticks = []\r\n      let current = start.getTime() + interval // 从第一个间隔开始，避免与开始时间重叠\r\n      while (current < end.getTime()) { // 使用 < 而不是 <=，避免与结束时间重叠\r\n        const position = getTimePosition(current, startTime, endTime)\r\n        ticks.push({\r\n          time: new Date(current),\r\n          position: position\r\n        })\r\n        current += interval\r\n      }\r\n      \r\n      return ticks\r\n    }\r\n\r\n    // 合并重叠的时间段\r\n    const mergeOverlappingTimeRanges = (usages) => {\r\n      if (!usages || usages.length === 0) return []\r\n      \r\n      // 将使用记录转换为时间范围对象\r\n      const timeRanges = usages.map(usage => ({\r\n        startTime: new Date(usage.startTime).getTime(),\r\n        endTime: new Date(usage.endTime).getTime()\r\n      }))\r\n      \r\n      // 按开始时间排序\r\n      timeRanges.sort((a, b) => a.startTime - b.startTime)\r\n      \r\n      const merged = []\r\n      let current = timeRanges[0]\r\n      \r\n      for (let i = 1; i < timeRanges.length; i++) {\r\n        const next = timeRanges[i]\r\n        \r\n        // 如果当前时间段与下一个时间段重叠或相邻，则合并\r\n        if (current.endTime >= next.startTime) {\r\n          current.endTime = Math.max(current.endTime, next.endTime)\r\n        } else {\r\n          // 不重叠，添加当前时间段到结果中\r\n          merged.push(current)\r\n          current = next\r\n        }\r\n      }\r\n      \r\n      // 添加最后一个时间段\r\n      if (current) {\r\n        merged.push(current)\r\n      }\r\n      \r\n      return merged\r\n    }\r\n\r\n    // 获取工具臂时间线样式（时间对齐）\r\n    const getArmTimelineStyle = (armUsage, surgery) => {\r\n      if (!armUsage || armUsage.length === 0 || !surgery.surgery_start_time || !surgery.surgery_end_time) {\r\n        return { left: '0%', width: '0%' }\r\n      }\r\n      \r\n      // 找到所有完整的使用时间段（有开始和结束时间）\r\n      const completeUsages = armUsage.filter(usage => usage.startTime && usage.endTime)\r\n      \r\n      if (completeUsages.length === 0) return { left: '0%', width: '0%' }\r\n      \r\n      // 如果有多个器械使用时间段，需要合并重叠的时间段\r\n      const mergedTimeRanges = mergeOverlappingTimeRanges(completeUsages)\r\n      \r\n      if (mergedTimeRanges.length === 0) return { left: '0%', width: '0%' }\r\n      \r\n      // 计算所有合并后时间段的总长度\r\n      let totalWidth = 0\r\n      const segments = []\r\n      \r\n      // 使用\"手术时间线\"事件范围（第一个事件 ~ 最后一个事件）\r\n      const timelineRange = getEventTimelineRange(surgery)\r\n      if (!timelineRange.start || !timelineRange.end) return { left: '0%', width: '0%' }\r\n      \r\n      mergedTimeRanges.forEach(range => {\r\n        const startPosition = getTimePosition(range.startTime, timelineRange.start, timelineRange.end)\r\n        const endPosition = getTimePosition(range.endTime, timelineRange.start, timelineRange.end)\r\n        const width = Math.max(0, endPosition - startPosition)\r\n        \r\n        segments.push({\r\n          left: `${startPosition}%`,\r\n          width: `${width}%`\r\n        })\r\n        \r\n        totalWidth += width\r\n      })\r\n      \r\n      // 如果有多个时间段，返回第一个（主要时间段）\r\n      // 如果需要显示多个时间段，可以在这里扩展逻辑\r\n      return segments.length > 0 ? segments[0] : { left: '0%', width: '0%' }\r\n    }\r\n\r\n    // 获取工具臂时间线所有段（用于显示多个时间段）\r\n    const getArmTimelineSegments = (armUsage, surgery) => {\r\n      if (!armUsage || armUsage.length === 0 || !surgery.surgery_start_time || !surgery.surgery_end_time) {\r\n        return []\r\n      }\r\n      \r\n      // 找到所有完整的使用时间段（有开始和结束时间）\r\n      const completeUsages = armUsage.filter(usage => usage.startTime && usage.endTime)\r\n      \r\n      if (completeUsages.length === 0) return []\r\n      \r\n      // 合并重叠的时间段\r\n      const mergedTimeRanges = mergeOverlappingTimeRanges(completeUsages)\r\n      \r\n      if (mergedTimeRanges.length === 0) return []\r\n      \r\n      // 计算所有合并后时间段的样式\r\n      const segments = []\r\n      \r\n      // 使用\"手术时间线\"事件范围（第一个事件 ~ 最后一个事件）\r\n      const timelineRange = getEventTimelineRange(surgery)\r\n      if (!timelineRange.start || !timelineRange.end) return []\r\n      \r\n      mergedTimeRanges.forEach((range, index) => {\r\n        const startPosition = getTimePosition(range.startTime, timelineRange.start, timelineRange.end)\r\n        const endPosition = getTimePosition(range.endTime, timelineRange.start, timelineRange.end)\r\n        const width = Math.max(0, endPosition - startPosition)\r\n        \r\n        if (width > 0) {\r\n          segments.push({\r\n            left: `${startPosition}%`,\r\n            width: `${width}%`\r\n          })\r\n        }\r\n      })\r\n      \r\n      return segments\r\n    }\r\n\r\n    // 获取手术时间段在总时间轴上的样式\r\n    const getSurgeryTimelineStyle = (surgery) => {\r\n      if (!surgery || !surgery.surgery_start_time || !surgery.surgery_end_time) {\r\n        return { left: '0%', width: '0%' }\r\n      }\r\n      \r\n      // 使用\"手术时间线\"事件范围（第一个事件 ~ 最后一个事件）\r\n      const timelineRange = getEventTimelineRange(surgery)\r\n      if (!timelineRange.start || !timelineRange.end) {\r\n        return { left: '0%', width: '0%' }\r\n      }\r\n      \r\n      // 手术进度条：显示手术开始到手术结束的时间段，但基于开机时间到关机时间的时间轴\r\n      const startPosition = getTimePosition(surgery.surgery_start_time, timelineRange.start, timelineRange.end)\r\n      const endPosition = getTimePosition(surgery.surgery_end_time, timelineRange.start, timelineRange.end)\r\n      const width = Math.max(0, endPosition - startPosition)\r\n      \r\n      console.log('手术进度条计算:', surgery.surgery_id, {\r\n        surgeryStartTime: surgery.surgery_start_time,\r\n        surgeryEndTime: surgery.surgery_end_time,\r\n        timelineStart: timelineRange.start,\r\n        timelineEnd: timelineRange.end,\r\n        startPosition: startPosition.toFixed(2) + '%',\r\n        endPosition: endPosition.toFixed(2) + '%',\r\n        width: width.toFixed(2) + '%'\r\n      })\r\n      \r\n      return { \r\n        left: `${startPosition}%`, \r\n        width: `${width}%` \r\n      }\r\n    }\r\n\r\n    // 获取使用时间线样式（时间对齐）\r\n    const getUsageTimelineStyle = (usage, surgery) => {\r\n      if (!usage || !surgery.surgery_start_time || !surgery.surgery_end_time) {\r\n        return { left: '0%', width: '0%' }\r\n      }\r\n      \r\n      // 检查是否有完整的时间段信息\r\n      if (!usage.startTime || !usage.endTime) {\r\n        return { left: '0%', width: '0%' }\r\n      }\r\n      \r\n      // 使用\"手术时间线\"事件范围（第一个事件 ~ 最后一个事件），确保与时间线完全对齐\r\n      const timelineRange = getEventTimelineRange(surgery)\r\n      if (!timelineRange.start || !timelineRange.end) {\r\n        return { left: '0%', width: '0%' }\r\n      }\r\n      \r\n      const startTime = new Date(usage.startTime).getTime()\r\n      const endTime = new Date(usage.endTime).getTime()\r\n      \r\n      // 使用与arm-timeline-bar完全相同的时间计算逻辑\r\n      const startPosition = getTimePosition(startTime, timelineRange.start, timelineRange.end)\r\n      const endPosition = getTimePosition(endTime, timelineRange.start, timelineRange.end)\r\n      \r\n      // 确保进度条宽度不为负数，并且位置在有效范围内\r\n      const width = Math.max(0, endPosition - startPosition)\r\n      const left = Math.max(0, Math.min(100 - width, startPosition))\r\n      \r\n      return { \r\n        left: `${left}%`, \r\n        width: `${width}%` \r\n      }\r\n    }\r\n\r\n    // 获取能量时间\r\n    const getEnergyTime = (armUsage) => {\r\n      if (!armUsage || armUsage.length === 0) return '0分0秒'\r\n      \r\n      // 计算所有完整使用时间段的总时长（不再过滤术前安装的器械）\r\n      const totalSeconds = armUsage\r\n        .filter(usage => usage.startTime && usage.endTime)\r\n        .reduce((total, usage) => {\r\n          const duration = Math.floor((new Date(usage.endTime) - new Date(usage.startTime)) / 1000)\r\n          return total + duration\r\n        }, 0)\r\n      \r\n      const minutes = Math.floor(totalSeconds / 60)\r\n      const seconds = totalSeconds % 60\r\n      return `${minutes}分${seconds}秒`\r\n    }\r\n\r\n\r\n\r\n    // 获取开机时间：支持多个开机时间\r\n    const getPowerOnTime = (surgery) => {\r\n      if (!surgery) return null\r\n      \r\n      // 如果有开机时间数组，返回第一个（最早的开机时间）\r\n      if (surgery.power_on_times && surgery.power_on_times.length > 0) {\r\n        return surgery.power_on_times[0]\r\n      }\r\n      \r\n      // 兼容旧版本：如果有单个开机时间，直接使用\r\n      if (surgery.power_on_time) {\r\n        return surgery.power_on_time\r\n      }\r\n      \r\n      // 如果没有开机时间，使用手术开始时间\r\n      return surgery.surgery_start_time\r\n    }\r\n\r\n    // 获取关机时间：支持多个关机时间\r\n    const getPowerOffTime = (surgery) => {\r\n      if (!surgery) return null\r\n      \r\n      // 如果有关机时间数组，返回最后一个（最晚的关机时间）\r\n      if (surgery.shutdown_times && surgery.shutdown_times.length > 0) {\r\n        return surgery.shutdown_times[surgery.shutdown_times.length - 1]\r\n      }\r\n      \r\n      // 兼容旧版本：如果有单个关机时间，直接使用\r\n      if (surgery.power_off_time) {\r\n        return surgery.power_off_time\r\n      }\r\n      \r\n      // 如果没有关机时间，返回null（让调用方决定使用什么作为终点）\r\n      return null\r\n    }\r\n\r\n    // 获取所有开机时间\r\n    const getAllPowerOnTimes = (surgery) => {\r\n      if (!surgery) return []\r\n      \r\n      // 如果有开机时间数组，返回所有\r\n      if (surgery.power_on_times && surgery.power_on_times.length > 0) {\r\n        return surgery.power_on_times\r\n      }\r\n      \r\n      // 兼容旧版本：如果有单个开机时间，返回数组\r\n      if (surgery.power_on_time) {\r\n        return [surgery.power_on_time]\r\n      }\r\n      \r\n      return []\r\n    }\r\n\r\n    // 获取所有关机时间\r\n    const getAllPowerOffTimes = (surgery) => {\r\n      if (!surgery) return []\r\n      \r\n      // 如果有关机时间数组，返回所有\r\n      if (surgery.shutdown_times && surgery.shutdown_times.length > 0) {\r\n        return surgery.shutdown_times\r\n      }\r\n      \r\n      // 兼容旧版本：如果有单个关机时间，返回数组\r\n      if (surgery.power_off_time) {\r\n        return [surgery.power_off_time]\r\n      }\r\n      \r\n      return []\r\n    }\r\n\r\n    // 获取按时间排序的所有事件\r\n    const getSortedTimelineEvents = (surgery) => {\r\n      if (!surgery) return []\r\n      \r\n      const events = []\r\n      \r\n      // 添加开机事件 - 支持多个开机时间\r\n      const powerOnTimes = getAllPowerOnTimes(surgery)\r\n      \r\n      // 调试信息：检查连台手术数据\r\n      if (surgery.is_consecutive_surgery) {\r\n        console.log('连台手术调试信息:', {\r\n          surgery_id: surgery.surgery_id,\r\n          is_consecutive_surgery: surgery.is_consecutive_surgery,\r\n          previous_surgery_end_time: surgery.previous_surgery_end_time,\r\n          power_on_times: surgery.power_on_times,\r\n          powerOnTimes: powerOnTimes\r\n        })\r\n      }\r\n      \r\n      powerOnTimes.forEach((time, index) => {\r\n        // 检查是否为连台手术，如果是则显示\"上一场手术结束时间\"\r\n        let label = '开机'\r\n        let displayTime = time\r\n        \r\n        if (surgery.is_consecutive_surgery && index === 0 && surgery.previous_surgery_end_time) {\r\n          // 连台手术：使用上一场手术结束时间而不是开机时间\r\n          label = '上一场手术结束时间'\r\n          displayTime = surgery.previous_surgery_end_time\r\n        } else if (powerOnTimes.length > 1) {\r\n          label = `开机 ${index + 1}`\r\n        }\r\n        \r\n        events.push({\r\n          time: new Date(displayTime),\r\n          type: 'powerOn',\r\n          label: label,\r\n          color: 'green',\r\n          icon: 'PowerOff'\r\n        })\r\n      })\r\n      \r\n      // 添加手术开始事件\r\n      if (surgery.surgery_start_time) {\r\n        events.push({\r\n          time: new Date(surgery.surgery_start_time),\r\n          type: 'surgeryStart',\r\n          label: '手术开始',\r\n          color: 'blue',\r\n          icon: 'VideoPlay'\r\n        })\r\n      }\r\n      \r\n      // 添加手术结束事件\r\n      if (surgery.surgery_end_time) {\r\n        events.push({\r\n          time: new Date(surgery.surgery_end_time),\r\n          type: 'surgeryEnd',\r\n          label: '手术结束',\r\n          color: 'orange',\r\n          icon: 'VideoPause'\r\n        })\r\n      }\r\n      \r\n      // 添加关机事件 - 支持多个关机时间\r\n      const powerOffTimes = getAllPowerOffTimes(surgery)\r\n      powerOffTimes.forEach((time, index) => {\r\n        events.push({\r\n          time: new Date(time),\r\n          type: 'powerOff',\r\n          label: powerOffTimes.length > 1 ? `关机 ${index + 1}` : '关机',\r\n          color: 'red',\r\n          icon: 'PowerOff'\r\n        })\r\n      })\r\n      \r\n      // 按时间排序\r\n      return events.sort((a, b) => a.time.getTime() - b.time.getTime())\r\n    }\r\n\r\n    // 获取手术状态变化数据\r\n    const getStateChanges = (surgery) => {\r\n      if (!surgery) return []\r\n      \r\n      // 优先使用后端提供的状态机变化数据\r\n      let stateMachineChanges = []\r\n      \r\n      if (surgery.state_machine_changes) {\r\n        if (typeof surgery.state_machine_changes === 'string') {\r\n          try {\r\n            stateMachineChanges = JSON.parse(surgery.state_machine_changes)\r\n          } catch (error) {\r\n            console.error('解析state_machine_changes字符串失败:', error)\r\n            stateMachineChanges = []\r\n          }\r\n        } else {\r\n          stateMachineChanges = surgery.state_machine_changes || []\r\n        }\r\n      }\r\n      \r\n      // 调试信息\r\n      console.log('手术状态机变化数据:', surgery.surgery_id, stateMachineChanges)\r\n      \r\n      // 如果没有状态机变化数据，返回空数组\r\n      if (stateMachineChanges.length === 0) {\r\n        console.log('没有状态机变化数据')\r\n        return []\r\n      }\r\n      \r\n      // 将状态机变化数据转换为柱状图数据\r\n      const stateChanges = []\r\n      \r\n      for (let i = 0; i < stateMachineChanges.length; i++) {\r\n        const currentChange = stateMachineChanges[i]\r\n        const nextChange = stateMachineChanges[i + 1]\r\n        \r\n        const currentState = parseInt(currentChange.state)\r\n        const startTime = new Date(currentChange.time)\r\n        const endTime = nextChange ? new Date(nextChange.time) : (surgery.surgery_end_time ? new Date(surgery.surgery_end_time) : new Date())\r\n        const duration = endTime.getTime() - startTime.getTime()\r\n        \r\n        // 调试信息\r\n        console.log(`状态变化 ${i}: currentState=${currentState}, startTime=${startTime}, endTime=${endTime}, duration=${duration}ms`)\r\n        \r\n        // 根据currentState分类 - 新的阶段定义\r\n        let stateCategory = 'none'\r\n        \r\n        // 关机到开机阶段 (currentState <= 0) 不显示柱状图\r\n        if (currentState <= 0) {\r\n          stateCategory = 'none'\r\n        } \r\n        // currentState < 30 都用浅绿色柱状体表示\r\n        else if (currentState > 0 && currentState < 30) {\r\n          stateCategory = 'surgery' // 浅绿色 - 正常阶段\r\n        } \r\n        // currentState = 30 且未变化至 currentState >= 10 时都用红色柱状体表示\r\n        else if (currentState === 30) {\r\n          // 检查下一个状态是否 >= 10，如果不是则标记为错误\r\n          const nextState = nextChange ? parseInt(nextChange.state) : null\r\n          if (nextState === null || nextState < 10) {\r\n            stateCategory = 'error' // 红色 - 故障阶段\r\n          } else {\r\n            stateCategory = 'surgery' // 浅绿色 - 正常阶段\r\n          }\r\n        }\r\n        // currentState > 30 的其他状态不显示柱状图\r\n        else {\r\n          stateCategory = 'none'\r\n        }\r\n        \r\n        console.log(`状态分类: currentState=${currentState}, nextState=${nextChange ? nextChange.state : 'null'} -> stateCategory=${stateCategory}`)\r\n        \r\n        if (stateCategory !== 'none') {\r\n          stateChanges.push({\r\n            state: stateCategory,\r\n            startTime: startTime,\r\n            endTime: endTime,\r\n            duration: duration,\r\n            originalState: currentState,\r\n            stateName: currentChange.stateName || `状态${currentState}`\r\n          })\r\n        }\r\n      }\r\n      \r\n      console.log('生成的柱状图数据:', stateChanges)\r\n      return stateChanges\r\n    }\r\n\r\n    // 获取状态名称\r\n    const getStateName = (state) => {\r\n      const stateMap = {\r\n        'surgery': '正常阶段',\r\n        'error': '故障阶段',\r\n        'idle': '空闲',\r\n        'active': '激活',\r\n        'standby': '待机',\r\n        'offline': '离线'\r\n      }\r\n      return stateMap[state] || state\r\n    }\r\n\r\n    // 计算状态柱状图高度\r\n    const getStateBarHeight = (state) => {\r\n      // 根据状态类型设置不同高度\r\n      const heightMap = {\r\n        'surgery': 60,     // 正常阶段 60% 高度 (浅绿色)\r\n        'error': 100       // 故障阶段 100% 高度 (红色)\r\n      }\r\n      const height = heightMap[state] || 60;\r\n      console.log(`柱状图高度: state=${state}, height=${height}px`);\r\n      return height;\r\n    }\r\n\r\n    // 计算状态柱状图位置\r\n    const getStateBarPosition = (startTime, surgery) => {\r\n      if (!startTime || !surgery) return 0\r\n      \r\n      const timelineRange = getProgressTimelineRange(surgery)\r\n      if (!timelineRange.start || !timelineRange.end) return 0\r\n      \r\n      const position = getTimePosition(startTime, timelineRange.start, timelineRange.end)\r\n      console.log(`柱状图位置计算: startTime=${startTime}, timelineStart=${timelineRange.start}, timelineEnd=${timelineRange.end}, position=${position}%`)\r\n      \r\n      // 确保位置在有效范围内\r\n      const clampedPosition = Math.max(0, Math.min(95, position)) // 留出5%的边距\r\n      return clampedPosition\r\n    }\r\n\r\n\r\n\r\n    // 按UID码分组器械使用\r\n    const getGroupedUsagesByUdi = (armUsage) => {\r\n      const grouped = {}\r\n      armUsage.forEach((usage, index) => {\r\n        // 不过滤术前安装的器械，详情中需要完整显示\r\n        \r\n        // 使用UDI码作为分组键，如果没有UDI则使用器械名称和索引\r\n        const udi = usage.udi || `${usage.instrumentName}_${index}`\r\n        if (!grouped[udi]) {\r\n          grouped[udi] = {\r\n            instrumentName: usage.instrumentName,\r\n            usages: []\r\n          }\r\n        }\r\n        grouped[udi].usages.push(usage)\r\n      })\r\n      return grouped\r\n    }\r\n\r\n\r\n\r\n    // 获取分组器械的总使用时长\r\n    const getGroupedUsageDuration = (groupedUsage) => {\r\n      if (!groupedUsage || groupedUsage.usages.length === 0) return '0分钟'\r\n      \r\n      const totalDuration = groupedUsage.usages\r\n        .filter(usage => usage.startTime && usage.endTime)\r\n        .reduce((total, usage) => {\r\n          const duration = Math.floor((new Date(usage.endTime) - new Date(usage.startTime)) / 1000 / 60)\r\n          return total + duration\r\n        }, 0)\r\n      \r\n      return `${totalDuration}分钟`\r\n    }\r\n\r\n         // 根据进度条宽度获取合适的显示文本\r\n     const getSegmentText = (usage, surgery) => {\r\n       try {\r\n         // 计算进度条宽度百分比\r\n         const style = getUsageTimelineStyle(usage, surgery);\r\n         const width = style.width;\r\n         const widthPercent = parseFloat(width);\r\n         \r\n         // 获取器械名称\r\n         const instrumentName = usage.instrumentName || '器械';\r\n         \r\n         // 计算所需的最小宽度（每个字符约1.5%宽度，加上一些边距）\r\n         const minWidthPerChar = 1.5;\r\n         const padding = 2; // 左右边距\r\n         const requiredWidth = Math.min(instrumentName.length * minWidthPerChar + padding, 20); // 最大20%\r\n         \r\n         // 只有当宽度足够显示器械名称时才显示文本\r\n         if (widthPercent >= requiredWidth) {\r\n           // 如果宽度足够显示完整名称，直接显示\r\n           if (widthPercent >= instrumentName.length * minWidthPerChar + padding) {\r\n             return instrumentName;\r\n           } else {\r\n             // 否则截断显示\r\n             const maxChars = Math.floor((widthPercent - padding) / minWidthPerChar);\r\n             return instrumentName.substring(0, maxChars) + '...';\r\n           }\r\n         } else {\r\n           // 宽度不足，不显示任何文本\r\n           return '';\r\n         }\r\n       } catch (error) {\r\n         console.error('计算进度条文本失败:', error);\r\n         return '';\r\n       }\r\n     };\r\n\r\n    // 获取时间段对应的器械名称\r\n    const getSegmentInstrumentName = (segment, armUsage, surgery) => {\r\n      if (!segment || !armUsage || !surgery) return '未知器械'\r\n      \r\n      // 获取进度条时间轴范围\r\n      const timelineRange = getProgressTimelineRange(surgery)\r\n      if (!timelineRange.start || !timelineRange.end) return '未知器械'\r\n      \r\n      // 计算时间段的开始和结束时间\r\n      const startPercent = parseFloat(segment.left)\r\n      const endPercent = startPercent + parseFloat(segment.width)\r\n      \r\n      const startTime = new Date(timelineRange.start).getTime() + (startPercent / 100) * (new Date(timelineRange.end).getTime() - new Date(timelineRange.start).getTime())\r\n      const endTime = new Date(timelineRange.start).getTime() + (endPercent / 100) * (new Date(timelineRange.end).getTime() - new Date(timelineRange.start).getTime())\r\n      \r\n      // 查找在这个时间段内使用的器械\r\n      const instrumentsInSegment = armUsage.filter(usage => {\r\n        if (!usage.startTime || !usage.endTime) return false\r\n        \r\n        const usageStart = new Date(usage.startTime).getTime()\r\n        const usageEnd = new Date(usage.endTime).getTime()\r\n        \r\n        // 检查是否有重叠\r\n        return usageStart < endTime && usageEnd > startTime\r\n      })\r\n      \r\n      if (instrumentsInSegment.length === 0) return '无器械使用'\r\n      \r\n      // 返回第一个找到的器械名称\r\n      return instrumentsInSegment[0].instrumentName || '未知器械'\r\n    }\r\n\r\n    \r\n\r\n\r\n    // 标签页点击处理 - 使用防抖和安全的 nextTick\r\n    const handleTabClick = debounce((tab) => {\r\n      safeNextTick(() => {\r\n        activeTab.value = tab.name\r\n      })\r\n    }, 50)\r\n\r\n    // 标签页切换前的处理 - 使用安全的 nextTick\r\n    const handleBeforeTabLeave = (newTabName, oldTabName) => {\r\n      return safeNextTick().then(() => true)\r\n    }\r\n\r\n    // 状态机图表相关方法\r\n    const resetChartView = () => {\r\n      // 清理所有图表实例\r\n      stateMachineCharts.forEach((chart, surgeryId) => {\r\n        console.log('销毁图表实例:', surgeryId)\r\n        try {\r\n          chart.dispose && chart.dispose()\r\n        } catch (e) {\r\n          console.warn('图表实例释放失败', surgeryId, e)\r\n        }\r\n      })\r\n      stateMachineCharts.clear()\r\n      // 清理响应式对象的所有属性\r\n      Object.keys(surgeryChartStates).forEach(key => {\r\n        delete surgeryChartStates[key]\r\n      })\r\n      surgeryScrollbarStates.clear()\r\n      chartCurrentTime.value = null\r\n    }\r\n\r\n    // 获取状态机图表数据（全时段，ECharts）\r\n    const getStateMachineChartData = (surgery) => {\r\n      if (!surgery) return null\r\n      let changes = []\r\n      if (surgery.state_machine_changes) {\r\n        if (typeof surgery.state_machine_changes === 'string') {\r\n          try {\r\n            changes = JSON.parse(surgery.state_machine_changes)\r\n          } catch (e) {\r\n            console.error('解析state_machine_changes失败', e)\r\n            return null\r\n          }\r\n        } else {\r\n          changes = surgery.state_machine_changes || []\r\n        }\r\n      }\r\n\r\n      // 时间范围：使用时间线事件的最早与最晚时间；若无事件，回退到状态机数据\r\n      const events = getSortedTimelineEvents(surgery)\r\n      let xMin = null\r\n      let xMax = null\r\n      if (events.length > 0) {\r\n        xMin = new Date(events[0].time).getTime()\r\n        xMax = new Date(events[events.length - 1].time).getTime()\r\n      }\r\n\r\n      if (changes.length === 0) {\r\n        if (!xMin || !xMax) return null\r\n        return { points: [], rawData: [], xMin, xMax }\r\n      }\r\n\r\n      // 排序并构建阶梯数据点\r\n      changes.sort((a, b) => new Date(a.time).getTime() - new Date(b.time).getTime())\r\n      if (!xMin || !xMax) {\r\n        xMin = new Date(changes[0].time).getTime()\r\n        xMax = new Date(changes[changes.length - 1].time).getTime()\r\n      }\r\n\r\n      const positionMap = getStateToYPositionMap()\r\n\r\n      // 仅使用与时间线相同范围内的状态机数据，并在边界补点\r\n      const changesWithin = []\r\n      let lastBefore = null\r\n      for (const ch of changes) {\r\n        const t = new Date(ch.time).getTime()\r\n        if (t <= xMin) {\r\n          lastBefore = ch\r\n        }\r\n        if (t > xMin && t <= xMax) {\r\n          changesWithin.push(ch)\r\n        }\r\n      }\r\n\r\n      const points = []\r\n      // 起点：xMin 使用边界前最后状态（若无，则用第一个变化的状态）\r\n      let startState = lastBefore ? lastBefore.state : (changes.length > 0 ? changes[0].state : '0')\r\n      points.push([xMin, positionMap[parseInt(startState)] ?? parseInt(startState), startState])\r\n\r\n      // 区间内变化\r\n      for (const ch of changesWithin) {\r\n        const t = new Date(ch.time).getTime()\r\n        const y = positionMap[parseInt(ch.state)] ?? parseInt(ch.state)\r\n        points.push([t, y, ch.state])\r\n      }\r\n\r\n      // 终点：xMax 使用区间内最后状态（或起点状态）\r\n      const lastState = changesWithin.length > 0 ? changesWithin[changesWithin.length - 1].state : startState\r\n      points.push([xMax, positionMap[parseInt(lastState)] ?? parseInt(lastState), lastState])\r\n\r\n      return { points, rawData: changesWithin, xMin, xMax }\r\n    }\r\n\r\n    // 获取状态机图表配置\r\n    const getStateMachineChartOptions = (surgery) => {\r\n      const surgeryStartTime = surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : null\r\n      if (!surgeryStartTime) return {}\r\n      \r\n      // 获取当前手术的图表状态\r\n      let surgeryState = surgeryChartStates[surgery.id]\r\n      if (!surgeryState) {\r\n        surgeryState = {\r\n          currentTime: surgeryStartTime,\r\n          viewRange: chartViewRange.value\r\n        }\r\n        surgeryChartStates[surgery.id] = surgeryState\r\n      }\r\n      \r\n      const startTime = new Date(surgeryState.currentTime.getTime() - (surgeryState.viewRange * 30 * 1000))\r\n      const endTime = new Date(surgeryState.currentTime.getTime() + (surgeryState.viewRange * 30 * 1000))\r\n      \r\n      return {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        interaction: {\r\n          mode: 'index',\r\n          intersect: false,\r\n        },\r\n        plugins: {\r\n          legend: {\r\n            display: false\r\n          },\r\n          tooltip: {\r\n            callbacks: {\r\n              title: function(context) {\r\n                const dataIndex = context[0].dataIndex\r\n                const rawData = context[0].chart.data.rawData\r\n                if (rawData && rawData[dataIndex]) {\r\n                  const time = new Date(rawData[dataIndex].time)\r\n                  // 检查是否跨天，如果是则显示日期\r\n                  const isCrossDay = startTime.getDate() !== endTime.getDate() || \r\n                                   startTime.getMonth() !== endTime.getMonth() || \r\n                                   startTime.getFullYear() !== endTime.getFullYear()\r\n                  \r\n                  if (isCrossDay) {\r\n                    return time.toLocaleDateString('zh-CN') + ' ' + time.toLocaleTimeString('zh-CN')\r\n                  } else {\r\n                    return time.toLocaleTimeString('zh-CN')\r\n                  }\r\n                }\r\n                return context[0].label\r\n              },\r\n              label: function(context) {\r\n                const dataIndex = context.dataIndex\r\n                const rawData = context.chart.data.rawData\r\n                if (rawData && rawData[dataIndex]) {\r\n                  const originalState = parseInt(rawData[dataIndex].state)\r\n                  const stateName = getStateMachineStateName(originalState.toString())\r\n                  return `状态: ${originalState} (${stateName})`\r\n                }\r\n                return `状态: ${context.parsed.y}`\r\n              }\r\n            }\r\n          }\r\n        },\r\n        scales: {\r\n                     x: {\r\n             title: {\r\n               display: true,\r\n               text: '时间'\r\n             },\r\n             ticks: {\r\n               maxTicksLimit: 10,\r\n               callback: function(value, index, ticks) {\r\n                 const rawData = this.chart.data.rawData\r\n                 if (rawData && rawData[index]) {\r\n                   const time = new Date(rawData[index].time)\r\n                   // 检查是否跨天\r\n                   const isCrossDay = startTime.getDate() !== endTime.getDate() || \r\n                                    startTime.getMonth() !== endTime.getMonth() || \r\n                                    startTime.getFullYear() !== endTime.getFullYear()\r\n                   \r\n                   if (isCrossDay) {\r\n                     return time.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }) + ' ' + \r\n                            time.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })\r\n                   } else {\r\n                     return time.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })\r\n                   }\r\n                 }\r\n                 return value\r\n               }\r\n             },\r\n             // 移除afterBuildTicks函数，使用更简单的回调方式\r\n             // afterBuildTicks在Chart.js 4.x中可能有问题，改用callback方式\r\n           },\r\n          y: {\r\n            beginAtZero: true,\r\n            min: 0,\r\n            max: 30, // 调整为映射后的最大值\r\n            title: {\r\n              display: true,\r\n              text: '状态机状态'\r\n            },\r\n            // 简化Y轴配置，避免afterBuildTicks问题\r\n            ticks: {\r\n              stepSize: 1,\r\n              maxTicksLimit: 15\r\n            }\r\n          }\r\n        },\r\n        animation: {\r\n          duration: 300\r\n        }\r\n      }\r\n    }\r\n\r\n    // 更新状态机图表 - 确保所有组件同步\r\n    const updateStateMachineChart = (surgery) => {\r\n      if (!surgery) return\r\n      const container = document.getElementById(`stateMachineChart_${surgery.id}`)\r\n      if (!container) {\r\n        setTimeout(() => updateStateMachineChart(surgery), 50)\r\n        return\r\n      }\r\n\r\n      const data = getStateMachineChartData(surgery)\r\n      // 清理旧实例\r\n      const existing = stateMachineCharts.get(surgery.id)\r\n      if (existing) {\r\n        try { existing.dispose && existing.dispose() } catch (_) {}\r\n        stateMachineCharts.delete(surgery.id)\r\n      }\r\n\r\n      if (!data) {\r\n        container.innerHTML = '<div style=\"display:flex;align-items:center;justify-content:center;height:100%;color:#909399;\">暂无状态机数据</div>'\r\n        return\r\n      }\r\n\r\n      const chart = echarts.init(container)\r\n      stateMachineCharts.set(surgery.id, chart)\r\n\r\n      const positionMap = getStateToYPositionMap()\r\n      const reverseMap = {}\r\n      Object.keys(positionMap).forEach(k => { reverseMap[positionMap[k]] = k })\r\n\r\n      const fiveMinutesMs = 5 * 60 * 1000\r\n      const initialEnd = Math.min(data.xMin + fiveMinutesMs, data.xMax)\r\n\r\n      chart.setOption({\r\n        grid: { left: 60, right: 20, top: 70, bottom: 80, containLabel: true },\r\n        toolbox: {\r\n          right: 10,\r\n          top: 10,\r\n          feature: {\r\n            dataZoom: { yAxisIndex: 'none' },\r\n            restore: {},\r\n            saveAsImage: {}\r\n          }\r\n        },\r\n        tooltip: {\r\n          trigger: 'axis',\r\n          axisPointer: { type: 'line' },\r\n          formatter: (params) => {\r\n            if (!params || !params[0]) return ''\r\n            const p = params[0]\r\n            const t = new Date(p.value[0])\r\n            const yMapped = p.value[1]\r\n            const originalState = p.value[2] ?? reverseMap[yMapped] ?? yMapped\r\n            const stateName = getStateMachineStateName(String(originalState))\r\n            return `${t.toLocaleString('zh-CN')}<br/>状态: ${originalState}（${stateName}）`\r\n          }\r\n        },\r\n        dataZoom: [\r\n          {\r\n            type: 'inside',\r\n            xAxisIndex: 0,\r\n            filterMode: 'none',\r\n            zoomOnMouseWheel: true,\r\n            moveOnMouseWheel: true,\r\n            moveOnMouseMove: true,\r\n            startValue: data.xMin,\r\n            endValue: initialEnd\r\n          },\r\n          {\r\n            type: 'slider',\r\n            xAxisIndex: 0,\r\n            filterMode: 'none',\r\n            height: 40,\r\n            bottom: 20,\r\n            showDataShadow: true,\r\n            brushSelect: true,\r\n            startValue: data.xMin,\r\n            endValue: initialEnd\r\n          }\r\n        ],\r\n        xAxis: {\r\n          type: 'time',\r\n          min: data.xMin,\r\n          max: data.xMax,\r\n          axisLabel: { formatter: (value) => new Date(value).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' }) }\r\n        },\r\n        yAxis: {\r\n          type: 'value',\r\n          min: 0,\r\n          max: 65,\r\n          axisLabel: {\r\n            formatter: (val) => {\r\n              const original = reverseMap[val]\r\n              return original ? String(original) : ''\r\n            }\r\n          },\r\n          axisTick: { show: false },\r\n          splitNumber: 8\r\n        },\r\n        series: [{\r\n          type: 'line',\r\n          step: 'end',\r\n          showSymbol: false,\r\n          lineStyle: { width: 2, color: '#409EFF' },\r\n          areaStyle: {\r\n            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\r\n              { offset: 0, color: 'rgba(64,158,255,0.25)' },\r\n              { offset: 1, color: 'rgba(64,158,255,0.05)' }\r\n            ])\r\n          },\r\n          data: data.points\r\n        }]\r\n      })\r\n    }\r\n\r\n    // 获取状态机状态名称\r\n    const getStateMachineStateName = (state) => {\r\n      const stateMap = {\r\n        \"0\": \"初始化（S00）\",\r\n        \"1\": \"使能（S01）\",\r\n        \"2\": \"自检（S02）\",\r\n        \"10\": \"待机（S10）\",\r\n        \"12\": \"从手调整（S12）\",\r\n        \"13\": \"主手跟随（S13）\",\r\n        \"14\": \"断开主从/离合（S14）\",\r\n        \"15\": \"初始化（S00）\",\r\n        \"20\": \"主从控制（S20）\",\r\n        \"21\": \"内窥镜控制（S21）\",\r\n        \"30\": \"错误（S30）\",\r\n        \"31\": \"关机（S31）\"\r\n      }\r\n      return stateMap[state] || `状态${state}`\r\n    }\r\n\r\n    // 网络图表相关功能\r\n    const networkCharts = new Map() // 为每个手术存储网络图表实例\r\n\r\n    // 更新网络延时图表\r\n    const updateNetworkChart = (surgery) => {\r\n      if (!surgery || !surgery.is_remote_surgery || !surgery.network_stats) return\r\n      \r\n      const container = document.getElementById(`networkChart_${surgery.id}`)\r\n      if (!container) {\r\n        setTimeout(() => updateNetworkChart(surgery), 50)\r\n        return\r\n      }\r\n\r\n      // 清理旧实例\r\n      const existing = networkCharts.get(surgery.id)\r\n      if (existing) {\r\n        try { existing.dispose && existing.dispose() } catch (_) {}\r\n        networkCharts.delete(surgery.id)\r\n      }\r\n\r\n      const chart = echarts.init(container)\r\n      networkCharts.set(surgery.id, chart)\r\n\r\n      // 获取手术开始和结束时间\r\n      const surgeryStartTime = new Date(surgery.surgery_start_time).getTime()\r\n      const surgeryEndTime = new Date(surgery.surgery_end_time).getTime()\r\n\r\n      // 准备数据 - 只包含手术时间段内的数据\r\n      const data = surgery.network_stats.data\r\n        .filter(item => {\r\n          const timestamp = new Date(item.timestamp).getTime()\r\n          return timestamp >= surgeryStartTime && timestamp <= surgeryEndTime\r\n        })\r\n        .map(item => [\r\n          new Date(item.timestamp).getTime(),\r\n          item.latency\r\n        ])\r\n\r\n      // 按时间排序\r\n      data.sort((a, b) => a[0] - b[0])\r\n\r\n      chart.setOption({\r\n        grid: { left: 60, right: 20, top: 70, bottom: 80, containLabel: true },\r\n        toolbox: {\r\n          right: 10,\r\n          top: 10,\r\n          feature: {\r\n            dataZoom: { yAxisIndex: 'none' },\r\n            restore: {},\r\n            saveAsImage: {}\r\n          }\r\n        },\r\n        tooltip: {\r\n          trigger: 'axis',\r\n          axisPointer: { type: 'line' },\r\n          formatter: (params) => {\r\n            if (!params || !params[0]) return ''\r\n            const p = params[0]\r\n            const time = new Date(p.value[0])\r\n            const latency = p.value[1]\r\n            return `${time.toLocaleString('zh-CN')}<br/>网络延时: ${latency}ms`\r\n          }\r\n        },\r\n        dataZoom: [\r\n          {\r\n            type: 'inside',\r\n            xAxisIndex: 0,\r\n            filterMode: 'none',\r\n            zoomOnMouseWheel: true,\r\n            moveOnMouseWheel: true,\r\n            moveOnMouseMove: true\r\n          },\r\n          {\r\n            type: 'slider',\r\n            xAxisIndex: 0,\r\n            filterMode: 'none',\r\n            height: 40,\r\n            bottom: 20,\r\n            showDataShadow: true,\r\n            brushSelect: true\r\n          }\r\n        ],\r\n        xAxis: {\r\n          type: 'time',\r\n          min: surgeryStartTime,\r\n          max: surgeryEndTime,\r\n          axisLabel: { \r\n            formatter: (value) => new Date(value).toLocaleTimeString('zh-CN', { \r\n              hour: '2-digit', \r\n              minute: '2-digit', \r\n              second: '2-digit' \r\n            }) \r\n          }\r\n        },\r\n        yAxis: {\r\n          type: 'value',\r\n          name: '延时 (ms)',\r\n          axisLabel: { formatter: '{value}ms' },\r\n          scale: true\r\n        },\r\n        series: [{\r\n          type: 'line',\r\n          name: '网络延时',\r\n          showSymbol: false,\r\n          lineStyle: { width: 2, color: '#409EFF' },\r\n          itemStyle: { color: '#409EFF' },\r\n          areaStyle: {\r\n            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\r\n              { offset: 0, color: 'rgba(64,158,255,0.25)' },\r\n              { offset: 1, color: 'rgba(64,158,255,0.05)' }\r\n            ])\r\n          },\r\n          data: data\r\n        }]\r\n      })\r\n    }\r\n\r\n    // 图表滚动功能已移除，现在只使用滚动条控制\r\n    \r\n    // 使用智能间隔模式\r\n\r\n    // 滚动条相关功能\r\n    const surgeryScrollbarStates = new Map() // 为每个手术存储滚动条状态\r\n    const surgeryChartStates = reactive({}) // 为每个手术存储图表状态（响应式）\r\n    const scrollbarUpdateTrigger = ref(0) // 用于触发滚动条重新渲染\r\n\r\n    // 获取滚动条滑块样式 - 重新设计：滚动条范围从手术开始到手术结束\r\n    const getScrollbarThumbStyle = (surgery, updateTrigger) => {\r\n      if (!surgery || !surgery.state_machine_changes) return {}\r\n      \r\n      // 重新设计：滚动条的总范围就是手术开始到手术结束\r\n      const totalStartTime = new Date(surgery.surgery_start_time)\r\n      const totalEndTime = new Date(surgery.surgery_end_time)\r\n      const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n      \r\n      if (totalDuration <= 0) return {}\r\n      \r\n      // 获取图表数据 - 使用与图表完全相同的时间计算逻辑\r\n      const chartData = getStateMachineChartData(surgery)\r\n      let viewStartTime, viewEndTime\r\n      \r\n      if (chartData && chartData.startTime && chartData.endTime) {\r\n        // 使用图表实际的时间范围，确保完全同步\r\n        viewStartTime = new Date(chartData.startTime)\r\n        viewEndTime = new Date(chartData.endTime)\r\n      } else {\r\n        // 如果没有图表数据，使用与图表相同的计算逻辑\r\n        let surgeryState = surgeryChartStates[surgery.id]\r\n        if (!surgeryState) {\r\n          surgeryState = {\r\n            currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n            viewRange: chartViewRange.value\r\n          }\r\n          surgeryChartStates[surgery.id] = surgeryState\r\n        }\r\n        \r\n        // 使用与图表完全相同的视图窗口计算\r\n        const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n        let viewCenterTime = surgeryState.currentTime\r\n        \r\n        // 重新设计：确保视图中心时间在手术时间范围内\r\n          const minCenterTime = new Date(totalStartTime.getTime() + viewWindowDuration / 2)\r\n          const maxCenterTime = new Date(totalEndTime.getTime() - viewWindowDuration / 2)\r\n          \r\n        // 如果总时间范围小于视图窗口，允许在整个范围内移动\r\n        if (totalDuration <= viewWindowDuration) {\r\n          // 总时间范围太小，允许在整个范围内移动，但确保不超出边界\r\n          const clampedTime = new Date(Math.max(totalStartTime.getTime(), Math.min(totalEndTime.getTime(), viewCenterTime.getTime())))\r\n          viewCenterTime = clampedTime\r\n        } else {\r\n          // 正常的时间范围限制\r\n          if (viewCenterTime.getTime() < minCenterTime.getTime()) {\r\n            viewCenterTime = minCenterTime\r\n          } else if (viewCenterTime.getTime() > maxCenterTime.getTime()) {\r\n            viewCenterTime = maxCenterTime\r\n          }\r\n        }\r\n        \r\n        // 计算视图的开始和结束时间\r\n        viewStartTime = new Date(viewCenterTime.getTime() - viewWindowDuration / 2)\r\n        viewEndTime = new Date(viewCenterTime.getTime() + viewWindowDuration / 2)\r\n        \r\n        // 确保视图范围不超出手术总时间范围\r\n        if (viewStartTime.getTime() < totalStartTime.getTime()) {\r\n          viewStartTime = totalStartTime\r\n          viewEndTime = new Date(totalStartTime.getTime() + viewWindowDuration)\r\n        }\r\n        \r\n        if (viewEndTime.getTime() > totalEndTime.getTime()) {\r\n          viewEndTime = totalEndTime\r\n          viewStartTime = new Date(totalEndTime.getTime() - viewWindowDuration)\r\n          \r\n          // 确保调整后的开始时间不早于手术开始时间\r\n          if (viewStartTime.getTime() < totalStartTime.getTime()) {\r\n            viewStartTime = totalStartTime\r\n            viewEndTime = new Date(totalStartTime.getTime() + viewWindowDuration)\r\n          }\r\n        }\r\n      }\r\n      \r\n      const viewDuration = viewEndTime.getTime() - viewStartTime.getTime()\r\n      \r\n      // 计算滑块位置和宽度 - 基于手术开始到手术结束的总范围\r\n      const thumbPosition = ((viewStartTime.getTime() - totalStartTime.getTime()) / totalDuration) * 100\r\n      const thumbWidth = (viewDuration / totalDuration) * 100\r\n      \r\n      // 确保滑块位置和宽度在有效范围内\r\n      const clampedPosition = Math.max(0, Math.min(100 - thumbWidth, thumbPosition))\r\n      const clampedWidth = Math.max(5, Math.min(100, thumbWidth))\r\n      \r\n      console.log('滚动条计算 (重新设计):', {\r\n        surgeryId: surgery.surgery_id,\r\n        totalStartTime: totalStartTime.toISOString(),\r\n        totalEndTime: totalEndTime.toISOString(),\r\n        totalDuration: totalDuration / (1000 * 60),\r\n        viewStartTime: viewStartTime.toISOString(),\r\n        viewEndTime: viewEndTime.toISOString(),\r\n        viewDuration: viewDuration / (1000 * 60),\r\n        thumbPosition: thumbPosition.toFixed(2),\r\n        thumbWidth: thumbWidth.toFixed(2),\r\n        clampedPosition: clampedPosition.toFixed(2),\r\n        clampedWidth: clampedWidth.toFixed(2),\r\n        isAtEnd: viewEndTime.getTime() === totalEndTime.getTime(),\r\n        isAtStart: viewStartTime.getTime() === totalStartTime.getTime()\r\n      })\r\n      \r\n      return {\r\n        left: `${clampedPosition}%`,\r\n        width: `${clampedWidth}%`\r\n      }\r\n    }\r\n\r\n         // 处理滚动条轨道点击 - 重新设计：基于手术开始到手术结束的范围\r\n     const handleTrackClick = (event, surgery) => {\r\n       if (!surgery) return\r\n       \r\n       const track = event.currentTarget\r\n       const rect = track.getBoundingClientRect()\r\n       const clickX = event.clientX - rect.left\r\n       const trackWidth = rect.width\r\n       \r\n       // 计算点击位置占总宽度的百分比\r\n       const clickPercentage = clickX / trackWidth\r\n       \r\n       // 重新设计：计算总时间范围从手术开始到手术结束\r\n       const totalStartTime = new Date(surgery.surgery_start_time)\r\n       const totalEndTime = new Date(surgery.surgery_end_time)\r\n       const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n       \r\n       // 计算目标时间（考虑5分钟窗口的中心）\r\n       const targetTime = new Date(totalStartTime.getTime() + (clickPercentage * totalDuration))\r\n       \r\n       // 使用与图表完全相同的视图窗口计算\r\n       const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n       const minTime = new Date(totalStartTime.getTime() + viewWindowDuration / 2)\r\n       const maxTime = new Date(totalEndTime.getTime() - viewWindowDuration / 2)\r\n       \r\n       // 更新当前手术的图表状态\r\n       let surgeryState = surgeryChartStates[surgery.id]\r\n       if (!surgeryState) {\r\n         surgeryState = {\r\n           currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n           viewRange: chartViewRange.value\r\n         }\r\n         surgeryChartStates[surgery.id] = surgeryState\r\n       }\r\n       \r\n       // 重新设计：如果总时间范围小于视图窗口，允许在整个范围内移动\r\n       if (totalDuration <= viewWindowDuration) {\r\n         // 总时间范围太小，允许在整个范围内移动，但确保不超出边界\r\n         const clampedTime = new Date(Math.max(totalStartTime.getTime(), Math.min(totalEndTime.getTime(), targetTime.getTime())))\r\n         surgeryState.currentTime = clampedTime\r\n       } else {\r\n         // 正常的时间范围限制\r\n         if (targetTime.getTime() < minTime.getTime()) {\r\n           surgeryState.currentTime = minTime\r\n         } else if (targetTime.getTime() > maxTime.getTime()) {\r\n           surgeryState.currentTime = maxTime\r\n         } else {\r\n           surgeryState.currentTime = targetTime\r\n         }\r\n       }\r\n       \r\n       console.log('滚动条点击 (重新设计):', {\r\n         surgeryId: surgery.surgery_id,\r\n         clickPercentage: clickPercentage.toFixed(2),\r\n         targetTime: targetTime.toISOString(),\r\n         newCurrentTime: surgeryState.currentTime.toISOString(),\r\n         totalStartTime: totalStartTime.toISOString(),\r\n         totalEndTime: totalEndTime.toISOString(),\r\n         totalDuration: totalDuration / (1000 * 60)\r\n       })\r\n       \r\n       // 触发滚动条重新渲染\r\n       scrollbarUpdateTrigger.value++\r\n       updateStateMachineChart(surgery)\r\n     }\r\n\r\n     // 开始滚动条拖拽\r\n     const startScrollbarDrag = (event, surgery) => {\r\n       if (!surgery) return\r\n       \r\n       event.preventDefault()\r\n       event.stopPropagation() // 防止触发轨道点击事件\r\n       \r\n       // 获取或创建当前手术的滚动条状态\r\n       let scrollbarState = surgeryScrollbarStates.get(surgery.id)\r\n       if (!scrollbarState) {\r\n         scrollbarState = {\r\n           isDragging: false,\r\n           dragStartX: 0,\r\n           dragStartTime: null\r\n         }\r\n         surgeryScrollbarStates.set(surgery.id, scrollbarState)\r\n       }\r\n       \r\n       scrollbarState.isDragging = true\r\n       scrollbarState.dragStartX = event.clientX\r\n       \r\n       // 获取当前手术的图表状态\r\n       let surgeryState = surgeryChartStates[surgery.id]\r\n       if (!surgeryState) {\r\n         surgeryState = {\r\n           currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n           viewRange: chartViewRange.value\r\n         }\r\n         surgeryChartStates[surgery.id] = surgeryState\r\n       }\r\n       scrollbarState.dragStartTime = surgeryState.currentTime ? new Date(surgeryState.currentTime) : null\r\n       \r\n       // 添加全局事件监听\r\n       document.addEventListener('mousemove', (e) => handleScrollbarDrag(e, surgery))\r\n       document.addEventListener('mouseup', () => stopScrollbarDrag(surgery))\r\n     }\r\n\r\n     // 处理滚动条拖拽 - 重新设计：基于手术开始到手术结束的范围\r\n     const handleScrollbarDrag = (event, surgery) => {\r\n       // 获取当前手术的滚动条状态\r\n       let scrollbarState = surgeryScrollbarStates.get(surgery.id)\r\n       if (!scrollbarState || !scrollbarState.isDragging || !scrollbarState.dragStartTime) return\r\n       \r\n       const deltaX = event.clientX - scrollbarState.dragStartX\r\n       \r\n       // 查找当前手术的滚动条轨道\r\n       // 通过手术ID查找对应的滚动条容器\r\n       const scrollbarContainer = document.querySelector(`[data-surgery-id=\"${surgery.id}\"] .chart-scrollbar-container`)\r\n       const scrollbarTrack = scrollbarContainer?.querySelector('.scrollbar-track')\r\n       if (!scrollbarTrack) {\r\n         console.warn('找不到滚动条轨道:', surgery.id)\r\n         return\r\n       }\r\n       \r\n       const trackWidth = scrollbarTrack.offsetWidth\r\n       // 重新设计：计算总时间范围从手术开始到手术结束\r\n       const totalStartTime = new Date(surgery.surgery_start_time)\r\n       const totalEndTime = new Date(surgery.surgery_end_time)\r\n       const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n       \r\n       // 计算拖拽对应的总时间变化\r\n       const dragTimeChange = (deltaX / trackWidth) * totalDuration\r\n       \r\n       // 计算新的中心时间\r\n       const newCenterTime = new Date(scrollbarState.dragStartTime.getTime() + dragTimeChange)\r\n       \r\n       // 使用与图表完全相同的视图窗口计算\r\n       const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n       const minTime = new Date(totalStartTime.getTime() + viewWindowDuration / 2)\r\n       const maxTime = new Date(totalEndTime.getTime() - viewWindowDuration / 2)\r\n       \r\n       // 更新当前手术的图表状态\r\n       let surgeryState = surgeryChartStates[surgery.id]\r\n       if (!surgeryState) {\r\n         surgeryState = {\r\n           currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n           viewRange: chartViewRange.value\r\n         }\r\n         surgeryChartStates[surgery.id] = surgeryState\r\n       }\r\n       \r\n       // 重新设计：如果总时间范围小于视图窗口，允许在整个范围内移动\r\n       if (totalDuration <= viewWindowDuration) {\r\n         // 总时间范围太小，允许在整个范围内移动，但确保不超出边界\r\n         const clampedTime = new Date(Math.max(totalStartTime.getTime(), Math.min(totalEndTime.getTime(), newCenterTime.getTime())))\r\n         surgeryState.currentTime = clampedTime\r\n       } else {\r\n         // 正常的时间范围限制\r\n         if (newCenterTime.getTime() < minTime.getTime()) {\r\n           surgeryState.currentTime = minTime\r\n         } else if (newCenterTime.getTime() > maxTime.getTime()) {\r\n           surgeryState.currentTime = maxTime\r\n         } else {\r\n           surgeryState.currentTime = newCenterTime\r\n         }\r\n       }\r\n       \r\n       console.log('滚动条拖拽 (重新设计):', {\r\n         surgeryId: surgery.surgery_id,\r\n         deltaX: deltaX.toFixed(2),\r\n         dragTimeChange: dragTimeChange / (1000 * 60),\r\n         newCenterTime: newCenterTime.toISOString(),\r\n         newCurrentTime: surgeryState.currentTime.toISOString(),\r\n         totalStartTime: totalStartTime.toISOString(),\r\n         totalEndTime: totalEndTime.toISOString(),\r\n         totalDuration: totalDuration / (1000 * 60)\r\n       })\r\n       \r\n       // 触发滚动条重新渲染\r\n       scrollbarUpdateTrigger.value++\r\n       updateStateMachineChart(surgery)\r\n     }\r\n\r\n    // 停止滚动条拖拽\r\n    const stopScrollbarDrag = (surgery) => {\r\n      if (!surgery) return\r\n      \r\n      // 获取当前手术的滚动条状态\r\n      let scrollbarState = surgeryScrollbarStates.get(surgery.id)\r\n      if (scrollbarState) {\r\n        scrollbarState.isDragging = false\r\n        scrollbarState.dragStartX = 0\r\n        scrollbarState.dragStartTime = null\r\n      }\r\n      \r\n      // 移除全局事件监听\r\n      document.removeEventListener('mousemove', (e) => handleScrollbarDrag(e, surgery))\r\n      document.removeEventListener('mouseup', () => stopScrollbarDrag(surgery))\r\n    }\r\n\r\n    // 向左滚动图表 - 重新设计：基于手术开始到手术结束的范围\r\n    const scrollChartLeft = (surgery) => {\r\n      if (!surgery) return\r\n      \r\n      let surgeryState = surgeryChartStates[surgery.id]\r\n      if (!surgeryState) {\r\n        surgeryState = {\r\n          currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n          viewRange: chartViewRange.value\r\n        }\r\n        surgeryChartStates[surgery.id] = surgeryState\r\n      }\r\n      \r\n      const scrollStep = 60 * 1000 // 1分钟\r\n      const newCurrentTime = new Date(surgeryState.currentTime.getTime() - scrollStep)\r\n      \r\n      // 重新设计：使用与图表完全相同的边界检查逻辑\r\n      const totalStartTime = new Date(surgery.surgery_start_time)\r\n      const totalEndTime = new Date(surgery.surgery_end_time)\r\n      const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n      const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n      \r\n      // 重新设计：如果总时间范围小于等于视图窗口，允许在整个范围内移动\r\n      if (totalDuration <= viewWindowDuration) {\r\n        const clampedTime = new Date(Math.max(totalStartTime.getTime(), Math.min(totalEndTime.getTime(), newCurrentTime.getTime())))\r\n        surgeryState.currentTime = clampedTime\r\n      } else {\r\n        // 正常的时间范围限制\r\n        const minTime = new Date(totalStartTime.getTime() + viewWindowDuration / 2)\r\n        \r\n        // 确保不超出左边界\r\n        if (newCurrentTime.getTime() >= minTime.getTime()) {\r\n          surgeryState.currentTime = newCurrentTime\r\n        } else {\r\n          surgeryState.currentTime = minTime\r\n        }\r\n      }\r\n      \r\n      console.log('向左滚动 (重新设计):', {\r\n        surgeryId: surgery.surgery_id,\r\n        oldTime: surgeryState.currentTime.toISOString(),\r\n        newTime: newCurrentTime.toISOString(),\r\n        totalStartTime: totalStartTime.toISOString(),\r\n        totalEndTime: totalEndTime.toISOString(),\r\n        totalDuration: totalDuration / (1000 * 60)\r\n      })\r\n      \r\n      // 触发滚动条重新渲染\r\n      scrollbarUpdateTrigger.value++\r\n      updateStateMachineChart(surgery)\r\n    }\r\n\r\n    // 向右滚动图表 - 重新设计：基于手术开始到手术结束的范围\r\n    const scrollChartRight = (surgery) => {\r\n      if (!surgery) return\r\n      \r\n      let surgeryState = surgeryChartStates[surgery.id]\r\n      if (!surgeryState) {\r\n        surgeryState = {\r\n          currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n          viewRange: chartViewRange.value\r\n        }\r\n        surgeryChartStates[surgery.id] = surgeryState\r\n      }\r\n      \r\n      const scrollStep = 60 * 1000 // 1分钟\r\n      const newCurrentTime = new Date(surgeryState.currentTime.getTime() + scrollStep)\r\n      \r\n      // 重新设计：使用与图表完全相同的边界检查逻辑\r\n      const totalStartTime = new Date(surgery.surgery_start_time)\r\n      const totalEndTime = new Date(surgery.surgery_end_time)\r\n      const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n      const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n      \r\n      // 重新设计：如果总时间范围小于等于视图窗口，允许在整个范围内移动\r\n      if (totalDuration <= viewWindowDuration) {\r\n        const clampedTime = new Date(Math.max(totalStartTime.getTime(), Math.min(totalEndTime.getTime(), newCurrentTime.getTime())))\r\n        surgeryState.currentTime = clampedTime\r\n        \r\n        console.log('向右滚动 (短手术 - 重新设计):', {\r\n          surgeryId: surgery.surgery_id,\r\n          oldTime: surgeryState.currentTime.toISOString(),\r\n          newTime: newCurrentTime.toISOString(),\r\n          clampedTime: clampedTime.toISOString(),\r\n          totalStartTime: totalStartTime.toISOString(),\r\n          totalEndTime: totalEndTime.toISOString(),\r\n          totalDuration: totalDuration / (1000 * 60)\r\n        })\r\n      } else {\r\n        // 正常的时间范围限制\r\n        const maxTime = new Date(totalEndTime.getTime() - viewWindowDuration / 2)\r\n        \r\n        // 确保不超出右边界\r\n        if (newCurrentTime.getTime() <= maxTime.getTime()) {\r\n          surgeryState.currentTime = newCurrentTime\r\n        } else {\r\n          surgeryState.currentTime = maxTime\r\n        }\r\n        \r\n        console.log('向右滚动 (长手术 - 重新设计):', {\r\n          surgeryId: surgery.surgery_id,\r\n          oldTime: surgeryState.currentTime.toISOString(),\r\n          newTime: newCurrentTime.toISOString(),\r\n          maxTime: maxTime.toISOString(),\r\n          totalStartTime: totalStartTime.toISOString(),\r\n          totalEndTime: totalEndTime.toISOString(),\r\n          totalDuration: totalDuration / (1000 * 60)\r\n        })\r\n      }\r\n      \r\n      // 触发滚动条重新渲染\r\n      scrollbarUpdateTrigger.value++\r\n      updateStateMachineChart(surgery)\r\n    }\r\n\r\n    // 检查是否可以向左滚动 - 重新设计：基于手术开始到手术结束的范围\r\n    const canScrollLeft = (surgery) => {\r\n      if (!surgery) return false\r\n      \r\n      let surgeryState = surgeryChartStates[surgery.id]\r\n      if (!surgeryState) {\r\n        surgeryState = {\r\n          currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n          viewRange: chartViewRange.value\r\n        }\r\n        surgeryChartStates[surgery.id] = surgeryState\r\n      }\r\n      \r\n      // 重新设计：使用与图表完全相同的边界检查逻辑\r\n      const totalStartTime = new Date(surgery.surgery_start_time)\r\n      const totalEndTime = new Date(surgery.surgery_end_time)\r\n      const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n      const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n      \r\n      // 重新设计：如果总时间范围小于等于视图窗口，无法滚动\r\n      if (totalDuration <= viewWindowDuration) {\r\n        return false\r\n      }\r\n      \r\n      const minTime = new Date(totalStartTime.getTime() + viewWindowDuration / 2)\r\n      \r\n      return surgeryState.currentTime.getTime() > minTime.getTime()\r\n    }\r\n\r\n    // 检查是否可以向右滚动 - 重新设计：基于手术开始到手术结束的范围\r\n    const canScrollRight = (surgery) => {\r\n      if (!surgery) return false\r\n      \r\n      let surgeryState = surgeryChartStates[surgery.id]\r\n      if (!surgeryState) {\r\n        surgeryState = {\r\n          currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n          viewRange: chartViewRange.value\r\n        }\r\n        surgeryChartStates[surgery.id] = surgeryState\r\n      }\r\n      \r\n      // 重新设计：使用与图表完全相同的边界检查逻辑\r\n      const totalStartTime = new Date(surgery.surgery_start_time)\r\n      const totalEndTime = new Date(surgery.surgery_end_time)\r\n      const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n      const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n      \r\n      // 重新设计：如果总时间范围小于等于视图窗口，无法滚动\r\n      if (totalDuration <= viewWindowDuration) {\r\n        return false // 无法滚动，因为已经显示全部\r\n      }\r\n      \r\n      // 计算最大中心时间：当视图中心时间到达这个时间时，视图的结束时间正好是手术结束时间\r\n      const maxCenterTime = new Date(totalEndTime.getTime() - viewWindowDuration / 2)\r\n      \r\n      console.log('向右滚动检查 (重新设计):', {\r\n        surgeryId: surgery.surgery_id,\r\n        currentTime: surgeryState.currentTime.toISOString(),\r\n        maxCenterTime: maxCenterTime.toISOString(),\r\n        totalStartTime: totalStartTime.toISOString(),\r\n        totalEndTime: totalEndTime.toISOString(),\r\n        totalDuration: totalDuration / (1000 * 60),\r\n        viewWindowDuration: (viewWindowDuration / (1000 * 60)).toFixed(1) + '分钟',\r\n        canScroll: surgeryState.currentTime.getTime() < maxCenterTime.getTime()\r\n      })\r\n      \r\n      return surgeryState.currentTime.getTime() < maxCenterTime.getTime()\r\n    }\r\n\r\n    // 检查所有组件的同步状态\r\n    const checkSynchronization = (surgery) => {\r\n      if (!surgery) return\r\n      \r\n      const chartData = getStateMachineChartData(surgery)\r\n      const scrollbarStyle = getScrollbarThumbStyle(surgery, scrollbarUpdateTrigger.value)\r\n      const scrollbarInfo = getScrollbarInfo(surgery, scrollbarUpdateTrigger.value)\r\n      \r\n      // 重新设计：计算总时间范围和视图窗口\r\n      const totalStartTime = new Date(surgery.surgery_start_time)\r\n      const totalEndTime = new Date(surgery.surgery_end_time)\r\n      const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n      const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n      \r\n      // 计算边界时间用于调试\r\n      const minCenterTime = new Date(totalStartTime.getTime() + viewWindowDuration / 2)\r\n      const maxCenterTime = new Date(totalEndTime.getTime() - viewWindowDuration / 2)\r\n      \r\n      console.log('同步状态检查 (重新设计):', {\r\n        surgeryId: surgery.surgery_id,\r\n        totalStartTime: totalStartTime.toISOString(),\r\n        totalEndTime: totalEndTime.toISOString(),\r\n        totalDuration: (totalDuration / (1000 * 60)).toFixed(1) + '分钟',\r\n        viewWindowDuration: (viewWindowDuration / (1000 * 60)).toFixed(1) + '分钟',\r\n        isShortSurgery: totalDuration <= viewWindowDuration,\r\n        minCenterTime: minCenterTime.toISOString(),\r\n        maxCenterTime: maxCenterTime.toISOString(),\r\n        chartDataExists: !!chartData,\r\n        chartLabels: chartData?.labels?.length || 0,\r\n        chartDataPoints: chartData?.data?.length || 0,\r\n        chartStartTime: chartData?.startTime?.toISOString() || 'N/A',\r\n        chartEndTime: chartData?.endTime?.toISOString() || 'N/A',\r\n        scrollbarLeft: scrollbarStyle.left,\r\n        scrollbarWidth: scrollbarStyle.width,\r\n        scrollbarInfo: scrollbarInfo,\r\n        canScrollLeft: canScrollLeft(surgery),\r\n        canScrollRight: canScrollRight(surgery),\r\n        // 添加调试信息\r\n        surgeryStartTime: surgery.surgery_start_time,\r\n        surgeryEndTime: surgery.surgery_end_time,\r\n        timelineRange: getTimelineRange(surgery),\r\n        powerOnTime: getPowerOnTime(surgery),\r\n        powerOffTime: getPowerOffTime(surgery)\r\n      })\r\n    }\r\n\r\n    // 获取滚动条信息 - 重新设计：基于手术开始到手术结束的范围\r\n    const getScrollbarInfo = (surgery, updateTrigger) => {\r\n      if (!surgery) return ''\r\n      \r\n      // 获取图表实际的时间范围\r\n      const chartData = getStateMachineChartData(surgery)\r\n      if (!chartData || !chartData.startTime || !chartData.endTime) {\r\n        // 如果没有图表数据，使用与图表相同的计算逻辑\r\n        let surgeryState = surgeryChartStates[surgery.id]\r\n        if (!surgeryState) {\r\n          surgeryState = {\r\n            currentTime: surgery.surgery_start_time ? new Date(surgery.surgery_start_time) : new Date(),\r\n            viewRange: chartViewRange.value\r\n          }\r\n          surgeryChartStates[surgery.id] = surgeryState\r\n        }\r\n        \r\n        // 重新设计：使用与图表完全相同的视图窗口计算\r\n        const totalStartTime = new Date(surgery.surgery_start_time)\r\n        const totalEndTime = new Date(surgery.surgery_end_time)\r\n        const totalDuration = totalEndTime.getTime() - totalStartTime.getTime()\r\n        const viewWindowDuration = chartViewRange.value * 60 * 1000 // 5分钟\r\n        let viewCenterTime = surgeryState.currentTime\r\n        \r\n        // 重新设计：确保视图中心时间在手术时间范围内\r\n          const minCenterTime = new Date(totalStartTime.getTime() + viewWindowDuration / 2)\r\n          const maxCenterTime = new Date(totalEndTime.getTime() - viewWindowDuration / 2)\r\n          \r\n        // 如果总时间范围小于视图窗口，允许在整个范围内移动\r\n        if (totalDuration <= viewWindowDuration) {\r\n          // 总时间范围太小，允许在整个范围内移动，但确保不超出边界\r\n          const clampedTime = new Date(Math.max(totalStartTime.getTime(), Math.min(totalEndTime.getTime(), viewCenterTime.getTime())))\r\n          viewCenterTime = clampedTime\r\n        } else {\r\n          // 正常的时间范围限制\r\n          if (viewCenterTime.getTime() < minCenterTime.getTime()) {\r\n            viewCenterTime = minCenterTime\r\n          } else if (viewCenterTime.getTime() > maxCenterTime.getTime()) {\r\n            viewCenterTime = maxCenterTime\r\n          }\r\n        }\r\n        \r\n        // 计算视图的开始和结束时间\r\n        const viewStartTime = new Date(viewCenterTime.getTime() - viewWindowDuration / 2)\r\n        const viewEndTime = new Date(viewCenterTime.getTime() + viewWindowDuration / 2)\r\n        \r\n        // 确保视图范围不超出手术总时间范围\r\n        let finalViewStartTime = viewStartTime\r\n        let finalViewEndTime = viewEndTime\r\n        \r\n        if (finalViewStartTime.getTime() < totalStartTime.getTime()) {\r\n          finalViewStartTime = totalStartTime\r\n          finalViewEndTime = new Date(totalStartTime.getTime() + viewWindowDuration)\r\n        }\r\n        \r\n        if (finalViewEndTime.getTime() > totalEndTime.getTime()) {\r\n          finalViewEndTime = totalEndTime\r\n          finalViewStartTime = new Date(totalEndTime.getTime() - viewWindowDuration)\r\n          \r\n          // 确保调整后的开始时间不早于手术开始时间\r\n          if (finalViewStartTime.getTime() < totalStartTime.getTime()) {\r\n            finalViewStartTime = totalStartTime\r\n            finalViewEndTime = new Date(totalStartTime.getTime() + viewWindowDuration)\r\n          }\r\n        }\r\n        \r\n        const startTimeStr = finalViewStartTime.toLocaleTimeString('zh-CN', { \r\n          hour: '2-digit', \r\n          minute: '2-digit' \r\n        })\r\n        const endTimeStr = finalViewEndTime.toLocaleTimeString('zh-CN', { \r\n          hour: '2-digit', \r\n          minute: '2-digit' \r\n        })\r\n        \r\n        const durationMinutes = (finalViewEndTime.getTime() - finalViewStartTime.getTime()) / (1000 * 60)\r\n        \r\n        return `${startTimeStr} - ${endTimeStr} (${durationMinutes.toFixed(1)}分钟)`\r\n      }\r\n      \r\n      // 使用图表实际的时间范围\r\n      const actualStartTime = new Date(chartData.startTime)\r\n      const actualEndTime = new Date(chartData.endTime)\r\n      \r\n      const startTimeStr = actualStartTime.toLocaleTimeString('zh-CN', { \r\n        hour: '2-digit', \r\n        minute: '2-digit' \r\n      })\r\n      const endTimeStr = actualEndTime.toLocaleTimeString('zh-CN', { \r\n        hour: '2-digit', \r\n        minute: '2-digit' \r\n      })\r\n      \r\n      // 计算实际的时间范围（分钟）\r\n      const actualDurationMinutes = (actualEndTime.getTime() - actualStartTime.getTime()) / (1000 * 60)\r\n      \r\n      console.log('滚动条时间范围 (重新设计):', surgery.surgery_id, {\r\n        startTime: actualStartTime.toISOString(),\r\n        endTime: actualEndTime.toISOString(),\r\n        duration: actualDurationMinutes.toFixed(1) + '分钟',\r\n        totalStartTime: new Date(surgery.surgery_start_time).toISOString(),\r\n        totalEndTime: new Date(surgery.surgery_end_time).toISOString()\r\n      })\r\n      \r\n      return `${startTimeStr} - ${endTimeStr} (${actualDurationMinutes.toFixed(1)}分钟)`\r\n    }\r\n\r\n\r\n\r\n    // 监听手术数据变化，自动更新图表\r\n    watch(surgeries, (newSurgeries) => {\r\n      if (newSurgeries.length > 0 && activeTab.value) {\r\n        const currentSurgery = newSurgeries.find(s => s.id.toString() === activeTab.value)\r\n        if (currentSurgery) {\r\n          // 延迟更新图表，确保DOM已渲染\r\n          nextTick(() => {\r\n            // 检查canvas元素是否存在\r\n            const canvasId = `stateMachineChart_${currentSurgery.id}`\r\n            const canvas = document.getElementById(canvasId)\r\n            if (canvas) {\r\n            updateStateMachineChart(currentSurgery)\r\n            } else {\r\n              console.warn('Canvas元素不存在，等待DOM渲染:', canvasId)\r\n              // 如果canvas不存在，再等待一下\r\n              setTimeout(() => {\r\n                updateStateMachineChart(currentSurgery)\r\n              }, 100)\r\n            }\r\n            \r\n            // 更新网络延时图表\r\n            if (currentSurgery.is_remote_surgery && currentSurgery.network_stats) {\r\n              updateNetworkChart(currentSurgery)\r\n            }\r\n          })\r\n        }\r\n      }\r\n    }, { deep: true })\r\n\r\n    // 监听活动标签页变化，更新图表\r\n    watch(activeTab, (newTab) => {\r\n      if (newTab && surgeries.value.length > 0) {\r\n        const currentSurgery = surgeries.value.find(s => s.id.toString() === newTab)\r\n        if (currentSurgery) {\r\n          // 延迟更新图表，确保DOM已渲染\r\n          nextTick(() => {\r\n            // 再次检查canvas元素是否存在\r\n            const canvasId = `stateMachineChart_${currentSurgery.id}`\r\n            const canvas = document.getElementById(canvasId)\r\n            if (canvas) {\r\n              console.log('切换到手术标签页:', currentSurgery.surgery_id)\r\n              \r\n              // 添加调试信息，特别关注第四场手术\r\n              if (currentSurgery.surgery_id === '4371-17') {\r\n                console.log('=== 第四场手术调试信息 ===')\r\n                console.log('手术开始时间:', currentSurgery.surgery_start_time)\r\n                console.log('手术结束时间:', currentSurgery.surgery_end_time)\r\n                console.log('时间轴范围:', getTimelineRange(currentSurgery))\r\n                console.log('开机时间:', getPowerOnTime(currentSurgery))\r\n                console.log('关机时间:', getPowerOffTime(currentSurgery))\r\n                console.log('状态机变化数据:', currentSurgery.state_machine_changes)\r\n                console.log('========================')\r\n              }\r\n              \r\n              updateStateMachineChart(currentSurgery)\r\n            } else {\r\n              console.warn('Canvas元素不存在，等待DOM渲染:', canvasId)\r\n              // 如果canvas不存在，再等待一下\r\n              setTimeout(() => {\r\n                updateStateMachineChart(currentSurgery)\r\n              }, 100)\r\n            }\r\n            \r\n            // 更新网络延时图表\r\n            if (currentSurgery.is_remote_surgery && currentSurgery.network_stats) {\r\n              updateNetworkChart(currentSurgery)\r\n            }\r\n          })\r\n        }\r\n      }\r\n    })\r\n\r\n    // 生命周期\r\n    onMounted(async () => {\r\n      // 优先处理URL参数中的日志ID\r\n      const logIdsParam = route.query.logIds\r\n      if (logIdsParam) {\r\n        await loadBatchLogEntriesByIds()\r\n        return\r\n      }\r\n      \r\n      // 如果没有URL参数，检查是否有sessionStorage数据\r\n      if (logEntries.value.length > 0) {\r\n        // 检查是否有自动分析标志\r\n        const autoAnalyze = sessionStorage.getItem('autoAnalyze')\r\n        if (autoAnalyze === 'true') {\r\n          sessionStorage.removeItem('autoAnalyze')\r\n          await analyzeLogs()\r\n        }\r\n      }\r\n    })\r\n\r\n          return {\r\n        surgeries,\r\n        activeTab,\r\n        armDetailsVisible,\r\n        showAllAlarms,\r\n        analyzing,\r\n        logEntriesCount,\r\n        analyzeLogs,\r\n        exportSurgeryData,\r\n        toggleArmDetails,\r\n        toggleAlarms,\r\n        scrollToAlarmCard,\r\n        scrollToNetworkCard,\r\n        getArmUsages,\r\n        getInstrumentRows,\r\n        getArmTotalTime,\r\n        getArmTimelineStyle,\r\n              getArmTimelineSegments,\r\n      getSurgeryTimelineStyle,\r\n      getUsageTimelineStyle,\r\n        getEnergyTime,\r\n        getAlarmTypeTag,\r\n        getAlarmDetails,\r\n        getDeduplicatedAlarmStats,\r\n        formatTime,\r\n        formatSurgeryTime,\r\n        formatTimeShort,\r\n        getTimePosition,\r\n        getTimelineTicks,\r\n        handleTabClick,\r\n        getAnalysisButtonText,\r\n        getTimeRange,\r\n        loadBatchLogEntriesByIds,\r\n        pollTaskResult,\r\n        getPowerOnTime,\r\n        getPowerOffTime,\r\n        getAllPowerOnTimes,\r\n        getAllPowerOffTimes,\r\n        getSurgeryTimelineStyle,\r\n        getGroupedUsagesByUdi,\r\n        getGroupedUsageDuration,\r\n        getSegmentText,\r\n        getTimelineRange,\r\n        getProgressTimelineRange,\r\n        getSegmentInstrumentName,\r\n        getSortedTimelineEvents,\r\n        getStateChanges,\r\n        getStateName,\r\n        getStateBarHeight,\r\n        getStateBarPosition,\r\n        handleBeforeTabLeave,\r\n        \r\n        // 状态机图表相关方法\r\n        resetChartView,\r\n        updateStateMachineChart,\r\n        getStateMachineChartData,\r\n        getStateMachineChartOptions,\r\n\r\n        // 网络图表相关方法\r\n        updateNetworkChart,\r\n\r\n                 // 滚动条相关方法\r\n         getScrollbarThumbStyle,\r\n         handleTrackClick,\r\n         startScrollbarDrag,\r\n         scrollChartLeft,\r\n         scrollChartRight,\r\n         canScrollLeft,\r\n         canScrollRight,\r\n         getScrollbarInfo,\r\n         checkSynchronization,\r\n\r\n        // PostgreSQL数据预览相关\r\n        postgresqlPreviewVisible,\r\n        postgresqlDataText,\r\n        copyingData,\r\n        refreshingData,\r\n        togglePostgreSQLPreview,\r\n        copyPostgreSQLData,\r\n        refreshPostgreSQLData,\r\n\r\n      }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.surgery-statistics-container {\r\n  padding: 20px;\r\n  min-height: calc(100vh - 40px);\r\n  box-sizing: border-box;\r\n}\r\n\r\n.action-bar {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.analysis-section {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n  min-height: 400px;\r\n}\r\n\r\n.title-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.page-title {\r\n  margin: 0;\r\n  font-size: 24px;\r\n  font-weight: 600;\r\n  color: #303133;\r\n}\r\n\r\n.page-subtitle {\r\n  margin: 4px 0 0 0;\r\n  font-size: 14px;\r\n  color: #909399;\r\n}\r\n\r\n.empty-card {\r\n  text-align: center;\r\n  padding: 40px;\r\n  margin-top: 100px;\r\n}\r\n\r\n.empty-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 16px;\r\n  min-height: 300px;\r\n  justify-content: center;\r\n}\r\n\r\n.empty-icon {\r\n  font-size: 48px;\r\n  color: #C0C4CC;\r\n}\r\n\r\n.empty-content h3 {\r\n  margin: 0;\r\n  font-size: 18px;\r\n  color: #303133;\r\n}\r\n\r\n.empty-content p {\r\n  margin: 0;\r\n  color: #909399;\r\n}\r\n\r\n.log-entries-info {\r\n  width: 100%;\r\n  max-width: 600px;\r\n  margin: 20px 0;\r\n  text-align: left;\r\n}\r\n\r\n.entries-preview {\r\n  font-size: 12px;\r\n  color: #606266;\r\n  margin-top: 8px;\r\n}\r\n\r\n.analysis-info-card {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.tab-card {\r\n  border-radius: 8px;\r\n  min-height: 500px;\r\n  /* 优化ResizeObserver性能 */\r\n  contain: layout style paint;\r\n}\r\n\r\n/* 优化标签页性能 */\r\n.el-tabs__content {\r\n  contain: layout style paint;\r\n}\r\n\r\n.el-tab-pane {\r\n  contain: layout style paint;\r\n}\r\n\r\n/* 减少标签页切换时的重绘 */\r\n.el-tabs__item {\r\n  will-change: auto;\r\n}\r\n\r\n.el-tabs__content {\r\n  will-change: auto;\r\n}\r\n\r\n/* 禁用标签页切换动画，减少 ResizeObserver 错误 */\r\n.el-tabs__item {\r\n  transition: none !important;\r\n}\r\n\r\n.el-tabs__content {\r\n  transition: none !important;\r\n}\r\n\r\n.el-tab-pane {\r\n  transition: none !important;\r\n}\r\n\r\n/* 优化标签页内容渲染 */\r\n.el-tabs__content > .el-tab-pane {\r\n  contain: layout style paint;\r\n  will-change: auto;\r\n}\r\n\r\n/* 减少标签页切换时的布局计算 */\r\n.el-tabs__header {\r\n  contain: layout style paint;\r\n}\r\n\r\n.el-tabs__nav-wrap {\r\n  contain: layout style paint;\r\n}\r\n\r\n.el-tabs__nav {\r\n  contain: layout style paint;\r\n}\r\n\r\n.export-section {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n/* 手术信息布局 */\r\n.surgery-info-layout {\r\n  display: flex;\r\n  gap: 20px;\r\n  margin-bottom: 20px;\r\n  align-items: stretch;\r\n}\r\n\r\n.timeline-section {\r\n  width: 25%;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.state-chart-section {\r\n  width: 75%;\r\n  flex-shrink: 0;\r\n}\r\n\r\n/* 第二行布局：器械卡片 + 手术统计卡片 */\r\n/* 删除外部分栏后的残留样式（不再使用） */\r\n\r\n/* 手术信息卡片样式 */\r\n.info-card {\r\n  background: #ffffff;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  /* 确保时间线内容不被遮挡 */\r\n  overflow: visible;\r\n}\r\n\r\n/* 状态图表卡片样式 */\r\n.state-chart-card {\r\n  background: #ffffff;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.info-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 16px;\r\n  padding-bottom: 12px;\r\n  border-bottom: 1px solid #E4E7ED;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.info-header .time {\r\n  font-size: 16px;\r\n  font-weight: 500;\r\n  color: #1d2129;\r\n}\r\n\r\n.info-header .badges {\r\n  display: flex;\r\n  gap: 8px;\r\n}\r\n\r\n/* 故障手术标签样式 */\r\n.alarm-tag {\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  user-select: none;\r\n}\r\n\r\n.alarm-tag:hover {\r\n  transform: scale(1.05);\r\n  box-shadow: 0 2px 8px rgba(245, 108, 108, 0.3);\r\n}\r\n\r\n.alarm-tag:active {\r\n  transform: scale(0.95);\r\n}\r\n\r\n/* AntD Steps 时间线样式 */\r\n.surgery-steps {\r\n  padding-left: 2px;\r\n}\r\n\r\n:deep(.ant-steps-vertical) {\r\n  align-items: stretch;\r\n}\r\n\r\n:deep(.ant-steps-item) {\r\n  padding-bottom: 10px;\r\n}\r\n\r\n:deep(.ant-steps-item:last-child) {\r\n  padding-bottom: 0;\r\n}\r\n\r\n:deep(.ant-steps-item-container) {\r\n  align-items: flex-start;\r\n}\r\n\r\n:deep(.ant-steps-item-title) {\r\n  font-weight: 500;\r\n  font-size: 14px;\r\n}\r\n\r\n:deep(.ant-steps-item-description) {\r\n  color: #606266; /* 统一时间字体颜色，不按类型区分 */\r\n}\r\n:deep(.ant-steps-item-icon),\r\n:deep(.ant-steps-item-tail) {\r\n  color: #dcdfe6; /* 统一连接线/节点颜色 */\r\n}\r\n\r\n:deep(.ant-steps-item-finish) .ant-steps-item-icon,\r\n:deep(.ant-steps-item-process) .ant-steps-item-icon,\r\n:deep(.ant-steps-item-wait) .ant-steps-item-icon,\r\n:deep(.ant-steps-item-error) .ant-steps-item-icon {\r\n  color: #dcdfe6;\r\n}\r\n\r\n:deep(.ant-steps-item-finish) .ant-steps-item-title::after,\r\n:deep(.ant-steps-item-process) .ant-steps-item-title::after,\r\n:deep(.ant-steps-item-wait) .ant-steps-item-title::after,\r\n:deep(.ant-steps-item-error) .ant-steps-item-title::after {\r\n  background-color: #dcdfe6; /* 统一连接线颜色 */\r\n}\r\n\r\n.timeline-content {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  padding: 8px 12px;\r\n  background-color: #f8f9fa;\r\n  border-radius: 6px;\r\n  border-left: 3px solid;\r\n  /* 移除悬停动画效果 */\r\n  transition: none;\r\n}\r\n\r\n/* 移除悬停时的动态效果 */\r\n.timeline-content:hover {\r\n  /* 移除 transform 和 box-shadow 效果 */\r\n  transform: none;\r\n  box-shadow: none;\r\n}\r\n\r\n.timeline-icon {\r\n  font-size: 16px;\r\n  color: #409EFF;\r\n}\r\n\r\n.timeline-text {\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  color: #303133;\r\n}\r\n\r\n/* 时间线项目颜色 - 根据事件类型设置 */\r\n.timeline-content {\r\n  border-left-color: #409EFF;\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n/* 开机事件样式 */\r\n.timeline-content.timeline-powerOn {\r\n  border-left-color: #67C23A;\r\n  background-color: #f0f9ff;\r\n}\r\n\r\n/* 手术开始事件样式 */\r\n.timeline-content.timeline-surgeryStart {\r\n  border-left-color: #409EFF;\r\n  background-color: #f0f9ff;\r\n}\r\n\r\n/* 手术结束事件样式 */\r\n.timeline-content.timeline-surgeryEnd {\r\n  border-left-color: #E6A23C;\r\n  background-color: #fff7ed;\r\n}\r\n\r\n/* 关机事件样式 */\r\n.timeline-content.timeline-powerOff {\r\n  border-left-color: #F56C6C;\r\n  background-color: #fef0f0;\r\n}\r\n\r\n/* 时间线时间戳样式 */\r\n.el-timeline-item__timestamp {\r\n  font-size: 12px !important;\r\n  color: #909399 !important;\r\n  font-weight: 500 !important;\r\n}\r\n\r\n/* 状态图表样式 */\r\n.chart-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n  padding-bottom: 12px;\r\n  border-bottom: 1px solid #E4E7ED;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.chart-title {\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  color: #303133;\r\n}\r\n\r\n.chart-controls {\r\n  display: flex;\r\n  gap: 16px;\r\n  align-items: center;\r\n}\r\n\r\n.chart-legend {\r\n  display: flex;\r\n  gap: 16px;\r\n}\r\n\r\n.legend-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 6px;\r\n  font-size: 12px;\r\n  color: #606266;\r\n}\r\n\r\n.legend-color {\r\n  width: 12px;\r\n  height: 12px;\r\n  border-radius: 2px;\r\n}\r\n\r\n.legend-color.state-normal {\r\n  background-color: #95D475; /* 浅绿色 - 正常状态 */\r\n}\r\n\r\n.legend-color.state-error {\r\n  background-color: #F56C6C; /* 红色 - 故障状态 */\r\n}\r\n\r\n.legend-color.state-shutdown {\r\n  background-color: #909399; /* 灰色 - 关机状态 */\r\n}\r\n\r\n.state-chart-container {\r\n  position: relative;\r\n  height: 380px;\r\n  background-color: #FAFAFA;\r\n  border-radius: 6px;\r\n  border: 1px solid #E4E7ED;\r\n  overflow: hidden;\r\n  flex: 1;\r\n  cursor: grab;\r\n  padding-left: 4px; /* 为图形左边界留出空间，避免截断 */\r\n  padding-right: 10px; /* 为Y轴标签留出空间 */\r\n}\r\n\r\n.state-chart-container:active {\r\n  cursor: grabbing;\r\n}\r\n\r\n/* 滚动条样式 */\r\n.chart-scrollbar-container {\r\n  margin-top: 10px;\r\n  padding: 0 10px;\r\n}\r\n\r\n.scrollbar-track {\r\n  position: relative;\r\n  height: 8px;\r\n  background-color: #F5F7FA;\r\n  border-radius: 4px;\r\n  border: 1px solid #E4E7ED;\r\n  cursor: pointer;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.scrollbar-thumb {\r\n  position: absolute;\r\n  height: 100%;\r\n  background-color: #409EFF;\r\n  border-radius: 4px;\r\n  cursor: grab;\r\n  transition: background-color 0.2s ease;\r\n  min-width: 20px;\r\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.scrollbar-thumb:hover {\r\n  background-color: #337ECC;\r\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.scrollbar-thumb:active {\r\n  cursor: grabbing;\r\n  background-color: #2B5BA1;\r\n  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);\r\n}\r\n\r\n.scrollbar-controls {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 12px;\r\n}\r\n\r\n.scrollbar-info {\r\n  font-size: 12px;\r\n  color: #606266;\r\n  min-width: 120px;\r\n  text-align: center;\r\n}\r\n\r\n\r\n\r\n.chart-bars {\r\n  position: relative;\r\n  height: 100%;\r\n  padding: 10px 40px;\r\n}\r\n\r\n.chart-bar {\r\n  position: absolute;\r\n  bottom: 0;\r\n  width: 30px;\r\n  border-radius: 2px 2px 0 0;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.chart-bar:hover {\r\n  transform: scaleY(1.1);\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.chart-bar.state-surgery {\r\n  background-color: #95D475; /* 浅绿色 - 正常阶段 */\r\n}\r\n\r\n.chart-bar.state-error {\r\n  background-color: #F56C6C; /* 红色 - 故障阶段 */\r\n}\r\n\r\n.bar-tooltip {\r\n  position: absolute;\r\n  bottom: 100%;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  background-color: rgba(0, 0, 0, 0.8);\r\n  color: white;\r\n  padding: 8px 12px;\r\n  border-radius: 4px;\r\n  font-size: 12px;\r\n  white-space: nowrap;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n  transition: opacity 0.3s ease;\r\n  z-index: 1000;\r\n}\r\n\r\n.chart-bar:hover .bar-tooltip {\r\n  opacity: 1;\r\n}\r\n\r\n.tooltip-state {\r\n  font-weight: 600;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.tooltip-original {\r\n  color: #909399;\r\n  font-size: 11px;\r\n  margin-bottom: 2px;\r\n}\r\n\r\n.tooltip-time {\r\n  color: #E4E7ED;\r\n  margin-bottom: 2px;\r\n}\r\n\r\n.tooltip-duration {\r\n  color: #67C23A;\r\n  font-weight: 500;\r\n}\r\n\r\n.chart-timeline {\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 30px;\r\n  border-top: 1px solid #E4E7ED;\r\n  background-color: #FFFFFF;\r\n}\r\n\r\n.time-tick {\r\n  position: absolute;\r\n  top: 0;\r\n  transform: translateX(-50%);\r\n}\r\n\r\n.tick-line {\r\n  width: 1px;\r\n  height: 8px;\r\n  background-color: #DCDFE6;\r\n  margin: 0 auto;\r\n}\r\n\r\n.tick-label {\r\n  font-size: 10px;\r\n  color: #909399;\r\n  text-align: center;\r\n  margin-top: 4px;\r\n  white-space: nowrap;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .surgery-info-layout {\r\n    flex-direction: column;\r\n    gap: 16px;\r\n  }\r\n  \r\n  .timeline-section,\r\n  .state-chart-section {\r\n    width: 100%;\r\n  }\r\n  \r\n  .info-header {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n    gap: 8px;\r\n  }\r\n  \r\n  .timeline-content {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n    gap: 4px;\r\n  }\r\n  \r\n  .chart-header {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n    gap: 12px;\r\n  }\r\n  \r\n  .chart-legend {\r\n    flex-wrap: wrap;\r\n    gap: 12px;\r\n  }\r\n  \r\n  .state-chart-container {\r\n    height: 100px;\r\n  }\r\n}\r\n\r\n/* 器械使用分组样式 */\r\n.usage-group {\r\n  margin-bottom: 16px;\r\n  padding: 16px;\r\n  background-color: #FFFFFF;\r\n  border-radius: 6px;\r\n  border: 1px solid #E4E7ED;\r\n}\r\n\r\n.usage-group-header {\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.usage-group-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 4px;\r\n}\r\n\r\n.usage-group-name {\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  color: #303133;\r\n}\r\n\r\n.usage-group-udi {\r\n  font-size: 12px;\r\n  color: #909399;\r\n}\r\n\r\n.usage-group-duration {\r\n  font-size: 12px;\r\n  color: #67C23A;\r\n  font-weight: 500;\r\n}\r\n\r\n.usage-group-color {\r\n  width: 16px;\r\n  height: 16px;\r\n  border-radius: 4px;\r\n}\r\n\r\n.usage-group-color.arm-1 { background-color: #409EFF; }\r\n.usage-group-color.arm-2 { background-color: #67C23A; }\r\n.usage-group-color.arm-3 { background-color: #E6A23C; }\r\n.usage-group-color.arm-4 { background-color: #F56C6C; }\r\n\r\n/* 工具提示样式 */\r\n.el-tooltip__popper {\r\n  z-index: 9999;\r\n}\r\n\r\n/* 自定义工具提示样式 */\r\n:deep(.usage-time-tooltip) {\r\n  background-color: rgba(0, 0, 0, 0.9) !important;\r\n  color: white !important;\r\n  border: none !important;\r\n  border-radius: 6px !important;\r\n  padding: 10px 12px !important;\r\n  font-size: 12px !important;\r\n  font-weight: 500 !important;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;\r\n  line-height: 1.4 !important;\r\n  max-width: 300px !important;\r\n  white-space: pre-line !important;\r\n}\r\n\r\n:deep(.usage-time-tooltip .el-tooltip__arrow) {\r\n  border-top-color: rgba(0, 0, 0, 0.9) !important;\r\n}\r\n\r\n/* 移除旧的样式 */\r\n.time-info-cards {\r\n  display: none;\r\n}\r\n\r\n.time-card {\r\n  display: none;\r\n}\r\n\r\n.time-card-content {\r\n  display: none;\r\n}\r\n\r\n.usage-item {\r\n  display: none;\r\n}\r\n\r\n.usage-label {\r\n  display: none;\r\n}\r\n\r\n.usage-name {\r\n  display: none;\r\n}\r\n\r\n.usage-udi {\r\n  display: none;\r\n}\r\n\r\n.usage-duration {\r\n  display: none;\r\n}\r\n\r\n.usage-timeline-container {\r\n  display: none;\r\n}\r\n\r\n.usage-timeline {\r\n  display: none;\r\n}\r\n\r\n.timeline-segment-sub {\r\n  display: none;\r\n}\r\n\r\n/* 移除旧的时间信息样式 */\r\n.time-info-section {\r\n  display: none;\r\n}\r\n\r\n.time-info-header {\r\n  display: none;\r\n}\r\n\r\n.time-info-title {\r\n  display: none;\r\n}\r\n\r\n.time-info-content {\r\n  display: none;\r\n}\r\n\r\n.time-info-item {\r\n  display: none;\r\n}\r\n\r\n.time-icon {\r\n  display: none;\r\n}\r\n\r\n.time-info {\r\n  display: none;\r\n}\r\n\r\n.time-label {\r\n  display: none;\r\n}\r\n\r\n.arm-usage-card {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.unified-timeline-view {\r\n  position: relative;\r\n  min-height: 120px;\r\n  margin-bottom: 30px;\r\n  /* 优化渲染性能 */\r\n  contain: layout style paint;\r\n  will-change: transform;\r\n}\r\n\r\n.surgery-progress-container {\r\n  margin-bottom: 30px;\r\n  padding: 16px;\r\n  background-color: #FAFAFA;\r\n  border-radius: 8px;\r\n  border: 1px solid #E4E7ED;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\r\n}\r\n\r\n.surgery-timeline-wrapper {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.surgery-label {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  min-width: 120px;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.surgery-color {\r\n  width: 16px;\r\n  height: 16px;\r\n  border-radius: 4px;\r\n  background: linear-gradient(90deg, #409EFF, #67C23A);\r\n}\r\n\r\n.surgery-name {\r\n  font-weight: 600;\r\n  color: #303133;\r\n}\r\n\r\n.progress-labels {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-top: 8px;\r\n  padding-left: 132px; /* 120px标签宽度 + 12px间距 */\r\n}\r\n\r\n.time-label {\r\n  font-size: 14px;\r\n  color: #303133;\r\n  font-weight: 500;\r\n}\r\n\r\n.surgery-progress {\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.surgery-timeline-container {\r\n  position: relative;\r\n  height: 20px;\r\n  background-color: #F5F7FA;\r\n  border-radius: 4px;\r\n  border: 1px solid #DCDFE6;\r\n  overflow: hidden;\r\n  flex: 1;\r\n  min-width: 0;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.surgery-timeline-bar {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.surgery-timeline-segment {\r\n  position: absolute;\r\n  height: 100%;\r\n  background: linear-gradient(90deg, #409EFF, #67C23A);\r\n  border-radius: 4px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: all 0.3s ease;\r\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.surgery-segment-text {\r\n  color: white;\r\n  font-size: 12px;\r\n  font-weight: 600;\r\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  padding: 0 8px;\r\n}\r\n\r\n.surgery-duration-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 4px;\r\n  font-size: 12px;\r\n  color: #666;\r\n  min-width: 120px;\r\n  flex-shrink: 0;\r\n  align-items: flex-start;\r\n}\r\n\r\n.surgery-duration-info .duration-text {\r\n  font-weight: 500;\r\n  color: #409EFF;\r\n}\r\n\r\n.surgery-duration-info .time-range {\r\n  color: #909399;\r\n  font-size: 11px;\r\n}\r\n\r\n.surgery-duration-info .timeline-range {\r\n  color: #606266;\r\n  font-size: 11px;\r\n  font-style: italic;\r\n}\r\n\r\n\r\n\r\n/* 时间值样式（保留用于其他地方） */\r\n.time-value {\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  color: #303133;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n.arm-timeline {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px; /* 更紧凑 */\r\n  margin-top: 12px; /* 更紧凑 */\r\n  position: relative;\r\n  z-index: 2;\r\n  contain: layout style paint;\r\n}\r\n\r\n.arm-item {\r\n  border: 1px solid #E4E7ED;\r\n  border-radius: 6px; /* 更紧凑 */\r\n  padding: 10px; /* 更紧凑 */\r\n  background-color: #FAFAFA;\r\n  margin-bottom: 8px; /* 更紧凑 */\r\n}\r\n\r\n.arm-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 8px; /* 更紧凑 */\r\n}\r\n\r\n.arm-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.arm-color {\r\n  width: 16px;\r\n  height: 16px;\r\n  border-radius: 4px;\r\n}\r\n\r\n.arm-1 { background-color: #409EFF; }\r\n.arm-2 { background-color: #67C23A; }\r\n.arm-3 { background-color: #E6A23C; }\r\n.arm-4 { background-color: #F56C6C; }\r\n\r\n.arm-name {\r\n  font-weight: 600;\r\n  color: #303133;\r\n}\r\n\r\n.arm-actions {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.arm-timeline-container {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px; /* 更紧凑 */\r\n  margin-bottom: 8px; /* 更紧凑 */\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  padding: 0;\r\n  position: relative;\r\n}\r\n\r\n/* 当arm-timeline-container没有arm-label时的样式 */\r\n.arm-timeline-container.no-label {\r\n  gap: 0;\r\n}\r\n\r\n.arm-timeline-container.no-label .arm-timeline-bar {\r\n  flex: 1;\r\n  width: 100%;\r\n}\r\n\r\n.arm-label {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 6px; /* 更紧凑 */\r\n  min-width: 110px; /* 稍微收窄 */\r\n  flex-shrink: 0;\r\n  padding: 0;\r\n  margin: 0;\r\n  position: relative;\r\n}\r\n\r\n.arm-timeline-bar {\r\n  position: relative;\r\n  height: 16px; /* 更紧凑 */\r\n  background: #F5F7FA;\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n  flex: 1;\r\n  min-width: 0;\r\n  border: 1px solid #DCDFE6;\r\n  box-sizing: border-box;\r\n  padding: 0;\r\n  margin: 0;\r\n  left: 0;\r\n  right: 0;\r\n}\r\n\r\n\r\n\r\n.timeline-segment {\r\n  position: absolute;\r\n  height: 100%;\r\n  border-radius: 4px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: white;\r\n  font-size: 12px;\r\n  font-weight: 500;\r\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.timeline-segment.arm-1 { background-color: #409EFF; }\r\n.timeline-segment.arm-2 { background-color: #67C23A; }\r\n.timeline-segment.arm-3 { background-color: #E6A23C; }\r\n.timeline-segment.arm-4 { background-color: #F56C6C; }\r\n\r\n/* 确保segment-content占满整个进度条区域 */\r\n.segment-content {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  cursor: pointer;\r\n}\r\n\r\n.segment-text {\r\n  font-size: 10px; /* 更紧凑 */\r\n  font-weight: 500;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  padding: 0 4px;\r\n  text-align: center;\r\n  color: white;\r\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\r\n  min-height: 16px; /* 与bar高度匹配 */\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.arm-details {\r\n  margin-top: 16px;\r\n  padding-top: 0;\r\n  border-top: 1px solid #E4E7ED;\r\n}\r\n\r\n\r\n\r\n.energy-time {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  font-size: 12px;\r\n  color: #909399;\r\n  margin-top: 12px;\r\n}\r\n\r\n.energy-icon {\r\n  color: #E6A23C;\r\n}\r\n\r\n.alarm-card {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.alarm-summary {\r\n  margin-top: 16px;\r\n  text-align: center;\r\n}\r\n\r\n.alarm-toggle {\r\n  margin-top: 12px;\r\n  text-align: center;\r\n}\r\n\r\n.alarm-toggle .el-button {\r\n  color: #409EFF;\r\n  font-size: 14px;\r\n}\r\n\r\n.alarm-toggle .el-button:hover {\r\n  color: #66b1ff;\r\n}\r\n\r\n\r\n\r\n.stats-section {\r\n  margin-top: 20px;\r\n}\r\n\r\n.stats-card {\r\n  background-color: #F5F7FA;\r\n  border-radius: 8px;\r\n  padding: 16px;\r\n}\r\n\r\n.stats-card h4 {\r\n  margin: 0 0 12px 0;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  color: #303133;\r\n}\r\n\r\n.stats-list {\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 0;\r\n}\r\n\r\n.stats-list li {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 8px;\r\n  font-size: 12px;\r\n  color: #606266;\r\n}\r\n\r\n.stats-list li:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n/* 多个时间显示样式 */\r\n.time-item {\r\n  margin-bottom: 4px;\r\n  padding: 2px 0;\r\n  font-size: 13px;\r\n  color: #606266;\r\n}\r\n\r\n.time-item:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.time-item:not(:last-child) {\r\n  border-bottom: 1px solid #EBEEF5;\r\n  padding-bottom: 4px;\r\n}\r\n\r\n.time-value {\r\n  min-height: 20px;\r\n}\r\n\r\n/* 确保时间轴对齐的全局样式 */\r\n.arm-timeline-container {\r\n  display: flex !important;\r\n  align-items: center !important;\r\n  gap: 12px !important;\r\n  margin-bottom: 12px !important;\r\n  width: 100% !important;\r\n  box-sizing: border-box !important;\r\n  padding: 0 !important;\r\n  position: relative !important;\r\n}\r\n\r\n/* 额外的 ResizeObserver 优化 */\r\n.surgery-statistics-container {\r\n  contain: layout style paint;\r\n}\r\n\r\n.tab-card {\r\n  contain: layout style paint;\r\n}\r\n\r\n/* 减少标签页内容的重绘 */\r\n.el-tabs__content > .el-tab-pane {\r\n  contain: layout style paint;\r\n  will-change: auto;\r\n  transform: translateZ(0);\r\n}\r\n\r\n/* 优化复杂组件的渲染 */\r\n.surgery-info-layout {\r\n  contain: layout style paint;\r\n  will-change: auto;\r\n}\r\n\r\n.unified-timeline-view {\r\n  contain: layout style paint;\r\n  will-change: auto;\r\n}\r\n\r\n/* 禁用不必要的动画和过渡 */\r\n.el-collapse-transition {\r\n  transition: none !important;\r\n}\r\n\r\n.el-fade-in-linear-enter-active,\r\n.el-fade-in-linear-leave-active {\r\n  transition: none !important;\r\n}\r\n\r\n/* 优化表格渲染 */\r\n.el-table {\r\n  contain: layout style paint;\r\n}\r\n\r\n.el-table__body-wrapper {\r\n  contain: layout style paint;\r\n}\r\n\r\n.arm-label {\r\n  display: flex !important;\r\n  align-items: center !important;\r\n  gap: 8px !important;\r\n  min-width: 120px !important;\r\n  flex-shrink: 0 !important;\r\n  padding: 0 !important;\r\n  margin: 0 !important;\r\n  position: relative !important;\r\n}\r\n\r\n.arm-timeline-bar {\r\n  position: relative !important;\r\n  height: 20px !important;\r\n  background: #F5F7FA !important;\r\n  border-radius: 4px !important;\r\n  overflow: hidden !important;\r\n  flex: 1 !important;\r\n  min-width: 0 !important;\r\n  border: 1px solid #DCDFE6 !important;\r\n  box-sizing: border-box !important;\r\n  padding: 0 !important;\r\n  margin: 0 !important;\r\n  left: 0 !important;\r\n  right: 0 !important;\r\n}\r\n\r\n/* 确保所有时间轴进度条完全对齐，基于容器左边偏移相同距离 */\r\n.arm-item .arm-timeline-container .arm-timeline-bar,\r\n.usage-group .arm-timeline-container .arm-timeline-bar {\r\n  margin-left: 0 !important;\r\n  margin-right: 0 !important;\r\n  padding-left: 0 !important;\r\n  padding-right: 0 !important;\r\n  width: 100% !important;\r\n  max-width: none !important;\r\n  position: relative !important;\r\n}\r\n\r\n/* 确保时间轴容器内的所有元素都基于相同的左边偏移 */\r\n.arm-timeline-container .arm-label {\r\n  position: relative !important;\r\n  left: 0 !important;\r\n}\r\n\r\n.arm-timeline-container .arm-timeline-bar {\r\n  position: relative !important;\r\n  left: 0 !important;\r\n}\r\n\r\n/* 器械使用时间段的特殊样式 */\r\n.arm-timeline-container .timeline-segment {\r\n  opacity: 0.7; /* 降低透明度 */\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.arm-timeline-container .timeline-segment:hover {\r\n  opacity: 1; /* 悬停时高亮显示 */\r\n  transform: scale(1.02);\r\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);\r\n  z-index: 10;\r\n}\r\n\r\n/* 网络延时统计卡片样式 */\r\n.network-card {\r\n  margin-top: 20px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.network-summary {\r\n  margin-bottom: 20px;\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 8px;\r\n}\r\n\r\n.network-chart-container {\r\n  width: 100%;\r\n  height: 300px;\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n}\r\n\r\n.network-no-data {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 200px;\r\n  color: #909399;\r\n}\r\n\r\n/* 网络标签样式 */\r\n.network-tag {\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  user-select: none;\r\n}\r\n\r\n.network-tag:hover {\r\n  transform: scale(1.05);\r\n  box-shadow: 0 2px 8px rgba(64, 158, 255, 0.3);\r\n}\r\n\r\n/* PostgreSQL数据预览样式 */\r\n.postgresql-preview-section {\r\n  margin-bottom: 20px;\r\n  border: 1px solid #E4E7ED;\r\n  border-radius: 6px;\r\n  background-color: #FAFAFA;\r\n}\r\n\r\n.preview-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 12px 16px;\r\n  background-color: #F5F7FA;\r\n  border-bottom: 1px solid #E4E7ED;\r\n  border-radius: 6px 6px 0 0;\r\n}\r\n\r\n.preview-title {\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  color: #303133;\r\n}\r\n\r\n.preview-content {\r\n  padding: 16px;\r\n}\r\n\r\n.postgresql-textarea {\r\n  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\r\n  font-size: 12px;\r\n  line-height: 1.4;\r\n  background-color: #FFFFFF;\r\n  border: 1px solid #DCDFE6;\r\n  border-radius: 4px;\r\n}\r\n\r\n.postgresql-textarea :deep(.el-textarea__inner) {\r\n  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\r\n  font-size: 12px;\r\n  line-height: 1.4;\r\n  background-color: #FFFFFF;\r\n  border: 1px solid #DCDFE6;\r\n  border-radius: 4px;\r\n  resize: vertical;\r\n  min-height: 120px;\r\n}\r\n\r\n.preview-actions {\r\n  display: flex;\r\n  gap: 8px;\r\n  margin-top: 12px;\r\n  justify-content: flex-end;\r\n}\r\n\r\n.preview-actions .el-button {\r\n  font-size: 12px;\r\n  padding: 6px 12px;\r\n}\r\n\r\n.preview-actions .el-button .el-icon {\r\n  margin-right: 4px;\r\n}\r\n\r\n/* 数据预览区域的响应式设计 */\r\n@media (max-width: 768px) {\r\n  .preview-header {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n    gap: 8px;\r\n  }\r\n  \r\n  .preview-actions {\r\n    justify-content: flex-start;\r\n    flex-wrap: wrap;\r\n  }\r\n}\r\n</style> ","import { render } from \"./SurgeryStatistics.vue?vue&type=template&id=eff525c6&scoped=true\"\nimport script from \"./SurgeryStatistics.vue?vue&type=script&lang=js\"\nexport * from \"./SurgeryStatistics.vue?vue&type=script&lang=js\"\n\nimport \"./SurgeryStatistics.vue?vue&type=style&index=0&id=eff525c6&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-eff525c6\"]])\n\nexport default __exports__"],"names":["class","surgeries","length","analyzing","logEntriesCount","type","analyzeLogs","loading","disabled","getAnalysisButtonText","activeTab","handleTabClick","lazy","handleBeforeTabLeave","stretch","closable","addable","surgery","key","id","label","surgery_id","name","toString","exportSurgeryData","alarm_count","size","scrollToAlarmCard","style","scrollToNetworkCard","togglePostgreSQLPreview","postgresqlPreviewVisible","postgresqlDataText","rows","readonly","placeholder","copyPostgreSQLData","copyingData","refreshPostgreSQLData","refreshingData","direction","current","getSortedTimelineEvents","event","index","title","description","formatTime","time","header","total_duration","surgery_start_time","surgery_end_time","getSurgeryTimelineStyle","formatTimeShort","getProgressTimelineRange","start","end","getArmUsages","armUsage","plain","toggleArmDetails","getArmTimelineSegments","segment","segmentIndex","content","getSegmentInstrumentName","placement","getGroupedUsagesByUdi","groupedUsage","udiCode","instrumentName","getGroupedUsageDuration","usages","usage","usageIndex","getUsageTimelineStyle","startTime","endTime","Math","floor","Date","getSegmentText","getEnergyTime","armDetailsVisible","data","getInstrumentRows","prop","getAlarmDetails","slice","showAllAlarms","undefined","width","default","row","code","error_code","status","toggleAlarms","getDeduplicatedAlarmStats","activeCount","network_stats","count","avg","min","max","components","DataAnalysis","Download","SwitchButton","Close","VideoPlay","VideoPause","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Calendar","Lightning","Loading","Document","Refresh","setup","route","stateMachineCharts","Map","chartViewRange","chartCurrentTime","getStateToYPositionMap","logEntries","logIdsParam","query","logIds","surgeryData","sessionStorage","getItem","JSON","parse","entries","dataAge","now","timestamp","console","log","removeItem","compressed","decompressedEntries","map","entry","t","e","param1","p1","param2","p2","param3","p3","param4","p4","explanation","exp","log_name","ln","error","value","loadBatchLogEntriesByIds","async","split","parseInt","response","api","surgeryStatistics","analyzeByLogIds","success","taskId","pollTaskResult","forEach","message","maxAttempts","attempts","poll","getAnalysisTaskStatus","task","result","Promise","resolve","setTimeout","getTimeRange","timestamps","minTime","maxTime","dataSize","stringify","maxSize","analysisData","warning","toFixed","sampleSize","step","i","push","analyzeSortedEntries","includePostgreSQLStructure","surgeryId","exportSingleSurgeryData","generatePostgreSQLData","find","s","logId","log_id","logIdArray","trim","surgeriesData","device_ids","start_time","end_time","is_remote","is_remote_surgery","structured_data","postgresql_structure","generateStructuredData","last_analyzed_at","toISOString","created_at","updated_at","powerCycles","power_on_times","shutdown_times","onTimes","offTimes","on_time","off_time","powerOnTime","powerOffTime","arms","arm_id","instrument_usage","tool_type","udi","energy_activation","surgeryStats","has_fault","has_error","network_latency_ms","d","latency","faults","alarm_details","fault","arm_switch_count","left_hand_clutch","hand_clutch_stats","arm1","right_hand_clutch","arm2","foot_clutch","foot_pedal_stats","clutch","endoscope_pedal","camera","power_cycles","surgery_stats","text","navigator","clipboard","writeText","armIndex","alarmCard","document","querySelector","scrollIntoView","behavior","block","boxShadow","transition","networkCard","arm1_usage","arm2_usage","arm3_usage","arm4_usage","grouped","allArms","u","has","set","segments","get","Array","from","values","item","sort","a","b","merged","seg","last","lastEnd","getTime","curStart","curEnd","getArmTotalTime","totalMinutes","filter","reduce","total","duration","getAlarmTypeTag","details","uniqueCount","totalCount","uniqueCodes","Set","isActive","date","year","getFullYear","month","String","getMonth","padStart","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","formatSurgeryTime","toLocaleString","getTimelineRange","warn","getEventTimelineRange","events","getPowerOnTime","getPowerOffTime","surgeryEndTime","getTimePosition","isNaN","position","getTimelineTicks","interval","ticks","mergeOverlappingTimeRanges","timeRanges","next","getArmTimelineStyle","left","completeUsages","mergedTimeRanges","totalWidth","timelineRange","range","startPosition","endPosition","surgeryStartTime","timelineStart","timelineEnd","totalSeconds","power_on_time","power_off_time","getAllPowerOnTimes","getAllPowerOffTimes","powerOnTimes","is_consecutive_surgery","previous_surgery_end_time","displayTime","color","icon","powerOffTimes","getStateChanges","stateMachineChanges","state_machine_changes","stateChanges","currentChange","nextChange","currentState","state","stateCategory","nextState","originalState","stateName","getStateName","stateMap","getStateBarHeight","heightMap","height","getStateBarPosition","clampedPosition","totalDuration","widthPercent","parseFloat","minWidthPerChar","padding","requiredWidth","maxChars","substring","startPercent","endPercent","instrumentsInSegment","usageStart","usageEnd","tab","newTabName","oldTabName","then","resetChartView","chart","dispose","clear","Object","keys","surgeryChartStates","surgeryScrollbarStates","getStateMachineChartData","changes","xMin","xMax","points","rawData","positionMap","changesWithin","lastBefore","ch","startState","y","lastState","getStateMachineChartOptions","surgeryState","currentTime","viewRange","responsive","maintainAspectRatio","interaction","mode","intersect","plugins","legend","display","tooltip","callbacks","context","dataIndex","isCrossDay","toLocaleDateString","toLocaleTimeString","getStateMachineStateName","parsed","scales","x","maxTicksLimit","callback","this","hour","minute","beginAtZero","stepSize","animation","updateStateMachineChart","container","getElementById","existing","_","delete","innerHTML","echarts","reverseMap","k","fiveMinutesMs","initialEnd","setOption","grid","right","top","bottom","containLabel","toolbox","feature","dataZoom","yAxisIndex","restore","saveAsImage","trigger","axisPointer","formatter","params","p","yMapped","xAxisIndex","filterMode","zoomOnMouseWheel","moveOnMouseWheel","moveOnMouseMove","startValue","endValue","showDataShadow","brushSelect","xAxis","axisLabel","second","yAxis","val","original","axisTick","show","splitNumber","series","showSymbol","lineStyle","areaStyle","offset","networkCharts","updateNetworkChart","scale","itemStyle","scrollbarUpdateTrigger","getScrollbarThumbStyle","updateTrigger","totalStartTime","totalEndTime","chartData","viewStartTime","viewEndTime","viewWindowDuration","viewCenterTime","minCenterTime","maxCenterTime","clampedTime","viewDuration","thumbPosition","thumbWidth","clampedWidth","isAtEnd","isAtStart","handleTrackClick","track","currentTarget","rect","getBoundingClientRect","clickX","clientX","trackWidth","clickPercentage","targetTime","newCurrentTime","startScrollbarDrag","preventDefault","stopPropagation","scrollbarState","isDragging","dragStartX","dragStartTime","addEventListener","handleScrollbarDrag","stopScrollbarDrag","deltaX","scrollbarContainer","scrollbarTrack","offsetWidth","dragTimeChange","newCenterTime","removeEventListener","scrollChartLeft","scrollStep","oldTime","newTime","scrollChartRight","canScrollLeft","canScrollRight","canScroll","checkSynchronization","scrollbarStyle","scrollbarInfo","getScrollbarInfo","isShortSurgery","chartDataExists","chartLabels","labels","chartDataPoints","chartStartTime","chartEndTime","scrollbarLeft","scrollbarWidth","finalViewStartTime","finalViewEndTime","startTimeStr","endTimeStr","durationMinutes","actualStartTime","actualEndTime","actualDurationMinutes","newSurgeries","currentSurgery","canvasId","canvas","deep","newTab","autoAnalyze","__exports__","render"],"sourceRoot":""}