"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[394],{1394:function(e,l,a){a.r(l),a.d(l,{default:function(){return v}});var s=a(641),o=a(33);const r={class:"users-container"},t={class:"action-bar"},d={class:"search-section"},u={class:"action-section"},n={class:"action-buttons"},i={class:"pagination-wrapper"};function m(e,l,a,m,c,p){const g=(0,s.g2)("Search"),w=(0,s.g2)("el-icon"),b=(0,s.g2)("el-input"),h=(0,s.g2)("Plus"),k=(0,s.g2)("el-button"),F=(0,s.g2)("el-table-column"),v=(0,s.g2)("el-tag"),f=(0,s.g2)("el-table"),_=(0,s.g2)("el-pagination"),V=(0,s.g2)("el-card"),R=(0,s.g2)("el-form-item"),y=(0,s.g2)("el-option"),P=(0,s.g2)("el-select"),C=(0,s.g2)("el-form"),U=(0,s.g2)("el-dialog"),x=(0,s.g2)("el-switch"),W=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",t,[(0,s.Lk)("div",d,[(0,s.bF)(b,{modelValue:m.searchQuery,"onUpdate:modelValue":l[0]||(l[0]=e=>m.searchQuery=e),placeholder:"搜索用户...",style:{width:"300px"},clearable:"",onInput:m.handleSearch},{prefix:(0,s.k6)(()=>[(0,s.bF)(w,null,{default:(0,s.k6)(()=>[(0,s.bF)(g)]),_:1})]),_:1},8,["modelValue","onInput"])]),(0,s.Lk)("div",u,[(0,s.bF)(k,{type:"primary",onClick:l[1]||(l[1]=e=>m.showAddDialog=!0)},{default:(0,s.k6)(()=>[(0,s.bF)(w,null,{default:(0,s.k6)(()=>[(0,s.bF)(h)]),_:1}),l[23]||(l[23]=(0,s.eW)(" 添加用户 "))]),_:1,__:[23]})])]),(0,s.bF)(V,{class:"list-card"},{default:(0,s.k6)(()=>[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(f,{data:m.users,loading:m.loading,style:{width:"100%"}},{default:(0,s.k6)(()=>[(0,s.bF)(F,{prop:"username",label:"用户名",width:"120"}),(0,s.bF)(F,{prop:"email",label:"邮箱",width:"180"}),(0,s.bF)(F,{prop:"role",label:"账户类型",width:"100"},{default:(0,s.k6)(({row:e})=>[(0,s.bF)(v,null,{default:(0,s.k6)(()=>[(0,s.eW)((0,o.v_)(m.getRoleText(e.role)),1)]),_:2},1024)]),_:1}),(0,s.bF)(F,{prop:"is_active",label:"是否启用",width:"90"},{default:(0,s.k6)(({row:e})=>[(0,s.bF)(v,{type:e.is_active?"success":"danger"},{default:(0,s.k6)(()=>[(0,s.eW)((0,o.v_)(e.is_active?"激活":"禁用"),1)]),_:2},1032,["type"])]),_:1}),(0,s.bF)(F,{prop:"created_at",label:"注册时间",width:"150"}),(0,s.bF)(F,{label:"操作",fixed:"right",width:"260"},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("div",n,[(0,s.bF)(k,{onClick:l=>m.handleEdit(e)},{default:(0,s.k6)(()=>l[24]||(l[24]=[(0,s.eW)("编辑")])),_:2,__:[24]},1032,["onClick"]),(0,s.bF)(k,{onClick:l=>m.openResetPassword(e)},{default:(0,s.k6)(()=>l[25]||(l[25]=[(0,s.eW)("重置密码")])),_:2,__:[25]},1032,["onClick"]),(0,s.bF)(k,{onClick:l=>m.handleDelete(e),type:"danger"},{default:(0,s.k6)(()=>l[26]||(l[26]=[(0,s.eW)("删除")])),_:2,__:[26]},1032,["onClick"])])]),_:1})]),_:1},8,["data","loading"])),[[W,m.loading]]),(0,s.Lk)("div",i,[(0,s.bF)(_,{"current-page":m.currentPage,"page-size":m.pageSize,"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m.handleSizeChange,onCurrentChange:m.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),(0,s.bF)(U,{modelValue:m.showAddDialog,"onUpdate:modelValue":l[9]||(l[9]=e=>m.showAddDialog=e),title:m.editingUser?"编辑用户":"添加用户",width:"500px"},{footer:(0,s.k6)(()=>[(0,s.bF)(k,{onClick:l[8]||(l[8]=e=>m.showAddDialog=!1)},{default:(0,s.k6)(()=>l[27]||(l[27]=[(0,s.eW)("取消")])),_:1,__:[27]}),(0,s.bF)(k,{type:"primary",onClick:m.handleSave,loading:m.saving},{default:(0,s.k6)(()=>l[28]||(l[28]=[(0,s.eW)(" 保存 ")])),_:1,__:[28]},8,["onClick","loading"])]),default:(0,s.k6)(()=>[(0,s.bF)(C,{ref:"userFormRef",model:m.userForm,rules:m.rules,"label-width":"100px"},{default:(0,s.k6)(()=>[(0,s.bF)(R,{label:"用户名",prop:"username"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:m.userForm.username,"onUpdate:modelValue":l[2]||(l[2]=e=>m.userForm.username=e),disabled:!!m.editingUser},null,8,["modelValue","disabled"])]),_:1}),(0,s.bF)(R,{label:"邮箱",prop:"email"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:m.userForm.email,"onUpdate:modelValue":l[3]||(l[3]=e=>m.userForm.email=e)},null,8,["modelValue"])]),_:1}),(0,s.bF)(R,{label:"账户类型",prop:"role"},{default:(0,s.k6)(()=>[m.roles.length?((0,s.uX)(),(0,s.Wv)(P,{key:0,modelValue:m.userForm.role,"onUpdate:modelValue":l[4]||(l[4]=e=>m.userForm.role=e),placeholder:"请选择账户类型"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.roles,e=>((0,s.uX)(),(0,s.Wv)(y,{key:e.id,label:m.getRoleText(e.name),value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(0,s.Q3)("",!0)]),_:1}),m.editingUser?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(R,{key:0,label:"密码",prop:"password"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:m.userForm.password,"onUpdate:modelValue":l[5]||(l[5]=e=>m.userForm.password=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),m.editingUser?((0,s.uX)(),(0,s.Wv)(R,{key:1,label:"新密码",prop:"password"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:m.userForm.password,"onUpdate:modelValue":l[6]||(l[6]=e=>m.userForm.password=e),type:"password","show-password":"",placeholder:"如需修改请输入新密码"},null,8,["modelValue"])]),_:1})):(0,s.Q3)("",!0),(0,s.bF)(R,{label:"状态",prop:"status"},{default:(0,s.k6)(()=>[(0,s.bF)(P,{modelValue:m.userForm.status,"onUpdate:modelValue":l[7]||(l[7]=e=>m.userForm.status=e),placeholder:"选择状态"},{default:(0,s.k6)(()=>[(0,s.bF)(y,{label:"激活",value:"active"}),(0,s.bF)(y,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),(0,s.bF)(U,{modelValue:m.showRoleDialog,"onUpdate:modelValue":l[12]||(l[12]=e=>m.showRoleDialog=e),title:"分配角色",width:"400px"},{footer:(0,s.k6)(()=>[(0,s.bF)(k,{onClick:l[11]||(l[11]=e=>m.showRoleDialog=!1)},{default:(0,s.k6)(()=>l[29]||(l[29]=[(0,s.eW)("取消")])),_:1,__:[29]}),(0,s.bF)(k,{type:"primary",onClick:m.handleSaveRole,loading:m.savingRole},{default:(0,s.k6)(()=>l[30]||(l[30]=[(0,s.eW)(" 保存 ")])),_:1,__:[30]},8,["onClick","loading"])]),default:(0,s.k6)(()=>[(0,s.bF)(C,{"label-width":"100px"},{default:(0,s.k6)(()=>[(0,s.bF)(R,{label:"用户"},{default:(0,s.k6)(()=>[(0,s.Lk)("span",null,(0,o.v_)(m.selectedUser?.username),1)]),_:1}),(0,s.bF)(R,{label:"角色"},{default:(0,s.k6)(()=>[(0,s.bF)(P,{modelValue:m.selectedRole,"onUpdate:modelValue":l[10]||(l[10]=e=>m.selectedRole=e),placeholder:"选择角色"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.roles,e=>((0,s.uX)(),(0,s.Wv)(y,{key:e.id,label:m.getRoleText(e.name),value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,s.bF)(U,{modelValue:m.showEditDialog,"onUpdate:modelValue":l[17]||(l[17]=e=>m.showEditDialog=e),title:"编辑用户",width:"400px"},{footer:(0,s.k6)(()=>[(0,s.bF)(k,{onClick:l[16]||(l[16]=e=>m.showEditDialog=!1)},{default:(0,s.k6)(()=>l[31]||(l[31]=[(0,s.eW)("取消")])),_:1,__:[31]}),(0,s.bF)(k,{type:"primary",onClick:e.handleSaveEdit},{default:(0,s.k6)(()=>l[32]||(l[32]=[(0,s.eW)("保存")])),_:1,__:[32]},8,["onClick"])]),default:(0,s.k6)(()=>[(0,s.bF)(C,{model:e.editForm,"label-width":"100px"},{default:(0,s.k6)(()=>[(0,s.bF)(R,{label:"邮箱"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:e.editForm.email,"onUpdate:modelValue":l[13]||(l[13]=l=>e.editForm.email=l)},null,8,["modelValue"])]),_:1}),(0,s.bF)(R,{label:"账户类型"},{default:(0,s.k6)(()=>[(0,s.bF)(P,{modelValue:e.editForm.role,"onUpdate:modelValue":l[14]||(l[14]=l=>e.editForm.role=l)},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.roles,e=>((0,s.uX)(),(0,s.Wv)(y,{key:e.id,label:m.getRoleText(e.name),value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(R,{label:"是否启用"},{default:(0,s.k6)(()=>[(0,s.bF)(x,{modelValue:e.editForm.is_active,"onUpdate:modelValue":l[15]||(l[15]=l=>e.editForm.is_active=l),"active-text":"激活","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,s.bF)(U,{modelValue:m.showResetPasswordDialog,"onUpdate:modelValue":l[22]||(l[22]=e=>m.showResetPasswordDialog=e),title:"重置密码",width:"400px"},{footer:(0,s.k6)(()=>[(0,s.bF)(k,{onClick:l[21]||(l[21]=e=>m.showResetPasswordDialog=!1)},{default:(0,s.k6)(()=>l[33]||(l[33]=[(0,s.eW)("取消")])),_:1,__:[33]}),(0,s.bF)(k,{type:"primary",onClick:m.handleResetPassword,loading:m.resettingPassword},{default:(0,s.k6)(()=>l[34]||(l[34]=[(0,s.eW)("确定")])),_:1,__:[34]},8,["onClick","loading"])]),default:(0,s.k6)(()=>[(0,s.bF)(C,{model:m.resetPasswordForm,rules:m.resetPasswordRules,ref:"resetPasswordFormRef","label-width":"100px"},{default:(0,s.k6)(()=>[(0,s.bF)(R,{label:"原密码",prop:"oldPassword"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:m.resetPasswordForm.oldPassword,"onUpdate:modelValue":l[18]||(l[18]=e=>m.resetPasswordForm.oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),(0,s.bF)(R,{label:"新密码",prop:"newPassword"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:m.resetPasswordForm.newPassword,"onUpdate:modelValue":l[19]||(l[19]=e=>m.resetPasswordForm.newPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),(0,s.bF)(R,{label:"确认新密码",prop:"confirmPassword"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:m.resetPasswordForm.confirmPassword,"onUpdate:modelValue":l[20]||(l[20]=e=>m.resetPasswordForm.confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}var c=a(953),p=a(6278),g=a(5220),w=a(163),b=a(7918),h={name:"Users",setup(){const e=(0,p.Pj)(),l=(0,g.rd)(),a=(0,c.KR)(!1),o=(0,c.KR)(!1),r=(0,c.KR)(!1),t=(0,c.KR)(!1),d=(0,c.KR)(!1),u=(0,c.KR)(null),n=(0,c.KR)(null),i=(0,c.KR)(""),m=(0,c.KR)(1),h=(0,c.KR)(20),k=(0,c.KR)(""),F=(0,c.KR)(!1);const v=()=>({username:"",email:"",password:"",status:"active",role:""}),f=(0,c.KR)(v()),_={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于 6 个字符",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],role:[{required:!0,message:"请选择账户类型",trigger:"change"}]},V=(0,s.EW)(()=>e.getters["users/usersList"]),R=(0,c.KR)([]),y=(0,s.EW)(()=>e.getters["users/totalCount"]),P=(0,s.EW)(()=>e.getters["auth/userRole"]),C=async()=>{try{a.value=!0,await e.dispatch("users/fetchUsers",{page:m.value,limit:h.value,search:i.value})}catch(l){w.nk.error("加载用户失败")}finally{a.value=!1}},U=async()=>{try{await e.dispatch("users/fetchRoles");R.value=e.getters["users/rolesList"]}catch(l){w.nk.error("加载角色失败")}},x=()=>{m.value=1,C()},W=e=>{h.value=e,m.value=1,C()},D=e=>{m.value=e,C()},K=()=>{f.value=v(),u.value=null},E=e=>{u.value=e,f.value=v(),f.value.username=e.username,f.value.email=e.email,f.value.status=e.status,f.value.role=e.role,t.value=!0},S=async l=>{try{await b.s.confirm("确定要删除这个用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await e.dispatch("users/deleteUser",l.id),w.nk.success("删除成功"),C()}catch(a){"cancel"!==a&&w.nk.error("删除失败")}},z=async()=>{try{o.value=!0;const l={...f.value};if(u.value&&!f.value.password&&delete l.password,l.role){const e=R.value.find(e=>e.name===l.role);e&&(l.roles=[e.id]),delete l.role}u.value?(await e.dispatch("users/updateUser",{id:u.value.id,data:l}),w.nk.success("更新成功")):(await e.dispatch("users/createUser",l),w.nk.success("添加成功")),t.value=!1,K(),C()}catch(l){w.nk.error("保存失败")}finally{o.value=!1}},X=e=>{n.value=e,k.value=e.roleId||"",d.value=!0},L=async()=>{try{r.value=!0,await e.dispatch("users/assignUserRole",n.value.id,k.value),w.nk.success("角色分配成功"),d.value=!1,C()}catch(l){w.nk.error("角色分配失败")}finally{r.value=!1}},T=e=>{const l={admin:"danger",expert:"warning",user:"info"};return l[e]||"info"},q=e=>{const l={admin:"管理员",expert:"专家用户",user:"普通用户"};return l[e]||e},A=e=>e?new Date(e).toLocaleString("zh-CN"):"-";(0,s.sV)(()=>{"admin"===P.value?(C(),U()):l.replace("/dashboard/account")});const I=(0,c.KR)(!1),Q=(0,c.Kh)({oldPassword:"",newPassword:"",confirmPassword:""}),j=(0,c.KR)(!1),B=(0,c.KR)(null);let N=null;const G={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于 6 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(e,l,a)=>{l!==Q.newPassword?a(new Error("两次输入的新密码不一致")):a()},trigger:"blur"}]},H=e=>{N=e.id,Q.oldPassword="",Q.newPassword="",Q.confirmPassword="",I.value=!0},J=async()=>{await B.value.validate(),j.value=!0;try{await e.dispatch("users/updateUser",{id:N,data:{oldPassword:Q.oldPassword,password:Q.newPassword}}),w.nk.success("密码重置成功"),I.value=!1,C()}catch(l){w.nk.error(l.response?.data?.message||"密码重置失败")}finally{j.value=!1}};return{loading:a,saving:o,savingRole:r,showAddDialog:t,showRoleDialog:d,editingUser:u,selectedUser:n,searchQuery:i,currentPage:m,pageSize:h,selectedRole:k,userForm:f,rules:_,users:V,roles:R,total:y,handleSearch:x,handleSizeChange:W,handleCurrentChange:D,handleEdit:E,handleDelete:S,handleSave:z,handleAssignRole:X,handleSaveRole:L,getRoleType:T,getRoleText:q,formatDate:A,showEditDialog:F,showResetPasswordDialog:I,resetPasswordForm:Q,resettingPassword:j,resetPasswordFormRef:B,resetPasswordRules:G,openResetPassword:H,handleResetPassword:J}}},k=a(6262);const F=(0,k.A)(h,[["render",m],["__scopeId","data-v-eaf83f9c"]]);var v=F}}]);
//# sourceMappingURL=394.206695aa.js.map