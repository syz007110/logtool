{"version":3,"file":"js/135.7e9d4b40.js","mappings":"0MACOA,MAAM,e,GAEFA,MAAM,c,SAWUA,MAAM,a,sHAb/B,QAqBM,MArBN,EAqBM,EApBJ,QAiBU,GAjBDA,MAAM,eAAa,C,iBAC1B,IAUM,EAVN,QAUM,MAVN,EAUM,EATJ,QAOY,GANVC,OAAO,GACN,eAAc,EAAAC,oBACd,kBAAgB,EACjBC,OAAO,Q,kBAEP,IAAmD,EAAnD,QAAmD,GAAxCC,KAAK,WAAS,C,iBAAC,IAAa,c,QAAb,oB,yCAE5B,QAA2E,GAA/DC,UAAW,EAAAC,OAAS,QAAO,EAAAC,YAAaC,MAAA,I,kBAAM,IAAK,c,QAAL,Y,wCAEjD,EAAQ,W,WAAnB,QAIM,MAJN,EAIM,EAHJ,QAA+B,YAAzB,QAAI,QAAG,EAAAC,UAAQ,IACrB,QAA2C,YAArC,QAAI,QAAG,EAAAC,WAAW,EAAAC,WAAQ,IAChC,QAAoC,YAA9B,SAAK,QAAG,EAAAC,cAAY,O,yDAclC,GACEC,KAAM,aACN,KAAAC,GACE,MAAMR,GAAS,QAAI,IACbG,GAAW,QAAI,IACfE,GAAW,QAAI,GACfC,GAAe,QAAI,GACnBG,GAAc,QAAI,GAClBC,GAAW,QAAI,KACfC,GAAO,QAAI,IACXC,GAAU,QAAI,IAIdR,EAAcS,GACdA,EAAO,KAAa,GAAGA,MACvBA,EAAO,QAAoB,IAAIA,EAAO,MAAMC,QAAQ,QACpDD,EAAO,WAA2B,IAAIA,EAAO,KAAO,MAAMC,QAAQ,QAC/D,IAAID,EAAO,KAAO,KAAO,MAAMC,QAAQ,QAG1ClB,EAAsBmB,OAASC,OAAMC,YAAWC,cACpD,IACE,MAAMC,EAAO,IAAIC,SACjBD,EAAKE,OAAO,OAAQL,GACpB,MAAM,KAAEM,SAAeC,EAAA,EAAIC,WAAWC,OAAON,GAC7CnB,EAAO0B,MAAQJ,EAAKK,GACpBxB,EAASuB,MAAQJ,EAAKM,SACtBvB,EAASqB,MAAQJ,EAAKT,KACtBJ,EAAYiB,MAAQ,QACdG,EAAa,GACfZ,GAAWA,EAAUK,EAC3B,CAAE,MAAOQ,GACP,KAAUC,MAAM,QACZb,GAASA,EAAQY,EACvB,GAGIE,EAAcjB,UAClB,MAAM,KAAEO,SAAeC,EAAA,EAAIC,WAAWS,YACtCrB,EAAQc,MAAQJ,EAAKV,SAGjBsB,GAAgB,QAAI,KAC1B,QAAMtB,EAAS,KACb,MAAMuB,EAAS,CACb,gBACGC,MAAMC,KAAK,CAAEC,OAAQ,GAAK,CAACC,EAAGC,IAAM,aAAaA,QACjDJ,MAAMC,KAAK,CAAEC,OAAQ,GAAK,CAACC,EAAGC,IAAM,aAAaA,EAAI,QACrDJ,MAAMC,KAAK,CAAEC,OAAQ,GAAK,CAACC,EAAGC,IAAM,aAAaA,EAAI,SACrDJ,MAAMC,KAAK,CAAEC,OAAQ,GAAK,CAACC,EAAGC,IAAM,aAAaA,EAAI,MACxD,eAAe,eAAe,eAC9B,eAAe,eAAe,gBAEhCN,EAAcR,MAAQd,EAAQc,MAAMe,OAAOC,GAAKP,EAAOQ,SAASD,EAAEE,UAGpE,MAAMf,EAAed,MAAO8B,EAAOpC,EAAYiB,SAC7C,IAAK1B,EAAO0B,MAAO,OACnB,MAAMoB,GAAUD,EAAO,GAAKnC,EAASgB,OAC/B,KAAEJ,SAAeC,EAAA,EAAIC,WAAWuB,QAAQ/C,EAAO0B,MAAO,CAAEoB,SAAQE,MAAOtC,EAASgB,QACtFf,EAAKe,MAAQJ,EAAKX,KAClBL,EAAaoB,MAAQJ,EAAKhB,cAGtBL,EAAcc,UAClB,GAAKf,EAAO0B,MACZ,IACE,MAAM,KAAEJ,SAAeC,EAAA,EAAIC,WAAWvB,YAAYD,EAAO0B,OACnDuB,EAAO3B,aAAgB4B,KAAO5B,EAAO,IAAI4B,KAAK,CAAC5B,GAAO,CAAExB,KAAM,2BAC9DqD,EAAMC,IAAIC,gBAAgBJ,GAC1BK,EAAIC,SAASC,cAAc,KACjCF,EAAEG,KAAON,EACTG,EAAEI,UAAYvD,EAASuB,OAAOiC,QAAQ,UAAW,KAAO,UAAY,OACpEL,EAAEM,QACFR,IAAIS,gBAAgBV,EACtB,CAAE,MAAOW,GACP,KAAU/B,MAAM,OAClB,GAOF,OAJA,QAAUhB,gBACFiB,MAGD,CACLhC,SAAQG,WAAUE,WAAUC,eAAcG,cAAaC,WAAUC,OAAMuB,gBACvEtC,sBAAqBiC,eAAc5B,cAAaG,aAEpD,G,UCjHF,MAAM2D,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAEzF,O","sources":["webpack://logtool-frontend/./src/views/DataReplay.vue","webpack://logtool-frontend/./src/views/DataReplay.vue?4b80"],"sourcesContent":["<template>\r\n  <div class=\"data-replay\">\r\n    <el-card class=\"upload-card\">\r\n      <div class=\"upload-row\">\r\n        <el-upload\r\n          action=\"\"\r\n          :http-request=\"handleUploadRequest\"\r\n          :show-file-list=\"false\"\r\n          accept=\".bin\"\r\n        >\r\n          <el-button type=\"primary\">上传二进制文件(.bin)</el-button>\r\n        </el-upload>\r\n        <el-button :disabled=\"!fileId\" @click=\"downloadCsv\" plain>下载CSV</el-button>\r\n      </div>\r\n      <div v-if=\"fileName\" class=\"file-meta\">\r\n        <span>文件: {{ fileName }}</span>\r\n        <span>大小: {{ prettySize(fileSize) }}</span>\r\n        <span>总条数: {{ totalEntries }}</span>\r\n      </div>\r\n    </el-card>\r\n\r\n    \r\n  </div>\r\n  \r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, watch } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport api from '../api'\r\n\r\nexport default {\r\n  name: 'DataReplay',\r\n  setup() {\r\n    const fileId = ref('')\r\n    const fileName = ref('')\r\n    const fileSize = ref(0)\r\n    const totalEntries = ref(0)\r\n    const currentPage = ref(1)\r\n    const pageSize = ref(500)\r\n    const rows = ref([])\r\n    const columns = ref([])\r\n\r\n    // charts removed for now\r\n\r\n    const prettySize = (size) => {\r\n      if (size < 1024) return `${size} B`\r\n      if (size < 1024 * 1024) return `${(size / 1024).toFixed(1)} KB`\r\n      if (size < 1024 * 1024 * 1024) return `${(size / 1024 / 1024).toFixed(1)} MB`\r\n      return `${(size / 1024 / 1024 / 1024).toFixed(1)} GB`\r\n    }\r\n\r\n    const handleUploadRequest = async ({ file, onSuccess, onError }) => {\r\n      try {\r\n        const form = new FormData()\r\n        form.append('file', file)\r\n        const { data } = await api.motionData.upload(form)\r\n        fileId.value = data.id\r\n        fileName.value = data.filename\r\n        fileSize.value = data.size\r\n        currentPage.value = 1\r\n        await fetchPreview(1)\r\n        if (onSuccess) onSuccess(data)\r\n      } catch (err) {\r\n        ElMessage.error('上传失败')\r\n        if (onError) onError(err)\r\n      }\r\n    }\r\n\r\n    const fetchConfig = async () => {\r\n      const { data } = await api.motionData.getConfig()\r\n      columns.value = data.columns\r\n    }\r\n\r\n    const columnsToShow = ref([])\r\n    watch(columns, () => {\r\n      const wanted = [\r\n        'ulint_data',\r\n        ...Array.from({ length: 7 }, (_, i) => `real_data_${i}`),\r\n        ...Array.from({ length: 7 }, (_, i) => `real_data_${i + 7}`),\r\n        ...Array.from({ length: 7 }, (_, i) => `real_data_${i + 42}`),\r\n        ...Array.from({ length: 7 }, (_, i) => `real_data_${i + 49}`),\r\n        'real_data_18','real_data_19','real_data_20',\r\n        'real_data_25','real_data_26','real_data_27',\r\n      ]\r\n      columnsToShow.value = columns.value.filter(c => wanted.includes(c.index))\r\n    })\r\n\r\n    const fetchPreview = async (page = currentPage.value) => {\r\n      if (!fileId.value) return\r\n      const offset = (page - 1) * pageSize.value\r\n      const { data } = await api.motionData.preview(fileId.value, { offset, limit: pageSize.value })\r\n      rows.value = data.rows\r\n      totalEntries.value = data.totalEntries\r\n    }\r\n\r\n    const downloadCsv = async () => {\r\n      if (!fileId.value) return\r\n      try {\r\n        const { data } = await api.motionData.downloadCsv(fileId.value)\r\n        const blob = data instanceof Blob ? data : new Blob([data], { type: 'text/csv;charset=utf-8' })\r\n        const url = URL.createObjectURL(blob)\r\n        const a = document.createElement('a')\r\n        a.href = url\r\n        a.download = (fileName.value?.replace(/\\.bin$/i, '') || 'motion') + '.csv'\r\n        a.click()\r\n        URL.revokeObjectURL(url)\r\n      } catch (e) {\r\n        ElMessage.error('下载失败')\r\n      }\r\n    }\r\n\r\n    onMounted(async () => {\r\n      await fetchConfig()\r\n    })\r\n\r\n    return {\r\n      fileId, fileName, fileSize, totalEntries, currentPage, pageSize, rows, columnsToShow,\r\n      handleUploadRequest, fetchPreview, downloadCsv, prettySize\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.data-replay { display: flex; flex-direction: column; gap: 16px; }\r\n.upload-card .upload-row { display: flex; gap: 12px; align-items: center; }\r\n.file-meta { margin-top: 8px; display: flex; gap: 16px; color: #666; }\r\n</style>\r\n \r\n","import { render } from \"./DataReplay.vue?vue&type=template&id=05f9acbc&scoped=true\"\nimport script from \"./DataReplay.vue?vue&type=script&lang=js\"\nexport * from \"./DataReplay.vue?vue&type=script&lang=js\"\n\nimport \"./DataReplay.vue?vue&type=style&index=0&id=05f9acbc&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-05f9acbc\"]])\n\nexport default __exports__"],"names":["class","action","handleUploadRequest","accept","type","disabled","fileId","downloadCsv","plain","fileName","prettySize","fileSize","totalEntries","name","setup","currentPage","pageSize","rows","columns","size","toFixed","async","file","onSuccess","onError","form","FormData","append","data","api","motionData","upload","value","id","filename","fetchPreview","err","error","fetchConfig","getConfig","columnsToShow","wanted","Array","from","length","_","i","filter","c","includes","index","page","offset","preview","limit","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","replace","click","revokeObjectURL","e","__exports__","render"],"sourceRoot":""}