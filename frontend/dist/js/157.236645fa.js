"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[157],{9157:function(e,t,l){l.r(t),l.d(t,{default:function(){return f}});var a=l(641),s=l(33);const o={class:"history-container"},i={class:"card-header"},r={class:"pagination-wrapper"},n={key:0},d={key:0,class:"details-section"};function u(e,t,l,u,c,g){const p=(0,a.g2)("Refresh"),h=(0,a.g2)("el-icon"),b=(0,a.g2)("el-button"),y=(0,a.g2)("el-table-column"),f=(0,a.g2)("el-tag"),v=(0,a.g2)("el-table"),_=(0,a.g2)("el-pagination"),k=(0,a.g2)("el-card"),m=(0,a.g2)("el-descriptions-item"),w=(0,a.g2)("el-descriptions"),F=(0,a.g2)("el-dialog"),C=(0,a.gN)("loading");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.bF)(k,null,{header:(0,a.k6)(()=>[(0,a.Lk)("div",i,[(0,a.Lk)("span",null,(0,s.v_)(e.$t("history.title")),1),(0,a.bF)(b,{type:"primary",size:"small",onClick:u.loadHistory},{default:(0,a.k6)(()=>[(0,a.bF)(h,null,{default:(0,a.k6)(()=>[(0,a.bF)(p)]),_:1}),(0,a.eW)(" "+(0,s.v_)(e.$t("common.refresh")),1)]),_:1},8,["onClick"])])]),default:(0,a.k6)(()=>[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(v,{data:u.historyList,loading:u.loading,style:{width:"100%"}},{default:(0,a.k6)(()=>[(0,a.bF)(y,{prop:"operation",label:e.$t("history.operation"),width:"150"},null,8,["label"]),(0,a.bF)(y,{prop:"description",label:e.$t("history.description"),"show-overflow-tooltip":""},null,8,["label"]),(0,a.bF)(y,{prop:"user",label:e.$t("history.user"),width:"120"},null,8,["label"]),(0,a.bF)(y,{prop:"time",label:e.$t("history.time"),width:"180"},{default:(0,a.k6)(({row:e})=>[(0,a.eW)((0,s.v_)(u.formatDate(e.time)),1)]),_:1},8,["label"]),(0,a.bF)(y,{prop:"status",label:e.$t("history.status"),width:"100"},{default:(0,a.k6)(({row:t})=>[(0,a.bF)(f,{type:u.getStatusType(t.status)},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(e.$t(u.getStatusText(t.status))),1)]),_:2},1032,["type"])]),_:1},8,["label"]),(0,a.bF)(y,{label:e.$t("history.details"),width:"100",fixed:"right"},{default:(0,a.k6)(({row:t})=>[(0,a.bF)(b,{size:"small",type:"primary",onClick:e=>u.showDetails(t)},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(e.$t("history.view")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data","loading"])),[[C,u.loading]]),(0,a.Lk)("div",r,[(0,a.bF)(_,{"current-page":u.currentPage,"page-size":u.pageSize,"page-sizes":[10,20,50,100],total:u.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u.handleSizeChange,onCurrentChange:u.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),(0,a.bF)(F,{modelValue:u.showDetailsDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>u.showDetailsDialog=e),title:e.$t("history.details"),width:"600px"},{default:(0,a.k6)(()=>[u.selectedRecord?((0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(w,{column:1,border:""},{default:(0,a.k6)(()=>[(0,a.bF)(m,{label:e.$t("history.operation")},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(u.selectedRecord.operation),1)]),_:1},8,["label"]),(0,a.bF)(m,{label:e.$t("history.description")},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(u.selectedRecord.description),1)]),_:1},8,["label"]),(0,a.bF)(m,{label:e.$t("history.user")},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(u.selectedRecord.user),1)]),_:1},8,["label"]),(0,a.bF)(m,{label:e.$t("history.time")},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(u.formatDate(u.selectedRecord.time)),1)]),_:1},8,["label"]),(0,a.bF)(m,{label:e.$t("history.status")},{default:(0,a.k6)(()=>[(0,a.bF)(f,{type:u.getStatusType(u.selectedRecord.status)},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(e.$t(u.getStatusText(u.selectedRecord.status))),1)]),_:1},8,["type"])]),_:1},8,["label"]),(0,a.bF)(m,{label:e.$t("history.ip")},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(u.selectedRecord.ip||"-"),1)]),_:1},8,["label"]),(0,a.bF)(m,{label:e.$t("history.userAgent")},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(u.selectedRecord.userAgent||"-"),1)]),_:1},8,["label"])]),_:1}),u.selectedRecord.details?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("h4",null,(0,s.v_)(e.$t("history.moreDetails")),1),(0,a.Lk)("pre",null,(0,s.v_)(JSON.stringify(u.selectedRecord.details,null,2)),1)])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)]),_:1},8,["modelValue","title"])])}var c=l(953),g=l(163),p=l(5495),h={name:"History",setup(){const e=(0,c.KR)(!1),t=(0,c.KR)(1),l=(0,c.KR)(20),s=(0,c.KR)(0),o=(0,c.KR)([]),i=(0,c.KR)(!1),r=(0,c.KR)(null),n=async()=>{try{e.value=!0;const a=await p.A.operationLogs.getList({page:t.value,limit:l.value});o.value=a.data.logs||[],s.value=a.data.total||0}catch(a){console.error("加载历史记录失败:",a),g.nk.error("加载历史记录失败")}finally{e.value=!1}},d=e=>{l.value=e,t.value=1,n()},u=e=>{t.value=e,n()},h=e=>{r.value=e,i.value=!0},b=e=>e?new Date(e).toLocaleString("zh-CN"):"-",y=e=>{const t={success:"success",failed:"danger",pending:"warning"};return t[e]||"info"},f=e=>{const t={success:"history.statusSuccess",failed:"history.statusFailed",pending:"history.statusPending"};return t[e]||e};return(0,a.sV)(()=>{n()}),{loading:e,currentPage:t,pageSize:l,total:s,historyList:o,showDetailsDialog:i,selectedRecord:r,loadHistory:n,handleSizeChange:d,handleCurrentChange:u,showDetails:h,formatDate:b,getStatusType:y,getStatusText:f}}},b=l(6262);const y=(0,b.A)(h,[["render",u],["__scopeId","data-v-8f49e7d8"]]);var f=y}}]);
//# sourceMappingURL=157.236645fa.js.map