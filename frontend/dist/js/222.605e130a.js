"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[222],{4222:function(e,a,t){t.r(a),t.d(a,{default:function(){return C}});var l=t(641),r=t(33);const n={class:"log-detail-container"},o={class:"loading-content"},s={class:"loading-text"},i={class:"card-header"},d={class:"header-left"},u={class:"header-right"},g={class:"log-info"},p={class:"entries-section"},c={class:"section-header"},f={class:"header-actions"},m={class:"pagination-wrapper"};function v(e,a,t,v,h,b){const _=(0,l.g2)("el-progress"),k=(0,l.g2)("el-card"),w=(0,l.g2)("el-button"),S=(0,l.g2)("el-tag"),y=(0,l.g2)("el-descriptions-item"),F=(0,l.g2)("el-descriptions"),C=(0,l.g2)("Search"),L=(0,l.g2)("el-icon"),z=(0,l.g2)("el-input"),I=(0,l.g2)("Download"),x=(0,l.g2)("DataAnalysis"),D=(0,l.g2)("el-table-column"),W=(0,l.g2)("el-table"),E=(0,l.g2)("el-pagination"),R=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",n,[v.loading?((0,l.uX)(),(0,l.Wv)(k,{key:0,class:"loading-card"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",o,[(0,l.bF)(_,{percentage:v.loadingProgress,status:v.loadingProgress>=100?"success":"","stroke-width":8},null,8,["percentage","status"]),(0,l.Lk)("p",s,"正在加载日志内容... "+(0,r.v_)(v.loadingProgress)+"%",1)])]),_:1})):(0,l.Q3)("",!0),(0,l.bF)(k,{class:"detail-card"},{header:(0,l.k6)(()=>[(0,l.Lk)("div",i,[(0,l.Lk)("div",d,[(0,l.bF)(w,{onClick:v.goBack,icon:"ArrowLeft",size:"small"},{default:(0,l.k6)(()=>a[1]||(a[1]=[(0,l.eW)(" 返回 ")])),_:1,__:[1]},8,["onClick"]),a[2]||(a[2]=(0,l.Lk)("span",{class:"title"},"日志详情",-1))]),(0,l.Lk)("div",u,[(0,l.bF)(S,{type:v.getStatusType(v.logInfo.status),size:"small"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(v.getStatusText(v.logInfo.status)),1)]),_:1},8,["type"])])])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",g,[(0,l.bF)(F,{column:3,border:""},{default:(0,l.k6)(()=>[(0,l.bF)(y,{label:"文件名"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(v.logInfo.original_name),1)]),_:1}),(0,l.bF)(y,{label:"设备编号"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(v.logInfo.device_id),1)]),_:1}),(0,l.bF)(y,{label:"文件大小"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(v.formatFileSize(v.logInfo.size)),1)]),_:1}),(0,l.bF)(y,{label:"上传时间"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(v.formatDate(v.logInfo.upload_time)),1)]),_:1}),(0,l.bF)(y,{label:"解析时间"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(v.formatDate(v.logInfo.parse_time)),1)]),_:1}),(0,l.bF)(y,{label:"上传用户ID"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(v.logInfo.uploader_id),1)]),_:1})]),_:1})]),(0,l.Lk)("div",p,[(0,l.Lk)("div",c,[(0,l.Lk)("h3",null,"日志条目 ("+(0,r.v_)(v.logEntries.length)+")",1),(0,l.Lk)("div",f,[(0,l.bF)(z,{modelValue:v.searchKeyword,"onUpdate:modelValue":a[0]||(a[0]=e=>v.searchKeyword=e),placeholder:"搜索释义内容或故障码",style:{width:"300px","margin-right":"10px"},clearable:"",onInput:v.filterEntries},{prefix:(0,l.k6)(()=>[(0,l.bF)(L,null,{default:(0,l.k6)(()=>[(0,l.bF)(C)]),_:1})]),_:1},8,["modelValue","onInput"]),(0,l.bF)(w,{onClick:v.exportToCSV,type:"success",size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(L,null,{default:(0,l.k6)(()=>[(0,l.bF)(I)]),_:1}),a[3]||(a[3]=(0,l.eW)(" 导出CSV "))]),_:1,__:[3]},8,["onClick"]),(0,l.bF)(w,{onClick:v.goToSurgeryAnalysis,type:"primary",size:"small",style:{"margin-left":"10px"}},{default:(0,l.k6)(()=>[(0,l.bF)(L,null,{default:(0,l.k6)(()=>[(0,l.bF)(x)]),_:1}),a[4]||(a[4]=(0,l.eW)(" 手术统计 "))]),_:1,__:[4]},8,["onClick"])])]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(W,{data:v.paginatedEntries,style:{width:"100%"},height:"600",stripe:""},{default:(0,l.k6)(()=>[(0,l.bF)(D,{prop:"timestamp",label:"时间戳",width:"180",sortable:""},{default:(0,l.k6)(({row:e})=>[(0,l.eW)((0,r.v_)(v.formatTimestamp(e.timestamp)),1)]),_:1}),(0,l.bF)(D,{prop:"error_code",label:"故障码",width:"120",sortable:""}),(0,l.bF)(D,{prop:"param1",label:"参数1",width:"100"}),(0,l.bF)(D,{prop:"param2",label:"参数2",width:"100"}),(0,l.bF)(D,{prop:"param3",label:"参数3",width:"100"}),(0,l.bF)(D,{prop:"param4",label:"参数4",width:"100"}),(0,l.bF)(D,{prop:"explanation",label:"释义","min-width":"300","show-overflow-tooltip":""})]),_:1},8,["data"])),[[R,v.loading]]),(0,l.Lk)("div",m,[(0,l.bF)(E,{"current-page":v.currentPage,"page-size":v.pageSize,"page-sizes":[50,100,200,500],total:v.filteredEntries.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v.handleSizeChange,onCurrentChange:v.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),_:1})])}var h=t(953),b=t(6278),_=t(5220),k=t(163),w=t(8548),S={name:"LogDetail",components:{Search:w.Search,Download:w.Download,ArrowLeft:w.ArrowLeft,DataAnalysis:w.DataAnalysis},setup(){const e=(0,b.Pj)(),a=(0,_.lq)(),t=(0,_.rd)(),r=a.params.id,n=(0,h.KR)(!1),o=(0,h.KR)(0),s=(0,h.KR)({}),i=(0,h.KR)([]),d=(0,h.KR)(""),u=(0,h.KR)(1),g=(0,h.KR)(100),p=(0,l.EW)(()=>d.value?i.value.filter(e=>e.explanation.toLowerCase().includes(d.value.toLowerCase())||e.error_code.toLowerCase().includes(d.value.toLowerCase())):i.value),c=(0,l.EW)(()=>{const e=(u.value-1)*g.value,a=e+g.value;return p.value.slice(e,a)}),f=async()=>{try{n.value=!0;const a=await e.dispatch("logs/fetchLogs",{page:1,limit:1e3}),t=a.data.logs.find(e=>e.id==r);t?s.value=t:(k.nk.error("日志不存在"),F())}catch(a){k.nk.error("加载日志信息失败")}finally{n.value=!1}},m=async()=>{try{n.value=!0,o.value=0;const a=setInterval(()=>{o.value<90&&(o.value+=10)},100),t=await e.dispatch("logs/fetchLogEntries",r);i.value=t.data?.entries||t.entries||[],clearInterval(a),o.value=100,setTimeout(()=>{n.value=!1,o.value=0},500)}catch(a){k.nk.error("加载日志条目失败"),n.value=!1,o.value=0}},v=()=>{u.value=1},w=()=>{const e=["时间戳","故障码","参数1","参数2","参数3","参数4","释义"],a=[e.join(","),...p.value.map(e=>[x(e.timestamp),e.error_code,e.param1,e.param2,e.param3,e.param4,`"${e.explanation.replace(/"/g,'""')}"`].join(","))].join("\n"),t=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(t),l.download=`${s.value.original_name}_entries.csv`,l.click(),URL.revokeObjectURL(l.href),k.nk.success("CSV文件导出成功")},S=e=>{g.value=e,u.value=1},y=e=>{u.value=e},F=()=>{t.go(-1)},C=()=>{const e={logId:r,logName:s.value.original_name,entries:i.value,totalCount:i.value.length,timeRange:{start:i.value.length>0?i.value[0].timestamp:null,end:i.value.length>0?i.value[i.value.length-1].timestamp:null}},a=L(e.entries);sessionStorage.setItem("surgeryAnalysisData",JSON.stringify({...e,entries:a,compressed:!0,timestamp:Date.now()})),sessionStorage.setItem("autoAnalyze","true"),t.push("/surgery-statistics")},L=e=>e.map(e=>({t:e.timestamp,e:e.error_code,p1:e.param1,p2:e.param2,p3:e.param3,p4:e.param4,exp:e.explanation,ln:e.log_name||s.value.original_name})),z=e=>{if(0===e)return"0 B";const a=1024,t=["B","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,l)).toFixed(2))+" "+t[l]},I=e=>e?new Date(e).toLocaleString("zh-CN"):"-",x=e=>{if(!e)return"-";const a=new Date(e),t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0"),n=String(a.getHours()).padStart(2,"0"),o=String(a.getMinutes()).padStart(2,"0"),s=String(a.getSeconds()).padStart(2,"0");return`${t}-${l}-${r} ${n}:${o}:${s}`},D=e=>{const a={uploaded:"warning",parsed:"success",failed:"danger"};return a[e]||"info"},W=e=>{const a={uploaded:"已上传",parsed:"已解析",failed:"解析失败"};return a[e]||"未知"};return(0,l.sV)(()=>{f(),m()}),{loading:n,loadingProgress:o,logInfo:s,logEntries:i,searchKeyword:d,currentPage:u,pageSize:g,filteredEntries:p,paginatedEntries:c,loadLogInfo:f,loadLogEntries:m,filterEntries:v,exportToCSV:w,handleSizeChange:S,handleCurrentChange:y,goBack:F,goToSurgeryAnalysis:C,formatFileSize:z,formatDate:I,formatTimestamp:x,getStatusType:D,getStatusText:W}}},y=t(6262);const F=(0,y.A)(S,[["render",v],["__scopeId","data-v-da49d4b8"]]);var C=F}}]);
//# sourceMappingURL=222.605e130a.js.map