"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[722],{4722:function(e,a,t){t.r(a),t.d(a,{default:function(){return _}});var l=t(641),n=t(33);const r={class:"data-replay"},o={class:"upload-row"},i={key:0,class:"file-meta"};function d(e,a,t,d,u,s){const c=(0,l.g2)("el-button"),p=(0,l.g2)("el-upload"),f=(0,l.g2)("el-card"),v=(0,l.g2)("el-pagination"),_=(0,l.g2)("el-table-column"),g=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(f,{class:"upload-card"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",o,[(0,l.bF)(p,{action:"","http-request":d.handleUploadRequest,"show-file-list":!1,accept:".bin"},{default:(0,l.k6)(()=>[(0,l.bF)(c,{type:"primary"},{default:(0,l.k6)(()=>a[1]||(a[1]=[(0,l.eW)("上传二进制文件(.bin)")])),_:1,__:[1]})]),_:1},8,["http-request"]),(0,l.bF)(c,{disabled:!d.fileId,onClick:d.downloadCsv,plain:""},{default:(0,l.k6)(()=>a[2]||(a[2]=[(0,l.eW)("下载CSV")])),_:1,__:[2]},8,["disabled","onClick"])]),d.fileName?((0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("span",null,"文件: "+(0,n.v_)(d.fileName),1),(0,l.Lk)("span",null,"大小: "+(0,n.v_)(d.prettySize(d.fileSize)),1),(0,l.Lk)("span",null,"总条数: "+(0,n.v_)(d.totalEntries),1)])):(0,l.Q3)("",!0)]),_:1}),d.rows.length?((0,l.uX)(),(0,l.Wv)(f,{key:0,class:"preview-card"},{default:(0,l.k6)(()=>[(0,l.bF)(v,{background:"",layout:"prev, pager, next","page-size":d.pageSize,total:d.totalEntries,"current-page":d.currentPage,"onUpdate:currentPage":a[0]||(a[0]=e=>d.currentPage=e),onCurrentChange:d.fetchPreview},null,8,["page-size","total","current-page","onCurrentChange"]),(0,l.bF)(g,{data:d.rows,height:"300",style:{width:"100%"},border:""},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(d.columnsToShow,e=>((0,l.uX)(),(0,l.Wv)(_,{key:e.index,prop:e.index,label:e.name,"min-width":"150"},null,8,["prop","label"]))),128))]),_:1},8,["data"])]),_:1})):(0,l.Q3)("",!0)])}var u=t(953),s=t(163),c=t(5495),p={name:"DataReplay",setup(){const e=(0,u.KR)(""),a=(0,u.KR)(""),t=(0,u.KR)(0),n=(0,u.KR)(0),r=(0,u.KR)(1),o=(0,u.KR)(500),i=(0,u.KR)([]),d=(0,u.KR)([]),p=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:e<1073741824?`${(e/1024/1024).toFixed(1)} MB`:`${(e/1024/1024/1024).toFixed(1)} GB`,f=async({file:l,onSuccess:n,onError:o})=>{try{const o=new FormData;o.append("file",l);const{data:i}=await c.A.motionData.upload(o);e.value=i.id,a.value=i.filename,t.value=i.size,r.value=1,await g(1),n&&n(i)}catch(i){s.nk.error("上传失败"),o&&o(i)}},v=async()=>{const{data:e}=await c.A.motionData.getConfig();d.value=e.columns},_=(0,u.KR)([]);(0,l.wB)(d,()=>{const e=["ulint_data",...Array.from({length:7},(e,a)=>`real_data_${a}`),...Array.from({length:7},(e,a)=>`real_data_${a+7}`),...Array.from({length:7},(e,a)=>`real_data_${a+42}`),...Array.from({length:7},(e,a)=>`real_data_${a+49}`),"real_data_18","real_data_19","real_data_20","real_data_25","real_data_26","real_data_27"];_.value=d.value.filter(a=>e.includes(a.index))});const g=async(a=r.value)=>{if(!e.value)return;const t=(a-1)*o.value,{data:l}=await c.A.motionData.preview(e.value,{offset:t,limit:o.value});i.value=l.rows,n.value=l.totalEntries},w=async()=>{if(e.value)try{const{data:t}=await c.A.motionData.downloadCsv(e.value),l=t instanceof Blob?t:new Blob([t],{type:"text/csv;charset=utf-8"}),n=URL.createObjectURL(l),r=document.createElement("a");r.href=n,r.download=(a.value?.replace(/\.bin$/i,"")||"motion")+".csv",r.click(),URL.revokeObjectURL(n)}catch(t){s.nk.error("下载失败")}};return(0,l.sV)(async()=>{await v()}),{fileId:e,fileName:a,fileSize:t,totalEntries:n,currentPage:r,pageSize:o,rows:i,columnsToShow:_,handleUploadRequest:f,fetchPreview:g,downloadCsv:w,prettySize:p}}},f=t(6262);const v=(0,f.A)(p,[["render",d],["__scopeId","data-v-744d9207"]]);var _=v}}]);
//# sourceMappingURL=722.6a1e602f.js.map