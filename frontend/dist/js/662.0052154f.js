"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[662],{7662:function(t,e,s){function r(t){if(!t)return null;try{if("string"===typeof t&&/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2}$/.test(t)){const e=t.replace(" ","T")+"Z",s=new Date(e);return isNaN(s.getTime())?(console.warn("⚠️ 无效的时间格式:",t),t):s.toISOString()}return t}catch(e){return console.warn("⚠️ 时间转换失败:",t,e),t}}function a(t){if(!t)return console.warn("⚠️ 手术数据为空"),null;console.log("🔧 开始适配手术数据:",t);let e=null,s={};if(t.postgresql_row_preview?.structured_data?(e=t.postgresql_row_preview.structured_data,s={surgery_id:t.surgery_id||t.postgresql_row_preview.surgery_id,start_time:r(t.surgery_start_time||t.postgresql_row_preview.start_time),end_time:r(t.surgery_end_time||t.postgresql_row_preview.end_time),is_remote:t.is_remote_surgery||t.postgresql_row_preview.is_remote,has_fault:t.has_error||t.postgresql_row_preview.has_fault,device_ids:t.postgresql_row_preview.device_ids||[],source_log_ids:t.postgresql_row_preview.source_log_ids||[]}):t.structured_data?(e=t.structured_data,s={surgery_id:t.surgery_id,start_time:r(t.start_time),end_time:r(t.end_time),is_remote:t.is_remote,has_fault:t.has_fault,device_ids:t.device_ids||[],source_log_ids:t.source_log_ids||[]}):t.arms||t.surgery_stats||t.power_cycles?(e=t,s={surgery_id:t.surgery_id,start_time:r(t.start_time||t.surgery_start_time),end_time:r(t.end_time||t.surgery_end_time),is_remote:t.is_remote,has_fault:t.has_fault,device_ids:t.device_ids||[],source_log_ids:t.source_log_ids||[]}):(t.arm1_usage||t.state_machine_changes||t.alarm_details)&&(e=_(t),s={surgery_id:t.surgery_id,start_time:r(t.surgery_start_time),end_time:r(t.surgery_end_time),is_remote:t.is_remote_surgery,has_fault:t.has_error,device_ids:[],source_log_ids:t.log_id?[t.log_id]:[]}),!e)return console.warn("⚠️ 无法识别的数据格式:",t),null;const a=n(e),i={...a,...s};return console.log("✅ 手术数据适配完成:",i),i}function _(t){const e={power_cycles:[],arms:[],surgery_stats:{success:!t.has_error,network_latency_ms:[],faults:[],state_machine:[],arm_switch_count:0,left_hand_clutch:0,right_hand_clutch:0,foot_clutch:0,endoscope_pedal:0}};for(let s=1;s<=4;s++){const a=t[`arm${s}_usage`]||[],_=a.map(t=>({tool_type:t.instrumentName||t.tool_type||"未知器械",udi:t.udi||"无UDI",start_time:r(t.startTime||t.start_time),end_time:r(t.endTime||t.end_time),energy_activation:[]}));e.arms.push({arm_id:s,instrument_usage:_})}if(t.state_machine_changes&&Array.isArray(t.state_machine_changes)&&(e.surgery_stats.state_machine=t.state_machine_changes.map(t=>({time:r(t.time),state:t.stateName||String(t.state)}))),t.network_latency_data&&Array.isArray(t.network_latency_data)&&(e.surgery_stats.network_latency_ms=t.network_latency_data.map(t=>({time:r(t.timestamp),latency:t.latency}))),t.alarm_details&&Array.isArray(t.alarm_details)&&(e.surgery_stats.faults=t.alarm_details.map(e=>({timestamp:r(e.time),error_code:e.code,param1:"",param2:"",param3:"",param4:"",explanation:e.message,log_id:t.log_id}))),t.power_on_times&&t.shutdown_times){const s=t.power_on_times,a=t.shutdown_times;let _=0,n=0;while(_<s.length||n<a.length){const t=_<s.length?s[_]:null,i=n<a.length?a[n]:null;e.power_cycles.push({on_time:r(t),off_time:r(i)}),t&&i?(_++,n++):t?_++:n++}}return e}function n(t){const e={arms:t.arms||[],power_cycles:t.power_cycles||[],surgery_stats:{success:t.surgery_stats?.success??!0,network_latency_ms:t.surgery_stats?.network_latency_ms||[],faults:t.surgery_stats?.faults||[],state_machine:t.surgery_stats?.state_machine||[],arm_switch_count:t.surgery_stats?.arm_switch_count||0,left_hand_clutch:t.surgery_stats?.left_hand_clutch||0,right_hand_clutch:t.surgery_stats?.right_hand_clutch||0,foot_clutch:t.surgery_stats?.foot_clutch||0,endoscope_pedal:t.surgery_stats?.endoscope_pedal||0}};Array.isArray(e.arms)||(e.arms=[]);for(let s=0;s<e.arms.length;s++)e.arms[s].arm_id||(e.arms[s].arm_id=s+1),e.arms[s].instrument_usage?e.arms[s].instrument_usage=e.arms[s].instrument_usage.map(t=>({...t,start_time:r(t.start_time),end_time:r(t.end_time)})):e.arms[s].instrument_usage=[];return e.surgery_stats.state_machine&&(e.surgery_stats.state_machine=e.surgery_stats.state_machine.map(t=>({...t,time:r(t.time)}))),e.surgery_stats.network_latency_ms&&(e.surgery_stats.network_latency_ms=e.surgery_stats.network_latency_ms.map(t=>({...t,time:r(t.time)}))),e.surgery_stats.faults&&(e.surgery_stats.faults=e.surgery_stats.faults.map(t=>({...t,timestamp:r(t.timestamp)}))),e.power_cycles&&(e.power_cycles=e.power_cycles.map(t=>({on_time:r(t.on_time),off_time:r(t.off_time)}))),e}function i(t){if(!t)return!1;const e=!!(t.surgery_id&&t.start_time&&t.arms&&t.surgery_stats),s=Array.isArray(t.arms)&&t.arms.length>0;return console.log("🔍 数据验证结果:",{hasRequiredFields:e,hasValidArms:s,armsCount:t.arms?.length||0,stateMachineCount:t.surgery_stats?.state_machine?.length||0,networkLatencyCount:t.surgery_stats?.network_latency_ms?.length||0}),e&&s}function o(t){return t?t.postgresql_row_preview?.structured_data?"surgery_statistics":t.structured_data?"database_record":t.arms||t.surgery_stats||t.power_cycles?"structured_data":t.arm1_usage||t.state_machine_changes||t.alarm_details?"analysis_data":"unknown":"unknown"}s.d(e,{adaptSurgeryData:function(){return a},q:function(){return o},validateAdaptedData:function(){return i}})}}]);
//# sourceMappingURL=662.0052154f.js.map