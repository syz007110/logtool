"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[153],{153:function(e,a,l){l.r(a),l.d(a,{default:function(){return $}});var t=l(641),o=l(33),n=l(3751);const r={class:"logs-container"},s={key:0,class:"overall-progress"},i={class:"progress-stages"},d={class:"el-upload__tip"},c={key:0},u={key:1,class:"parsing-tip"},p={key:1,class:"custom-file-list"},g={class:"file-list-header"},v={class:"file-items"},k={class:"file-name"},b={class:"file-size"},h={class:"key-input-section"},f={class:"key-input-row"},m={key:0,class:"key-file-info"},y={key:1,class:"key-error"},F={class:"device-input-section"},_={class:"device-input-row"},w={key:0,class:"device-error"},C={class:"upload-actions"},L={class:"card-header"},z={class:"header-actions"},E={key:0,class:"batch-actions"},K={key:0,class:"status-tip"},B={class:"pagination-wrapper"};function x(e,a,l,x,D,W){const R=(0,t.g2)("el-progress"),U=(0,t.g2)("upload-filled"),I=(0,t.g2)("el-icon"),A=(0,t.g2)("Refresh"),S=(0,t.g2)("el-upload"),X=(0,t.g2)("el-button"),$=(0,t.g2)("Document"),P=(0,t.g2)("Delete"),M=(0,t.g2)("Key"),T=(0,t.g2)("el-input"),V=(0,t.g2)("Upload"),O=(0,t.g2)("el-tag"),j=(0,t.g2)("Monitor"),Q=(0,t.g2)("el-card"),N=(0,t.g2)("Download"),Z=(0,t.g2)("Search"),H=(0,t.g2)("el-table-column"),Y=(0,t.g2)("Warning"),G=(0,t.g2)("el-table"),q=(0,t.g2)("el-pagination"),J=(0,t.g2)("el-dialog"),ee=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.bF)(Q,{class:"upload-card"},{header:(0,t.k6)(()=>a[4]||(a[4]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"日志上传")],-1)])),default:(0,t.k6)(()=>[x.uploading?((0,t.uX)(),(0,t.CE)("div",s,[(0,t.bF)(R,{percentage:x.overallProgress,status:x.overallProgress>=100?"success":"","stroke-width":12,"show-text":!0,format:x.progressFormat},null,8,["percentage","status","format"]),(0,t.Lk)("div",i,[(0,t.Lk)("span",{class:(0,o.C4)(["stage",{active:x.overallProgress>=0,completed:x.overallProgress>=30}])}," 文件上传 ",2),(0,t.Lk)("span",{class:(0,o.C4)(["stage",{active:x.overallProgress>=30,completed:x.overallProgress>=60}])}," 解密处理 ",2),(0,t.Lk)("span",{class:(0,o.C4)(["stage",{active:x.overallProgress>=60,completed:x.overallProgress>=100}])}," 解析完成 ",2)])])):(0,t.Q3)("",!0),(0,t.bF)(S,{ref:"uploadRef",action:x.uploadUrl,headers:x.uploadHeaders,"before-upload":x.beforeUpload,"on-success":x.onUploadSuccess,"on-error":x.onUploadError,"on-exceed":x.onExceed,"on-change":x.onFileChange,"on-remove":x.onFileRemove,"on-progress":e.onUploadProgress,"auto-upload":!1,"show-file-list":!1,multiple:!0,limit:50,accept:".medbot",drag:"",name:"file",disabled:x.uploading},{tip:(0,t.k6)(()=>[(0,t.Lk)("div",d,[x.uploading?((0,t.uX)(),(0,t.CE)("div",u,[(0,t.bF)(I,{class:"is-loading"},{default:(0,t.k6)(()=>[(0,t.bF)(A)]),_:1}),a[5]||(a[5]=(0,t.eW)(" 正在解析中，请勿刷新页面... "))])):((0,t.uX)(),(0,t.CE)("div",c," 支持上传 .medbot 文件，最多50个文件，总大小不超过200MB，上传后将自动解密并解析 "))])]),default:(0,t.k6)(()=>[(0,t.bF)(I,{class:"el-icon--upload"},{default:(0,t.k6)(()=>[(0,t.bF)(U)]),_:1}),a[6]||(a[6]=(0,t.Lk)("div",{class:"el-upload__text"},[(0,t.eW)(" 将文件拖到此处，或"),(0,t.Lk)("em",null,"点击上传")],-1))]),_:1,__:[6]},8,["action","headers","before-upload","on-success","on-error","on-exceed","on-change","on-remove","on-progress","disabled"]),x.uploadFileList.length>0?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.Lk)("div",g,[(0,t.Lk)("span",null,"已选择的文件 ("+(0,o.v_)(x.uploadFileList.length)+")",1),(0,t.bF)(X,{type:"text",size:"small",onClick:x.clearUpload,disabled:x.uploading},{default:(0,t.k6)(()=>a[7]||(a[7]=[(0,t.eW)(" 清空 ")])),_:1,__:[7]},8,["onClick","disabled"])]),(0,t.Lk)("div",v,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(x.uploadFileList,(e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"file-item"},[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)($)]),_:1}),(0,t.Lk)("span",k,(0,o.v_)(e.name||e.originalname),1),(0,t.Lk)("span",b,(0,o.v_)(x.formatFileSize(e.size||e.raw?.size||0)),1),(0,t.bF)(X,{type:"text",size:"small",onClick:e=>x.removeFile(a),disabled:x.uploading},{default:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(P)]),_:1})]),_:2},1032,["onClick","disabled"])]))),128))])])):(0,t.Q3)("",!0),(0,t.Lk)("div",h,[(0,t.Lk)("div",f,[(0,t.bF)(T,{modelValue:x.decryptKey,"onUpdate:modelValue":a[0]||(a[0]=e=>x.decryptKey=e),placeholder:"请输入解密密钥（MAC地址格式，如：00-01-05-77-6a-09）",style:{width:"300px"},clearable:"",onBlur:x.validateKeyFormat},{prefix:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(M)]),_:1})]),_:1},8,["modelValue","onBlur"]),(0,t.bF)(X,{type:"primary",plain:"",onClick:x.autoFillDeviceId,disabled:!x.decryptKey.trim()},{default:(0,t.k6)(()=>a[8]||(a[8]=[(0,t.eW)(" 自动填充设备编号 ")])),_:1,__:[8]},8,["onClick","disabled"]),a[10]||(a[10]=(0,t.Lk)("span",{class:"key-separator"},"或",-1)),(0,t.bF)(S,{ref:"keyUploadRef","auto-upload":!1,"show-file-list":!1,accept:".txt","before-upload":x.beforeKeyUpload,"on-change":x.onKeyFileChange},{default:(0,t.k6)(()=>[(0,t.bF)(X,{type:"primary",plain:""},{default:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(V)]),_:1}),a[9]||(a[9]=(0,t.eW)(" 上传密钥文件 "))]),_:1,__:[9]})]),_:1},8,["before-upload","on-change"])]),x.keyFileName?((0,t.uX)(),(0,t.CE)("div",m,[(0,t.bF)(O,{type:"success",size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)($)]),_:1}),(0,t.eW)(" "+(0,o.v_)(x.keyFileName),1)]),_:1})])):(0,t.Q3)("",!0),x.keyError?((0,t.uX)(),(0,t.CE)("div",y,[(0,t.bF)(O,{type:"danger",size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(x.keyError),1)]),_:1})])):(0,t.Q3)("",!0)]),(0,t.Lk)("div",F,[(0,t.Lk)("div",_,[(0,t.bF)(T,{modelValue:x.deviceId,"onUpdate:modelValue":a[1]||(a[1]=e=>x.deviceId=e),placeholder:"设备编号（格式：数字或字母组合，例：4371-01、ABC-12，默认为0000-00）",style:{width:"300px"},clearable:"",onBlur:x.validateDeviceIdFormat},{prefix:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(j)]),_:1})]),_:1},8,["modelValue","onBlur"]),(0,t.bF)(X,{type:"primary",plain:"",onClick:x.autoFillKey,disabled:!x.deviceId.trim()},{default:(0,t.k6)(()=>a[11]||(a[11]=[(0,t.eW)(" 自动填充密钥 ")])),_:1,__:[11]},8,["onClick","disabled"])]),x.deviceIdError?((0,t.uX)(),(0,t.CE)("div",w,[(0,t.bF)(O,{type:"danger",size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(x.deviceIdError),1)]),_:1})])):(0,t.Q3)("",!0)]),(0,t.Lk)("div",C,[(0,t.bF)(X,{type:"primary",onClick:x.submitUpload,loading:x.uploading,disabled:x.uploading||!x.decryptKey.trim()||0===x.uploadFileList.length},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(x.uploading?"解析中...":"上传并解析"),1)]),_:1},8,["onClick","loading","disabled"])])]),_:1}),(0,t.bF)(Q,{class:"list-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",L,[a[14]||(a[14]=(0,t.Lk)("span",null,"日志列表",-1)),(0,t.Lk)("div",z,[x.selectedLogs.length>0?((0,t.uX)(),(0,t.CE)("div",E,[(0,t.bF)(X,{type:"primary",size:"small",onClick:x.handleBatchAnalyze,disabled:!x.canBatchOperate},{default:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(j)]),_:1}),(0,t.eW)(" 批量分析 ("+(0,o.v_)(x.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled"]),(0,t.bF)(X,{type:"success",size:"small",onClick:x.handleBatchDownload,disabled:!x.canBatchOperate},{default:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(N)]),_:1}),(0,t.eW)(" 批量下载 ("+(0,o.v_)(x.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled"]),(0,t.bF)(X,{type:"danger",size:"small",onClick:x.handleBatchDelete,disabled:!x.canBatchDelete},{default:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(P)]),_:1}),(0,t.eW)(" 批量删除 ("+(0,o.v_)(x.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled"]),(0,t.bF)(X,{type:"info",size:"small",onClick:x.clearSelection},{default:(0,t.k6)(()=>a[12]||(a[12]=[(0,t.eW)(" 取消选择 ")])),_:1,__:[12]},8,["onClick"])])):(0,t.Q3)("",!0),(0,t.bF)(T,{modelValue:x.filterDeviceId,"onUpdate:modelValue":a[2]||(a[2]=e=>x.filterDeviceId=e),placeholder:"按设备编号筛选",style:{width:"200px","margin-right":"10px"},clearable:"",onKeyup:(0,n.jR)(x.loadLogs,["enter"])},{prefix:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(Z)]),_:1})]),_:1},8,["modelValue","onKeyup"]),(0,t.bF)(X,{type:"primary",size:"small",onClick:x.loadLogs},{default:(0,t.k6)(()=>[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(A)]),_:1}),a[13]||(a[13]=(0,t.eW)(" 刷新 "))]),_:1,__:[13]},8,["onClick"])])])]),default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(G,{data:x.logs,loading:x.loading,style:{width:"100%"},onSelectionChange:x.handleSelectionChange},{default:(0,t.k6)(()=>[(0,t.bF)(H,{type:"selection",width:"55"}),(0,t.bF)(H,{prop:"original_name",label:"原始文件名",width:"200"}),(0,t.bF)(H,{prop:"device_id",label:"设备编号",width:"120"}),(0,t.bF)(H,{prop:"uploader_id",label:"上传用户ID",width:"100"}),(0,t.bF)(H,{prop:"upload_time",label:"上传时间",width:"180"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,o.v_)(x.formatDate(e.upload_time)),1)]),_:1}),(0,t.bF)(H,{label:"状态",width:"120",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(O,{type:x.getStatusType(e.status),size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(x.getStatusText(e.status)),1)]),_:2},1032,["type"]),x.canOperate(e)?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",K,[(0,t.bF)(I,null,{default:(0,t.k6)(()=>[(0,t.bF)(Y)]),_:1}),a[15]||(a[15]=(0,t.Lk)("span",null,"处理中，请稍候",-1))]))]),_:1}),(0,t.bF)(H,{label:"操作",width:"240",fixed:"right"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(X,{size:"small",type:"primary",onClick:a=>x.goToLogAnalysis(e),disabled:!x.canOperate(e)},{default:(0,t.k6)(()=>a[16]||(a[16]=[(0,t.eW)(" 分析 ")])),_:2,__:[16]},1032,["onClick","disabled"]),(0,t.bF)(X,{size:"small",type:"success",onClick:a=>x.handleDownload(e),disabled:!x.canOperate(e)},{default:(0,t.k6)(()=>a[17]||(a[17]=[(0,t.eW)(" 下载 ")])),_:2,__:[17]},1032,["onClick","disabled"]),x.canDeleteLog(e)?((0,t.uX)(),(0,t.Wv)(X,{key:0,size:"small",type:"danger",onClick:a=>x.handleDelete(e),disabled:!x.canOperate(e)},{default:(0,t.k6)(()=>a[18]||(a[18]=[(0,t.eW)(" 删除 ")])),_:2,__:[18]},1032,["onClick","disabled"])):(0,t.Q3)("",!0)]),_:1})]),_:1},8,["data","loading","onSelectionChange"])),[[ee,x.loading]]),(0,t.Lk)("div",B,[(0,t.bF)(q,{"current-page":x.currentPage,"page-size":x.pageSize,"page-sizes":[10,20,50,100],total:x.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:x.handleSizeChange,onCurrentChange:x.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),(0,t.bF)(J,{modelValue:e.showEntriesDialog,"onUpdate:modelValue":a[3]||(a[3]=a=>e.showEntriesDialog=a),title:"日志分析",width:"900px"},{default:(0,t.k6)(()=>[(0,t.bF)(G,{data:e.logEntries,style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(H,{prop:"timestamp",label:"时间戳",width:"180"}),(0,t.bF)(H,{prop:"error_code",label:"故障码",width:"100"}),(0,t.bF)(H,{prop:"param1",label:"参数1",width:"100"}),(0,t.bF)(H,{prop:"param2",label:"参数2",width:"100"}),(0,t.bF)(H,{prop:"param3",label:"参数3",width:"100"}),(0,t.bF)(H,{prop:"param4",label:"参数4",width:"100"}),(0,t.bF)(H,{prop:"explanation",label:"日志解释"})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}var D=l(953),W=l(6278),R=l(5220),U=l(163),I=l(7918),A={name:"Logs",setup(){const e=(0,W.Pj)(),a=(0,R.rd)(),l=(0,D.KR)(!1),o=(0,D.KR)(!1),n=(0,D.KR)(0),r=(0,D.KR)(null),s=(0,D.KR)(null),i=(0,D.KR)(1),d=(0,D.KR)(20),c=(0,D.KR)(""),u=(0,D.KR)(""),p=(0,D.KR)(""),g=(0,D.KR)(""),v=(0,D.KR)([]),k=(0,D.KR)(""),b=(0,D.KR)(""),h=(0,D.KR)([]),f=(0,t.EW)(()=>e.getters["logs/logsList"]),m=(0,t.EW)(()=>e.getters["logs/totalCount"]),y=(0,t.EW)(()=>"/api/logs/upload"),F=(0,t.EW)(()=>({Authorization:`Bearer ${e.state.auth.token}`,"X-Decrypt-Key":c.value,"X-Device-ID":p.value})),_=(0,t.EW)(()=>e.state.auth.user?.role_id),w=(0,t.EW)(()=>e.state.auth.user?.id),C=(0,t.EW)(()=>h.value.length>0&&h.value.every(e=>se(e))),L=(0,t.EW)(()=>h.value.length>0&&h.value.every(e=>z(e))),z=e=>1===_.value||(2===_.value||3===_.value&&e.uploader_id===w.value),E=async()=>{try{l.value=!0,await e.dispatch("logs/fetchLogs",{page:i.value,limit:d.value,device_id:g.value||void 0})}catch(a){U.nk.error("加载日志失败")}finally{l.value=!1}},K=e=>{d.value=e,i.value=1,E()},B=e=>{i.value=e,E()},x=()=>{if(!c.value.trim())return void U.nk.error("请输入解密密钥或上传密钥文件");const e=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;if(!e.test(c.value))return void U.nk.error("密钥格式不正确，应为MAC地址格式（如：00-01-05-77-6a-09）");if(!p.value.trim())return void U.nk.warning("请输入设备编号，或使用默认值0000-00");if(!p.value||"0000-00"===p.value)return void U.nk.warning("请输入设备编号，或使用默认值0000-00");{const e=/^[0-9A-Za-z]+-[0-9A-Za-z]+$/;if(!e.test(p.value))return void U.nk.error("设备编号格式不正确，应为数字或字母组合格式（如：4371-01、ABC-12、123-XY）")}if(!r.value)return void U.nk.error("上传组件未初始化");if(0===v.value.length)return void U.nk.error("请选择要上传的文件");if(v.value.length>50)return void U.nk.error("最多只能上传50个文件");const a=v.value.reduce((e,a)=>e+(a.size||a.raw?.size||0),0);a/1024/1024>200?U.nk.error("总文件大小不能超过200MB"):r.value.submit()},A=e=>{const a=e.name.endsWith(".medbot"),l=e.size/1024/1024<200;return a?l?!!c.value.trim()||(U.nk.error("请输入解密密钥或上传密钥文件!"),!1):(U.nk.error("单个文件大小不能超过200MB!"),!1):(U.nk.error("只能上传 .medbot 文件!"),!1)},S=e=>{const a=e.name.endsWith(".txt"),l="systemInfo.txt"===e.name,t=e.size/1024/1024<1;return a?l?(t||U.nk.error("密钥文件大小不能超过1MB!"),!1):(U.nk.error("密钥文件名必须是 systemInfo.txt!"),!1):(U.nk.error("密钥文件必须是 .txt 格式!"),!1)},X=e=>{const a=new FileReader;a.onload=a=>{const l=a.target.result.trim(),t=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;t.test(l)?(c.value=l,u.value=e.name,k.value="",U.nk.success("密钥文件读取成功")):U.nk.error("密钥文件内容格式不正确，应为MAC地址格式（如：00-01-05-77-6a-09）")},a.readAsText(e.raw)},$=()=>{r.value&&r.value.clearFiles(),s.value&&s.value.clearFiles(),v.value=[],c.value="",u.value="",p.value="",k.value="",b.value="",o.value=!1,n.value=0},P=e=>e<30?`文件上传中 ${e}%`:e<60?`解密处理中 ${e}%`:e<100?`解析处理中 ${e}%`:`处理完成 ${e}%`,M=()=>{if(o.value)return"解析正在进行中，刷新页面可能导致解析失败。确定要离开吗？"};(0,t.sV)(()=>{window.addEventListener("beforeunload",M)});const T=(e,a,l)=>{if(v.value=l,0===l.length){o.value=!0,U.nk.success("文件上传完成，正在解密和解析中...");let e=30,a=0;const l=setInterval(()=>{e<60?(e+=2,n.value=e):(clearInterval(l),t())},100),t=()=>{const e=setInterval(()=>{a<40?(a+=1,n.value=60+a):(clearInterval(e),r())},200)},r=async()=>{try{await E();const e=f.value.every(e=>"parsed"===e.status);if(e){n.value=100,o.value=!1;const e=v.value.map(e=>e.name||e.originalname).join(", ");U.nk.success(`${e} 上传成功，解析完成`),$()}else setTimeout(r,1e3)}catch(e){o.value=!1,n.value=0,U.nk.error("检查解析状态失败"),$()}};setTimeout(()=>{},500)}else U.nk.success(`文件 ${a.name} 上传成功，正在处理中...`)},V=e=>{U.nk.error("上传失败: "+(e.message||"未知错误"))},O=(e,a)=>{U.nk.error("最多只能上传50个文件!")},j=(e,a)=>{v.value=a},Q=(e,a)=>{v.value=a},N=e=>{v.value.splice(e,1)},Z=async a=>{try{a.parsing=!0,await e.dispatch("logs/parseLog",a.id),U.nk.success("解析成功"),E()}catch(l){U.nk.error("解析失败")}finally{a.parsing=!1}},H=async a=>{try{const l=await e.dispatch("logs/downloadLog",a.id),t=new Blob([l.data]),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=a.filename,n.click(),window.URL.revokeObjectURL(o),U.nk.success("下载成功")}catch(l){U.nk.error("下载失败")}},Y=async a=>{try{await I.s.confirm("确定要删除这个日志文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await e.dispatch("logs/deleteLog",a.id),U.nk.success("删除成功"),E()}catch(l){"cancel"!==l&&U.nk.error("删除失败")}},G=e=>{const l=a.resolve(`/analysis/${e.id}`);window.open(l.href,"_blank")},q=e=>{if(0===e)return"0 B";const a=1024,l=["B","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,t)).toFixed(2))+" "+l[t]},J=e=>e?new Date(e).toLocaleString("zh-CN"):"-",ee=e=>{const a={uploading:"warning",decrypting:"warning",parsing:"warning",parsed:"success",failed:"danger"};return a[e]||"info"},ae=e=>{const a={uploading:"上传中",decrypting:"解密中",parsing:"解析中",parsed:"完成",failed:"解析失败"};return a[e]||e},le=e=>{h.value=e},te=()=>{h.value=[]},oe=()=>{const e=h.value.map(e=>e.id).join(","),l=a.resolve(`/batch-analysis/${e}`);window.open(l.href,"_blank")},ne=async()=>{try{U.nk.info("开始批量下载...");for(const l of h.value)try{const a=await e.dispatch("logs/downloadLog",l.id),t=new Blob([a.data]),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=l.original_name.replace(".medbot","_decrypted.txt"),n.click(),window.URL.revokeObjectURL(o),await new Promise(e=>setTimeout(e,500))}catch(a){console.error(`下载日志 ${l.original_name} 失败:`,a),U.nk.warning(`下载日志 ${l.original_name} 失败`)}U.nk.success("批量下载完成")}catch(a){U.nk.error("批量下载失败")}},re=async()=>{try{await I.s.confirm(`确定要删除选中的 ${h.value.length} 个日志文件吗？此操作不可恢复！`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),U.nk.info("开始批量删除...");const a=h.value.map(e=>e.id),l=await e.dispatch("logs/batchDeleteLogs",a);U.nk.success(l.data.message),E(),te()}catch(a){"cancel"!==a&&U.nk.error("批量删除失败")}},se=e=>"parsed"===e.status,ie=async()=>{try{const a=await e.dispatch("logs/autoFillKey",p.value);a.data.key?(c.value=a.data.key,U.nk.success("已自动填充密钥")):U.nk.warning("未找到该设备编号对应的密钥")}catch(a){console.error("自动填充密钥错误:",a);const e=a.response?.data?.message||a.message||"自动填充密钥失败";U.nk.error(e)}},de=()=>{const e=/^([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}$/;c.value&&!e.test(c.value)?k.value="请输入有效的MAC地址格式密钥 (如: 00-01-05-77-6a-09)":k.value=""},ce=async()=>{try{const a=await e.dispatch("logs/autoFillDeviceId",c.value);a.data.device_id?(p.value=a.data.device_id,U.nk.success("已自动填充设备编号")):U.nk.warning("未找到该密钥对应的设备编号")}catch(a){console.error("自动填充设备编号错误:",a);const e=a.response?.data?.message||a.message||"自动填充设备编号失败";U.nk.error(e)}},ue=()=>{const e=/^[0-9A-Za-z]+-[0-9A-Za-z]+$/;p.value&&!e.test(p.value)?b.value="请输入有效的设备编号格式 (如: 4371-01、ABC-12、123-XY)":b.value=""};return(0,t.sV)(()=>{E()}),{loading:l,uploading:o,overallProgress:n,progressFormat:P,uploadRef:r,currentPage:i,pageSize:d,logs:f,total:m,uploadUrl:y,uploadHeaders:F,loadLogs:E,handleSizeChange:K,handleCurrentChange:B,beforeUpload:A,submitUpload:x,clearUpload:$,onUploadSuccess:T,onUploadError:V,onExceed:O,onFileChange:j,onFileRemove:Q,removeFile:N,handleParse:Z,handleDownload:H,handleDelete:Y,formatFileSize:q,formatDate:J,getStatusType:ee,getStatusText:ae,goToLogAnalysis:G,decryptKey:c,keyUploadRef:s,keyFileName:u,deviceId:p,filterDeviceId:g,uploadFileList:v,beforeKeyUpload:S,onKeyFileChange:X,canDeleteLog:z,canOperate:se,keyError:k,deviceIdError:b,autoFillKey:ie,validateKeyFormat:de,autoFillDeviceId:ce,validateDeviceIdFormat:ue,selectedLogs:h,canBatchOperate:C,canBatchDelete:L,handleSelectionChange:le,clearSelection:te,handleBatchAnalyze:oe,handleBatchDownload:ne,handleBatchDelete:re}}},S=l(6262);const X=(0,S.A)(A,[["render",x],["__scopeId","data-v-6cf97f4f"]]);var $=X}}]);
//# sourceMappingURL=153.65baccb7.js.map