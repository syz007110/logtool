"use strict";(self["webpackChunklogtool_frontend"]=self["webpackChunklogtool_frontend"]||[]).push([[619],{4619:function(e,l,a){a.r(l),a.d(l,{default:function(){return b}});var o=a(641),t=a(33);const s={class:"roles-container"},n={class:"action-bar"};function r(e,l,a,r,i,d){const u=(0,o.g2)("Plus"),c=(0,o.g2)("el-icon"),m=(0,o.g2)("el-button"),p=(0,o.g2)("el-table-column"),g=(0,o.g2)("el-table"),k=(0,o.g2)("el-card"),b=(0,o.g2)("el-input"),f=(0,o.g2)("el-form-item"),h=(0,o.g2)("el-checkbox"),F=(0,o.g2)("el-col"),v=(0,o.g2)("el-row"),w=(0,o.g2)("el-checkbox-group"),_=(0,o.g2)("el-form"),y=(0,o.g2)("el-dialog"),R=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.Lk)("div",n,[(0,o.bF)(m,{type:"primary",onClick:l[0]||(l[0]=e=>r.showAddDialog=!0)},{default:(0,o.k6)(()=>[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(u)]),_:1}),l[6]||(l[6]=(0,o.eW)(" 添加角色 ",-1))]),_:1})]),(0,o.bF)(k,{class:"list-card"},{default:(0,o.k6)(()=>[(0,o.bo)(((0,o.uX)(),(0,o.Wv)(g,{data:r.roles,loading:r.loading,style:{width:"100%"}},{default:(0,o.k6)(()=>[(0,o.bF)(p,{prop:"name",label:"角色名称",width:"150"}),(0,o.bF)(p,{prop:"description",label:"角色描述","show-overflow-tooltip":""}),(0,o.bF)(p,{label:"操作",width:"150",fixed:"right"},{default:(0,o.k6)(({row:e})=>[(0,o.bF)(m,{size:"small",onClick:l=>r.handleEdit(e)},{default:(0,o.k6)(()=>[...l[7]||(l[7]=[(0,o.eW)(" 编辑 ",-1)])]),_:2},1032,["onClick"]),(0,o.bF)(m,{size:"small",type:"danger",onClick:l=>r.handleDelete(e)},{default:(0,o.k6)(()=>[...l[8]||(l[8]=[(0,o.eW)(" 删除 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])),[[R,r.loading]])]),_:1}),(0,o.bF)(y,{modelValue:r.showAddDialog,"onUpdate:modelValue":l[5]||(l[5]=e=>r.showAddDialog=e),title:r.editingRole?"编辑角色":"添加角色",width:"600px"},{footer:(0,o.k6)(()=>[(0,o.bF)(m,{onClick:l[4]||(l[4]=e=>r.showAddDialog=!1)},{default:(0,o.k6)(()=>[...l[9]||(l[9]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(m,{type:"primary",onClick:r.handleSave,loading:r.saving},{default:(0,o.k6)(()=>[...l[10]||(l[10]=[(0,o.eW)(" 保存 ",-1)])]),_:1},8,["onClick","loading"])]),default:(0,o.k6)(()=>[(0,o.bF)(_,{ref:"roleFormRef",model:r.roleForm,rules:r.rules,"label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{label:"角色名称",prop:"name"},{default:(0,o.k6)(()=>[(0,o.bF)(b,{modelValue:r.roleForm.name,"onUpdate:modelValue":l[1]||(l[1]=e=>r.roleForm.name=e)},null,8,["modelValue"])]),_:1}),(0,o.bF)(f,{label:"角色描述",prop:"description"},{default:(0,o.k6)(()=>[(0,o.bF)(b,{modelValue:r.roleForm.description,"onUpdate:modelValue":l[2]||(l[2]=e=>r.roleForm.description=e),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),(0,o.bF)(f,{label:"权限",prop:"permissions"},{default:(0,o.k6)(()=>[(0,o.bF)(w,{modelValue:r.roleForm.permissions,"onUpdate:modelValue":l[3]||(l[3]=e=>r.roleForm.permissions=e)},{default:(0,o.k6)(()=>[(0,o.bF)(v,{gutter:20},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.permissionGroups,(e,l)=>((0,o.uX)(),(0,o.Wv)(F,{span:12,key:l,style:{"margin-bottom":"10px"}},{default:(0,o.k6)(()=>[(0,o.Lk)("h4",null,(0,t.v_)(l),1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e,e=>((0,o.uX)(),(0,o.Wv)(h,{key:e.name,value:e.name},{default:(0,o.k6)(()=>[(0,o.eW)((0,t.v_)(e.name),1)]),_:2},1032,["value"]))),128))]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}var i=a(953),d=a(6278),u=a(163),c=a(7918),m=a(5495),p={name:"Roles",setup(){const e=(0,d.Pj)(),l=(0,i.KR)(!1),a=(0,i.KR)(!1),t=(0,i.KR)(!1),s=(0,i.KR)(null),n=(0,i.KR)([]),r=(0,i.KR)(null),p=(0,i.Kh)({name:"",description:"",permissions:[]}),g={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]},k=(0,o.EW)(()=>e.getters["users/rolesList"]),b=(0,o.EW)(()=>{const e={};for(const l of n.value){const a=l.name.includes(":")?l.name.split(":")[0]:"其他";e[a]||(e[a]=[]),e[a].push(l)}return e}),f=async()=>{l.value=!0;try{await e.dispatch("users/fetchRoles")}catch(a){u.nk.error("加载角色失败")}finally{l.value=!1}},h=async()=>{try{const e=await m.A.permissions.getList();n.value=e.data.permissions||[]}catch(e){u.nk.error("加载权限清单失败")}},F=()=>{Object.assign(p,{name:"",description:"",permissions:[]}),s.value=null},v=e=>{s.value=e,Object.assign(p,{name:e.name,description:e.description,permissions:e.permissions||[]}),t.value=!0},w=async l=>{try{await c.s.confirm("确定要删除这个角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await e.dispatch("users/deleteRole",l.id),u.nk.success("删除成功"),f()}catch(a){"cancel"!==a&&u.nk.error("删除失败")}},_=async()=>{try{a.value=!0,s.value?(await e.dispatch("users/updateRole",{id:s.value.id,data:p}),u.nk.success("更新成功")):(await e.dispatch("users/createRole",p),u.nk.success("添加成功")),t.value=!1,F(),f()}catch(l){u.nk.error("保存失败")}finally{a.value=!1}};return(0,o.sV)(()=>{f(),h()}),{loading:l,saving:a,showAddDialog:t,editingRole:s,roleForm:p,roleFormRef:r,rules:g,roles:k,permissions:n,permissionGroups:b,handleEdit:v,handleDelete:w,handleSave:_}}},g=a(6262);const k=(0,g.A)(p,[["render",r],["__scopeId","data-v-065c4e25"]]);var b=k}}]);
//# sourceMappingURL=619.73292b69.js.map